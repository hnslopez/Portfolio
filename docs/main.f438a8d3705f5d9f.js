"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[179],{328:(f3,m3,mn)=>{function wi(e){return"function"==typeof e}function j0(e){const i=e(n=>{Error.call(n),n.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const ed=j0(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((n,r)=>`${r+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function jh(e,t){if(e){const i=e.indexOf(t);0<=i&&e.splice(i,1)}}class Vi{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const o of i)o.remove(this);else i.remove(this);const{initialTeardown:n}=this;if(wi(n))try{n()}catch(o){t=o instanceof ed?o.errors:[o]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const o of r)try{nd(o)}catch(s){t=t??[],s instanceof ed?t=[...t,...s.errors]:t.push(s)}}if(t)throw new ed(t)}}add(t){var i;if(t&&t!==this)if(this.closed)nd(t);else{if(t instanceof Vi){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(t)}}_hasParent(t){const{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){const{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&jh(i,t)}remove(t){const{_finalizers:i}=this;i&&jh(i,t),t instanceof Vi&&t._removeParent(this)}}Vi.EMPTY=(()=>{const e=new Vi;return e.closed=!0,e})();const td=Vi.EMPTY;function id(e){return e instanceof Vi||e&&"closed"in e&&wi(e.remove)&&wi(e.add)&&wi(e.unsubscribe)}function nd(e){wi(e)?e():e.unsubscribe()}const Us={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Tl={setTimeout(e,t,...i){const{delegate:n}=Tl;return n?.setTimeout?n.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){const{delegate:t}=Tl;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function zc(e){Tl.setTimeout(()=>{const{onUnhandledError:t}=Us;if(!t)throw e;t(e)})}function Yh(){}const RK=J5("C",void 0,void 0);function J5(e,t,i){return{kind:e,value:t,error:i}}let rd=null;function g3(e){if(Us.useDeprecatedSynchronousErrorHandling){const t=!rd;if(t&&(rd={errorThrown:!1,error:null}),e(),t){const{errorThrown:i,error:n}=rd;if(rd=null,i)throw n}}else e()}class e7 extends Vi{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,id(t)&&t.add(this)):this.destination=YK}static create(t,i,n){return new Y0(t,i,n)}next(t){this.isStopped?n7(function BK(e){return J5("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?n7(function FK(e){return J5("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?n7(RK,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const HK=Function.prototype.bind;function t7(e,t){return HK.call(e,t)}class UK{constructor(t){this.partialObserver=t}next(t){const{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(n){v3(n)}}error(t){const{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(n){v3(n)}else v3(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){v3(i)}}}class Y0 extends e7{constructor(t,i,n){let r;if(super(),wi(t)||!t)r={next:t??void 0,error:i??void 0,complete:n??void 0};else{let o;this&&Us.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&t7(t.next,o),error:t.error&&t7(t.error,o),complete:t.complete&&t7(t.complete,o)}):r=t}this.destination=new UK(r)}}function v3(e){Us.useDeprecatedSynchronousErrorHandling?function VK(e){Us.useDeprecatedSynchronousErrorHandling&&rd&&(rd.errorThrown=!0,rd.error=e)}(e):zc(e)}function n7(e,t){const{onStoppedNotification:i}=Us;i&&Tl.setTimeout(()=>i(e,t))}const YK={closed:!0,next:Yh,error:function jK(e){throw e},complete:Yh},r7="function"==typeof Symbol&&Symbol.observable||"@@observable";function Tc(e){return e}function WE(e){return 0===e.length?Tc:1===e.length?e[0]:function(i){return e.reduce((n,r)=>r(n),i)}}let Li=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,r){const o=function qK(e){return e&&e instanceof e7||function WK(e){return e&&wi(e.next)&&wi(e.error)&&wi(e.complete)}(e)&&id(e)}(i)?i:new Y0(i,n,r);return g3(()=>{const{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(i){try{return this._subscribe(i)}catch(n){i.error(n)}}forEach(i,n){return new(n=qE(n))((r,o)=>{const s=new Y0({next:a=>{try{i(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(i){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(i)}[r7](){return this}pipe(...i){return WE(i)(this)}toPromise(i){return new(i=qE(i))((n,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>n(o))})}}return e.create=t=>new e(t),e})();function qE(e){var t;return null!==(t=e??Us.Promise)&&void 0!==t?t:Promise}const XK=j0(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let He=(()=>{class e extends Li{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const n=new XE(this,this);return n.operator=i,n}_throwIfClosed(){if(this.closed)throw new XK}next(i){g3(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(i)}})}error(i){g3(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:n}=this;for(;n.length;)n.shift().error(i)}})}complete(){g3(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:n,isStopped:r,observers:o}=this;return n||r?td:(this.currentObservers=null,o.push(i),new Vi(()=>{this.currentObservers=null,jh(o,i)}))}_checkFinalizedStatuses(i){const{hasError:n,thrownError:r,isStopped:o}=this;n?i.error(r):o&&i.complete()}asObservable(){const i=new Li;return i.source=this,i}}return e.create=(t,i)=>new XE(t,i),e})();class XE extends He{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===n||n.call(i,t)}error(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===n||n.call(i,t)}complete(){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===i||i.call(t)}_subscribe(t){var i,n;return null!==(n=null===(i=this.source)||void 0===i?void 0:i.subscribe(t))&&void 0!==n?n:td}}function $E(e){return wi(e?.lift)}function Mn(e){return t=>{if($E(t))return t.lift(function(i){try{return e(i,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function $i(e,t,i,n,r){return new $K(e,t,i,n,r)}class $K extends e7{constructor(t,i,n,r,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=i?function(a){try{i(a)}catch(l){t.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function bt(e,t){return Mn((i,n)=>{let r=0;i.subscribe($i(n,o=>{n.next(e.call(t,o,r++))}))})}function Qe(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}function od(e){return this instanceof od?(this.v=e,this):new od(e)}function JK(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function KE(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(o){i[o]=e[o]&&function(s){return new Promise(function(a,l){!function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}(a,l,(s=e[o](s)).done,s.value)})}}}const s7=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function JE(e){return wi(e?.then)}function eD(e){return wi(e[r7])}function tD(e){return Symbol.asyncIterator&&wi(e?.[Symbol.asyncIterator])}function iD(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const nD=function tJ(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function rD(e){return wi(e?.[nD])}function oD(e){return function KK(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(d){n[d]&&(r[d]=function(p){return new Promise(function(f,m){o.push([d,p,f,m])>1||a(d,p)})})}function a(d,p){try{!function l(d){d.value instanceof od?Promise.resolve(d.value.v).then(c,h):u(o[0][2],d)}(n[d](p))}catch(f){u(o[0][3],f)}}function c(d){a("next",d)}function h(d){a("throw",d)}function u(d,p){d(p),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:n,done:r}=yield od(i.read());if(r)return yield od(void 0);yield yield od(n)}}finally{i.releaseLock()}})}function sD(e){return wi(e?.getReader)}function eo(e){if(e instanceof Li)return e;if(null!=e){if(eD(e))return function iJ(e){return new Li(t=>{const i=e[r7]();if(wi(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(s7(e))return function nJ(e){return new Li(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}(e);if(JE(e))return function rJ(e){return new Li(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,zc)})}(e);if(tD(e))return aD(e);if(rD(e))return function oJ(e){return new Li(t=>{for(const i of e)if(t.next(i),t.closed)return;t.complete()})}(e);if(sD(e))return function sJ(e){return aD(oD(e))}(e)}throw iD(e)}function aD(e){return new Li(t=>{(function aJ(e,t){var i,n,r,o;return function QK(e,t,i,n){return new(i||(i=Promise))(function(o,s){function a(h){try{c(n.next(h))}catch(u){s(u)}}function l(h){try{c(n.throw(h))}catch(u){s(u)}}function c(h){h.done?o(h.value):function r(o){return o instanceof i?o:new i(function(s){s(o)})}(h.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(i=JK(e);!(n=yield i.next()).done;)if(t.next(n.value),t.closed)return}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&(yield o.call(i))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(i=>t.error(i))})}function Ec(e,t,i,n=0,r=!1){const o=t.schedule(function(){i(),r?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!r)return o}function xr(e,t,i=1/0){return wi(t)?xr((n,r)=>bt((o,s)=>t(n,o,r,s))(eo(e(n,r))),i):("number"==typeof t&&(i=t),Mn((n,r)=>function lJ(e,t,i,n,r,o,s,a){const l=[];let c=0,h=0,u=!1;const d=()=>{u&&!l.length&&!c&&t.complete()},p=m=>c<n?f(m):l.push(m),f=m=>{o&&t.next(m),c++;let g=!1;eo(i(m,h++)).subscribe($i(t,v=>{r?.(v),o?p(v):t.next(v)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<n;){const v=l.shift();s?Ec(t,s,()=>f(v)):f(v)}d()}catch(v){t.error(v)}}))};return e.subscribe($i(t,p,()=>{u=!0,d()})),()=>{a?.()}}(n,r,e,i)))}function F1(e=1/0){return xr(Tc,e)}const js=new Li(e=>e.complete());function lD(e){return e&&wi(e.schedule)}function a7(e){return e[e.length-1]}function l7(e){return wi(a7(e))?e.pop():void 0}function G0(e){return lD(a7(e))?e.pop():void 0}function cD(e,t=0){return Mn((i,n)=>{i.subscribe($i(n,r=>Ec(n,e,()=>n.next(r),t),()=>Ec(n,e,()=>n.complete(),t),r=>Ec(n,e,()=>n.error(r),t)))})}function hD(e,t=0){return Mn((i,n)=>{n.add(e.schedule(()=>i.subscribe(n),t))})}function uD(e,t){if(!e)throw new Error("Iterable cannot be null");return new Li(i=>{Ec(i,t,()=>{const n=e[Symbol.asyncIterator]();Ec(i,t,()=>{n.next().then(r=>{r.done?i.complete():i.next(r.value)})},0,!0)})})}function Wn(e,t){return t?function gJ(e,t){if(null!=e){if(eD(e))return function uJ(e,t){return eo(e).pipe(hD(t),cD(t))}(e,t);if(s7(e))return function pJ(e,t){return new Li(i=>{let n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})})}(e,t);if(JE(e))return function dJ(e,t){return eo(e).pipe(hD(t),cD(t))}(e,t);if(tD(e))return uD(e,t);if(rD(e))return function fJ(e,t){return new Li(i=>{let n;return Ec(i,t,()=>{n=e[nD](),Ec(i,t,()=>{let r,o;try{({value:r,done:o}=n.next())}catch(s){return void i.error(s)}o?i.complete():i.next(r)},0,!0)}),()=>wi(n?.return)&&n.return()})}(e,t);if(sD(e))return function mJ(e,t){return uD(oD(e),t)}(e,t)}throw iD(e)}(e,t):eo(e)}function ts(...e){const t=G0(e),i=function hJ(e,t){return"number"==typeof a7(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?eo(n[0]):F1(i)(Wn(n,t)):js}function c7(e={}){const{connector:t=(()=>new He),resetOnError:i=!0,resetOnComplete:n=!0,resetOnRefCountZero:r=!0}=e;return o=>{let s,a,l,c=0,h=!1,u=!1;const d=()=>{a?.unsubscribe(),a=void 0},p=()=>{d(),s=l=void 0,h=u=!1},f=()=>{const m=s;p(),m?.unsubscribe()};return Mn((m,g)=>{c++,!u&&!h&&d();const v=l=l??t();g.add(()=>{c--,0===c&&!u&&!h&&(a=h7(f,r))}),v.subscribe(g),!s&&c>0&&(s=new Y0({next:y=>v.next(y),error:y=>{u=!0,d(),a=h7(p,i,y),v.error(y)},complete:()=>{h=!0,d(),a=h7(p,n),v.complete()}}),eo(m).subscribe(s))})(o)}}function h7(e,t,...i){if(!0===t)return void e();if(!1===t)return;const n=new Y0({next:()=>{n.unsubscribe(),e()}});return eo(t(...i)).subscribe(n)}function xn(e){for(let t in e)if(e[t]===xn)return t;throw Error("Could not find renamed property on target object.")}function u7(e,t){for(const i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function zn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(zn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const i=t.indexOf("\n");return-1===i?t:t.substring(0,i)}function d7(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const vJ=xn({__forward_ref__:xn});function nn(e){return e.__forward_ref__=nn,e.toString=function(){return zn(this())},e}function Bt(e){return p7(e)?e():e}function p7(e){return"function"==typeof e&&e.hasOwnProperty(vJ)&&e.__forward_ref__===nn}function f7(e){return e&&!!e.\u0275providers}const y3="https://g.co/ng/security#xss";class xe extends Error{constructor(t,i){super(_3(t,i)),this.code=t}}function _3(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}function ti(e){return"string"==typeof e?e:null==e?"":String(e)}function b3(e,t){throw new xe(-201,!1)}function ua(e,t){null==e&&function Zi(e,t,i,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${i} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function Oe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ht(e){return{providers:e.providers||[],imports:e.imports||[]}}function x3(e){return dD(e,w3)||dD(e,fD)}function dD(e,t){return e.hasOwnProperty(t)?e[t]:null}function pD(e){return e&&(e.hasOwnProperty(m7)||e.hasOwnProperty(zJ))?e[m7]:null}const w3=xn({\u0275prov:xn}),m7=xn({\u0275inj:xn}),fD=xn({ngInjectableDef:xn}),zJ=xn({ngInjectorDef:xn});var Vt=(()=>((Vt=Vt||{})[Vt.Default=0]="Default",Vt[Vt.Host=1]="Host",Vt[Vt.Self=2]="Self",Vt[Vt.SkipSelf=4]="SkipSelf",Vt[Vt.Optional=8]="Optional",Vt))();let g7;function da(e){const t=g7;return g7=e,t}function mD(e,t,i){const n=x3(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&Vt.Optional?null:void 0!==t?t:void b3(zn(e))}const On=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),W0={},v7="__NG_DI_FLAG__",C3="ngTempTokenPath",EJ="ngTokenPath",DJ=/\n/gm,AJ="\u0275",gD="__source";let q0;function B1(e){const t=q0;return q0=e,t}function PJ(e,t=Vt.Default){if(void 0===q0)throw new xe(-203,!1);return null===q0?mD(e,void 0,t):q0.get(e,t&Vt.Optional?null:void 0,t)}function he(e,t=Vt.Default){return(function TJ(){return g7}()||PJ)(Bt(e),t)}function si(e,t=Vt.Default){return he(e,S3(t))}function S3(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function y7(e){const t=[];for(let i=0;i<e.length;i++){const n=Bt(e[i]);if(Array.isArray(n)){if(0===n.length)throw new xe(900,!1);let r,o=Vt.Default;for(let s=0;s<n.length;s++){const a=n[s],l=IJ(a);"number"==typeof l?-1===l?r=a.token:o|=l:r=a}t.push(he(r,o))}else t.push(he(n))}return t}function X0(e,t){return e[v7]=t,e.prototype[v7]=t,e}function IJ(e){return e[v7]}function Dc(e){return{toString:e}.toString()}var El=(()=>((El=El||{})[El.OnPush=0]="OnPush",El[El.Default=1]="Default",El))(),Ua=(()=>{return(e=Ua||(Ua={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Ua;var e})();const Ac={},Hi=[],M3=xn({\u0275cmp:xn}),_7=xn({\u0275dir:xn}),b7=xn({\u0275pipe:xn}),yD=xn({\u0275mod:xn}),Pc=xn({\u0275fac:xn}),$0=xn({__NG_ELEMENT_ID__:xn});let NJ=0;function ut(e){return Dc(()=>{const t=xD(e),i={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===El.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,data:e.data||{},encapsulation:e.encapsulation||Ua.Emulated,id:"c"+NJ++,styles:e.styles||Hi,_:null,schemas:e.schemas||null,tView:null};wD(i);const n=e.dependencies;return i.directiveDefs=z3(n,!1),i.pipeDefs=z3(n,!0),i})}function LJ(e){return Ki(e)||No(e)}function RJ(e){return null!==e}function dt(e){return Dc(()=>({type:e.type,bootstrap:e.bootstrap||Hi,declarations:e.declarations||Hi,imports:e.imports||Hi,exports:e.exports||Hi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function bD(e,t){if(null==e)return Ac;const i={};for(const n in e)if(e.hasOwnProperty(n)){let r=e[n],o=r;Array.isArray(r)&&(o=r[1],r=r[0]),i[r]=n,t&&(t[r]=o)}return i}function Ge(e){return Dc(()=>{const t=xD(e);return wD(t),t})}function Ki(e){return e[M3]||null}function No(e){return e[_7]||null}function zs(e){return e[b7]||null}function Gs(e,t){const i=e[yD]||null;if(!i&&!0===t)throw new Error(`Type ${zn(e)} does not have '\u0275mod' property.`);return i}function xD(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,exportAs:e.exportAs||null,standalone:!0===e.standalone,selectors:e.selectors||Hi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:bD(e.inputs,t),outputs:bD(e.outputs)}}function wD(e){e.features?.forEach(t=>t(e))}function z3(e,t){if(!e)return null;const i=t?zs:LJ;return()=>("function"==typeof e?e():e).map(n=>i(n)).filter(RJ)}const Ic=0,at=1,hi=2,er=3,ja=4,sd=5,Lo=6,H1=7,ar=8,T3=9,E3=10,di=11,x7=12,Q0=13,CD=14,U1=15,Ro=16,Z0=17,j1=18,Dl=19,K0=20,SD=21,kn=22,w7=1,MD=2,D3=7,A3=8,Y1=9,is=10;function Ws(e){return Array.isArray(e)&&"object"==typeof e[w7]}function Ya(e){return Array.isArray(e)&&!0===e[w7]}function C7(e){return 0!=(4&e.flags)}function J0(e){return e.componentOffset>-1}function P3(e){return 1==(1&e.flags)}function Ga(e){return!!e.template}function BJ(e){return 0!=(256&e[hi])}function ad(e,t){return e.hasOwnProperty(Pc)?e[Pc]:null}class UJ{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}}function Ht(){return ED}function ED(e){return e.type.prototype.ngOnChanges&&(e.setInput=YJ),jJ}function jJ(){const e=AD(this),t=e?.current;if(t){const i=e.previous;if(i===Ac)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function YJ(e,t,i,n){const r=this.declaredInputs[i],o=AD(e)||function GJ(e,t){return e[DD]=t}(e,{previous:Ac,current:null}),s=o.current||(o.current={}),a=o.previous,l=a[r];s[r]=new UJ(l&&l.currentValue,t,a===Ac),e[n]=t}Ht.ngInherit=!0;const DD="__ngSimpleChanges__";function AD(e){return e[DD]||null}const pa=function(e,t,i){},PD="svg";function _o(e){for(;Array.isArray(e);)e=e[Ic];return e}function I3(e,t){return _o(t[e])}function qs(e,t){return _o(t[e.index])}function OD(e,t){return e.data[t]}function Xs(e,t){const i=t[e];return Ws(i)?i:i[Ic]}function O3(e){return 64==(64&e[hi])}function Wh(e,t){return null==t?null:e[t]}function kD(e){e[j1]=0}function M7(e,t){e[sd]+=t;let i=e,n=e[er];for(;null!==n&&(1===t&&1===i[sd]||-1===t&&0===i[sd]);)n[sd]+=t,i=n,n=n[er]}const ii={lFrame:YD(null),bindingsEnabled:!0};function LD(){return ii.bindingsEnabled}function Ae(){return ii.lFrame.lView}function Oi(){return ii.lFrame.tView}function ai(e){return ii.lFrame.contextLView=e,e[ar]}function li(e){return ii.lFrame.contextLView=null,e}function bo(){let e=RD();for(;null!==e&&64===e.type;)e=e.parent;return e}function RD(){return ii.lFrame.currentTNode}function Al(e,t){const i=ii.lFrame;i.currentTNode=e,i.isParent=t}function z7(){return ii.lFrame.isParent}function T7(){ii.lFrame.isParent=!1}function ns(){const e=ii.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function W1(){return ii.lFrame.bindingIndex++}function ree(e,t){const i=ii.lFrame;i.bindingIndex=i.bindingRootIndex=e,E7(t)}function E7(e){ii.lFrame.currentDirectiveIndex=e}function D7(e){const t=ii.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}function HD(){return ii.lFrame.currentQueryIndex}function A7(e){ii.lFrame.currentQueryIndex=e}function see(e){const t=e[at];return 2===t.type?t.declTNode:1===t.type?e[Lo]:null}function UD(e,t,i){if(i&Vt.SkipSelf){let r=t,o=e;for(;!(r=r.parent,null!==r||i&Vt.Host||(r=see(o),null===r||(o=o[U1],10&r.type))););if(null===r)return!1;t=r,e=o}const n=ii.lFrame=jD();return n.currentTNode=t,n.lView=e,!0}function P7(e){const t=jD(),i=e[at];ii.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function jD(){const e=ii.lFrame,t=null===e?null:e.child;return null===t?YD(e):t}function YD(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function GD(){const e=ii.lFrame;return ii.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const WD=GD;function I7(){const e=GD();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function rs(){return ii.lFrame.selectedIndex}function ld(e){ii.lFrame.selectedIndex=e}function qn(){const e=ii.lFrame;return OD(e.tView,e.selectedIndex)}function O7(){ii.lFrame.currentNamespace=PD}function k3(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){const o=e.data[i].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:h}=o;s&&(e.contentHooks??(e.contentHooks=[])).push(-i,s),a&&((e.contentHooks??(e.contentHooks=[])).push(i,a),(e.contentCheckHooks??(e.contentCheckHooks=[])).push(i,a)),l&&(e.viewHooks??(e.viewHooks=[])).push(-i,l),c&&((e.viewHooks??(e.viewHooks=[])).push(i,c),(e.viewCheckHooks??(e.viewCheckHooks=[])).push(i,c)),null!=h&&(e.destroyHooks??(e.destroyHooks=[])).push(i,h)}}function N3(e,t,i){qD(e,t,3,i)}function L3(e,t,i,n){(3&e[hi])===i&&qD(e,t,i,n)}function k7(e,t){let i=e[hi];(3&i)===t&&(i&=2047,i+=1,e[hi]=i)}function qD(e,t,i,n){const o=n??-1,s=t.length-1;let a=0;for(let l=void 0!==n?65535&e[j1]:0;l<s;l++)if("number"==typeof t[l+1]){if(a=t[l],null!=n&&a>=n)break}else t[l]<0&&(e[j1]+=65536),(a<o||-1==o)&&(fee(e,i,t,l),e[j1]=(4294901760&e[j1])+l+2),l++}function fee(e,t,i,n){const r=i[n]<0,o=i[n+1],a=e[r?-i[n]:i[n]];if(r){if(e[hi]>>11<e[j1]>>16&&(3&e[hi])===t){e[hi]+=2048,pa(4,a,o);try{o.call(a)}finally{pa(5,a,o)}}}else{pa(4,a,o);try{o.call(a)}finally{pa(5,a,o)}}}const q1=-1;class tm{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}}function L7(e,t,i){let n=0;for(;n<i.length;){const r=i[n];if("number"==typeof r){if(0!==r)break;n++;const o=i[n++],s=i[n++],a=i[n++];e.setAttribute(t,s,a,o)}else{const o=r,s=i[++n];$D(o)?e.setProperty(t,o,s):e.setAttribute(t,o,s),n++}}return n}function XD(e){return 3===e||4===e||6===e}function $D(e){return 64===e.charCodeAt(0)}function im(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){const r=t[n];"number"==typeof r?i=r:0===i||QD(e,i,r,null,-1===i||2===i?t[++n]:null)}}return e}function QD(e,t,i,n,r){let o=0,s=e.length;if(-1===t)s=-1;else for(;o<e.length;){const a=e[o++];if("number"==typeof a){if(a===t){s=-1;break}if(a>t){s=o-1;break}}}for(;o<e.length;){const a=e[o];if("number"==typeof a)break;if(a===i){if(null===n)return void(null!==r&&(e[o+1]=r));if(n===e[o+1])return void(e[o+2]=r)}o++,null!==n&&o++,null!==r&&o++}-1!==s&&(e.splice(s,0,t),o=s+1),e.splice(o++,0,i),null!==n&&e.splice(o++,0,n),null!==r&&e.splice(o++,0,r)}function ZD(e){return e!==q1}function R3(e){return 32767&e}function F3(e,t){let i=function yee(e){return e>>16}(e),n=t;for(;i>0;)n=n[U1],i--;return n}let R7=!0;function B3(e){const t=R7;return R7=e,t}const KD=255,JD=5;let _ee=0;const Pl={};function V3(e,t){const i=eA(e,t);if(-1!==i)return i;const n=t[at];n.firstCreatePass&&(e.injectorIndex=t.length,F7(n.data,e),F7(t,null),F7(n.blueprint,null));const r=B7(e,t),o=e.injectorIndex;if(ZD(r)){const s=R3(r),a=F3(r,t),l=a[at].data;for(let c=0;c<8;c++)t[o+c]=a[s+c]|l[s+c]}return t[o+8]=r,o}function F7(e,t){e.push(0,0,0,0,0,0,0,0,t)}function eA(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function B7(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,n=null,r=t;for(;null!==r;){if(n=aA(r),null===n)return q1;if(i++,r=r[U1],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return q1}function V7(e,t,i){!function bee(e,t,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty($0)&&(n=i[$0]),null==n&&(n=i[$0]=_ee++);const r=n&KD;t.data[e+(r>>JD)]|=1<<r}(e,t,i)}function tA(e,t,i){if(i&Vt.Optional||void 0!==e)return e;b3()}function iA(e,t,i,n){if(i&Vt.Optional&&void 0===n&&(n=null),!(i&(Vt.Self|Vt.Host))){const r=e[T3],o=da(void 0);try{return r?r.get(t,n,i&Vt.Optional):mD(t,n,i&Vt.Optional)}finally{da(o)}}return tA(n,0,i)}function nA(e,t,i,n=Vt.Default,r){if(null!==e){if(1024&t[hi]){const s=function Mee(e,t,i,n,r){let o=e,s=t;for(;null!==o&&null!==s&&1024&s[hi]&&!(256&s[hi]);){const a=rA(o,s,i,n|Vt.Self,Pl);if(a!==Pl)return a;let l=o.parent;if(!l){const c=s[SD];if(c){const h=c.get(i,Pl,n);if(h!==Pl)return h}l=aA(s),s=s[U1]}o=l}return r}(e,t,i,n,Pl);if(s!==Pl)return s}const o=rA(e,t,i,n,Pl);if(o!==Pl)return o}return iA(t,i,n,r)}function rA(e,t,i,n,r){const o=function Cee(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty($0)?e[$0]:void 0;return"number"==typeof t?t>=0?t&KD:See:t}(i);if("function"==typeof o){if(!UD(t,e,n))return n&Vt.Host?tA(r,0,n):iA(t,i,n,r);try{const s=o(n);if(null!=s||n&Vt.Optional)return s;b3()}finally{WD()}}else if("number"==typeof o){let s=null,a=eA(e,t),l=q1,c=n&Vt.Host?t[Ro][Lo]:null;for((-1===a||n&Vt.SkipSelf)&&(l=-1===a?B7(e,t):t[a+8],l!==q1&&sA(n,!1)?(s=t[at],a=R3(l),t=F3(l,t)):a=-1);-1!==a;){const h=t[at];if(oA(o,a,h.data)){const u=wee(a,t,i,s,n,c);if(u!==Pl)return u}l=t[a+8],l!==q1&&sA(n,t[at].data[a+8]===c)&&oA(o,a,t)?(s=h,a=R3(l),t=F3(l,t)):a=-1}}return r}function wee(e,t,i,n,r,o){const s=t[at],a=s.data[e+8],h=H3(a,s,i,null==n?J0(a)&&R7:n!=s&&0!=(3&a.type),r&Vt.Host&&o===a);return null!==h?cd(t,s,h,a):Pl}function H3(e,t,i,n,r){const o=e.providerIndexes,s=t.data,a=1048575&o,l=e.directiveStart,h=o>>20,d=r?a+h:e.directiveEnd;for(let p=n?a:a+h;p<d;p++){const f=s[p];if(p<l&&i===f||p>=l&&f.type===i)return p}if(r){const p=s[l];if(p&&Ga(p)&&p.type===i)return l}return null}function cd(e,t,i,n){let r=e[i];const o=t.data;if(function mee(e){return e instanceof tm}(r)){const s=r;s.resolving&&function yJ(e,t){const i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new xe(-200,`Circular dependency in DI detected for ${e}${i}`)}(function Qi(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():ti(e)}(o[i]));const a=B3(s.canSeeViewProviders);s.resolving=!0;const l=s.injectImpl?da(s.injectImpl):null;UD(e,n,Vt.Default);try{r=e[i]=s.factory(void 0,o,e,n),t.firstCreatePass&&i>=n.directiveStart&&function pee(e,t,i){const{ngOnChanges:n,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(n){const s=ED(t);(i.preOrderHooks??(i.preOrderHooks=[])).push(e,s),(i.preOrderCheckHooks??(i.preOrderCheckHooks=[])).push(e,s)}r&&(i.preOrderHooks??(i.preOrderHooks=[])).push(0-e,r),o&&((i.preOrderHooks??(i.preOrderHooks=[])).push(e,o),(i.preOrderCheckHooks??(i.preOrderCheckHooks=[])).push(e,o))}(i,o[i],t)}finally{null!==l&&da(l),B3(a),s.resolving=!1,WD()}}return r}function oA(e,t,i){return!!(i[t+(e>>JD)]&1<<e)}function sA(e,t){return!(e&Vt.Self||e&Vt.Host&&t)}class X1{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return nA(this._tNode,this._lView,t,S3(n),i)}}function See(){return new X1(bo(),Ae())}function lr(e){return Dc(()=>{const t=e.prototype.constructor,i=t[Pc]||H7(t),n=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==n;){const o=r[Pc]||H7(r);if(o&&o!==i)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function H7(e){return p7(e)?()=>{const t=H7(Bt(e));return t&&t()}:ad(e)}function aA(e){const t=e[at],i=t.type;return 2===i?t.declTNode:1===i?e[Lo]:null}const Q1="__parameters__";function K1(e,t,i){return Dc(()=>{const n=function U7(e){return function(...i){if(e){const n=e(...i);for(const r in n)this[r]=n[r]}}}(t);function r(...o){if(this instanceof r)return n.apply(this,o),this;const s=new r(...o);return a.annotation=s,a;function a(l,c,h){const u=l.hasOwnProperty(Q1)?l[Q1]:Object.defineProperty(l,Q1,{value:[]})[Q1];for(;u.length<=h;)u.push(null);return(u[h]=u[h]||[]).push(s),l}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}class Fe{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=Oe({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const j3=Function;function hd(e,t){e.forEach(i=>Array.isArray(i)?hd(i,t):t(i))}function cA(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function Y3(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function om(e,t){const i=[];for(let n=0;n<e;n++)i.push(t);return i}function $s(e,t,i){let n=J1(e,t);return n>=0?e[1|n]=i:(n=~n,function Dee(e,t,i,n){let r=e.length;if(r==t)e.push(i,n);else if(1===r)e.push(n,e[0]),e[0]=i;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=i,e[t+1]=n}}(e,n,t,i)),n}function j7(e,t){const i=J1(e,t);if(i>=0)return e[1|i]}function J1(e,t){return function hA(e,t,i){let n=0,r=e.length>>i;for(;r!==n;){const o=n+(r-n>>1),s=e[o<<i];if(t===s)return o<<i;s>t?r=o:n=o+1}return~(r<<i)}(e,t,1)}const W3=X0(K1("Inject",e=>({token:e})),-1),qh=X0(K1("Optional"),8),ud=X0(K1("SkipSelf"),4);var Ts=(()=>((Ts=Ts||{})[Ts.Important=1]="Important",Ts[Ts.DashCase=2]="DashCase",Ts))();const X7=new Map;let Zee=0;const Q7="__ngContext__";function Fo(e,t){Ws(t)?(e[Q7]=t[K0],function Jee(e){X7.set(e[K0],e)}(t)):e[Q7]=t}let Z7;function K7(e,t){return Z7(e,t)}function cm(e){const t=e[er];return Ya(t)?t[er]:t}function J7(e){return AA(e[Q0])}function e_(e){return AA(e[ja])}function AA(e){for(;null!==e&&!Ya(e);)e=e[ja];return e}function tp(e,t,i,n,r){if(null!=n){let o,s=!1;Ya(n)?o=n:Ws(n)&&(s=!0,n=n[Ic]);const a=_o(n);0===e&&null!==i?null==r?LA(t,i,a):dd(t,i,a,r||null,!0):1===e&&null!==i?dd(t,i,a,r||null,!0):2===e?function a_(e,t,i){const n=$3(e,t);n&&function _te(e,t,i,n){e.removeChild(t,i,n)}(e,n,t,i)}(t,a,s):3===e&&t.destroyNode(a),null!=o&&function wte(e,t,i,n,r){const o=i[D3];o!==_o(i)&&tp(t,e,n,o,r);for(let a=is;a<i.length;a++){const l=i[a];hm(l[at],l,e,t,n,o)}}(t,e,o,i,r)}}function i_(e,t,i){return e.createElement(t,i)}function IA(e,t){const i=e[Y1],n=i.indexOf(t),r=t[er];512&t[hi]&&(t[hi]&=-513,M7(r,-1)),i.splice(n,1)}function n_(e,t){if(e.length<=is)return;const i=is+t,n=e[i];if(n){const r=n[Z0];null!==r&&r!==e&&IA(r,n),t>0&&(e[i-1][ja]=n[ja]);const o=Y3(e,is+t);!function ute(e,t){hm(e,t,t[di],2,null,null),t[Ic]=null,t[Lo]=null}(n[at],n);const s=o[Dl];null!==s&&s.detachView(o[at]),n[er]=null,n[ja]=null,n[hi]&=-65}return n}function OA(e,t){if(!(128&t[hi])){const i=t[di];i.destroyNode&&hm(e,t,i,3,null,null),function fte(e){let t=e[Q0];if(!t)return r_(e[at],e);for(;t;){let i=null;if(Ws(t))i=t[Q0];else{const n=t[is];n&&(i=n)}if(!i){for(;t&&!t[ja]&&t!==e;)Ws(t)&&r_(t[at],t),t=t[er];null===t&&(t=e),Ws(t)&&r_(t[at],t),i=t&&t[ja]}t=i}}(t)}}function r_(e,t){if(!(128&t[hi])){t[hi]&=-65,t[hi]|=128,function yte(e,t){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let n=0;n<i.length;n+=2){const r=t[i[n]];if(!(r instanceof tm)){const o=i[n+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=r[o[s]],l=o[s+1];pa(4,a,l);try{l.call(a)}finally{pa(5,a,l)}}else{pa(4,r,o);try{o.call(r)}finally{pa(5,r,o)}}}}}(e,t),function vte(e,t){const i=e.cleanup,n=t[H1];let r=-1;if(null!==i)for(let o=0;o<i.length-1;o+=2)if("string"==typeof i[o]){const s=i[o+3];s>=0?n[r=s]():n[r=-s].unsubscribe(),o+=2}else{const s=n[r=i[o+1]];i[o].call(s)}if(null!==n){for(let o=r+1;o<n.length;o++)(0,n[o])();t[H1]=null}}(e,t),1===t[at].type&&t[di].destroy();const i=t[Z0];if(null!==i&&Ya(t[er])){i!==t[er]&&IA(i,t);const n=t[Dl];null!==n&&n.detachView(e)}!function ete(e){X7.delete(e[K0])}(t)}}function kA(e,t,i){return function NA(e,t,i){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return i[Ic];{const{componentOffset:r}=n;if(r>-1){const{encapsulation:o}=e.data[n.directiveStart+r];if(o===Ua.None||o===Ua.Emulated)return null}return qs(n,i)}}(e,t.parent,i)}function dd(e,t,i,n,r){e.insertBefore(t,i,n,r)}function LA(e,t,i){e.appendChild(t,i)}function RA(e,t,i,n,r){null!==n?dd(e,t,i,n,r):LA(e,t,i)}function $3(e,t){return e.parentNode(t)}function FA(e,t,i){return VA(e,t,i)}let o_,K3,h_,J3,VA=function BA(e,t,i){return 40&e.type?qs(e,i):null};function Q3(e,t,i,n){const r=kA(e,n,t),o=t[di],a=FA(n.parent||t[Lo],n,t);if(null!=r)if(Array.isArray(i))for(let l=0;l<i.length;l++)RA(o,r,i[l],a,!1);else RA(o,r,i,a,!1);void 0!==o_&&o_(o,n,t,i,r)}function Z3(e,t){if(null!==t){const i=t.type;if(3&i)return qs(t,e);if(4&i)return s_(-1,e[t.index]);if(8&i){const n=t.child;if(null!==n)return Z3(e,n);{const r=e[t.index];return Ya(r)?s_(-1,r):_o(r)}}if(32&i)return K7(t,e)()||_o(e[t.index]);{const n=UA(e,t);return null!==n?Array.isArray(n)?n[0]:Z3(cm(e[Ro]),n):Z3(e,t.next)}}return null}function UA(e,t){return null!==t?e[Ro][Lo].projection[t.projection]:null}function s_(e,t){const i=is+e+1;if(i<t.length){const n=t[i],r=n[at].firstChild;if(null!==r)return Z3(n,r)}return t[D3]}function l_(e,t,i,n,r,o,s){for(;null!=i;){const a=n[i.index],l=i.type;if(s&&0===t&&(a&&Fo(_o(a),n),i.flags|=2),32!=(32&i.flags))if(8&l)l_(e,t,i.child,n,r,o,!1),tp(t,e,r,a,o);else if(32&l){const c=K7(i,n);let h;for(;h=c();)tp(t,e,r,h,o);tp(t,e,r,a,o)}else 16&l?jA(e,t,n,i,r,o):tp(t,e,r,a,o);i=s?i.projectionNext:i.next}}function hm(e,t,i,n,r,o){l_(i,n,e.firstChild,t,r,o,!1)}function jA(e,t,i,n,r,o){const s=i[Ro],l=s[Lo].projection[n.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)tp(t,e,r,l[c],o);else l_(e,t,l,s[er],r,o,!0)}function YA(e,t,i){""===i?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function GA(e,t,i){const{mergedAttrs:n,classes:r,styles:o}=i;null!==n&&L7(e,t,n),null!==r&&YA(e,t,r),null!==o&&function Ste(e,t,i){e.setAttribute(t,"style",i)}(e,t,o)}function ip(e){return function c_(){if(void 0===K3&&(K3=null,On.trustedTypes))try{K3=On.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return K3}()?.createHTML(e)||e}function u_(){if(void 0===J3&&(J3=null,On.trustedTypes))try{J3=On.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return J3}function qA(e){return u_()?.createHTML(e)||e}function $A(e){return u_()?.createScriptURL(e)||e}class pd{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${y3})`}}class Dte extends pd{getTypeName(){return"HTML"}}class Ate extends pd{getTypeName(){return"Style"}}class Pte extends pd{getTypeName(){return"Script"}}class Ite extends pd{getTypeName(){return"URL"}}class Ote extends pd{getTypeName(){return"ResourceURL"}}function Qs(e){return e instanceof pd?e.changingThisBreaksApplicationSecurity:e}function Il(e,t){const i=function kte(e){return e instanceof pd&&e.getTypeName()||null}(e);if(null!=i&&i!==t){if("ResourceURL"===i&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${i} (see ${y3})`)}return i===t}class Vte{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const i=(new window.DOMParser).parseFromString(ip(t),"text/html").body;return null===i?this.inertDocumentHelper.getInertBodyElement(t):(i.removeChild(i.firstChild),i)}catch{return null}}}class Hte{constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){const i=this.inertDocument.createElement("template");return i.innerHTML=ip(t),i}}const jte=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function eg(e){return(e=String(e)).match(jte)?e:"unsafe:"+e}function Nc(e){const t={};for(const i of e.split(","))t[i]=!0;return t}function um(...e){const t={};for(const i of e)for(const n in i)i.hasOwnProperty(n)&&(t[n]=!0);return t}const ZA=Nc("area,br,col,hr,img,wbr"),KA=Nc("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),JA=Nc("rp,rt"),d_=um(ZA,um(KA,Nc("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),um(JA,Nc("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),um(JA,KA)),p_=Nc("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),eP=um(p_,Nc("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Nc("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Yte=Nc("script,style,template");class Gte{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let i=t.firstChild,n=!0;for(;i;)if(i.nodeType===Node.ELEMENT_NODE?n=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,n&&i.firstChild)i=i.firstChild;else for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let r=this.checkClobberedElement(i,i.nextSibling);if(r){i=r;break}i=this.checkClobberedElement(i,i.parentNode)}return this.buf.join("")}startElement(t){const i=t.nodeName.toLowerCase();if(!d_.hasOwnProperty(i))return this.sanitizedSomething=!0,!Yte.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);const n=t.attributes;for(let r=0;r<n.length;r++){const o=n.item(r),s=o.name,a=s.toLowerCase();if(!eP.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=o.value;p_[a]&&(l=eg(l)),this.buf.push(" ",s,'="',tP(l),'"')}return this.buf.push(">"),!0}endElement(t){const i=t.nodeName.toLowerCase();d_.hasOwnProperty(i)&&!ZA.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(t){this.buf.push(tP(t))}checkClobberedElement(t,i){if(i&&(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return i}}const Wte=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,qte=/([^\#-~ |!])/g;function tP(e){return e.replace(/&/g,"&amp;").replace(Wte,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(qte,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let tg;function iP(e,t){let i=null;try{tg=tg||function QA(e){const t=new Hte(e);return function Ute(){try{return!!(new window.DOMParser).parseFromString(ip(""),"text/html")}catch{return!1}}()?new Vte(t):t}(e);let n=t?String(t):"";i=tg.getInertBodyElement(n);let r=5,o=n;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,n=o,o=i.innerHTML,i=tg.getInertBodyElement(n)}while(n!==o);return ip((new Gte).sanitizeChildren(f_(i)||i))}finally{if(i){const n=f_(i)||i;for(;n.firstChild;)n.removeChild(n.firstChild)}}}function f_(e){return"content"in e&&function Xte(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var wn=(()=>((wn=wn||{})[wn.NONE=0]="NONE",wn[wn.HTML=1]="HTML",wn[wn.STYLE=2]="STYLE",wn[wn.SCRIPT=3]="SCRIPT",wn[wn.URL=4]="URL",wn[wn.RESOURCE_URL=5]="RESOURCE_URL",wn))();function m_(e){const t=dm();return t?qA(t.sanitize(wn.HTML,e)||""):Il(e,"HTML")?qA(Qs(e)):iP(function WA(){return void 0!==h_?h_:typeof document<"u"?document:void 0}(),ti(e))}function fd(e){const t=dm();return t?t.sanitize(wn.URL,e)||"":Il(e,"URL")?Qs(e):eg(ti(e))}function nP(e){const t=dm();if(t)return $A(t.sanitize(wn.RESOURCE_URL,e)||"");if(Il(e,"ResourceURL"))return $A(Qs(e));throw new xe(904,!1)}function dm(){const e=Ae();return e&&e[x7]}const ig=new Fe("ENVIRONMENT_INITIALIZER"),oP=new Fe("INJECTOR",-1),sP=new Fe("INJECTOR_DEF_TYPES");class aP{get(t,i=W0){if(i===W0){const n=new Error(`NullInjectorError: No provider for ${zn(t)}!`);throw n.name="NullInjectorError",n}return i}}function tie(...e){return{\u0275providers:lP(0,e),\u0275fromNgModule:!0}}function lP(e,...t){const i=[],n=new Set;let r;return hd(t,o=>{const s=o;g_(s,i,[],n)&&(r||(r=[]),r.push(s))}),void 0!==r&&cP(r,i),i}function cP(e,t){for(let i=0;i<e.length;i++){const{providers:r}=e[i];v_(r,o=>{t.push(o)})}}function g_(e,t,i,n){if(!(e=Bt(e)))return!1;let r=null,o=pD(e);const s=!o&&Ki(e);if(o||s){if(s&&!s.standalone)return!1;r=e}else{const l=e.ngModule;if(o=pD(l),!o)return!1;r=l}const a=n.has(r);if(s){if(a)return!1;if(n.add(r),s.dependencies){const l="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const c of l)g_(c,t,i,n)}}else{if(!o)return!1;{if(null!=o.imports&&!a){let c;n.add(r);try{hd(o.imports,h=>{g_(h,t,i,n)&&(c||(c=[]),c.push(h))})}finally{}void 0!==c&&cP(c,t)}if(!a){const c=ad(r)||(()=>new r);t.push({provide:r,useFactory:c,deps:Hi},{provide:sP,useValue:r,multi:!0},{provide:ig,useValue:()=>he(r),multi:!0})}const l=o.providers;null==l||a||v_(l,h=>{t.push(h)})}}return r!==e&&void 0!==e.providers}function v_(e,t){for(let i of e)f7(i)&&(i=i.\u0275providers),Array.isArray(i)?v_(i,t):t(i)}const iie=xn({provide:String,useValue:xn});function y_(e){return null!==e&&"object"==typeof e&&iie in e}function md(e){return"function"==typeof e}const __=new Fe("Set Injector scope."),ng={},rie={};let b_;function rg(){return void 0===b_&&(b_=new aP),b_}class Ol{}class dP extends Ol{get destroyed(){return this._destroyed}constructor(t,i,n,r){super(),this.parent=i,this.source=n,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,w_(t,s=>this.processProvider(s)),this.records.set(oP,np(void 0,this)),r.has("environment")&&this.records.set(Ol,np(void 0,this));const o=this.records.get(__);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(sP.multi,Hi,Vt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const i=B1(this),n=da(void 0);try{return t()}finally{B1(i),da(n)}}get(t,i=W0,n=Vt.Default){this.assertNotDestroyed(),n=S3(n);const r=B1(this),o=da(void 0);try{if(!(n&Vt.SkipSelf)){let a=this.records.get(t);if(void 0===a){const l=function cie(e){return"function"==typeof e||"object"==typeof e&&e instanceof Fe}(t)&&x3(t);a=l&&this.injectableDefInScope(l)?np(x_(t),ng):null,this.records.set(t,a)}if(null!=a)return this.hydrate(t,a)}return(n&Vt.Self?rg():this.parent).get(t,i=n&Vt.Optional&&i===W0?null:i)}catch(s){if("NullInjectorError"===s.name){if((s[C3]=s[C3]||[]).unshift(zn(t)),r)throw s;return function OJ(e,t,i,n){const r=e[C3];throw t[gD]&&r.unshift(t[gD]),e.message=function kJ(e,t,i,n=null){e=e&&"\n"===e.charAt(0)&&e.charAt(1)==AJ?e.slice(2):e;let r=zn(t);if(Array.isArray(t))r=t.map(zn).join(" -> ");else if("object"==typeof t){let o=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):zn(a)))}r=`{${o.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${e.replace(DJ,"\n  ")}`}("\n"+e.message,r,i,n),e[EJ]=r,e[C3]=null,e}(s,t,"R3InjectorError",this.source)}throw s}finally{da(o),B1(r)}}resolveInjectorInitializers(){const t=B1(this),i=da(void 0);try{const n=this.get(ig.multi,Hi,Vt.Self);for(const r of n)r()}finally{B1(t),da(i)}}toString(){const t=[],i=this.records;for(const n of i.keys())t.push(zn(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xe(205,!1)}processProvider(t){let i=md(t=Bt(t))?t:Bt(t&&t.provide);const n=function sie(e){return y_(e)?np(void 0,e.useValue):np(pP(e),ng)}(t);if(md(t)||!0!==t.multi)this.records.get(i);else{let r=this.records.get(i);r||(r=np(void 0,ng,!0),r.factory=()=>y7(r.multi),this.records.set(i,r)),i=t,r.multi.push(t)}this.records.set(i,n)}hydrate(t,i){return i.value===ng&&(i.value=rie,i.value=i.factory()),"object"==typeof i.value&&i.value&&function lie(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(t){if(!t.providedIn)return!1;const i=Bt(t.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}}function x_(e){const t=x3(e),i=null!==t?t.factory:ad(e);if(null!==i)return i;if(e instanceof Fe)throw new xe(204,!1);if(e instanceof Function)return function oie(e){const t=e.length;if(t>0)throw om(t,"?"),new xe(204,!1);const i=function SJ(e){const t=e&&(e[w3]||e[fD]);return t?(function MJ(e){if(e.hasOwnProperty("name"))return e.name;(""+e).match(/^function\s*([^\s(]+)/)}(e),t):null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new xe(204,!1)}function pP(e,t,i){let n;if(md(e)){const r=Bt(e);return ad(r)||x_(r)}if(y_(e))n=()=>Bt(e.useValue);else if(function uP(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...y7(e.deps||[]));else if(function hP(e){return!(!e||!e.useExisting)}(e))n=()=>he(Bt(e.useExisting));else{const r=Bt(e&&(e.useClass||e.provide));if(!function aie(e){return!!e.deps}(e))return ad(r)||x_(r);n=()=>new r(...y7(e.deps))}return n}function np(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function w_(e,t){for(const i of e)Array.isArray(i)?w_(i,t):i&&f7(i)?w_(i.\u0275providers,t):t(i)}class hie{}class fP{}class die{resolveComponentFactory(t){throw function uie(e){const t=Error(`No component factory found for ${zn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Lc=(()=>{class e{}return e.NULL=new die,e})();function pie(){return rp(bo(),Ae())}function rp(e,t){return new yt(qs(e,t))}let yt=(()=>{class e{constructor(i){this.nativeElement=i}}return e.__NG_ELEMENT_ID__=pie,e})();function fie(e){return e instanceof yt?e.nativeElement:e}class Xh{}let Nn=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function mie(){const e=Ae(),i=Xs(bo().index,e);return(Ws(i)?i:e)[di]}(),e})(),gie=(()=>{class e{}return e.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>null}),e})();class pm{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const vie=new pm("15.2.6"),C_={},S_="ngOriginalError";function M_(e){return e[S_]}class op{constructor(){this._console=console}handleError(t){const i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&M_(t);for(;i&&M_(i);)i=M_(i);return i||null}}function Rc(e){return e instanceof Function?e():e}function vP(e,t,i){let n=e.length;for(;;){const r=e.indexOf(t,i);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const o=t.length;if(r+o===n||e.charCodeAt(r+o)<=32)return r}i=r+1}}const yP="ng-template";function Eie(e,t,i){let n=0,r=!0;for(;n<e.length;){let o=e[n++];if("string"==typeof o&&r){const s=e[n++];if(i&&"class"===o&&-1!==vP(s.toLowerCase(),t,0))return!0}else{if(1===o){for(;n<e.length&&"string"==typeof(o=e[n++]);)if(o.toLowerCase()===t)return!0;return!1}"number"==typeof o&&(r=!1)}}return!1}function _P(e){return 4===e.type&&e.value!==yP}function Die(e,t,i){return t===(4!==e.type||i?e.value:yP)}function Aie(e,t,i){let n=4;const r=e.attrs||[],o=function Oie(e){for(let t=0;t<e.length;t++)if(XD(e[t]))return t;return e.length}(r);let s=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!s)if(4&n){if(n=2|1&n,""!==l&&!Die(e,l,i)||""===l&&1===t.length){if(Wa(n))return!1;s=!0}}else{const c=8&n?l:t[++a];if(8&n&&null!==e.attrs){if(!Eie(e.attrs,c,i)){if(Wa(n))return!1;s=!0}continue}const u=Pie(8&n?"class":l,r,_P(e),i);if(-1===u){if(Wa(n))return!1;s=!0;continue}if(""!==c){let d;d=u>o?"":r[u+1].toLowerCase();const p=8&n?d:null;if(p&&-1!==vP(p,c,0)||2&n&&c!==d){if(Wa(n))return!1;s=!0}}}}else{if(!s&&!Wa(n)&&!Wa(l))return!1;if(s&&Wa(l))continue;s=!1,n=l|1&n}}return Wa(n)||s}function Wa(e){return 0==(1&e)}function Pie(e,t,i,n){if(null===t)return-1;let r=0;if(n||!i){let o=!1;for(;r<t.length;){const s=t[r];if(s===e)return r;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=t[++r];for(;"string"==typeof a;)a=t[++r];continue}if(4===s)break;if(0===s){r+=4;continue}}r+=o?1:2}return-1}return function kie(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const n=e[i];if("number"==typeof n)return-1;if(n===t)return i;i++}return-1}(t,e)}function bP(e,t,i=!1){for(let n=0;n<t.length;n++)if(Aie(e,t[n],i))return!0;return!1}function Nie(e,t){e:for(let i=0;i<t.length;i++){const n=t[i];if(e.length===n.length){for(let r=0;r<e.length;r++)if(e[r]!==n[r])continue e;return!0}}return!1}function xP(e,t){return e?":not("+t.trim()+")":t}function Lie(e){let t=e[0],i=1,n=2,r="",o=!1;for(;i<e.length;){let s=e[i];if("string"==typeof s)if(2&n){const a=e[++i];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?r+="."+s:4&n&&(r+=" "+s);else""!==r&&!Wa(s)&&(t+=xP(o,r),r=""),n=s,o=o||!Wa(n);i++}return""!==r&&(t+=xP(o,r)),t}const ni={};function ie(e){wP(Oi(),Ae(),rs()+e,!1)}function wP(e,t,i,n){if(!n)if(3==(3&t[hi])){const o=e.preOrderCheckHooks;null!==o&&N3(t,o,i)}else{const o=e.preOrderHooks;null!==o&&L3(t,o,0,i)}ld(i)}function zP(e,t=null,i=null,n){const r=TP(e,t,i,n);return r.resolveInjectorInitializers(),r}function TP(e,t=null,i=null,n,r=new Set){const o=[i||Hi,tie(e)];return n=n||("object"==typeof e?void 0:zn(e)),new dP(o,t||rg(),n||null,r)}let Bo=(()=>{class e{static create(i,n){if(Array.isArray(i))return zP({name:""},n,i,"");{const r=i.name??"";return zP({name:r},i.parent,i.providers,r)}}}return e.THROW_IF_NOT_FOUND=W0,e.NULL=new aP,e.\u0275prov=Oe({token:e,providedIn:"any",factory:()=>he(oP)}),e.__NG_ELEMENT_ID__=-1,e})();function L(e,t=Vt.Default){const i=Ae();return null===i?he(e,t):nA(bo(),i,Bt(e),t)}function NP(e,t){const i=e.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const o=i[n+1];if(-1!==o){const s=e.data[o];A7(i[n]),s.contentQueries(2,t[o],o)}}}function sg(e,t,i,n,r,o,s,a,l,c,h){const u=t.blueprint.slice();return u[Ic]=r,u[hi]=76|n,(null!==h||e&&1024&e[hi])&&(u[hi]|=1024),kD(u),u[er]=u[U1]=e,u[ar]=i,u[E3]=s||e&&e[E3],u[di]=a||e&&e[di],u[x7]=l||e&&e[x7]||null,u[T3]=c||e&&e[T3]||null,u[Lo]=o,u[K0]=function Kee(){return Zee++}(),u[SD]=h,u[Ro]=2==t.type?e[Ro]:u,u}function lp(e,t,i,n,r){let o=e.data[t];if(null===o)o=function A_(e,t,i,n,r){const o=RD(),s=z7(),l=e.data[t]=function lne(e,t,i,n,r,o){return{type:i,index:n,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,i,t,n,r);return null===e.firstChild&&(e.firstChild=l),null!==o&&(s?null==o.child&&null!==l.parent&&(o.child=l):null===o.next&&(o.next=l,l.prev=o)),l}(e,t,i,n,r),function nee(){return ii.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=i,o.value=n,o.attrs=r;const s=function em(){const e=ii.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return Al(o,!0),o}function fm(e,t,i,n){if(0===i)return-1;const r=t.length;for(let o=0;o<i;o++)t.push(n),e.blueprint.push(n),e.data.push(null);return r}function P_(e,t,i){P7(t);try{const n=e.viewQuery;null!==n&&H_(1,n,i);const r=e.template;null!==r&&LP(e,t,r,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&NP(e,t),e.staticViewQueries&&H_(2,e.viewQuery,i);const o=e.components;null!==o&&function one(e,t){for(let i=0;i<t.length;i++)Tne(e,t[i])}(t,o)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[hi]&=-5,I7()}}function ag(e,t,i,n){const r=t[hi];if(128!=(128&r)){P7(t);try{kD(t),function BD(e){return ii.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&LP(e,t,i,2,n);const s=3==(3&r);if(s){const c=e.preOrderCheckHooks;null!==c&&N3(t,c,null)}else{const c=e.preOrderHooks;null!==c&&L3(t,c,0,null),k7(t,0)}if(function Mne(e){for(let t=J7(e);null!==t;t=e_(t)){if(!t[MD])continue;const i=t[Y1];for(let n=0;n<i.length;n++){const r=i[n];512&r[hi]||M7(r[er],1),r[hi]|=512}}}(t),function Sne(e){for(let t=J7(e);null!==t;t=e_(t))for(let i=is;i<t.length;i++){const n=t[i],r=n[at];O3(n)&&ag(r,n,r.template,n[ar])}}(t),null!==e.contentQueries&&NP(e,t),s){const c=e.contentCheckHooks;null!==c&&N3(t,c)}else{const c=e.contentHooks;null!==c&&L3(t,c,1),k7(t,1)}!function nne(e,t){const i=e.hostBindingOpCodes;if(null!==i)try{for(let n=0;n<i.length;n++){const r=i[n];if(r<0)ld(~r);else{const o=r,s=i[++n],a=i[++n];ree(s,o),a(2,t[o])}}}finally{ld(-1)}}(e,t);const a=e.components;null!==a&&function rne(e,t){for(let i=0;i<t.length;i++)zne(e,t[i])}(t,a);const l=e.viewQuery;if(null!==l&&H_(2,l,n),s){const c=e.viewCheckHooks;null!==c&&N3(t,c)}else{const c=e.viewHooks;null!==c&&L3(t,c,2),k7(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[hi]&=-41,512&t[hi]&&(t[hi]&=-513,M7(t[er],-1))}finally{I7()}}}function LP(e,t,i,n,r){const o=rs(),s=2&n;try{ld(-1),s&&t.length>kn&&wP(e,t,kn,!1),pa(s?2:0,r),i(n,r)}finally{ld(o),pa(s?3:1,r)}}function I_(e,t,i){if(C7(t)){const r=t.directiveEnd;for(let o=t.directiveStart;o<r;o++){const s=e.data[o];s.contentQueries&&s.contentQueries(1,i[o],o)}}}function O_(e,t,i){LD()&&(function fne(e,t,i,n){const r=i.directiveStart,o=i.directiveEnd;J0(i)&&function xne(e,t,i){const n=qs(t,e),r=RP(i),o=e[E3],s=lg(e,sg(e,r,null,i.onPush?32:16,n,t,o,o.createRenderer(n,i),null,null,null));e[t.index]=s}(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||V3(i,t),Fo(n,t);const s=i.initialInputs;for(let a=r;a<o;a++){const l=e.data[a],c=cd(t,e,a,i);Fo(c,t),null!==s&&wne(0,a-r,c,l,0,s),Ga(l)&&(Xs(i.index,t)[ar]=cd(t,e,a,i))}}(e,t,i,qs(i,t)),64==(64&i.flags)&&jP(e,t,i))}function k_(e,t,i=qs){const n=t.localNames;if(null!==n){let r=t.index+1;for(let o=0;o<n.length;o+=2){const s=n[o+1],a=-1===s?i(t,e):e[s];e[r++]=a}}}function RP(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=N_(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function N_(e,t,i,n,r,o,s,a,l,c){const h=kn+n,u=h+r,d=function sne(e,t){const i=[];for(let n=0;n<t;n++)i.push(n<e?null:ni);return i}(h,u),p="function"==typeof c?c():c;return d[at]={type:e,blueprint:d,template:i,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:u,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function FP(e,t,i,n){const r=GP(t);null===i?r.push(n):(r.push(i),e.firstCreatePass&&WP(e).push(n,r.length-1))}function BP(e,t,i,n){for(let r in e)if(e.hasOwnProperty(r)){i=null===i?{}:i;const o=e[r];null===n?VP(i,t,r,o):n.hasOwnProperty(r)&&VP(i,t,n[r],o)}return i}function VP(e,t,i,n){e.hasOwnProperty(i)?e[i].push(t,n):e[i]=[t,n]}function Zs(e,t,i,n,r,o,s,a){const l=qs(t,i);let h,c=t.inputs;!a&&null!=c&&(h=c[n])?(U_(e,i,h,n,r),J0(t)&&HP(i,t.index)):3&t.type&&(n=function hne(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),r=null!=s?s(r,t.value||"",n):r,o.setProperty(l,n,r))}function HP(e,t){const i=Xs(t,e);16&i[hi]||(i[hi]|=32)}function L_(e,t,i,n){if(LD()){const r=null===n?null:{"":-1},o=function gne(e,t){const i=e.directiveRegistry;let n=null,r=null;if(i)for(let o=0;o<i.length;o++){const s=i[o];if(bP(t,s.selectors,!1))if(n||(n=[]),Ga(s))if(null!==s.findHostDirectiveDefs){const a=[];r=r||new Map,s.findHostDirectiveDefs(s,a,r),n.unshift(...a,s),R_(e,t,a.length)}else n.unshift(s),R_(e,t,0);else r=r||new Map,s.findHostDirectiveDefs?.(s,n,r),n.push(s)}return null===n?null:[n,r]}(e,i);let s,a;null===o?s=a=null:[s,a]=o,null!==s&&UP(e,t,i,s,r,a),r&&function vne(e,t,i){if(t){const n=e.localNames=[];for(let r=0;r<t.length;r+=2){const o=i[t[r+1]];if(null==o)throw new xe(-301,!1);n.push(t[r],o)}}}(i,n,r)}i.mergedAttrs=im(i.mergedAttrs,i.attrs)}function UP(e,t,i,n,r,o){for(let c=0;c<n.length;c++)V7(V3(i,t),e,n[c].type);!function _ne(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}(i,e.data.length,n.length);for(let c=0;c<n.length;c++){const h=n[c];h.providersResolver&&h.providersResolver(h)}let s=!1,a=!1,l=fm(e,t,n.length,null);for(let c=0;c<n.length;c++){const h=n[c];i.mergedAttrs=im(i.mergedAttrs,h.hostAttrs),bne(e,i,t,l,h),yne(l,h,r),null!==h.contentQueries&&(i.flags|=4),(null!==h.hostBindings||null!==h.hostAttrs||0!==h.hostVars)&&(i.flags|=64);const u=h.type.prototype;!s&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks??(e.preOrderHooks=[])).push(i.index),s=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(i.index),a=!0),l++}!function cne(e,t,i){const r=t.directiveEnd,o=e.data,s=t.attrs,a=[];let l=null,c=null;for(let h=t.directiveStart;h<r;h++){const u=o[h],d=i?i.get(u):null,f=d?d.outputs:null;l=BP(u.inputs,h,l,d?d.inputs:null),c=BP(u.outputs,h,c,f);const m=null===l||null===s||_P(t)?null:Cne(l,h,s);a.push(m)}null!==l&&(l.hasOwnProperty("class")&&(t.flags|=8),l.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=l,t.outputs=c}(e,i,o)}function jP(e,t,i){const n=i.directiveStart,r=i.directiveEnd,o=i.index,s=function oee(){return ii.lFrame.currentDirectiveIndex}();try{ld(o);for(let a=n;a<r;a++){const l=e.data[a],c=t[a];E7(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&mne(l,c)}}finally{ld(-1),E7(s)}}function mne(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function R_(e,t,i){t.componentOffset=i,(e.components??(e.components=[])).push(t.index)}function yne(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;Ga(t)&&(i[""]=e)}}function bne(e,t,i,n,r){e.data[n]=r;const o=r.factory||(r.factory=ad(r.type)),s=new tm(o,Ga(r),L);e.blueprint[n]=s,i[n]=s,function dne(e,t,i,n,r){const o=r.hostBindings;if(o){let s=e.hostBindingOpCodes;null===s&&(s=e.hostBindingOpCodes=[]);const a=~t.index;(function pne(e){let t=e.length;for(;t>0;){const i=e[--t];if("number"==typeof i&&i<0)return i}return 0})(s)!=a&&s.push(a),s.push(i,n,o)}}(e,t,n,fm(e,i,r.hostVars,ni),r)}function kl(e,t,i,n,r,o){const s=qs(e,t);!function F_(e,t,i,n,r,o,s){if(null==o)e.removeAttribute(t,r,i);else{const a=null==s?ti(o):s(o,n||"",r);e.setAttribute(t,r,a,i)}}(t[di],s,o,e.value,i,n,r)}function wne(e,t,i,n,r,o){const s=o[t];if(null!==s){const a=n.setInput;for(let l=0;l<s.length;){const c=s[l++],h=s[l++],u=s[l++];null!==a?n.setInput(i,u,c,h):i[h]=u}}}function Cne(e,t,i){let n=null,r=0;for(;r<i.length;){const o=i[r];if(0!==o)if(5!==o){if("number"==typeof o)break;if(e.hasOwnProperty(o)){null===n&&(n=[]);const s=e[o];for(let a=0;a<s.length;a+=2)if(s[a]===t){n.push(o,s[a+1],i[r+1]);break}}r+=2}else r+=2;else r+=4}return n}function YP(e,t,i,n){return[e,!0,!1,t,null,0,n,i,null,null]}function zne(e,t){const i=Xs(t,e);if(O3(i)){const n=i[at];48&i[hi]?ag(n,i,n.template,i[ar]):i[sd]>0&&B_(i)}}function B_(e){for(let n=J7(e);null!==n;n=e_(n))for(let r=is;r<n.length;r++){const o=n[r];if(O3(o))if(512&o[hi]){const s=o[at];ag(s,o,s.template,o[ar])}else o[sd]>0&&B_(o)}const i=e[at].components;if(null!==i)for(let n=0;n<i.length;n++){const r=Xs(i[n],e);O3(r)&&r[sd]>0&&B_(r)}}function Tne(e,t){const i=Xs(t,e),n=i[at];(function Ene(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])})(n,i),P_(n,i,i[ar])}function lg(e,t){return e[Q0]?e[CD][ja]=t:e[Q0]=t,e[CD]=t,t}function V_(e){for(;e;){e[hi]|=32;const t=cm(e);if(BJ(e)&&!t)return e;e=t}return null}function cg(e,t,i,n=!0){const r=t[E3];r.begin&&r.begin();try{ag(e,t,e.template,i)}catch(s){throw n&&XP(t,s),s}finally{r.end&&r.end()}}function H_(e,t,i){A7(0),t(e,i)}function GP(e){return e[H1]||(e[H1]=[])}function WP(e){return e.cleanup||(e.cleanup=[])}function XP(e,t){const i=e[T3],n=i?i.get(op,null):null;n&&n.handleError(t)}function U_(e,t,i,n,r){for(let o=0;o<i.length;){const s=i[o++],a=i[o++],l=t[s],c=e.data[s];null!==c.setInput?c.setInput(l,r,n,a):l[a]=r}}function hg(e,t,i){let n=i?e.styles:null,r=i?e.classes:null,o=0;if(null!==t)for(let s=0;s<t.length;s++){const a=t[s];"number"==typeof a?o=a:1==o?r=d7(r,a):2==o&&(n=d7(n,a+": "+t[++s]+";"))}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=r:e.classesWithoutHost=r}function ug(e,t,i,n,r=!1){for(;null!==i;){const o=t[i.index];if(null!==o&&n.push(_o(o)),Ya(o))for(let a=is;a<o.length;a++){const l=o[a],c=l[at].firstChild;null!==c&&ug(l[at],l,c,n)}const s=i.type;if(8&s)ug(e,t,i.child,n);else if(32&s){const a=K7(i,t);let l;for(;l=a();)n.push(l)}else if(16&s){const a=UA(t,i);if(Array.isArray(a))n.push(...a);else{const l=cm(t[Ro]);ug(l[at],l,a,n,!0)}}i=r?i.projectionNext:i.next}return n}class mm{get rootNodes(){const t=this._lView,i=t[at];return ug(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ar]}set context(t){this._lView[ar]=t}get destroyed(){return 128==(128&this._lView[hi])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[er];if(Ya(t)){const i=t[A3],n=i?i.indexOf(this):-1;n>-1&&(n_(t,n),Y3(i,n))}this._attachedToViewContainer=!1}OA(this._lView[at],this._lView)}onDestroy(t){FP(this._lView[at],this._lView,null,t)}markForCheck(){V_(this._cdRefInjectingView||this._lView)}detach(){this._lView[hi]&=-65}reattach(){this._lView[hi]|=64}detectChanges(){cg(this._lView[at],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function pte(e,t){hm(e,t,t[di],2,null,null)}(this._lView[at],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new xe(902,!1);this._appRef=t}}class Dne extends mm{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;cg(t[at],t,t[ar],!1)}checkNoChanges(){}get context(){return null}}class $P extends Lc{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const i=Ki(t);return new gm(i,this.ngModule)}}function QP(e){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push({propName:e[i],templateName:i});return t}class Pne{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=S3(n);const r=this.injector.get(t,C_,n);return r!==C_||i===C_?r:this.parentInjector.get(t,i,n)}}class gm extends fP{get inputs(){return QP(this.componentDef.inputs)}get outputs(){return QP(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=function Rie(e){return e.map(Lie).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,r){let o=(r=r||this.ngModule)instanceof Ol?r:r?.injector;o&&null!==this.componentDef.getStandaloneInjector&&(o=this.componentDef.getStandaloneInjector(o)||o);const s=o?new Pne(t,o):t,a=s.get(Xh,null);if(null===a)throw new xe(407,!1);const l=s.get(gie,null),c=a.createRenderer(null,this.componentDef),h=this.componentDef.selectors[0][0]||"div",u=n?function ane(e,t,i){return e.selectRootElement(t,i===Ua.ShadowDom)}(c,n,this.componentDef.encapsulation):i_(c,h,function Ane(e){const t=e.toLowerCase();return"svg"===t?PD:"math"===t?"math":null}(h)),d=this.componentDef.onPush?288:272,p=N_(0,null,null,1,0,null,null,null,null,null),f=sg(null,p,null,d,null,null,a,c,l,s,null);let m,g;P7(f);try{const v=this.componentDef;let y,_=null;v.findHostDirectiveDefs?(y=[],_=new Map,v.findHostDirectiveDefs(v,y,_),y.push(v)):y=[v];const b=function One(e,t){const i=e[at],n=kn;return e[n]=t,lp(i,n,2,"#host",null)}(f,u),x=function kne(e,t,i,n,r,o,s,a){const l=r[at];!function Nne(e,t,i,n){for(const r of e)t.mergedAttrs=im(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(hg(t,t.mergedAttrs,!0),null!==i&&GA(n,i,t))}(n,e,t,s);const c=o.createRenderer(t,i),h=sg(r,RP(i),null,i.onPush?32:16,r[e.index],e,o,c,a||null,null,null);return l.firstCreatePass&&R_(l,e,n.length-1),lg(r,h),r[e.index]=h}(b,u,v,y,f,a,c);g=OD(p,kn),u&&function Rne(e,t,i,n){if(n)L7(e,i,["ng-version",vie.full]);else{const{attrs:r,classes:o}=function Fie(e){const t=[],i=[];let n=1,r=2;for(;n<e.length;){let o=e[n];if("string"==typeof o)2===r?""!==o&&t.push(o,e[++n]):8===r&&i.push(o);else{if(!Wa(r))break;r=o}n++}return{attrs:t,classes:i}}(t.selectors[0]);r&&L7(e,i,r),o&&o.length>0&&YA(e,i,o.join(" "))}}(c,v,u,n),void 0!==i&&function Fne(e,t,i){const n=e.projection=[];for(let r=0;r<t.length;r++){const o=i[r];n.push(null!=o?Array.from(o):null)}}(g,this.ngContentSelectors,i),m=function Lne(e,t,i,n,r,o){const s=bo(),a=r[at],l=qs(s,r);UP(a,r,s,i,null,n);for(let h=0;h<i.length;h++)Fo(cd(r,a,s.directiveStart+h,s),r);jP(a,r,s),l&&Fo(l,r);const c=cd(r,a,s.directiveStart+s.componentOffset,s);if(e[ar]=r[ar]=c,null!==o)for(const h of o)h(c,t);return I_(a,s,e),c}(x,v,y,_,f,[Bne]),P_(p,f,null)}finally{I7()}return new Ine(this.componentType,m,rp(g,f),f,g)}}class Ine extends hie{constructor(t,i,n,r,o){super(),this.location=n,this._rootLView=r,this._tNode=o,this.instance=i,this.hostView=this.changeDetectorRef=new Dne(r),this.componentType=t}setInput(t,i){const n=this._tNode.inputs;let r;if(null!==n&&(r=n[t])){const o=this._rootLView;U_(o[at],o,r,t,i),HP(o,this._tNode.index)}}get injector(){return new X1(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Bne(){const e=bo();k3(Ae()[at],e)}function Ci(e){let t=function ZP(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const n=[e];for(;t;){let r;if(Ga(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new xe(903,!1);r=t.\u0275dir}if(r){if(i){n.push(r);const s=e;s.inputs=j_(e.inputs),s.declaredInputs=j_(e.declaredInputs),s.outputs=j_(e.outputs);const a=r.hostBindings;a&&jne(e,a);const l=r.viewQuery,c=r.contentQueries;if(l&&Hne(e,l),c&&Une(e,c),u7(e.inputs,r.inputs),u7(e.declaredInputs,r.declaredInputs),u7(e.outputs,r.outputs),Ga(r)&&r.data.animation){const h=e.data;h.animation=(h.animation||[]).concat(r.data.animation)}}const o=r.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(e),a===Ci&&(i=!1)}}t=Object.getPrototypeOf(t)}!function Vne(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){const r=e[n];r.hostVars=t+=r.hostVars,r.hostAttrs=im(r.hostAttrs,i=im(i,r.hostAttrs))}}(n)}function j_(e){return e===Ac?{}:e===Hi?[]:e}function Hne(e,t){const i=e.viewQuery;e.viewQuery=i?(n,r)=>{t(n,r),i(n,r)}:t}function Une(e,t){const i=e.contentQueries;e.contentQueries=i?(n,r,o)=>{t(n,r,o),i(n,r,o)}:t}function jne(e,t){const i=e.hostBindings;e.hostBindings=i?(n,r)=>{t(n,r),i(n,r)}:t}function dg(e){return!!Y_(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Y_(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Nl(e,t,i){return e[t]=i}function Vo(e,t,i){return!Object.is(e[t],i)&&(e[t]=i,!0)}function to(e,t,i,n){const r=Ae();return Vo(r,W1(),t)&&(Oi(),kl(qn(),r,e,t,i,n)),to}function ne(e,t,i,n,r,o,s,a){const l=Ae(),c=Oi(),h=e+kn,u=c.firstCreatePass?function Jne(e,t,i,n,r,o,s,a,l){const c=t.consts,h=lp(t,e,4,s||null,Wh(c,a));L_(t,i,h,Wh(c,l)),k3(t,h);const u=h.tView=N_(2,h,n,r,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,h),u.queries=t.queries.embeddedTView(h)),h}(h,c,l,t,i,n,r,o,s):c.data[h];Al(u,!1);const d=l[di].createComment("");Q3(c,l,d,u),Fo(d,l),lg(l,l[h]=YP(d,l,d,u)),P3(u)&&O_(c,l,u),null!=s&&k_(l,u,a)}function gn(e){return function G1(e,t){return e[t]}(function iee(){return ii.lFrame.contextLView}(),kn+e)}function X(e,t,i){const n=Ae();return Vo(n,W1(),t)&&Zs(Oi(),qn(),n,e,t,n[di],i,!1),X}function G_(e,t,i,n,r){const s=r?"class":"style";U_(e,i,t.inputs[s],s,n)}function Ee(e,t,i,n){const r=Ae(),o=Oi(),s=kn+e,a=r[di],l=o.firstCreatePass?function tre(e,t,i,n,r,o){const s=t.consts,l=lp(t,e,2,n,Wh(s,r));return L_(t,i,l,Wh(s,o)),null!==l.attrs&&hg(l,l.attrs,!1),null!==l.mergedAttrs&&hg(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(s,o,r,t,i,n):o.data[s],c=r[s]=i_(a,t,function dee(){return ii.lFrame.currentNamespace}()),h=P3(l);return Al(l,!0),GA(a,c,l),32!=(32&l.flags)&&Q3(o,r,c,l),0===function ZJ(){return ii.lFrame.elementDepthCount}()&&Fo(c,r),function KJ(){ii.lFrame.elementDepthCount++}(),h&&(O_(o,r,l),I_(o,l,r)),null!==n&&k_(r,l),Ee}function Pe(){let e=bo();z7()?T7():(e=e.parent,Al(e,!1));const t=e;!function JJ(){ii.lFrame.elementDepthCount--}();const i=Oi();return i.firstCreatePass&&(k3(i,e),C7(e)&&i.queries.elementEnd(e)),null!=t.classesWithoutHost&&function gee(e){return 0!=(8&e.flags)}(t)&&G_(i,t,Ae(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function vee(e){return 0!=(16&e.flags)}(t)&&G_(i,t,Ae(),t.stylesWithoutHost,!1),Pe}function Je(e,t,i,n){return Ee(e,t,i,n),Pe(),Je}function Yt(e,t,i){const n=Ae(),r=Oi(),o=e+kn,s=r.firstCreatePass?function ire(e,t,i,n,r){const o=t.consts,s=Wh(o,n),a=lp(t,e,8,"ng-container",s);return null!==s&&hg(a,s,!0),L_(t,i,a,Wh(o,r)),null!==t.queries&&t.queries.elementStart(t,a),a}(o,r,n,t,i):r.data[o];Al(s,!0);const a=n[o]=n[di].createComment("");return Q3(r,n,a,s),Fo(a,n),P3(s)&&(O_(r,n,s),I_(r,s,n)),null!=i&&k_(n,s),Yt}function Gt(){let e=bo();const t=Oi();return z7()?T7():(e=e.parent,Al(e,!1)),t.firstCreatePass&&(k3(t,e),C7(e)&&t.queries.elementEnd(e)),Gt}function Ji(){return Ae()}function ym(e){return!!e&&"function"==typeof e.then}const q_=function hI(e){return!!e&&"function"==typeof e.subscribe};function pt(e,t,i,n){const r=Ae(),o=Oi(),s=bo();return function dI(e,t,i,n,r,o,s){const a=P3(n),c=e.firstCreatePass&&WP(e),h=t[ar],u=GP(t);let d=!0;if(3&n.type||s){const m=qs(n,t),g=s?s(m):m,v=u.length,y=s?b=>s(_o(b[n.index])):n.index;let _=null;if(!s&&a&&(_=function nre(e,t,i,n){const r=e.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const s=r[o];if(s===i&&r[o+1]===n){const a=t[H1],l=r[o+2];return a.length>l?a[l]:null}"string"==typeof s&&(o+=2)}return null}(e,t,r,n.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=o,_.__ngLastListenerFn__=o,d=!1;else{o=fI(n,t,h,o,!1);const b=i.listen(g,r,o);u.push(o,b),c&&c.push(r,y,v,v+1)}}else o=fI(n,t,h,o,!1);const p=n.outputs;let f;if(d&&null!==p&&(f=p[r])){const m=f.length;if(m)for(let g=0;g<m;g+=2){const x=t[f[g]][f[g+1]].subscribe(o),w=u.length;u.push(o,x),c&&c.push(r,n.index,w,-(w+1))}}}(o,r,r[di],s,e,t,n),pt}function pI(e,t,i,n){try{return pa(6,t,i),!1!==i(n)}catch(r){return XP(e,r),!1}finally{pa(7,t,i)}}function fI(e,t,i,n,r){return function o(s){if(s===Function)return n;V_(e.componentOffset>-1?Xs(e.index,t):t);let l=pI(t,i,n,s),c=o.__ngNextListenerFn__;for(;c;)l=pI(t,i,c,s)&&l,c=c.__ngNextListenerFn__;return r&&!1===l&&(s.preventDefault(),s.returnValue=!1),l}}function de(e=1){return function aee(e){return(ii.lFrame.contextLView=function lee(e,t){for(;e>0;)t=t[U1],e--;return t}(e,ii.lFrame.contextLView))[ar]}(e)}function rre(e,t){let i=null;const n=function Iie(e){const t=e.attrs;if(null!=t){const i=t.indexOf(5);if(!(1&i))return t[i+1]}return null}(e);for(let r=0;r<t.length;r++){const o=t[r];if("*"!==o){if(null===n?bP(e,o,!0):Nie(n,o))return r}else i=r}return i}function Ln(e){const t=Ae()[Ro][Lo];if(!t.projection){const n=t.projection=om(e?e.length:1,null),r=n.slice();let o=t.child;for(;null!==o;){const s=e?rre(o,e):0;null!==s&&(r[s]?r[s].projectionNext=o:n[s]=o,r[s]=o),o=o.next}}}function Mi(e,t=0,i){const n=Ae(),r=Oi(),o=lp(r,kn+e,16,null,i||null);null===o.projection&&(o.projection=t),T7(),32!=(32&o.flags)&&function xte(e,t,i){jA(t[di],0,t,i,kA(e,i,t),FA(i.parent||t[Lo],i,t))}(r,n,o)}function fg(e,t){return e<<17|t<<2}function $h(e){return e>>17&32767}function $_(e){return 2|e}function vd(e){return(131068&e)>>2}function Q_(e,t){return-131069&e|t<<2}function Z_(e){return 1|e}function SI(e,t,i,n,r){const o=e[i+1],s=null===t;let a=n?$h(o):vd(o),l=!1;for(;0!==a&&(!1===l||s);){const h=e[a+1];hre(e[a],t)&&(l=!0,e[a+1]=n?Z_(h):$_(h)),a=n?$h(h):vd(h)}l&&(e[i+1]=n?$_(o):Z_(o))}function hre(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&J1(e,t)>=0}function Xn(e,t,i){return qa(e,t,i,!1),Xn}function Dt(e,t){return qa(e,t,null,!0),Dt}function qa(e,t,i,n){const r=Ae(),o=Oi(),s=function kc(e){const t=ii.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}(2);o.firstUpdatePass&&function II(e,t,i,n){const r=e.data;if(null===r[i+1]){const o=r[rs()],s=function PI(e,t){return t>=e.expandoStartIndex}(e,i);(function LI(e,t){return 0!=(e.flags&(t?8:16))})(o,n)&&null===t&&!s&&(t=!1),t=function _re(e,t,i,n){const r=D7(e);let o=n?t.residualClasses:t.residualStyles;if(null===r)0===(n?t.classBindings:t.styleBindings)&&(i=_m(i=K_(null,e,t,i,n),t.attrs,n),o=null);else{const s=t.directiveStylingLast;if(-1===s||e[s]!==r)if(i=K_(r,e,t,i,n),null===o){let l=function bre(e,t,i){const n=i?t.classBindings:t.styleBindings;if(0!==vd(n))return e[$h(n)]}(e,t,n);void 0!==l&&Array.isArray(l)&&(l=K_(null,e,t,l[1],n),l=_m(l,t.attrs,n),function xre(e,t,i,n){e[$h(i?t.classBindings:t.styleBindings)]=n}(e,t,n,l))}else o=function wre(e,t,i){let n;const r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++)n=_m(n,e[o].hostAttrs,i);return _m(n,t.attrs,i)}(e,t,n)}return void 0!==o&&(n?t.residualClasses=o:t.residualStyles=o),i}(r,o,t,n),function lre(e,t,i,n,r,o){let s=o?t.classBindings:t.styleBindings,a=$h(s),l=vd(s);e[n]=i;let h,c=!1;if(Array.isArray(i)?(h=i[1],(null===h||J1(i,h)>0)&&(c=!0)):h=i,r)if(0!==l){const d=$h(e[a+1]);e[n+1]=fg(d,a),0!==d&&(e[d+1]=Q_(e[d+1],n)),e[a+1]=function sre(e,t){return 131071&e|t<<17}(e[a+1],n)}else e[n+1]=fg(a,0),0!==a&&(e[a+1]=Q_(e[a+1],n)),a=n;else e[n+1]=fg(l,0),0===a?a=n:e[l+1]=Q_(e[l+1],n),l=n;c&&(e[n+1]=$_(e[n+1])),SI(e,h,n,!0),SI(e,h,n,!1),function cre(e,t,i,n,r){const o=r?e.residualClasses:e.residualStyles;null!=o&&"string"==typeof t&&J1(o,t)>=0&&(i[n+1]=Z_(i[n+1]))}(t,h,e,n,o),s=fg(a,l),o?t.classBindings=s:t.styleBindings=s}(r,o,t,i,s,n)}}(o,e,s,n),t!==ni&&Vo(r,s,t)&&function kI(e,t,i,n,r,o,s,a){if(!(3&t.type))return;const l=e.data,c=l[a+1],h=function are(e){return 1==(1&e)}(c)?NI(l,t,i,r,vd(c),s):void 0;mg(h)||(mg(o)||function ore(e){return 2==(2&e)}(c)&&(o=NI(l,null,i,r,a,s)),function Cte(e,t,i,n,r){if(t)r?e.addClass(i,n):e.removeClass(i,n);else{let o=-1===n.indexOf("-")?void 0:Ts.DashCase;null==r?e.removeStyle(i,n,o):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=Ts.Important),e.setStyle(i,n,r,o))}}(n,s,I3(rs(),i),r,o))}(o,o.data[rs()],r,r[di],e,r[s+1]=function Mre(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=zn(Qs(e)))),e}(t,i),n,s)}function K_(e,t,i,n,r){let o=null;const s=i.directiveEnd;let a=i.directiveStylingLast;for(-1===a?a=i.directiveStart:a++;a<s&&(o=t[a],n=_m(n,o.hostAttrs,r),o!==e);)a++;return null!==e&&(i.directiveStylingLast=a),n}function _m(e,t,i){const n=i?1:2;let r=-1;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?r=s:r===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),$s(e,s,!!i||t[++o]))}return void 0===e?null:e}function NI(e,t,i,n,r,o){const s=null===t;let a;for(;r>0;){const l=e[r],c=Array.isArray(l),h=c?l[1]:l,u=null===h;let d=i[r+1];d===ni&&(d=u?Hi:void 0);let p=u?j7(d,n):h===n?d:void 0;if(c&&!mg(p)&&(p=j7(l,n)),mg(p)&&(a=p,s))return a;const f=e[r+1];r=s?$h(f):vd(f)}if(null!==t){let l=o?t.residualClasses:t.residualStyles;null!=l&&(a=j7(l,n))}return a}function mg(e){return void 0!==e}function zi(e,t=""){const i=Ae(),n=Oi(),r=e+kn,o=n.firstCreatePass?lp(n,r,1,t,null):n.data[r],s=i[r]=function t_(e,t){return e.createText(t)}(i[di],t);Q3(n,i,s,o),Al(o,!1)}function cr(e){return $a("",e,""),cr}function $a(e,t,i){const n=Ae(),r=function hp(e,t,i,n){return Vo(e,W1(),i)?t+ti(i)+n:ni}(n,e,t,i);return r!==ni&&function Fc(e,t,i){const n=I3(t,e);!function PA(e,t,i){e.setValue(t,i)}(e[di],n,i)}(n,rs(),r),$a}function gg(e,t,i){const n=Ae();if(Vo(n,W1(),t)){const o=Oi(),s=qn();Zs(o,s,n,e,t,function qP(e,t,i){return(null===e||Ga(e))&&(i=function qJ(e){for(;Array.isArray(e);){if("object"==typeof e[w7])return e;e=e[Ic]}return null}(i[t.index])),i[di]}(D7(o.data),s,n),i,!0)}return gg}let _p={};var nt=(()=>((nt=nt||{})[nt.LocaleId=0]="LocaleId",nt[nt.DayPeriodsFormat=1]="DayPeriodsFormat",nt[nt.DayPeriodsStandalone=2]="DayPeriodsStandalone",nt[nt.DaysFormat=3]="DaysFormat",nt[nt.DaysStandalone=4]="DaysStandalone",nt[nt.MonthsFormat=5]="MonthsFormat",nt[nt.MonthsStandalone=6]="MonthsStandalone",nt[nt.Eras=7]="Eras",nt[nt.FirstDayOfWeek=8]="FirstDayOfWeek",nt[nt.WeekendRange=9]="WeekendRange",nt[nt.DateFormat=10]="DateFormat",nt[nt.TimeFormat=11]="TimeFormat",nt[nt.DateTimeFormat=12]="DateTimeFormat",nt[nt.NumberSymbols=13]="NumberSymbols",nt[nt.NumberFormats=14]="NumberFormats",nt[nt.CurrencyCode=15]="CurrencyCode",nt[nt.CurrencySymbol=16]="CurrencySymbol",nt[nt.CurrencyName=17]="CurrencyName",nt[nt.Currencies=18]="Currencies",nt[nt.Directionality=19]="Directionality",nt[nt.PluralCase=20]="PluralCase",nt[nt.ExtraData=21]="ExtraData",nt))();const bp="en-US";let nO=bp;function t9(e,t,i,n,r){if(e=Bt(e),Array.isArray(e))for(let o=0;o<e.length;o++)t9(e[o],t,i,n,r);else{const o=Oi(),s=Ae();let a=md(e)?e:Bt(e.provide),l=pP(e);const c=bo(),h=1048575&c.providerIndexes,u=c.directiveStart,d=c.providerIndexes>>20;if(md(e)||!e.multi){const p=new tm(l,r,L),f=r9(a,t,r?h:h+d,u);-1===f?(V7(V3(c,s),o,a),n9(o,e,t.length),t.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),i.push(p),s.push(p)):(i[f]=p,s[f]=p)}else{const p=r9(a,t,h+d,u),f=r9(a,t,h,h+d),g=f>=0&&i[f];if(r&&!g||!r&&!(p>=0&&i[p])){V7(V3(c,s),o,a);const v=function Yoe(e,t,i,n,r){const o=new tm(e,i,L);return o.multi=[],o.index=t,o.componentProviders=0,EO(o,r,n&&!i),o}(r?joe:Uoe,i.length,r,n,l);!r&&g&&(i[f].providerFactory=v),n9(o,e,t.length,0),t.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),i.push(v),s.push(v)}else n9(o,e,p>-1?p:f,EO(i[r?f:p],l,!r&&n));!r&&n&&g&&i[f].componentProviders++}}}function n9(e,t,i,n){const r=md(t),o=function nie(e){return!!e.useClass}(t);if(r||o){const l=(o?Bt(t.useClass):t).prototype.ngOnDestroy;if(l){const c=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const h=c.indexOf(i);-1===h?c.push(i,[n,l]):c[h+1].push(n,l)}else c.push(i,l)}}}function EO(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function r9(e,t,i,n){for(let r=i;r<n;r++)if(t[r]===e)return r;return-1}function Uoe(e,t,i,n){return o9(this.multi,[])}function joe(e,t,i,n){const r=this.multi;let o;if(this.providerFactory){const s=this.providerFactory.componentProviders,a=cd(i,i[at],this.providerFactory.index,n);o=a.slice(0,s),o9(r,o);for(let l=s;l<a.length;l++)o.push(a[l])}else o=[],o9(r,o);return o}function o9(e,t){for(let i=0;i<e.length;i++)t.push((0,e[i])());return t}function vi(e,t=[]){return i=>{i.providersResolver=(n,r)=>function Hoe(e,t,i){const n=Oi();if(n.firstCreatePass){const r=Ga(e);t9(i,n.data,n.blueprint,r,!0),t9(t,n.data,n.blueprint,r,!1)}}(n,r?r(e):e,t)}}class xp{}class DO{}class AO extends xp{constructor(t,i){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $P(this);const n=Gs(t);this._bootstrapComponents=Rc(n.bootstrap),this._r3Injector=TP(t,i,[{provide:xp,useValue:this},{provide:Lc,useValue:this.componentFactoryResolver}],zn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class s9 extends DO{constructor(t){super(),this.moduleType=t}create(t){return new AO(this.moduleType,t)}}class Woe extends xp{constructor(t,i,n){super(),this.componentFactoryResolver=new $P(this),this.instance=null;const r=new dP([...t,{provide:xp,useValue:this},{provide:Lc,useValue:this.componentFactoryResolver}],i||rg(),n,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function xg(e,t,i=null){return new Woe(e,t,i).injector}let qoe=(()=>{class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i.id)){const n=lP(0,i.type),r=n.length>0?xg([n],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i.id,r)}return this.cachedInjectors.get(i.id)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=Oe({token:e,providedIn:"environment",factory:()=>new e(he(Ol))}),e})();function a9(e){e.getStandaloneInjector=t=>t.get(qoe).getOrCreateStandaloneInjector(e)}function Cg(e,t,i,n){return function RO(e,t,i,n,r,o){const s=t+i;return Vo(e,s,r)?Nl(e,s+1,o?n.call(o,r):n(r)):Mm(e,s+1)}(Ae(),ns(),e,t,i,n)}function Sg(e,t,i,n,r){return function FO(e,t,i,n,r,o,s){const a=t+i;return function gd(e,t,i,n){const r=Vo(e,t,i);return Vo(e,t+1,n)||r}(e,a,r,o)?Nl(e,a+2,s?n.call(s,r,o):n(r,o)):Mm(e,a+2)}(Ae(),ns(),e,t,i,n,r)}function Mm(e,t){const i=e[t];return i===ni?void 0:i}function c9(e){return t=>{setTimeout(e,void 0,t)}}const Re=class gse extends He{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,i,n){let r=t,o=i||(()=>null),s=n;if(t&&"object"==typeof t){const l=t;r=l.next?.bind(l),o=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(o=c9(o),r&&(r=c9(r)),s&&(s=c9(s)));const a=super.subscribe({next:r,error:o,complete:s});return t instanceof Vi&&t.add(a),a}};function vse(){return this._results[Symbol.iterator]()}class _d{get changes(){return this._changes||(this._changes=new Re)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=_d.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=vse)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){const n=this;n.dirty=!1;const r=function fa(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function Tee(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],o=t[n];if(i&&(r=i(r),o=i(o)),o!==r)return!1}return!0}(n._results,r,i))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Tn=(()=>{class e{}return e.__NG_ELEMENT_ID__=bse,e})();const yse=Tn,_se=class extends yse{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}createEmbeddedView(t,i){const n=this._declarationTContainer.tView,r=sg(this._declarationLView,n,t,16,null,n.declTNode,null,null,null,null,i||null);r[Z0]=this._declarationLView[this._declarationTContainer.index];const s=this._declarationLView[Dl];return null!==s&&(r[Dl]=s.createEmbeddedView(n)),P_(n,r,t),new mm(r)}};function bse(){return Mg(bo(),Ae())}function Mg(e,t){return 4&e.type?new _se(t,e,rp(e,t)):null}let $n=(()=>{class e{}return e.__NG_ELEMENT_ID__=xse,e})();function xse(){return YO(bo(),Ae())}const wse=$n,UO=class extends wse{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return rp(this._hostTNode,this._hostLView)}get injector(){return new X1(this._hostTNode,this._hostLView)}get parentInjector(){const t=B7(this._hostTNode,this._hostLView);if(ZD(t)){const i=F3(t,this._hostLView),n=R3(t);return new X1(i[at].data[n+8],i)}return new X1(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const i=jO(this._lContainer);return null!==i&&i[t]||null}get length(){return this._lContainer.length-is}createEmbeddedView(t,i,n){let r,o;"number"==typeof n?r=n:null!=n&&(r=n.index,o=n.injector);const s=t.createEmbeddedView(i||{},o);return this.insert(s,r),s}createComponent(t,i,n,r,o){const s=t&&!function rm(e){return"function"==typeof e}(t);let a;if(s)a=i;else{const u=i||{};a=u.index,n=u.injector,r=u.projectableNodes,o=u.environmentInjector||u.ngModuleRef}const l=s?t:new gm(Ki(t)),c=n||this.parentInjector;if(!o&&null==l.ngModule){const d=(s?c:this.parentInjector).get(Ol,null);d&&(o=d)}const h=l.create(c,r,void 0,o);return this.insert(h.hostView,a),h}insert(t,i){const n=t._lView,r=n[at];if(function QJ(e){return Ya(e[er])}(n)){const h=this.indexOf(t);if(-1!==h)this.detach(h);else{const u=n[er],d=new UO(u,u[Lo],u[er]);d.detach(d.indexOf(t))}}const o=this._adjustIndex(i),s=this._lContainer;!function mte(e,t,i,n){const r=is+n,o=i.length;n>0&&(i[r-1][ja]=t),n<o-is?(t[ja]=i[r],cA(i,is+n,t)):(i.push(t),t[ja]=null),t[er]=i;const s=t[Z0];null!==s&&i!==s&&function gte(e,t){const i=e[Y1];t[Ro]!==t[er][er][Ro]&&(e[MD]=!0),null===i?e[Y1]=[t]:i.push(t)}(s,t);const a=t[Dl];null!==a&&a.insertView(e),t[hi]|=64}(r,n,s,o);const a=s_(o,s),l=n[di],c=$3(l,s[D3]);return null!==c&&function dte(e,t,i,n,r,o){n[Ic]=r,n[Lo]=t,hm(e,n,i,1,r,o)}(r,s[Lo],l,n,c,a),t.attachToViewContainerRef(),cA(h9(s),o,t),t}move(t,i){return this.insert(t,i)}indexOf(t){const i=jO(this._lContainer);return null!==i?i.indexOf(t):-1}remove(t){const i=this._adjustIndex(t,-1),n=n_(this._lContainer,i);n&&(Y3(h9(this._lContainer),i),OA(n[at],n))}detach(t){const i=this._adjustIndex(t,-1),n=n_(this._lContainer,i);return n&&null!=Y3(h9(this._lContainer),i)?new mm(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function jO(e){return e[A3]}function h9(e){return e[A3]||(e[A3]=[])}function YO(e,t){let i;const n=t[e.index];if(Ya(n))i=n;else{let r;if(8&e.type)r=_o(n);else{const o=t[di];r=o.createComment("");const s=qs(e,t);dd(o,$3(o,s),r,function bte(e,t){return e.nextSibling(t)}(o,s),!1)}t[e.index]=i=YP(n,t,r,e),lg(t,i)}return new UO(i,e,t)}class u9{constructor(t){this.queryList=t,this.matches=null}clone(){return new u9(this.queryList)}setDirty(){this.queryList.setDirty()}}class d9{constructor(t=[]){this.queries=t}createEmbeddedView(t){const i=t.queries;if(null!==i){const n=null!==t.contentQueries?t.contentQueries[0]:i.length,r=[];for(let o=0;o<n;o++){const s=i.getByIndex(o);r.push(this.queries[s.indexInDeclarationView].clone())}return new d9(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)null!==$O(t,i).matches&&this.queries[i].setDirty()}}class GO{constructor(t,i,n=null){this.predicate=t,this.flags=i,this.read=n}}class p9{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){const r=null!==i?i.length:0,o=this.getByIndex(n).embeddedTView(t,r);o&&(o.indexInDeclarationView=n,null!==i?i.push(o):i=[o])}return null!==i?new p9(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class f9{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new f9(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==i;)n=n.parent;return i===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const o=n[r];this.matchTNodeWithReadOption(t,i,Cse(i,o)),this.matchTNodeWithReadOption(t,i,H3(i,t,o,!1,!1))}else n===Tn?4&i.type&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,H3(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===yt||r===$n||r===Tn&&4&i.type)this.addMatch(i.index,-2);else{const o=H3(i,t,r,!1,!1);null!==o&&this.addMatch(i.index,o)}else this.addMatch(i.index,n)}}addMatch(t,i){null===this.matches?this.matches=[t,i]:this.matches.push(t,i)}}function Cse(e,t){const i=e.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1];return null}function Mse(e,t,i,n){return-1===i?function Sse(e,t){return 11&e.type?rp(e,t):4&e.type?Mg(e,t):null}(t,e):-2===i?function zse(e,t,i){return i===yt?rp(t,e):i===Tn?Mg(t,e):i===$n?YO(t,e):void 0}(e,t,n):cd(e,e[at],i,t)}function WO(e,t,i,n){const r=t[Dl].queries[n];if(null===r.matches){const o=e.data,s=i.matches,a=[];for(let l=0;l<s.length;l+=2){const c=s[l];a.push(c<0?null:Mse(t,o[c],s[l+1],i.metadata.read))}r.matches=a}return r.matches}function m9(e,t,i,n){const r=e.queries.getByIndex(i),o=r.matches;if(null!==o){const s=WO(e,t,r,i);for(let a=0;a<o.length;a+=2){const l=o[a];if(l>0)n.push(s[a/2]);else{const c=o[a+1],h=t[-l];for(let u=is;u<h.length;u++){const d=h[u];d[Z0]===d[er]&&m9(d[at],d,c,n)}if(null!==h[Y1]){const u=h[Y1];for(let d=0;d<u.length;d++){const p=u[d];m9(p[at],p,c,n)}}}}}return n}function Mt(e){const t=Ae(),i=Oi(),n=HD();A7(n+1);const r=$O(i,n);if(e.dirty&&function $J(e){return 4==(4&e[hi])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)e.reset([]);else{const o=r.crossesNgTemplate?m9(i,t,n,[]):WO(i,t,r,n);e.reset(o,fie),e.notifyOnChanges()}return!0}return!1}function Ui(e,t,i){const n=Oi();n.firstCreatePass&&(XO(n,new GO(e,t,i),-1),2==(2&t)&&(n.staticViewQueries=!0)),qO(n,Ae(),t)}function Un(e,t,i,n){const r=Oi();if(r.firstCreatePass){const o=bo();XO(r,new GO(t,i,n),o.index),function Ese(e,t){const i=e.contentQueries||(e.contentQueries=[]);t!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,t)}(r,e),2==(2&i)&&(r.staticContentQueries=!0)}qO(r,Ae(),i)}function zt(){return function Tse(e,t){return e[Dl].queries[t].queryList}(Ae(),HD())}function qO(e,t,i){const n=new _d(4==(4&i));FP(e,t,n,n.destroy),null===t[Dl]&&(t[Dl]=new d9),t[Dl].queries.push(new u9(n))}function XO(e,t,i){null===e.queries&&(e.queries=new p9),e.queries.track(new f9(t,i))}function $O(e,t){return e.queries.getByIndex(t)}function jn(e,t){return Mg(e,t)}function Tg(...e){}const Em=new Fe("Application Initializer");let Eg=(()=>{class e{constructor(i){this.appInits=i,this.resolve=Tg,this.reject=Tg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r})}runInitializers(){if(this.initialized)return;const i=[],n=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const o=this.appInits[r]();if(ym(o))i.push(o);else if(q_(o)){const s=new Promise((a,l)=>{o.subscribe({complete:a,error:l})});i.push(s)}}Promise.all(i).then(()=>{n()}).catch(r=>{this.reject(r)}),0===i.length&&n(),this.initialized=!0}}return e.\u0275fac=function(i){return new(i||e)(he(Em,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Dm=new Fe("AppId",{providedIn:"root",factory:function pk(){return`${x9()}${x9()}${x9()}`}});function x9(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const fk=new Fe("Platform Initializer"),Dg=new Fe("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Am=new Fe("AnimationModuleType");let Xse=(()=>{class e{log(i){console.log(i)}warn(i){console.warn(i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Bc=new Fe("LocaleId",{providedIn:"root",factory:()=>si(Bc,Vt.Optional|Vt.SkipSelf)||function $se(){return typeof $localize<"u"&&$localize.locale||bp}()});class Zse{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}}let mk=(()=>{class e{compileModuleSync(i){return new s9(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const n=this.compileModuleSync(i),o=Rc(Gs(i).declarations).reduce((s,a)=>{const l=Ki(a);return l&&s.push(new gm(l)),s},[]);return new Zse(n,o)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const eae=(()=>Promise.resolve(0))();function w9(e){typeof Zone>"u"?eae.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Pt{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Re(!1),this.onMicrotaskEmpty=new Re(!1),this.onStable=new Re(!1),this.onError=new Re(!1),typeof Zone>"u")throw new xe(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&i,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function tae(){let e=On.requestAnimationFrame,t=On.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function rae(e){const t=()=>{!function nae(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(On,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,S9(e),e.isCheckStableRunning=!0,C9(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),S9(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,o,s,a)=>{try{return yk(e),i.invokeTask(r,o,s,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||e.shouldCoalesceRunChangeDetection)&&t(),_k(e)}},onInvoke:(i,n,r,o,s,a,l)=>{try{return yk(e),i.invoke(r,o,s,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),_k(e)}},onHasTask:(i,n,r,o)=>{i.hasTask(r,o),n===r&&("microTask"==o.change?(e._hasPendingMicrotasks=o.microTask,S9(e),C9(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,n,r,o)=>(i.handleError(r,o),e.runOutsideAngular(()=>e.onError.emit(o)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Pt.isInAngularZone())throw new xe(909,!1)}static assertNotInAngularZone(){if(Pt.isInAngularZone())throw new xe(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,r){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,t,iae,Tg,Tg);try{return o.runTask(s,i,n)}finally{o.cancelTask(s)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}}const iae={};function C9(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function S9(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function yk(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function _k(e){e._nesting--,C9(e)}class oae{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Re,this.onMicrotaskEmpty=new Re,this.onStable=new Re,this.onError=new Re}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,r){return t.apply(i,n)}}const bk=new Fe(""),Ag=new Fe("");let T9,M9=(()=>{class e{constructor(i,n,r){this._ngZone=i,this.registry=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,T9||(function sae(e){T9=e}(r),r.addToWindow(n)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Pt.assertNotInAngularZone(),w9(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())w9(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(n=>!n.updateCb||!n.updateCb(i)||(clearTimeout(n.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,n,r){let o=-1;n&&n>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),i(this._didWork,this.getPendingTasks())},n)),this._callbacks.push({doneCb:i,timeoutId:o,updateCb:r})}whenStable(i,n,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,n,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,n,r){return[]}}return e.\u0275fac=function(i){return new(i||e)(he(Pt),he(z9),he(Ag))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),z9=(()=>{class e{constructor(){this._applications=new Map}registerApplication(i,n){this._applications.set(i,n)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,n=!0){return T9?.findTestabilityInTree(this,i,n)??null}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Vc=!1;let Qh=null;const xk=new Fe("AllowMultipleToken"),E9=new Fe("PlatformDestroyListeners"),wk=new Fe("appBootstrapListener");class Ck{constructor(t,i){this.name=t,this.token=i}}function Mk(e,t,i=[]){const n=`Platform: ${t}`,r=new Fe(n);return(o=[])=>{let s=D9();if(!s||s.injector.get(xk,!1)){const a=[...i,...o,{provide:r,useValue:!0}];e?e(a):function cae(e){if(Qh&&!Qh.get(xk,!1))throw new xe(400,!1);Qh=e;const t=e.get(Tk);(function Sk(e){const t=e.get(fk,null);t&&t.forEach(i=>i())})(e)}(function zk(e=[],t){return Bo.create({name:t,providers:[{provide:__,useValue:"platform"},{provide:E9,useValue:new Set([()=>Qh=null])},...e]})}(a,n))}return function uae(e){const t=D9();if(!t)throw new xe(401,!1);return t}()}}function D9(){return Qh?.get(Tk)??null}let Tk=(()=>{class e{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,n){const r=function Dk(e,t){let i;return i="noop"===e?new oae:("zone.js"===e?void 0:e)||new Pt(t),i}(n?.ngZone,function Ek(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(n)),o=[{provide:Pt,useValue:r}];return r.run(()=>{const s=Bo.create({providers:o,parent:this.injector,name:i.moduleType.name}),a=i.create(s),l=a.injector.get(op,null);if(!l)throw new xe(402,!1);return r.runOutsideAngular(()=>{const c=r.onError.subscribe({next:h=>{l.handleError(h)}});a.onDestroy(()=>{Pg(this._modules,a),c.unsubscribe()})}),function Ak(e,t,i){try{const n=i();return ym(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(l,r,()=>{const c=a.injector.get(Eg);return c.runInitializers(),c.donePromise.then(()=>(function rO(e){ua(e,"Expected localeId to be defined"),"string"==typeof e&&(nO=e.toLowerCase().replace(/_/g,"-"))}(a.injector.get(Bc,bp)||bp),this._moduleDoBootstrap(a),a))})})}bootstrapModule(i,n=[]){const r=Pk({},n);return function aae(e,t,i){const n=new s9(i);return Promise.resolve(n)}(0,0,i).then(o=>this.bootstrapModuleFactory(o,r))}_moduleDoBootstrap(i){const n=i.injector.get(Sp);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(r=>n.bootstrap(r));else{if(!i.instance.ngDoBootstrap)throw new xe(-403,!1);i.instance.ngDoBootstrap(n)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new xe(404,!1);this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n());const i=this._injector.get(E9,null);i&&(i.forEach(n=>n()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(i){return new(i||e)(he(Bo))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function Pk(e,t){return Array.isArray(t)?t.reduce(Pk,e):{...e,...t}}let Sp=(()=>{class e{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(i,n,r){this._zone=i,this._injector=n,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new Li(a=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{a.next(this._stable),a.complete()})}),s=new Li(a=>{let l;this._zone.runOutsideAngular(()=>{l=this._zone.onStable.subscribe(()=>{Pt.assertNotInAngularZone(),w9(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,a.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Pt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{a.next(!1)}))});return()=>{l.unsubscribe(),c.unsubscribe()}});this.isStable=ts(o,s.pipe(c7()))}bootstrap(i,n){const r=i instanceof fP;if(!this._injector.get(Eg).done){!r&&function V1(e){const t=Ki(e)||No(e)||zs(e);return null!==t&&t.standalone}(i);throw new xe(405,Vc)}let s;s=r?i:this._injector.get(Lc).resolveComponentFactory(i),this.componentTypes.push(s.componentType);const a=function lae(e){return e.isBoundToModule}(s)?void 0:this._injector.get(xp),c=s.create(Bo.NULL,[],n||s.selector,a),h=c.location.nativeElement,u=c.injector.get(bk,null);return u?.registerApplication(h),c.onDestroy(()=>{this.detachView(c.hostView),Pg(this.components,c),u?.unregisterApplication(h)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new xe(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(i))}finally{this._runningTick=!1}}attachView(i){const n=i;this._views.push(n),n.attachToAppRef(this)}detachView(i){const n=i;Pg(this._views,n),n.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const n=this._injector.get(wk,[]);n.push(...this._bootstrapListeners),n.forEach(r=>r(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>Pg(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new xe(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(i){return new(i||e)(he(Pt),he(Ol),he(op))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Pg(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}let Ri=(()=>{class e{}return e.__NG_ELEMENT_ID__=pae,e})();function pae(e){return function fae(e,t,i){if(J0(e)&&!i){const n=Xs(e.index,t);return new mm(n,n)}return 47&e.type?new mm(t[Ro],t):null}(bo(),Ae(),16==(16&e))}class Rk{constructor(){}supports(t){return dg(t)}create(t){return new bae(t)}}const _ae=(e,t)=>t;class bae{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||_ae}forEachItem(t){let i;for(i=this._itHead;null!==i;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,r=0,o=null;for(;i||n;){const s=!n||i&&i.currentIndex<Bk(n,r,o)?i:n,a=Bk(s,r,o),l=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(i=i._next,null==s.previousIndex)r++;else{o||(o=[]);const c=a-r,h=l-r;if(c!=h){for(let d=0;d<c;d++){const p=d<o.length?o[d]:o[d]=0,f=p+d;h<=f&&f<c&&(o[d]=p+1)}o[s.previousIndex]=h-c}}a!==l&&t(s,a,l)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)t(i)}diff(t){if(null==t&&(t=[]),!dg(t))throw new xe(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,o,s,i=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),null!==i&&Object.is(i.trackById,s)?(n&&(i=this._verifyReinsertion(i,o,s,a)),Object.is(i.item,o)||this._addIdentityChange(i,o)):(i=this._mismatch(i,o,s,a),n=!0),i=i._next}else r=0,function Qne(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{const i=e[Symbol.iterator]();let n;for(;!(n=i.next()).done;)t(n.value)}}(t,a=>{s=this._trackByFn(r,a),null!==i&&Object.is(i.trackById,s)?(n&&(i=this._verifyReinsertion(i,a,s,r)),Object.is(i.item,a)||this._addIdentityChange(i,a)):(i=this._mismatch(i,a,s,r),n=!0),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,r){let o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,o,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,o,r)):t=this._addAfter(new xae(i,n),o,r),t}_verifyReinsertion(t,i,n,r){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==o?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const i=t._next;this._addToRemovals(this._unlink(t)),t=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,o=t._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){const r=null===i?this._itHead:i._next;return t._next=r,t._prev=i,null===r?this._itTail=t:r._prev=t,null===i?this._itHead=t:i._next=t,null===this._linkedRecords&&(this._linkedRecords=new Fk),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const i=t._prev,n=t._next;return null===i?this._itHead=n:i._next=n,null===n?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Fk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class xae{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class wae{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===i||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const i=t._prevDup,n=t._nextDup;return null===i?this._head=n:i._nextDup=n,null===n?this._tail=i:n._prevDup=i,null===this._head}}class Fk{constructor(){this.map=new Map}put(t){const i=t.trackById;let n=this.map.get(i);n||(n=new wae,this.map.set(i,n)),n.add(t)}get(t,i){const r=this.map.get(t);return r?r.get(t,i):null}remove(t){const i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Bk(e,t,i){const n=e.previousIndex;if(null===n)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+t+r}class Vk{constructor(){}supports(t){return t instanceof Map||Y_(t)}create(){return new Cae}}class Cae{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let i;for(i=this._mapHead;null!==i;i=i._next)t(i)}forEachPreviousItem(t){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)t(i)}forEachChangedItem(t){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}diff(t){if(t){if(!(t instanceof Map||Y_(t)))throw new xe(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,r)=>{if(i&&i.key===r)this._maybeAddToChanges(i,n),this._appendAfter=i,i=i._next;else{const o=this._getOrCreateRecordForKey(r,n);i=this._insertBeforeOrAppend(i,o)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,i){if(t){const n=t._prev;return i._next=t,i._prev=n,t._prev=i,n&&(n._next=i),t===this._mapHead&&(this._mapHead=i),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(t,i){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,i);const o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}const n=new Sae(t);return this._records.set(t,n),n.currentValue=i,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,i){Object.is(i,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=i,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,i){t instanceof Map?t.forEach(i):Object.keys(t).forEach(n=>i(t[n],n))}}class Sae{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Hk(){return new Pm([new Rk])}let Pm=(()=>{class e{constructor(i){this.factories=i}static create(i,n){if(null!=n){const r=n.factories.slice();i=i.concat(r)}return new e(i)}static extend(i){return{provide:e,useFactory:n=>e.create(i,n||Hk()),deps:[[e,new ud,new qh]]}}find(i){const n=this.factories.find(r=>r.supports(i));if(null!=n)return n;throw new xe(901,!1)}}return e.\u0275prov=Oe({token:e,providedIn:"root",factory:Hk}),e})();function Uk(){return new Im([new Vk])}let Im=(()=>{class e{constructor(i){this.factories=i}static create(i,n){if(n){const r=n.factories.slice();i=i.concat(r)}return new e(i)}static extend(i){return{provide:e,useFactory:n=>e.create(i,n||Uk()),deps:[[e,new ud,new qh]]}}find(i){const n=this.factories.find(r=>r.supports(i));if(n)return n;throw new xe(901,!1)}}return e.\u0275prov=Oe({token:e,providedIn:"root",factory:Uk}),e})();const Tae=Mk(null,"core",[]);let Eae=(()=>{class e{constructor(i){}}return e.\u0275fac=function(i){return new(i||e)(he(Sp))},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();function Mp(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let k9=null;function Hc(){return k9}class Pae{}const _i=new Fe("DocumentToken");let N9=(()=>{class e{historyGo(i){throw new Error("Not implemented")}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return function Iae(){return he(jk)}()},providedIn:"platform"}),e})();const Oae=new Fe("Location Initialized");let jk=(()=>{class e extends N9{constructor(i){super(),this._doc=i,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Hc().getBaseHref(this._doc)}onPopState(i){const n=Hc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",i,!1),()=>n.removeEventListener("popstate",i)}onHashChange(i){const n=Hc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",i,!1),()=>n.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,n,r){Yk()?this._history.pushState(i,n,r):this._location.hash=r}replaceState(i,n,r){Yk()?this._history.replaceState(i,n,r):this._location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:function(){return function kae(){return new jk(he(_i))}()},providedIn:"platform"}),e})();function Yk(){return!!window.history.pushState}function L9(e,t){if(0==e.length)return t;if(0==t.length)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,2==i?e+t.substring(1):1==i?e+t:e+"/"+t}function Gk(e){const t=e.match(/#|\?|$/),i=t&&t.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Uc(e){return e&&"?"!==e[0]?"?"+e:e}let xd=(()=>{class e{historyGo(i){throw new Error("Not implemented")}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return si(qk)},providedIn:"root"}),e})();const Wk=new Fe("appBaseHref");let qk=(()=>{class e extends xd{constructor(i,n){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??si(_i).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return L9(this._baseHref,i)}path(i=!1){const n=this._platformLocation.pathname+Uc(this._platformLocation.search),r=this._platformLocation.hash;return r&&i?`${n}${r}`:n}pushState(i,n,r,o){const s=this.prepareExternalUrl(r+Uc(o));this._platformLocation.pushState(i,n,s)}replaceState(i,n,r,o){const s=this.prepareExternalUrl(r+Uc(o));this._platformLocation.replaceState(i,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}}return e.\u0275fac=function(i){return new(i||e)(he(N9),he(Wk,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Nae=(()=>{class e extends xd{constructor(i,n){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=n&&(this._baseHref=n)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let n=this._platformLocation.hash;return null==n&&(n="#"),n.length>0?n.substring(1):n}prepareExternalUrl(i){const n=L9(this._baseHref,i);return n.length>0?"#"+n:n}pushState(i,n,r,o){let s=this.prepareExternalUrl(r+Uc(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(i,n,s)}replaceState(i,n,r,o){let s=this.prepareExternalUrl(r+Uc(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(i,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}}return e.\u0275fac=function(i){return new(i||e)(he(N9),he(Wk,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),kg=(()=>{class e{constructor(i){this._subject=new Re,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const n=this._locationStrategy.getBaseHref();this._basePath=function Fae(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(Gk(Xk(n))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,n=""){return this.path()==this.normalize(i+Uc(n))}normalize(i){return e.stripTrailingSlash(function Rae(e,t){if(!e||!t.startsWith(e))return t;const i=t.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:t}(this._basePath,Xk(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,n="",r=null){this._locationStrategy.pushState(r,"",i,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Uc(n)),r)}replaceState(i,n="",r=null){this._locationStrategy.replaceState(r,"",i,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Uc(n)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)})),()=>{const n=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",n){this._urlChangeListeners.forEach(r=>r(i,n))}subscribe(i,n,r){return this._subject.subscribe({next:i,error:n,complete:r})}}return e.normalizeQueryParams=Uc,e.joinWithSlash=L9,e.stripTrailingSlash=Gk,e.\u0275fac=function(i){return new(i||e)(he(xd))},e.\u0275prov=Oe({token:e,factory:function(){return function Lae(){return new kg(he(xd))}()},providedIn:"root"}),e})();function Xk(e){return e.replace(/\/index.html$/,"")}function nN(e,t){t=encodeURIComponent(t);for(const i of e.split(";")){const n=i.indexOf("="),[r,o]=-1==n?[i,""]:[i.slice(0,n),i.slice(n+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}const W9=/\s+/,rN=[];let Nm=(()=>{class e{constructor(i,n,r,o){this._iterableDiffers=i,this._keyValueDiffers=n,this._ngEl=r,this._renderer=o,this.initialClasses=rN,this.stateMap=new Map}set klass(i){this.initialClasses=null!=i?i.trim().split(W9):rN}set ngClass(i){this.rawClass="string"==typeof i?i.trim().split(W9):i}ngDoCheck(){for(const n of this.initialClasses)this._updateState(n,!0);const i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(const n of i)this._updateState(n,!0);else if(null!=i)for(const n of Object.keys(i))this._updateState(n,Boolean(i[n]));this._applyStateDiff()}_updateState(i,n){const r=this.stateMap.get(i);void 0!==r?(r.enabled!==n&&(r.changed=!0,r.enabled=n),r.touched=!0):this.stateMap.set(i,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(const i of this.stateMap){const n=i[0],r=i[1];r.changed?(this._toggleClass(n,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),r.touched=!1}}_toggleClass(i,n){(i=i.trim()).length>0&&i.split(W9).forEach(r=>{n?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return e.\u0275fac=function(i){return new(i||e)(L(Pm),L(Im),L(yt),L(Nn))},e.\u0275dir=Ge({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),e})();class Cle{constructor(t,i,n,r){this.$implicit=t,this.ngForOf=i,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Zh=(()=>{class e{set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}constructor(i,n,r){this._viewContainer=i,this._template=n,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){const i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){const n=this._viewContainer;i.forEachOperation((r,o,s)=>{if(null==r.previousIndex)n.createEmbeddedView(this._template,new Cle(r.item,this._ngForOf,-1,-1),null===s?void 0:s);else if(null==s)n.remove(null===o?void 0:o);else if(null!==o){const a=n.get(o);n.move(a,s),aN(a,r)}});for(let r=0,o=n.length;r<o;r++){const a=n.get(r).context;a.index=r,a.count=o,a.ngForOf=this._ngForOf}i.forEachIdentityChange(r=>{aN(n.get(r.currentIndex),r)})}static ngTemplateContextGuard(i,n){return!0}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn),L(Pm))},e.\u0275dir=Ge({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function aN(e,t){e.context.$implicit=t.item}let Fi=(()=>{class e{constructor(i,n){this._viewContainer=i,this._context=new Mle,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){lN("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){lN("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,n){return!0}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn))},e.\u0275dir=Ge({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class Mle{constructor(){this.$implicit=null,this.ngIf=null}}function lN(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${zn(t)}'.`)}class q9{constructor(t,i){this._viewContainerRef=t,this._templateRef=i,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Kh=(()=>{class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(i){this._ngSwitch=i,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(i){this._defaultViews.push(i)}_matchCase(i){const n=i==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||n,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),n}_updateDefaultCases(i){if(this._defaultViews.length>0&&i!==this._defaultUsed){this._defaultUsed=i;for(const n of this._defaultViews)n.enforceState(i)}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Ge({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),e})(),zp=(()=>{class e{constructor(i,n,r){this.ngSwitch=r,r._addCase(),this._view=new q9(i,n)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn),L(Kh,9))},e.\u0275dir=Ge({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),e})(),Yg=(()=>{class e{constructor(i,n,r){r._addDefault(new q9(i,n))}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn),L(Kh,9))},e.\u0275dir=Ge({type:e,selectors:[["","ngSwitchDefault",""]],standalone:!0}),e})(),Tp=(()=>{class e{constructor(i,n,r){this._ngEl=i,this._differs=n,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){const i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,n){const[r,o]=i.split("."),s=-1===r.indexOf("-")?void 0:Ts.DashCase;null!=n?this._renderer.setStyle(this._ngEl.nativeElement,r,o?`${n}${o}`:n,s):this._renderer.removeStyle(this._ngEl.nativeElement,r,s)}_applyChanges(i){i.forEachRemovedItem(n=>this._setStyle(n.key,null)),i.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),i.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Im),L(Nn))},e.\u0275dir=Ge({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),e})(),as=(()=>{class e{constructor(i){this._viewContainerRef=i,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(i){if(i.ngTemplateOutlet||i.ngTemplateOutletInjector){const n=this._viewContainerRef;if(this._viewRef&&n.remove(n.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:o,ngTemplateOutletInjector:s}=this;this._viewRef=n.createEmbeddedView(r,o,s?{injector:s}:void 0)}else this._viewRef=null}else this._viewRef&&i.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return e.\u0275fac=function(i){return new(i||e)(L($n))},e.\u0275dir=Ge({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ht]}),e})(),ji=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();const uN="browser";let Jle=(()=>{class e{}return e.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>new ece(he(_i),window)}),e})();class ece{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const i=function tce(e,t){const i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const o=r.shadowRoot;if(o){const s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}r=n.nextNode()}}return null}(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const i=this.window.history;i&&i.scrollRestoration&&(i.scrollRestoration=t)}}scrollToElement(t){const i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,r=i.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],r-o[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=dN(this.window.history)||dN(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function dN(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class pN{}class Ece extends Pae{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class K9 extends Ece{static makeCurrent(){!function Aae(e){k9||(k9=e)}(new K9)}onAndCancel(t,i,n){return t.addEventListener(i,n,!1),()=>{t.removeEventListener(i,n,!1)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return(i=i||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return"window"===i?window:"document"===i?t:"body"===i?t.body:null}getBaseHref(t){const i=function Dce(){return Rm=Rm||document.querySelector("base"),Rm?Rm.getAttribute("href"):null}();return null==i?null:function Ace(e){qg=qg||document.createElement("a"),qg.setAttribute("href",e);const t=qg.pathname;return"/"===t.charAt(0)?t:`/${t}`}(i)}resetBaseElement(){Rm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return nN(document.cookie,t)}}let qg,Rm=null;const yN=new Fe("TRANSITION_ID"),Ice=[{provide:Em,useFactory:function Pce(e,t,i){return()=>{i.get(Eg).donePromise.then(()=>{const n=Hc(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let o=0;o<r.length;o++)n.remove(r[o])})}},deps:[yN,_i,Bo],multi:!0}];let kce=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const Xg=new Fe("EventManagerPlugins");let $g=(()=>{class e{constructor(i,n){this._zone=n,this._eventNameToPlugin=new Map,i.forEach(r=>{r.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,n,r){return this._findPluginFor(n).addEventListener(i,n,r)}addGlobalEventListener(i,n,r){return this._findPluginFor(n).addGlobalEventListener(i,n,r)}getZone(){return this._zone}_findPluginFor(i){const n=this._eventNameToPlugin.get(i);if(n)return n;const r=this._plugins;for(let o=0;o<r.length;o++){const s=r[o];if(s.supports(i))return this._eventNameToPlugin.set(i,s),s}throw new Error(`No event manager plugin found for event ${i}`)}}return e.\u0275fac=function(i){return new(i||e)(he(Xg),he(Pt))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class _N{constructor(t){this._doc=t}addGlobalEventListener(t,i,n){const r=Hc().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${i}`);return this.addEventListener(r,i,n)}}let bN=(()=>{class e{constructor(){this.usageCount=new Map}addStyles(i){for(const n of i)1===this.changeUsageCount(n,1)&&this.onStyleAdded(n)}removeStyles(i){for(const n of i)0===this.changeUsageCount(n,-1)&&this.onStyleRemoved(n)}onStyleRemoved(i){}onStyleAdded(i){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(i,n){const r=this.usageCount;let o=r.get(i)??0;return o+=n,o>0?r.set(i,o):r.delete(i),o}ngOnDestroy(){for(const i of this.getAllStyles())this.onStyleRemoved(i);this.usageCount.clear()}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),Fm=(()=>{class e extends bN{constructor(i){super(),this.doc=i,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(i){for(const n of this.hostNodes)this.addStyleToHost(n,i)}onStyleRemoved(i){const n=this.styleRef;n.get(i)?.forEach(o=>o.remove()),n.delete(i)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const n of this.getAllStyles())this.addStyleToHost(i,n)}removeHost(i){this.hostNodes.delete(i)}addStyleToHost(i,n){const r=this.doc.createElement("style");r.textContent=n,i.appendChild(r);const o=this.styleRef.get(n);o?o.push(r):this.styleRef.set(n,[r])}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const J9={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},eb=/%COMP%/g,CN=new Fe("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function SN(e,t){return t.flat(100).map(i=>i.replace(eb,e))}function MN(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Qg=(()=>{class e{constructor(i,n,r,o){this.eventManager=i,this.sharedStylesHost=n,this.appId=r,this.removeStylesOnCompDestory=o,this.rendererByCompId=new Map,this.defaultRenderer=new tb(i)}createRenderer(i,n){if(!i||!n)return this.defaultRenderer;const r=this.getOrCreateRenderer(i,n);return r instanceof EN?r.applyToHost(i):r instanceof ib&&r.applyStyles(),r}getOrCreateRenderer(i,n){const r=this.rendererByCompId;let o=r.get(n.id);if(!o){const s=this.eventManager,a=this.sharedStylesHost,l=this.removeStylesOnCompDestory;switch(n.encapsulation){case Ua.Emulated:o=new EN(s,a,n,this.appId,l);break;case Ua.ShadowDom:return new Hce(s,a,i,n);default:o=new ib(s,a,n,l)}o.onDestroy=()=>r.delete(n.id),r.set(n.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return e.\u0275fac=function(i){return new(i||e)(he($g),he(Fm),he(Dm),he(CN))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class tb{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,i){return i?document.createElementNS(J9[i]||i,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,i){(TN(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(TN(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,r){if(r){i=r+":"+i;const o=J9[r];o?t.setAttributeNS(o,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){const r=J9[n];r?t.removeAttributeNS(r,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,r){r&(Ts.DashCase|Ts.Important)?t.style.setProperty(i,n,r&Ts.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&Ts.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t[i]=n}setValue(t,i){t.nodeValue=i}listen(t,i,n){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,i,MN(n)):this.eventManager.addEventListener(t,i,MN(n))}}function TN(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Hce extends tb{constructor(t,i,n,r){super(t),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=SN(r.id,r.styles);for(const s of o){const a=document.createElement("style");a.textContent=s,this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class ib extends tb{constructor(t,i,n,r,o=n.id){super(t),this.sharedStylesHost=i,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=SN(o,n.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class EN extends ib{constructor(t,i,n,r,o){const s=r+"-"+n.id;super(t,i,n,o,s),this.contentAttr=function Fce(e){return"_ngcontent-%COMP%".replace(eb,e)}(s),this.hostAttr=function Bce(e){return"_nghost-%COMP%".replace(eb,e)}(s)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){const n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}}let Uce=(()=>{class e extends _N{constructor(i){super(i)}supports(i){return!0}addEventListener(i,n,r){return i.addEventListener(n,r,!1),()=>this.removeEventListener(i,n,r)}removeEventListener(i,n,r){return i.removeEventListener(n,r)}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const DN=["alt","control","meta","shift"],jce={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Yce={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Gce=(()=>{class e extends _N{constructor(i){super(i)}supports(i){return null!=e.parseEventName(i)}addEventListener(i,n,r){const o=e.parseEventName(n),s=e.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Hc().onAndCancel(i,o.domEventName,s))}static parseEventName(i){const n=i.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const o=e._normalizeKey(n.pop());let s="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),s="code."),DN.forEach(c=>{const h=n.indexOf(c);h>-1&&(n.splice(h,1),s+=c+".")}),s+=o,0!=n.length||0===o.length)return null;const l={};return l.domEventName=r,l.fullKey=s,l}static matchEventFullKeyCode(i,n){let r=jce[i.key]||i.key,o="";return n.indexOf("code.")>-1&&(r=i.code,o="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),DN.forEach(s=>{s!==r&&(0,Yce[s])(i)&&(o+=s+".")}),o+=r,o===n)}static eventCallback(i,n,r){return o=>{e.matchEventFullKeyCode(o,i)&&r.runGuarded(()=>n(o))}}static _normalizeKey(i){return"esc"===i?"escape":i}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const PN=[{provide:Dg,useValue:uN},{provide:fk,useValue:function Wce(){K9.makeCurrent()},multi:!0},{provide:_i,useFactory:function Xce(){return function Ete(e){h_=e}(document),document},deps:[]}],$ce=Mk(Tae,"browser",PN),IN=new Fe(""),ON=[{provide:Ag,useClass:class Oce{addToWindow(t){On.getAngularTestability=(n,r=!0)=>{const o=t.findTestabilityInTree(n,r);if(null==o)throw new Error("Could not find testability for element.");return o},On.getAllAngularTestabilities=()=>t.getAllTestabilities(),On.getAllAngularRootElements=()=>t.getAllRootElements(),On.frameworkStabilizers||(On.frameworkStabilizers=[]),On.frameworkStabilizers.push(n=>{const r=On.getAllAngularTestabilities();let o=r.length,s=!1;const a=function(l){s=s||l,o--,0==o&&n(s)};r.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(t,i,n){return null==i?null:t.getTestability(i)??(n?Hc().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},deps:[]},{provide:bk,useClass:M9,deps:[Pt,z9,Ag]},{provide:M9,useClass:M9,deps:[Pt,z9,Ag]}],kN=[{provide:__,useValue:"root"},{provide:op,useFactory:function qce(){return new op},deps:[]},{provide:Xg,useClass:Uce,multi:!0,deps:[_i,Pt,Dg]},{provide:Xg,useClass:Gce,multi:!0,deps:[_i]},{provide:Qg,useClass:Qg,deps:[$g,Fm,Dm,CN]},{provide:Xh,useExisting:Qg},{provide:bN,useExisting:Fm},{provide:Fm,useClass:Fm,deps:[_i]},{provide:$g,useClass:$g,deps:[Xg,Pt]},{provide:pN,useClass:kce,deps:[]},[]];let NN=(()=>{class e{constructor(i){}static withServerTransition(i){return{ngModule:e,providers:[{provide:Dm,useValue:i.appId},{provide:yN,useExisting:Dm},Ice]}}}return e.\u0275fac=function(i){return new(i||e)(he(IN,12))},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:[...kN,...ON],imports:[ji,Eae]}),e})(),LN=(()=>{class e{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:function(i){let n=null;return n=i?new i:function Zce(){return new LN(he(_i))}(),n},providedIn:"root"}),e})();typeof window<"u"&&window;let Zg=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(i){let n=null;return n=i?new(i||e):he(BN),n},providedIn:"root"}),e})(),BN=(()=>{class e extends Zg{constructor(i){super(),this._doc=i}sanitize(i,n){if(null==n)return null;switch(i){case wn.NONE:return n;case wn.HTML:return Il(n,"HTML")?Qs(n):iP(this._doc,String(n)).toString();case wn.STYLE:return Il(n,"Style")?Qs(n):n;case wn.SCRIPT:if(Il(n,"Script"))return Qs(n);throw new Error("unsafe value used in a script context");case wn.URL:return Il(n,"URL")?Qs(n):eg(String(n));case wn.RESOURCE_URL:if(Il(n,"ResourceURL"))return Qs(n);throw new Error(`unsafe value used in a resource URL context (see ${y3})`);default:throw new Error(`Unexpected SecurityContext ${i} (see ${y3})`)}}bypassSecurityTrustHtml(i){return function Nte(e){return new Dte(e)}(i)}bypassSecurityTrustStyle(i){return function Lte(e){return new Ate(e)}(i)}bypassSecurityTrustScript(i){return function Rte(e){return new Pte(e)}(i)}bypassSecurityTrustUrl(i){return function Fte(e){return new Ite(e)}(i)}bypassSecurityTrustResourceUrl(i){return function Bte(e){return new Ote(e)}(i)}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:function(i){let n=null;return n=i?new i:function ihe(e){return new BN(e.get(_i))}(he(Bo)),n},providedIn:"root"}),e})();function tt(...e){return Wn(e,G0(e))}class Yi extends He{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){const{hasError:t,thrownError:i,_value:n}=this;if(t)throw i;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}const Kg=j0(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:nhe}=Array,{getPrototypeOf:rhe,prototype:ohe,keys:she}=Object;function VN(e){if(1===e.length){const t=e[0];if(nhe(t))return{args:t,keys:null};if(function ahe(e){return e&&"object"==typeof e&&rhe(e)===ohe}(t)){const i=she(t);return{args:i.map(n=>t[n]),keys:i}}}return{args:e,keys:null}}const{isArray:lhe}=Array;function ob(e){return bt(t=>function che(e,t){return lhe(t)?e(...t):e(t)}(e,t))}function HN(e,t){return e.reduce((i,n,r)=>(i[n]=t[r],i),{})}function Yc(...e){const t=G0(e),i=l7(e),{args:n,keys:r}=VN(e);if(0===n.length)return Wn([],t);const o=new Li(function hhe(e,t,i=Tc){return n=>{UN(t,()=>{const{length:r}=e,o=new Array(r);let s=r,a=r;for(let l=0;l<r;l++)UN(t,()=>{const c=Wn(e[l],t);let h=!1;c.subscribe($i(n,u=>{o[l]=u,h||(h=!0,a--),a||n.next(i(o.slice()))},()=>{--s||n.complete()}))},n)},n)}}(n,t,r?s=>HN(r,s):Tc));return i?o.pipe(ob(i)):o}function UN(e,t,i){e?Ec(i,e,t):t()}function wd(...e){return function uhe(){return F1(1)}()(Wn(e,G0(e)))}function Bm(e){return new Li(t=>{eo(e()).subscribe(t)})}function Vm(e,t){const i=wi(e)?e:()=>e,n=r=>r.error(i());return new Li(t?r=>t.schedule(n,0,r):n)}function sb(){return Mn((e,t)=>{let i=null;e._refCount++;const n=$i(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const r=e._connection,o=i;i=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(i=e.connect())})}class ab extends Li{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,$E(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Vi;const i=this.getSubject();t.add(this.source.subscribe($i(i,void 0,()=>{this._teardown(),i.complete()},n=>{this._teardown(),i.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Vi.EMPTY)}return t}refCount(){return sb()(this)}}function Sr(e,t){return Mn((i,n)=>{let r=null,o=0,s=!1;const a=()=>s&&!r&&n.complete();i.subscribe($i(n,l=>{r?.unsubscribe();let c=0;const h=o++;eo(e(l,h)).subscribe(r=$i(n,u=>n.next(t?t(l,u,h,c++):u),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function Fr(e){return e<=0?()=>js:Mn((t,i)=>{let n=0;t.subscribe($i(i,r=>{++n<=e&&(i.next(r),e<=n&&i.complete())}))})}function Ho(...e){const t=G0(e);return Mn((i,n)=>{(t?wd(e,i,t):wd(e,i)).subscribe(n)})}function rn(e,t){return Mn((i,n)=>{let r=0;i.subscribe($i(n,o=>e.call(t,o,r++)&&n.next(o)))})}function Jg(e){return Mn((t,i)=>{let n=!1;t.subscribe($i(i,r=>{n=!0,i.next(r)},()=>{n||i.next(e),i.complete()}))})}function jN(e=dhe){return Mn((t,i)=>{let n=!1;t.subscribe($i(i,r=>{n=!0,i.next(r)},()=>n?i.complete():i.error(e())))})}function dhe(){return new Kg}function Gc(e,t){const i=arguments.length>=2;return n=>n.pipe(e?rn((r,o)=>e(r,o,n)):Tc,Fr(1),i?Jg(t):jN(()=>new Kg))}function Wc(e,t){return wi(t)?xr(e,t,1):xr(e,1)}function Br(e,t,i){const n=wi(e)||t||i?{next:e,error:t,complete:i}:e;return n?Mn((r,o)=>{var s;null===(s=n.subscribe)||void 0===s||s.call(n);let a=!0;r.subscribe($i(o,l=>{var c;null===(c=n.next)||void 0===c||c.call(n,l),o.next(l)},()=>{var l;a=!1,null===(l=n.complete)||void 0===l||l.call(n),o.complete()},l=>{var c;a=!1,null===(c=n.error)||void 0===c||c.call(n,l),o.error(l)},()=>{var l,c;a&&(null===(l=n.unsubscribe)||void 0===l||l.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):Tc}function Fl(e){return Mn((t,i)=>{let o,n=null,r=!1;n=t.subscribe($i(i,void 0,void 0,s=>{o=eo(e(s,Fl(e)(t))),n?(n.unsubscribe(),n=null,o.subscribe(i)):r=!0})),r&&(n.unsubscribe(),n=null,o.subscribe(i))})}function YN(e,t){return Mn(function phe(e,t,i,n,r){return(o,s)=>{let a=i,l=t,c=0;o.subscribe($i(s,h=>{const u=c++;l=a?e(l,h,u):(a=!0,h),n&&s.next(l)},r&&(()=>{a&&s.next(l),s.complete()})))}}(e,t,arguments.length>=2,!0))}function lb(e){return e<=0?()=>js:Mn((t,i)=>{let n=[];t.subscribe($i(i,r=>{n.push(r),e<n.length&&n.shift()},()=>{for(const r of n)i.next(r);i.complete()},void 0,()=>{n=null}))})}function GN(e,t){const i=arguments.length>=2;return n=>n.pipe(e?rn((r,o)=>e(r,o,n)):Tc,lb(1),i?Jg(t):jN(()=>new Kg))}function WN(e,t=!1){return Mn((i,n)=>{let r=0;i.subscribe($i(n,o=>{const s=e(o,r++);(s||t)&&n.next(o),!s&&n.complete()}))})}function Cd(e){return bt(()=>e)}function Hm(e){return Mn((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}const ci="primary",Um=Symbol("RouteTitle");class fhe{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Ep(e){return new fhe(e)}function mhe(e,t,i){const n=i.path.split("/");if(n.length>e.length||"full"===i.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const r={};for(let o=0;o<n.length;o++){const s=n[o],a=e[o];if(s.startsWith(":"))r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:e.slice(0,n.length),posParams:r}}function Bl(e,t){const i=e?Object.keys(e):void 0,n=t?Object.keys(t):void 0;if(!i||!n||i.length!=n.length)return!1;let r;for(let o=0;o<i.length;o++)if(r=i[o],!qN(e[r],t[r]))return!1;return!0}function qN(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const i=[...e].sort(),n=[...t].sort();return i.every((r,o)=>n[o]===r)}return e===t}function XN(e){return Array.prototype.concat.apply([],e)}function $N(e){return e.length>0?e[e.length-1]:null}function xo(e,t){for(const i in e)e.hasOwnProperty(i)&&t(e[i],i)}function eu(e){return q_(e)?e:ym(e)?Wn(Promise.resolve(e)):tt(e)}const ev=!1,vhe={exact:function KN(e,t,i){if(!Sd(e.segments,t.segments)||!tv(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!KN(e.children[n],t.children[n],i))return!1;return!0},subset:JN},QN={exact:function yhe(e,t){return Bl(e,t)},subset:function _he(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>qN(e[i],t[i]))},ignored:()=>!0};function ZN(e,t,i){return vhe[i.paths](e.root,t.root,i.matrixParams)&&QN[i.queryParams](e.queryParams,t.queryParams)&&!("exact"===i.fragment&&e.fragment!==t.fragment)}function JN(e,t,i){return eL(e,t,t.segments,i)}function eL(e,t,i,n){if(e.segments.length>i.length){const r=e.segments.slice(0,i.length);return!(!Sd(r,i)||t.hasChildren()||!tv(r,i,n))}if(e.segments.length===i.length){if(!Sd(e.segments,i)||!tv(e.segments,i,n))return!1;for(const r in t.children)if(!e.children[r]||!JN(e.children[r],t.children[r],n))return!1;return!0}{const r=i.slice(0,e.segments.length),o=i.slice(e.segments.length);return!!(Sd(e.segments,r)&&tv(e.segments,r,n)&&e.children[ci])&&eL(e.children[ci],t,o,n)}}function tv(e,t,i){return t.every((n,r)=>QN[i](e[r].parameters,n.parameters))}class tu{constructor(t=new yi([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ep(this.queryParams)),this._queryParamMap}toString(){return whe.serialize(this)}}class yi{constructor(t,i){this.segments=t,this.children=i,this.parent=null,xo(i,(n,r)=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iv(this)}}class jm{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Ep(this.parameters)),this._parameterMap}toString(){return nL(this)}}function Sd(e,t){return e.length===t.length&&e.every((i,n)=>i.path===t[n].path)}let Ym=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return new cb},providedIn:"root"}),e})();class cb{parse(t){const i=new Phe(t);return new tu(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){const i=`/${Gm(t.root,!0)}`,n=function Mhe(e){const t=Object.keys(e).map(i=>{const n=e[i];return Array.isArray(n)?n.map(r=>`${nv(i)}=${nv(r)}`).join("&"):`${nv(i)}=${nv(n)}`}).filter(i=>!!i);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${i}${n}${"string"==typeof t.fragment?`#${function Che(e){return encodeURI(e)}(t.fragment)}`:""}`}}const whe=new cb;function iv(e){return e.segments.map(t=>nL(t)).join("/")}function Gm(e,t){if(!e.hasChildren())return iv(e);if(t){const i=e.children[ci]?Gm(e.children[ci],!1):"",n=[];return xo(e.children,(r,o)=>{o!==ci&&n.push(`${o}:${Gm(r,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}{const i=function xhe(e,t){let i=[];return xo(e.children,(n,r)=>{r===ci&&(i=i.concat(t(n,r)))}),xo(e.children,(n,r)=>{r!==ci&&(i=i.concat(t(n,r)))}),i}(e,(n,r)=>r===ci?[Gm(e.children[ci],!1)]:[`${r}:${Gm(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[ci]?`${iv(e)}/${i[0]}`:`${iv(e)}/(${i.join("//")})`}}function tL(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function nv(e){return tL(e).replace(/%3B/gi,";")}function hb(e){return tL(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function rv(e){return decodeURIComponent(e)}function iL(e){return rv(e.replace(/\+/g,"%20"))}function nL(e){return`${hb(e.path)}${function She(e){return Object.keys(e).map(t=>`;${hb(t)}=${hb(e[t])}`).join("")}(e.parameters)}`}const zhe=/^[^\/()?;=#]+/;function ov(e){const t=e.match(zhe);return t?t[0]:""}const The=/^[^=?&#]+/,Dhe=/^[^&#]+/;class Phe{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yi([],{}):new yi([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[ci]=new yi(t,i)),n}parseSegment(){const t=ov(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new xe(4009,ev);return this.capture(t),new jm(rv(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const i=ov(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const r=ov(this.remaining);r&&(n=r,this.capture(n))}t[rv(i)]=rv(n)}parseQueryParam(t){const i=function Ehe(e){const t=e.match(The);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const s=function Ahe(e){const t=e.match(Dhe);return t?t[0]:""}(this.remaining);s&&(n=s,this.capture(n))}const r=iL(i),o=iL(n);if(t.hasOwnProperty(r)){let s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}parseParens(t){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=ov(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new xe(4010,ev);let o;n.indexOf(":")>-1?(o=n.slice(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=ci);const s=this.parseChildren();i[o]=1===Object.keys(s).length?s[ci]:new yi([],s),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new xe(4011,ev)}}function ub(e){return e.segments.length>0?new yi([],{[ci]:e}):e}function sv(e){const t={};for(const n of Object.keys(e.children)){const o=sv(e.children[n]);(o.segments.length>0||o.hasChildren())&&(t[n]=o)}return function Ihe(e){if(1===e.numberOfChildren&&e.children[ci]){const t=e.children[ci];return new yi(e.segments.concat(t.segments),t.children)}return e}(new yi(e.segments,t))}function Md(e){return e instanceof tu}const db=!1;function Ohe(e,t,i,n,r){if(0===i.length)return Dp(t.root,t.root,t.root,n,r);const o=function lL(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new aL(!0,0,e);let t=0,i=!1;const n=e.reduce((r,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return xo(o.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return"string"!=typeof o?[...r,o]:0===s?(o.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?i=!0:".."===a?t++:""!=a&&r.push(a))}),r):[...r,o]},[]);return new aL(i,t,n)}(i);return o.toRoot()?Dp(t.root,t.root,new yi([],{}),n,r):function s(l){const c=function Nhe(e,t,i,n){if(e.isAbsolute)return new Ap(t.root,!0,0);if(-1===n)return new Ap(i,i===t.root,0);return function cL(e,t,i){let n=e,r=t,o=i;for(;o>r;){if(o-=r,n=n.parent,!n)throw new xe(4005,db&&"Invalid number of '../'");r=n.segments.length}return new Ap(n,!1,r-o)}(i,n+(Wm(e.commands[0])?0:1),e.numberOfDoubleDots)}(o,t,e.snapshot?._urlSegment,l),h=c.processChildren?Pp(c.segmentGroup,c.index,o.commands):pb(c.segmentGroup,c.index,o.commands);return Dp(t.root,c.segmentGroup,h,n,r)}(e.snapshot?._lastPathIndex)}function Wm(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function qm(e){return"object"==typeof e&&null!=e&&e.outlets}function Dp(e,t,i,n,r){let s,o={};n&&xo(n,(l,c)=>{o[c]=Array.isArray(l)?l.map(h=>`${h}`):`${l}`}),s=e===t?i:sL(e,t,i);const a=ub(sv(s));return new tu(a,o,r)}function sL(e,t,i){const n={};return xo(e.children,(r,o)=>{n[o]=r===t?i:sL(r,t,i)}),new yi(e.segments,n)}class aL{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&Wm(n[0]))throw new xe(4003,db&&"Root segment cannot have matrix parameters");const r=n.find(qm);if(r&&r!==$N(n))throw new xe(4004,db&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ap{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}}function pb(e,t,i){if(e||(e=new yi([],{})),0===e.segments.length&&e.hasChildren())return Pp(e,t,i);const n=function Rhe(e,t,i){let n=0,r=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(n>=i.length)return o;const s=e.segments[r],a=i[n];if(qm(a))break;const l=`${a}`,c=n<i.length-1?i[n+1]:null;if(r>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!uL(l,c,s))return o;n+=2}else{if(!uL(l,{},s))return o;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}(e,t,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const o=new yi(e.segments.slice(0,n.pathIndex),{});return o.children[ci]=new yi(e.segments.slice(n.pathIndex),e.children),Pp(o,0,r)}return n.match&&0===r.length?new yi(e.segments,{}):n.match&&!e.hasChildren()?fb(e,t,i):n.match?Pp(e,0,r):fb(e,t,i)}function Pp(e,t,i){if(0===i.length)return new yi(e.segments,{});{const n=function Lhe(e){return qm(e[0])?e[0].outlets:{[ci]:e}}(i),r={};if(!n[ci]&&e.children[ci]&&1===e.numberOfChildren&&0===e.children[ci].segments.length){const o=Pp(e.children[ci],t,i);return new yi(e.segments,o.children)}return xo(n,(o,s)=>{"string"==typeof o&&(o=[o]),null!==o&&(r[s]=pb(e.children[s],t,o))}),xo(e.children,(o,s)=>{void 0===n[s]&&(r[s]=o)}),new yi(e.segments,r)}}function fb(e,t,i){const n=e.segments.slice(0,t);let r=0;for(;r<i.length;){const o=i[r];if(qm(o)){const l=Fhe(o.outlets);return new yi(n,l)}if(0===r&&Wm(i[0])){n.push(new jm(e.segments[t].path,hL(i[0]))),r++;continue}const s=qm(o)?o.outlets[ci]:`${o}`,a=r<i.length-1?i[r+1]:null;s&&a&&Wm(a)?(n.push(new jm(s,hL(a))),r+=2):(n.push(new jm(s,{})),r++)}return new yi(n,{})}function Fhe(e){const t={};return xo(e,(i,n)=>{"string"==typeof i&&(i=[i]),null!==i&&(t[n]=fb(new yi([],{}),0,i))}),t}function hL(e){const t={};return xo(e,(i,n)=>t[n]=`${i}`),t}function uL(e,t,i){return e==i.path&&Bl(t,i.parameters)}const Xm="imperative";class Vl{constructor(t,i){this.id=t,this.url=i}}class mb extends Vl{constructor(t,i,n="imperative",r=null){super(t,i),this.type=0,this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class qc extends Vl{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class av extends Vl{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class lv extends Vl{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=16}}class gb extends Vl{constructor(t,i,n,r){super(t,i),this.error=n,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Bhe extends Vl{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vhe extends Vl{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hhe extends Vl{constructor(t,i,n,r,o){super(t,i),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=o,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Uhe extends Vl{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jhe extends Vl{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yhe{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ghe{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Whe{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qhe{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Xhe{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $he{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class dL{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let Khe=(()=>{class e{createUrlTree(i,n,r,o,s,a){return Ohe(i||n.root,r,o,s,a)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),eue=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(t){return Khe.\u0275fac(t)},providedIn:"root"}),e})();class pL{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){const i=vb(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){const i=vb(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){const i=yb(t,this._root);return i.length<2?[]:i[i.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return yb(t,this._root).map(i=>i.value)}}function vb(e,t){if(e===t.value)return t;for(const i of t.children){const n=vb(e,i);if(n)return n}return null}function yb(e,t){if(e===t.value)return[t];for(const i of t.children){const n=yb(e,i);if(n.length)return n.unshift(t),n}return[]}class Xc{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}}function Ip(e){const t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}class fL extends pL{constructor(t,i){super(t),this.snapshot=i,_b(this,t)}toString(){return this.snapshot.toString()}}function mL(e,t){const i=function tue(e,t){const s=new cv([],{},{},"",{},ci,t,null,e.root,-1,{});return new vL("",new Xc(s,[]))}(e,t),n=new Yi([new jm("",{})]),r=new Yi({}),o=new Yi({}),s=new Yi({}),a=new Yi(""),l=new Op(n,r,s,a,o,ci,t,i.root);return l.snapshot=i.root,new fL(new Xc(l,[]),i)}class Op{constructor(t,i,n,r,o,s,a,l){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.title=this.data?.pipe(bt(c=>c[Um]))??tt(void 0),this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(bt(t=>Ep(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(bt(t=>Ep(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function gL(e,t="emptyOnly"){const i=e.pathFromRoot;let n=0;if("always"!==t)for(n=i.length-1;n>=1;){const r=i[n],o=i[n-1];if(r.routeConfig&&""===r.routeConfig.path)n--;else{if(o.component)break;n--}}return function iue(e){return e.reduce((t,i)=>({params:{...t.params,...i.params},data:{...t.data,...i.data},resolve:{...i.data,...t.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(n))}class cv{get title(){return this.data?.[Um]}constructor(t,i,n,r,o,s,a,l,c,h,u){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=h,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ep(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ep(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class vL extends pL{constructor(t,i){super(i),this.url=t,_b(this,i)}toString(){return yL(this._root)}}function _b(e,t){t.value._routerState=e,t.children.forEach(i=>_b(e,i))}function yL(e){const t=e.children.length>0?` { ${e.children.map(yL).join(", ")} } `:"";return`${e.value}${t}`}function bb(e){if(e.snapshot){const t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Bl(t.queryParams,i.queryParams)||e.queryParams.next(i.queryParams),t.fragment!==i.fragment&&e.fragment.next(i.fragment),Bl(t.params,i.params)||e.params.next(i.params),function ghe(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Bl(e[i],t[i]))return!1;return!0}(t.url,i.url)||e.url.next(i.url),Bl(t.data,i.data)||e.data.next(i.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function xb(e,t){const i=Bl(e.params,t.params)&&function bhe(e,t){return Sd(e,t)&&e.every((i,n)=>Bl(i.parameters,t[n].parameters))}(e.url,t.url);return i&&!(!e.parent!=!t.parent)&&(!e.parent||xb(e.parent,t.parent))}function $m(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){const n=i.value;n._futureSnapshot=t.value;const r=function rue(e,t,i){return t.children.map(n=>{for(const r of i.children)if(e.shouldReuseRoute(n.value,r.value.snapshot))return $m(e,n,r);return $m(e,n)})}(e,t,i);return new Xc(n,r)}{if(e.shouldAttach(t.value)){const o=e.retrieve(t.value);if(null!==o){const s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>$m(e,a)),s}}const n=function oue(e){return new Op(new Yi(e.url),new Yi(e.params),new Yi(e.queryParams),new Yi(e.fragment),new Yi(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(o=>$m(e,o));return new Xc(n,r)}}const wb="ngNavigationCancelingError";function _L(e,t){const{redirectTo:i,navigationBehaviorOptions:n}=Md(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=bL(!1,0,t);return r.url=i,r.navigationBehaviorOptions=n,r}function bL(e,t,i){const n=new Error("NavigationCancelingError: "+(e||""));return n[wb]=!0,n.cancellationCode=t,i&&(n.url=i),n}function xL(e){return wL(e)&&Md(e.url)}function wL(e){return e&&e[wb]}class sue{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Qm,this.attachRef=null}}let Qm=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(i,n){const r=this.getOrCreateContext(i);r.outlet=n,this.contexts.set(i,r)}onChildOutletDestroyed(i){const n=this.getContext(i);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let n=this.getContext(i);return n||(n=new sue,this.contexts.set(i,n)),n}getContext(i){return this.contexts.get(i)||null}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const hv=!1;let CL=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=ci,this.activateEvents=new Re,this.deactivateEvents=new Re,this.attachEvents=new Re,this.detachEvents=new Re,this.parentContexts=si(Qm),this.location=si($n),this.changeDetector=si(Ri),this.environmentInjector=si(Ol)}ngOnChanges(i){if(i.name){const{firstChange:n,previousValue:r}=i.name;if(n)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xe(4012,hv);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xe(4012,hv);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xe(4012,hv);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,n){this.activated=i,this._activatedRoute=n,this.location.insert(i.hostView),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,n){if(this.isActivated)throw new xe(4013,hv);this._activatedRoute=i;const r=this.location,s=i.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new aue(i,a,r.injector);if(n&&function lue(e){return!!e.resolveComponentFactory}(n)){const c=n.resolveComponentFactory(s);this.activated=r.createComponent(c,r.length,l)}else this.activated=r.createComponent(s,{index:r.length,injector:l,environmentInjector:n??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Ge({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ht]}),e})();class aue{constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===Op?this.route:t===Qm?this.childContexts:this.parent.get(t,i)}}let Cb=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["ng-component"]],standalone:!0,features:[a9],decls:1,vars:0,template:function(i,n){1&i&&Je(0,"router-outlet")},dependencies:[CL],encapsulation:2}),e})();function SL(e,t){return e.providers&&!e._injector&&(e._injector=xg(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Mb(e){const t=e.children&&e.children.map(Mb),i=t?{...e,children:t}:{...e};return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==ci&&(i.component=Cb),i}function ya(e){return e.outlet||ci}function ML(e,t){const i=e.filter(n=>ya(n)===t);return i.push(...e.filter(n=>ya(n)!==t)),i}function Zm(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class pue{constructor(t,i,n,r){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=r}activate(t){const i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),bb(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){const r=Ip(i);t.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,r[s],n),delete r[s]}),xo(r,(o,s)=>{this.deactivateRouteAndItsChildren(o,n)})}deactivateRoutes(t,i,n){const r=t.value,o=i?i.value:null;if(r===o)if(r.component){const s=n.getContext(r.outlet);s&&this.deactivateChildRoutes(t,i,s.children)}else this.deactivateChildRoutes(t,i,n);else o&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,o=Ip(t);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],r);if(n&&n.outlet){const s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,o=Ip(t);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(t,i,n){const r=Ip(i);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],n),this.forwardEvent(new $he(o.value.snapshot))}),t.children.length&&this.forwardEvent(new qhe(t.value.snapshot))}activateRoutes(t,i,n){const r=t.value,o=i?i.value:null;if(bb(r),r===o)if(r.component){const s=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,i,s.children)}else this.activateChildRoutes(t,i,n);else if(r.component){const s=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),bb(a.route.value),this.activateChildRoutes(t,null,s.children)}else{const a=Zm(r.snapshot),l=a?.get(Lc)??null;s.attachRef=null,s.route=r,s.resolver=l,s.injector=a,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(t,null,s.children)}}else this.activateChildRoutes(t,null,n)}}class zL{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class uv{constructor(t,i){this.component=t,this.route=i}}function fue(e,t,i){const n=e._root;return Km(n,t?t._root:null,i,[n.value])}function kp(e,t){const i=Symbol(),n=t.get(e,i);return n===i?"function"!=typeof e||function CJ(e){return null!==x3(e)}(e)?t.get(e):e:n}function Km(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=Ip(t);return e.children.forEach(s=>{(function gue(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=e.value,s=t?t.value:null,a=i?i.getContext(e.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const l=function vue(e,t,i){if("function"==typeof i)return i(e,t);switch(i){case"pathParamsChange":return!Sd(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Sd(e.url,t.url)||!Bl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xb(e,t)||!Bl(e.queryParams,t.queryParams);default:return!xb(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new zL(n)):(o.data=s.data,o._resolvedData=s._resolvedData),Km(e,t,o.component?a?a.children:null:i,n,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new uv(a.outlet.component,s))}else s&&Jm(t,a,r),r.canActivateChecks.push(new zL(n)),Km(e,null,o.component?a?a.children:null:i,n,r)})(s,o[s.value.outlet],i,n.concat([s.value]),r),delete o[s.value.outlet]}),xo(o,(s,a)=>Jm(s,i.getContext(a),r)),r}function Jm(e,t,i){const n=Ip(e),r=e.value;xo(n,(o,s)=>{Jm(o,r.component?t?t.children.getContext(s):null:t,i)}),i.canDeactivateChecks.push(new uv(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function e2(e){return"function"==typeof e}function zb(e){return e instanceof Kg||"EmptyError"===e?.name}const dv=Symbol("INITIAL_VALUE");function Np(){return Sr(e=>Yc(e.map(t=>t.pipe(Fr(1),Ho(dv)))).pipe(bt(t=>{for(const i of t)if(!0!==i){if(i===dv)return dv;if(!1===i||i instanceof tu)return i}return!0}),rn(t=>t!==dv),Fr(1)))}function TL(e){return function GK(...e){return WE(e)}(Br(t=>{if(Md(t))throw _L(0,t)}),bt(t=>!0===t))}const Tb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function EL(e,t,i,n,r){const o=Eb(e,t,i);return o.matched?function kue(e,t,i,n){const r=t.canMatch;return r&&0!==r.length?tt(r.map(s=>{const a=kp(s,e);return eu(function Cue(e){return e&&e2(e.canMatch)}(a)?a.canMatch(t,i):e.runInContext(()=>a(t,i)))})).pipe(Np(),TL()):tt(!0)}(n=SL(t,n),t,i).pipe(bt(s=>!0===s?o:{...Tb})):tt(o)}function Eb(e,t,i){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||i.length>0)?{...Tb}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const r=(t.matcher||mhe)(i,e,t);if(!r)return{...Tb};const o={};xo(r.posParams,(a,l)=>{o[l]=a.path});const s=r.consumed.length>0?{...o,...r.consumed[r.consumed.length-1].parameters}:o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:i.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function pv(e,t,i,n){if(i.length>0&&function Rue(e,t,i){return i.some(n=>fv(e,t,n)&&ya(n)!==ci)}(e,i,n)){const o=new yi(t,function Lue(e,t,i,n){const r={};r[ci]=n,n._sourceSegment=e,n._segmentIndexShift=t.length;for(const o of i)if(""===o.path&&ya(o)!==ci){const s=new yi([],{});s._sourceSegment=e,s._segmentIndexShift=t.length,r[ya(o)]=s}return r}(e,t,n,new yi(i,e.children)));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:[]}}if(0===i.length&&function Fue(e,t,i){return i.some(n=>fv(e,t,n))}(e,i,n)){const o=new yi(e.segments,function Nue(e,t,i,n,r){const o={};for(const s of n)if(fv(e,i,s)&&!r[ya(s)]){const a=new yi([],{});a._sourceSegment=e,a._segmentIndexShift=t.length,o[ya(s)]=a}return{...r,...o}}(e,t,i,n,e.children));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:i}}const r=new yi(e.segments,e.children);return r._sourceSegment=e,r._segmentIndexShift=t.length,{segmentGroup:r,slicedSegments:i}}function fv(e,t,i){return(!(e.hasChildren()||t.length>0)||"full"!==i.pathMatch)&&""===i.path}function DL(e,t,i,n){return!!(ya(e)===n||n!==ci&&fv(t,i,e))&&("**"===e.path||Eb(t,e,i).matched)}function AL(e,t,i){return 0===t.length&&!e.children[i]}const mv=!1;class gv{constructor(t){this.segmentGroup=t||null}}class PL{constructor(t){this.urlTree=t}}function t2(e){return Vm(new gv(e))}function IL(e){return Vm(new PL(e))}class Uue{constructor(t,i,n,r,o){this.injector=t,this.configLoader=i,this.urlSerializer=n,this.urlTree=r,this.config=o,this.allowRedirects=!0}apply(){const t=pv(this.urlTree.root,[],[],this.config).segmentGroup,i=new yi(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,i,ci).pipe(bt(o=>this.createUrlTree(sv(o),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Fl(o=>{if(o instanceof PL)return this.allowRedirects=!1,this.match(o.urlTree);throw o instanceof gv?this.noMatchError(o):o}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,ci).pipe(bt(r=>this.createUrlTree(sv(r),t.queryParams,t.fragment))).pipe(Fl(r=>{throw r instanceof gv?this.noMatchError(r):r}))}noMatchError(t){return new xe(4002,mv)}createUrlTree(t,i,n){const r=ub(t);return new tu(r,i,n)}expandSegmentGroup(t,i,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,i,n).pipe(bt(o=>new yi([],o))):this.expandSegment(t,n,i,n.segments,r,!0)}expandChildren(t,i,n){const r=[];for(const o of Object.keys(n.children))"primary"===o?r.unshift(o):r.push(o);return Wn(r).pipe(Wc(o=>{const s=n.children[o],a=ML(i,o);return this.expandSegmentGroup(t,a,s,o).pipe(bt(l=>({segment:l,outlet:o})))}),YN((o,s)=>(o[s.outlet]=s.segment,o),{}),GN())}expandSegment(t,i,n,r,o,s){return Wn(n).pipe(Wc(a=>this.expandSegmentAgainstRoute(t,i,n,a,r,o,s).pipe(Fl(c=>{if(c instanceof gv)return tt(null);throw c}))),Gc(a=>!!a),Fl((a,l)=>{if(zb(a))return AL(i,r,o)?tt(new yi([],{})):t2(i);throw a}))}expandSegmentAgainstRoute(t,i,n,r,o,s,a){return DL(r,i,o,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,i,r,o,s):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s):t2(i):t2(i)}expandSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,r){const o=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?IL(o):this.lineralizeSegments(n,o).pipe(xr(s=>{const a=new yi(s,{});return this.expandSegment(t,a,i,s,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:h}=Eb(i,r,o);if(!a)return t2(i);const u=this.applyRedirectCommands(l,r.redirectTo,h);return r.redirectTo.startsWith("/")?IL(u):this.lineralizeSegments(r,u).pipe(xr(d=>this.expandSegment(t,i,n,d.concat(c),s,!1)))}matchSegmentAgainstRoute(t,i,n,r,o){return"**"===n.path?(t=SL(n,t),n.loadChildren?(n._loadedRoutes?tt({routes:n._loadedRoutes,injector:n._loadedInjector}):this.configLoader.loadChildren(t,n)).pipe(bt(a=>(n._loadedRoutes=a.routes,n._loadedInjector=a.injector,new yi(r,{})))):tt(new yi(r,{}))):EL(i,n,r,t).pipe(Sr(({matched:s,consumedSegments:a,remainingSegments:l})=>s?this.getChildConfig(t=n._injector??t,n,r).pipe(xr(h=>{const u=h.injector??t,d=h.routes,{segmentGroup:p,slicedSegments:f}=pv(i,a,l,d),m=new yi(p.segments,p.children);if(0===f.length&&m.hasChildren())return this.expandChildren(u,d,m).pipe(bt(_=>new yi(a,_)));if(0===d.length&&0===f.length)return tt(new yi(a,{}));const g=ya(n)===o;return this.expandSegment(u,m,d,f,g?ci:o,!0).pipe(bt(y=>new yi(a.concat(y.segments),y.children)))})):t2(i)))}getChildConfig(t,i,n){return i.children?tt({routes:i.children,injector:t}):i.loadChildren?void 0!==i._loadedRoutes?tt({routes:i._loadedRoutes,injector:i._loadedInjector}):function Oue(e,t,i,n){const r=t.canLoad;return void 0===r||0===r.length?tt(!0):tt(r.map(s=>{const a=kp(s,e);return eu(function _ue(e){return e&&e2(e.canLoad)}(a)?a.canLoad(t,i):e.runInContext(()=>a(t,i)))})).pipe(Np(),TL())}(t,i,n).pipe(xr(r=>r?this.configLoader.loadChildren(t,i).pipe(Br(o=>{i._loadedRoutes=o.routes,i._loadedInjector=o.injector})):function Vue(e){return Vm(bL(mv,3))}())):tt({routes:[],injector:t})}lineralizeSegments(t,i){let n=[],r=i.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return tt(n);if(r.numberOfChildren>1||!r.children[ci])return t.redirectTo,Vm(new xe(4e3,mv));r=r.children[ci]}}applyRedirectCommands(t,i,n){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n)}applyRedirectCreateUrlTree(t,i,n,r){const o=this.createSegmentGroup(t,i.root,n,r);return new tu(o,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){const n={};return xo(t,(r,o)=>{if("string"==typeof r&&r.startsWith(":")){const a=r.substring(1);n[o]=i[a]}else n[o]=r}),n}createSegmentGroup(t,i,n,r){const o=this.createSegments(t,i.segments,n,r);let s={};return xo(i.children,(a,l)=>{s[l]=this.createSegmentGroup(t,a,n,r)}),new yi(o,s)}createSegments(t,i,n,r){return i.map(o=>o.path.startsWith(":")?this.findPosParam(t,o,r):this.findOrReturn(o,n))}findPosParam(t,i,n){const r=n[i.path.substring(1)];if(!r)throw new xe(4001,mv);return r}findOrReturn(t,i){let n=0;for(const r of i){if(r.path===t.path)return i.splice(n),r;n++}return t}}class Yue{}class que{constructor(t,i,n,r,o,s,a){this.injector=t,this.rootComponentType=i,this.config=n,this.urlTree=r,this.url=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a}recognize(){const t=pv(this.urlTree.root,[],[],this.config.filter(i=>void 0===i.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,ci).pipe(bt(i=>{if(null===i)return null;const n=new cv([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ci,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Xc(n,i),o=new vL(this.url,r);return this.inheritParamsAndData(o._root),o}))}inheritParamsAndData(t){const i=t.value,n=gL(i,this.paramsInheritanceStrategy);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,i,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,i,n):this.processSegment(t,i,n,n.segments,r)}processChildren(t,i,n){return Wn(Object.keys(n.children)).pipe(Wc(r=>{const o=n.children[r],s=ML(i,r);return this.processSegmentGroup(t,s,o,r)}),YN((r,o)=>r&&o?(r.push(...o),r):null),WN(r=>null!==r),Jg(null),GN(),bt(r=>{if(null===r)return null;const o=kL(r);return function Xue(e){e.sort((t,i)=>t.value.outlet===ci?-1:i.value.outlet===ci?1:t.value.outlet.localeCompare(i.value.outlet))}(o),o}))}processSegment(t,i,n,r,o){return Wn(i).pipe(Wc(s=>this.processSegmentAgainstRoute(s._injector??t,s,n,r,o)),Gc(s=>!!s),Fl(s=>{if(zb(s))return AL(n,r,o)?tt([]):tt(null);throw s}))}processSegmentAgainstRoute(t,i,n,r,o){if(i.redirectTo||!DL(i,n,r,o))return tt(null);let s;if("**"===i.path){const a=r.length>0?$N(r).parameters:{},l=LL(n)+r.length;s=tt({snapshot:new cv(r,a,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,RL(i),ya(i),i.component??i._loadedComponent??null,i,NL(n),l,FL(i)),consumedSegments:[],remainingSegments:[]})}else s=EL(n,i,r,t).pipe(bt(({matched:a,consumedSegments:l,remainingSegments:c,parameters:h})=>{if(!a)return null;const u=LL(n)+l.length;return{snapshot:new cv(l,h,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,RL(i),ya(i),i.component??i._loadedComponent??null,i,NL(n),u,FL(i)),consumedSegments:l,remainingSegments:c}}));return s.pipe(Sr(a=>{if(null===a)return tt(null);const{snapshot:l,consumedSegments:c,remainingSegments:h}=a;t=i._injector??t;const u=i._loadedInjector??t,d=function $ue(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(i),{segmentGroup:p,slicedSegments:f}=pv(n,c,h,d.filter(g=>void 0===g.redirectTo));if(0===f.length&&p.hasChildren())return this.processChildren(u,d,p).pipe(bt(g=>null===g?null:[new Xc(l,g)]));if(0===d.length&&0===f.length)return tt([new Xc(l,[])]);const m=ya(i)===o;return this.processSegment(u,d,p,f,m?ci:o).pipe(bt(g=>null===g?null:[new Xc(l,g)]))}))}}function Que(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function kL(e){const t=[],i=new Set;for(const n of e){if(!Que(n)){t.push(n);continue}const r=t.find(o=>n.value.routeConfig===o.value.routeConfig);void 0!==r?(r.children.push(...n.children),i.add(r)):t.push(n)}for(const n of i){const r=kL(n.children);t.push(new Xc(n.value,r))}return t.filter(n=>!i.has(n))}function NL(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function LL(e){let t=e,i=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,i+=t._segmentIndexShift??0;return i-1}function RL(e){return e.data||{}}function FL(e){return e.resolve||{}}function BL(e){return"string"==typeof e.title||null===e.title}function Db(e){return Sr(t=>{const i=e(t);return i?Wn(i).pipe(bt(()=>t)):tt(t)})}const Lp=new Fe("ROUTES");let Ab=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=si(mk)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return tt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const n=eu(i.loadComponent()).pipe(bt(HL),Br(o=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=o}),Hm(()=>{this.componentLoaders.delete(i)})),r=new ab(n,()=>new He).pipe(sb());return this.componentLoaders.set(i,r),r}loadChildren(i,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return tt({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const o=this.loadModuleFactoryOrRoutes(n.loadChildren).pipe(bt(a=>{this.onLoadEndListener&&this.onLoadEndListener(n);let l,c,h=!1;Array.isArray(a)?c=a:(l=a.create(i).injector,c=XN(l.get(Lp,[],Vt.Self|Vt.Optional)));return{routes:c.map(Mb),injector:l}}),Hm(()=>{this.childrenLoaders.delete(n)})),s=new ab(o,()=>new He).pipe(sb());return this.childrenLoaders.set(n,s),s}loadModuleFactoryOrRoutes(i){return eu(i()).pipe(bt(HL),xr(n=>n instanceof DO||Array.isArray(n)?tt(n):Wn(this.compiler.compileModuleAsync(n))))}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function HL(e){return function rde(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let yv=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new He,this.configLoader=si(Ab),this.environmentInjector=si(Ol),this.urlSerializer=si(Ym),this.rootContexts=si(Qm),this.navigationId=0,this.afterPreactivation=()=>tt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new Ghe(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new Yhe(r))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const n=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:n})}setupNavigations(i){return this.transitions=new Yi({id:0,targetPageId:0,currentUrlTree:i.currentUrlTree,currentRawUrl:i.currentUrlTree,extractedUrl:i.urlHandlingStrategy.extract(i.currentUrlTree),urlAfterRedirects:i.urlHandlingStrategy.extract(i.currentUrlTree),rawUrl:i.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Xm,restoredState:null,currentSnapshot:i.routerState.snapshot,targetSnapshot:null,currentRouterState:i.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(rn(n=>0!==n.id),bt(n=>({...n,extractedUrl:i.urlHandlingStrategy.extract(n.rawUrl)})),Sr(n=>{let r=!1,o=!1;return tt(n).pipe(Br(s=>{this.currentNavigation={id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Sr(s=>{const a=i.browserUrlTree.toString(),l=!i.navigated||s.extractedUrl.toString()!==a||a!==i.currentUrlTree.toString();if(!l&&"reload"!==(s.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const h="";return this.events.next(new lv(s.id,i.serializeUrl(n.rawUrl),h,0)),i.rawUrlTree=s.rawUrl,s.resolve(null),js}if(i.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return UL(s.source)&&(i.browserUrlTree=s.extractedUrl),tt(s).pipe(Sr(h=>{const u=this.transitions?.getValue();return this.events.next(new mb(h.id,this.urlSerializer.serialize(h.extractedUrl),h.source,h.restoredState)),u!==this.transitions?.getValue()?js:Promise.resolve(h)}),function jue(e,t,i,n){return Sr(r=>function Hue(e,t,i,n,r){return new Uue(e,t,i,n,r).apply()}(e,t,i,r.extractedUrl,n).pipe(bt(o=>({...r,urlAfterRedirects:o}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,i.config),Br(h=>{this.currentNavigation={...this.currentNavigation,finalUrl:h.urlAfterRedirects},n.urlAfterRedirects=h.urlAfterRedirects}),function Kue(e,t,i,n,r){return xr(o=>function Wue(e,t,i,n,r,o,s="emptyOnly"){return new que(e,t,i,n,r,s,o).recognize().pipe(Sr(a=>null===a?function Gue(e){return new Li(t=>t.error(e))}(new Yue):tt(a)))}(e,t,i,o.urlAfterRedirects,n.serialize(o.urlAfterRedirects),n,r).pipe(bt(s=>({...o,targetSnapshot:s}))))}(this.environmentInjector,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),Br(h=>{if(n.targetSnapshot=h.targetSnapshot,"eager"===i.urlUpdateStrategy){if(!h.extras.skipLocationChange){const d=i.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl);i.setBrowserUrl(d,h)}i.browserUrlTree=h.urlAfterRedirects}const u=new Bhe(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(u)}));if(l&&i.urlHandlingStrategy.shouldProcessUrl(i.rawUrlTree)){const{id:h,extractedUrl:u,source:d,restoredState:p,extras:f}=s,m=new mb(h,this.urlSerializer.serialize(u),d,p);this.events.next(m);const g=mL(u,this.rootComponentType).snapshot;return tt(n={...s,targetSnapshot:g,urlAfterRedirects:u,extras:{...f,skipLocationChange:!1,replaceUrl:!1}})}{const h="";return this.events.next(new lv(s.id,i.serializeUrl(n.extractedUrl),h,1)),i.rawUrlTree=s.rawUrl,s.resolve(null),js}}),Br(s=>{const a=new Vhe(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),bt(s=>n={...s,guards:fue(s.targetSnapshot,s.currentSnapshot,this.rootContexts)}),function Mue(e,t){return xr(i=>{const{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=i;return 0===s.length&&0===o.length?tt({...i,guardsResult:!0}):function zue(e,t,i,n){return Wn(e).pipe(xr(r=>function Iue(e,t,i,n,r){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?tt(o.map(a=>{const l=Zm(t)??r,c=kp(a,l);return eu(function wue(e){return e&&e2(e.canDeactivate)}(c)?c.canDeactivate(e,t,i,n):l.runInContext(()=>c(e,t,i,n))).pipe(Gc())})).pipe(Np()):tt(!0)}(r.component,r.route,i,t,n)),Gc(r=>!0!==r,!0))}(s,n,r,e).pipe(xr(a=>a&&function yue(e){return"boolean"==typeof e}(a)?function Tue(e,t,i,n){return Wn(t).pipe(Wc(r=>wd(function Due(e,t){return null!==e&&t&&t(new Whe(e)),tt(!0)}(r.route.parent,n),function Eue(e,t){return null!==e&&t&&t(new Xhe(e)),tt(!0)}(r.route,n),function Pue(e,t,i){const n=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>function mue(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(s)).filter(s=>null!==s).map(s=>Bm(()=>tt(s.guards.map(l=>{const c=Zm(s.node)??i,h=kp(l,c);return eu(function xue(e){return e&&e2(e.canActivateChild)}(h)?h.canActivateChild(n,e):c.runInContext(()=>h(n,e))).pipe(Gc())})).pipe(Np())));return tt(o).pipe(Np())}(e,r.path,i),function Aue(e,t,i){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return tt(!0);const r=n.map(o=>Bm(()=>{const s=Zm(t)??i,a=kp(o,s);return eu(function bue(e){return e&&e2(e.canActivate)}(a)?a.canActivate(t,e):s.runInContext(()=>a(t,e))).pipe(Gc())}));return tt(r).pipe(Np())}(e,r.route,i))),Gc(r=>!0!==r,!0))}(n,o,e,t):tt(a)),bt(a=>({...i,guardsResult:a})))})}(this.environmentInjector,s=>this.events.next(s)),Br(s=>{if(n.guardsResult=s.guardsResult,Md(s.guardsResult))throw _L(0,s.guardsResult);const a=new Hhe(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(a)}),rn(s=>!!s.guardsResult||(i.restoreHistory(s),this.cancelNavigationTransition(s,"",3),!1)),Db(s=>{if(s.guards.canActivateChecks.length)return tt(s).pipe(Br(a=>{const l=new Uhe(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),Sr(a=>{let l=!1;return tt(a).pipe(function Jue(e,t){return xr(i=>{const{targetSnapshot:n,guards:{canActivateChecks:r}}=i;if(!r.length)return tt(i);let o=0;return Wn(r).pipe(Wc(s=>function ede(e,t,i,n){const r=e.routeConfig,o=e._resolve;return void 0!==r?.title&&!BL(r)&&(o[Um]=r.title),function tde(e,t,i,n){const r=function ide(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===r.length)return tt({});const o={};return Wn(r).pipe(xr(s=>function nde(e,t,i,n){const r=Zm(t)??n,o=kp(e,r);return eu(o.resolve?o.resolve(t,i):r.runInContext(()=>o(t,i)))}(e[s],t,i,n).pipe(Gc(),Br(a=>{o[s]=a}))),lb(1),Cd(o),Fl(s=>zb(s)?js:Vm(s)))}(o,e,t,n).pipe(bt(s=>(e._resolvedData=s,e.data=gL(e,i).resolve,r&&BL(r)&&(e.data[Um]=r.title),null)))}(s.route,n,e,t)),Br(()=>o++),lb(1),xr(s=>o===r.length?tt(i):js))})}(i.paramsInheritanceStrategy,this.environmentInjector),Br({next:()=>l=!0,complete:()=>{l||(i.restoreHistory(a),this.cancelNavigationTransition(a,"",2))}}))}),Br(a=>{const l=new jhe(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),Db(s=>{const a=l=>{const c=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(l.routeConfig).pipe(Br(h=>{l.component=h}),bt(()=>{})));for(const h of l.children)c.push(...a(h));return c};return Yc(a(s.targetSnapshot.root)).pipe(Jg(),Fr(1))}),Db(()=>this.afterPreactivation()),bt(s=>{const a=function nue(e,t,i){const n=$m(e,t._root,i?i._root:void 0);return new fL(n,t)}(i.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return n={...s,targetRouterState:a}}),Br(s=>{i.currentUrlTree=s.urlAfterRedirects,i.rawUrlTree=i.urlHandlingStrategy.merge(s.urlAfterRedirects,s.rawUrl),i.routerState=s.targetRouterState,"deferred"===i.urlUpdateStrategy&&(s.extras.skipLocationChange||i.setBrowserUrl(i.rawUrlTree,s),i.browserUrlTree=s.urlAfterRedirects)}),((e,t,i)=>bt(n=>(new pue(t,n.targetRouterState,n.currentRouterState,i).activate(e),n)))(this.rootContexts,i.routeReuseStrategy,s=>this.events.next(s)),Fr(1),Br({next:s=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,i.navigated=!0,this.events.next(new qc(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(i.currentUrlTree))),i.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{r=!0}}),Hm(()=>{r||o||this.cancelNavigationTransition(n,"",1),this.currentNavigation?.id===n.id&&(this.currentNavigation=null)}),Fl(s=>{if(o=!0,wL(s)){xL(s)||(i.navigated=!0,i.restoreHistory(n,!0));const a=new av(n.id,this.urlSerializer.serialize(n.extractedUrl),s.message,s.cancellationCode);if(this.events.next(a),xL(s)){const l=i.urlHandlingStrategy.merge(s.url,i.rawUrlTree),c={skipLocationChange:n.extras.skipLocationChange,replaceUrl:"eager"===i.urlUpdateStrategy||UL(n.source)};i.scheduleNavigation(l,Xm,null,c,{resolve:n.resolve,reject:n.reject,promise:n.promise})}else n.resolve(!1)}else{i.restoreHistory(n,!0);const a=new gb(n.id,this.urlSerializer.serialize(n.extractedUrl),s,n.targetSnapshot??void 0);this.events.next(a);try{n.resolve(i.errorHandler(s))}catch(l){n.reject(l)}}return js}))}))}cancelNavigationTransition(i,n,r){const o=new av(i.id,this.urlSerializer.serialize(i.extractedUrl),n,r);this.events.next(o),i.resolve(!1)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function UL(e){return e!==Xm}let jL=(()=>{class e{buildTitle(i){let n,r=i.root;for(;void 0!==r;)n=this.getResolvedTitleForRoute(r)??n,r=r.children.find(o=>o.outlet===ci);return n}getResolvedTitleForRoute(i){return i.data[Um]}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return si(ode)},providedIn:"root"}),e})(),ode=(()=>{class e extends jL{constructor(i){super(),this.title=i}updateTitle(i){const n=this.buildTitle(i);void 0!==n&&this.title.setTitle(n)}}return e.\u0275fac=function(i){return new(i||e)(he(LN))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),sde=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return si(lde)},providedIn:"root"}),e})();class ade{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}}let lde=(()=>{class e extends ade{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _v=new Fe("",{providedIn:"root",factory:()=>({})});let hde=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:function(){return si(ude)},providedIn:"root"}),e})(),ude=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,n){return i}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function dde(e){throw e}function pde(e,t,i){return t.parse("/")}const fde={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},mde={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ls=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=si(Xse),this.isNgZoneEnabled=!1,this.options=si(_v,{optional:!0})||{},this.errorHandler=this.options.errorHandler||dde,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||pde,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=si(hde),this.routeReuseStrategy=si(sde),this.urlCreationStrategy=si(eue),this.titleStrategy=si(jL),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=XN(si(Lp,{optional:!0})??[]),this.navigationTransitions=si(yv),this.urlSerializer=si(Ym),this.location=si(kg),this.isNgZoneEnabled=si(Pt)instanceof Pt&&Pt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new tu,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=mL(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=i.targetPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)})}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Xm,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const n="popstate"===i.type?"popstate":"hashchange";"popstate"===n&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,n,i.state)},0)}))}navigateToSyncWithBrowser(i,n,r){const o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){const l={...r};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(o.state=l)}const a=this.parseUrl(i);this.scheduleNavigation(a,n,s,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(i){this.config=i.map(Mb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(i,n={}){const{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:l}=n,c=l?this.currentUrlTree.fragment:s;let h=null;switch(a){case"merge":h={...this.currentUrlTree.queryParams,...o};break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}return null!==h&&(h=this.removeEmptyProps(h)),this.urlCreationStrategy.createUrlTree(r,this.routerState,this.currentUrlTree,i,h,c??null)}navigateByUrl(i,n={skipLocationChange:!1}){const r=Md(i)?i:this.parseUrl(i),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Xm,null,n)}navigate(i,n={skipLocationChange:!1}){return function gde(e){for(let t=0;t<e.length;t++){const i=e[t];if(null==i)throw new xe(4008,false)}}(i),this.navigateByUrl(this.createUrlTree(i,n),n)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let n;try{n=this.urlSerializer.parse(i)}catch(r){n=this.malformedUriErrorHandler(r,this.urlSerializer,i)}return n}isActive(i,n){let r;if(r=!0===n?{...fde}:!1===n?{...mde}:n,Md(i))return ZN(this.currentUrlTree,i,r);const o=this.parseUrl(i);return ZN(this.currentUrlTree,o,r)}removeEmptyProps(i){return Object.keys(i).reduce((n,r)=>{const o=i[r];return null!=o&&(n[r]=o),n},{})}scheduleNavigation(i,n,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,l,c,h;return s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((u,d)=>{a=u,l=d}),h="computed"===this.canceledNavigationResolution?r&&r.\u0275routerPageId?r.\u0275routerPageId:o.replaceUrl||o.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:h,source:n,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:i,extras:o,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(u=>Promise.reject(u))}setBrowserUrl(i,n){const r=this.urlSerializer.serialize(i),o={...n.extras.state,...this.generateNgRouterState(n.id,n.targetPageId)};this.location.isCurrentPathEqualTo(r)||n.extras.replaceUrl?this.location.replaceState(r,"",o):this.location.go(r,"",o)}restoreHistory(i,n=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-i.targetPageId;"popstate"!==i.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===r?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===r&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(r)}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,n){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:n}:{navigationId:i}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Rp=(()=>{class e{constructor(i,n,r,o,s,a){this.router=i,this.route=n,this.tabIndexAttribute=r,this.renderer=o,this.el=s,this.locationStrategy=a,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new He;const l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===l||"area"===l,this.isAnchorElement?this.subscription=i.events.subscribe(c=>{c instanceof qc&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(i){this._preserveFragment=Mp(i)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(i){this._skipLocationChange=Mp(i)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(i){this._replaceUrl=Mp(i)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(i){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",i)}ngOnChanges(i){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(i){null!=i?(this.commands=Array.isArray(i)?i:[i],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(i,n,r,o,s){return!!(null===this.urlTree||this.isAnchorElement&&(0!==i||n||r||o||s||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const i=null===this.href?null:function rP(e,t,i){return function Jte(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?nP:fd}(t,i)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(i,n){const r=this.renderer,o=this.el.nativeElement;null!==n?r.setAttribute(o,i,n):r.removeAttribute(o,i)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(i){return new(i||e)(L(ls),L(Op),function U3(e){return function xee(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const i=e.attrs;if(i){const n=i.length;let r=0;for(;r<n;){const o=i[r];if(XD(o))break;if(0===o)r+=2;else if("number"==typeof o)for(r++;r<n&&"string"==typeof i[r];)r++;else{if(o===t)return i[r+1];r+=2}}}return null}(bo(),e)}("tabindex"),L(Nn),L(yt),L(xd))},e.\u0275dir=Ge({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,n){1&i&&pt("click",function(o){return n.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),2&i&&to("target",n.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Ht]}),e})();class YL{}let _de=(()=>{class e{preload(i,n){return n().pipe(Fl(()=>tt(null)))}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),bde=(()=>{class e{constructor(i,n,r,o,s){this.router=i,this.injector=r,this.preloadingStrategy=o,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(rn(i=>i instanceof qc),Wc(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,n){const r=[];for(const o of n){o.providers&&!o._injector&&(o._injector=xg(o.providers,i,`Route: ${o.path}`));const s=o._injector??i,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(a,o.children??o._loadedRoutes))}return Wn(r).pipe(F1())}preloadConfig(i,n){return this.preloadingStrategy.preload(n,()=>{let r;r=n.loadChildren&&void 0===n.canLoad?this.loader.loadChildren(i,n):tt(null);const o=r.pipe(xr(s=>null===s?tt(void 0):(n._loadedRoutes=s.routes,n._loadedInjector=s.injector,this.processRoutes(s.injector??i,s.routes))));return n.loadComponent&&!n._loadedComponent?Wn([o,this.loader.loadComponent(n)]).pipe(F1()):o})}}return e.\u0275fac=function(i){return new(i||e)(he(ls),he(mk),he(Ol),he(YL),he(Ab))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Ib=new Fe("");let GL=(()=>{class e{constructor(i,n,r,o,s={}){this.urlSerializer=i,this.transitions=n,this.viewportScroller=r,this.zone=o,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration=s.scrollPositionRestoration||"disabled",s.anchorScrolling=s.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof mb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof qc&&(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof dL&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,n){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new dL(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,n))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(i){!function kP(){throw new Error("invalid")}()},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();var Ks=(()=>((Ks=Ks||{})[Ks.COMPLETE=0]="COMPLETE",Ks[Ks.FAILED=1]="FAILED",Ks[Ks.REDIRECTING=2]="REDIRECTING",Ks))();const Fp=!1;function iu(e,t){return{\u0275kind:e,\u0275providers:t}}const Ob=new Fe("",{providedIn:"root",factory:()=>!1});function qL(){const e=si(Bo);return t=>{const i=e.get(Sp);if(t!==i.components[0])return;const n=e.get(ls),r=e.get(XL);1===e.get(kb)&&n.initialNavigation(),e.get($L,null,Vt.Optional)?.setUpPreloading(),e.get(Ib,null,Vt.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const XL=new Fe(Fp?"bootstrap done indicator":"",{factory:()=>new He}),kb=new Fe(Fp?"initial navigation":"",{providedIn:"root",factory:()=>1});function Mde(){let e=[];return e=Fp?[{provide:ig,multi:!0,useFactory:()=>{const t=si(ls);return()=>t.events.subscribe(i=>{console.group?.(`Router Event: ${i.constructor.name}`),console.log(function Qhe(e){if(!("type"in e))return`Unknown Router Event: ${e.constructor.name}`;switch(e.type){case 14:return`ActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${e.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${e.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state}, shouldActivate: ${e.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 2:return`NavigationCancel(id: ${e.id}, url: '${e.url}')`;case 16:return`NavigationSkipped(id: ${e.id}, url: '${e.url}')`;case 1:return`NavigationEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${e.id}, url: '${e.url}', error: ${e.error})`;case 0:return`NavigationStart(id: ${e.id}, url: '${e.url}')`;case 6:return`ResolveEnd(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 5:return`ResolveStart(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 10:return`RouteConfigLoadEnd(path: ${e.route.path})`;case 9:return`RouteConfigLoadStart(path: ${e.route.path})`;case 4:return`RoutesRecognized(id: ${e.id}, url: '${e.url}', urlAfterRedirects: '${e.urlAfterRedirects}', state: ${e.state})`;case 15:return`Scroll(anchor: '${e.anchor}', position: '${e.position?`${e.position[0]}, ${e.position[1]}`:null}')`}}(i)),console.log(i),console.groupEnd?.()})}}]:[],iu(1,e)}const $L=new Fe(Fp?"router preloader":"");function zde(e){return iu(0,[{provide:$L,useExisting:bde},{provide:YL,useExisting:e}])}const n2=!1,QL=new Fe(n2?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Tde=[kg,{provide:Ym,useClass:cb},ls,Qm,{provide:Op,useFactory:function WL(e){return e.routerState.root},deps:[ls]},Ab,n2?{provide:Ob,useValue:!0}:[]];function Ede(){return new Ck("Router",ls)}let ZL=(()=>{class e{constructor(i){}static forRoot(i,n){return{ngModule:e,providers:[Tde,n2&&n?.enableTracing?Mde().\u0275providers:[],{provide:Lp,multi:!0,useValue:i},{provide:QL,useFactory:Ide,deps:[[ls,new qh,new ud]]},{provide:_v,useValue:n||{}},n?.useHash?{provide:xd,useClass:Nae}:{provide:xd,useClass:qk},{provide:Ib,useFactory:()=>{const e=si(Jle),t=si(Pt),i=si(_v),n=si(yv),r=si(Ym);return i.scrollOffset&&e.setOffset(i.scrollOffset),new GL(r,n,e,t,i)}},n?.preloadingStrategy?zde(n.preloadingStrategy).\u0275providers:[],{provide:Ck,multi:!0,useFactory:Ede},n?.initialNavigation?Ode(n):[],[{provide:KL,useFactory:qL},{provide:wk,multi:!0,useExisting:KL}]]}}static forChild(i){return{ngModule:e,providers:[{provide:Lp,multi:!0,useValue:i}]}}}return e.\u0275fac=function(i){return new(i||e)(he(QL,8))},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[Cb]}),e})();function Ide(e){if(n2&&e)throw new xe(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Ode(e){return["disabled"===e.initialNavigation?iu(3,[{provide:Em,multi:!0,useFactory:()=>{const t=si(ls);return()=>{t.setUpLocationChangeListener()}}},{provide:kb,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?iu(2,[{provide:kb,useValue:0},{provide:Em,multi:!0,deps:[Bo],useFactory:t=>{const i=t.get(Oae,Promise.resolve());return()=>i.then(()=>new Promise(n=>{const r=t.get(ls),o=t.get(XL);(function xde(e,t){e.events.pipe(rn(i=>i instanceof qc||i instanceof av||i instanceof gb||i instanceof lv),bt(i=>i instanceof qc||i instanceof lv?Ks.COMPLETE:i instanceof av&&(0===i.code||1===i.code)?Ks.REDIRECTING:Ks.FAILED),rn(i=>i!==Ks.REDIRECTING),Fr(1)).subscribe(()=>{t()})})(r,()=>{n(!0)}),t.get(yv).afterPreactivation=()=>(n(!0),o.closed?tt(void 0):o),r.initialNavigation()}))}}]).\u0275providers:[]]}const KL=new Fe(n2?"Router Initializer":"");let Nb=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["app-home"]],decls:7,vars:0,consts:[[1,"lead"],["href","#",1,"btn","btn-lg","btn-secondary","fw-bold","border-white","bg-white"]],template:function(i,n){1&i&&(Ee(0,"p",0),zi(1,"Hola, soy Hans L\xf3pez, un desarrollador full-stack con especializaci\xf3n en JavaScript (NodeJS)."),Pe(),Ee(2,"p",0),zi(3,"Mi experiencia abarca una amplia gama de aplicaciones y proyectos, desde el desarrollo front-end hasta la creaci\xf3n de modelos de lenguaje supervisados en el \xe1mbito de la inteligencia artificial. Sin embargo, mi principal especializaci\xf3n es en el desarrollo de backend y la creaci\xf3n de APIs."),Pe(),Ee(4,"p",0)(5,"a",1),zi(6,"Learn more"),Pe()())},styles:[".btn-secondary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]:hover, .btn-secondary[_ngcontent-%COMP%]:focus{color:#333;text-shadow:none}body[_ngcontent-%COMP%]{text-shadow:0 .05rem .1rem rgba(0,0,0,.5);box-shadow:inset 0 0 5rem #00000080}.cover-container[_ngcontent-%COMP%]{max-width:42em}"]}),e})();const Nde=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:Nb},{path:"**",component:Nb}];let Lde=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ZL.forRoot(Nde,{scrollPositionRestoration:"enabled",preloadingStrategy:_de}),ZL]}),e})();var Dn=mn(861),Rde=Object.create,bv=Object.defineProperty,Fde=Object.getOwnPropertyDescriptor,Bde=Object.getOwnPropertyNames,Vde=Object.getPrototypeOf,Hde=Object.prototype.hasOwnProperty,$c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Qc=(e,t,i)=>(i=null!=e?Rde(Vde(e)):{},((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Bde(t))!Hde.call(e,r)&&undefined!==r&&bv(e,r,{get:()=>t[r],enumerable:!(n=Fde(t,r))||n.enumerable});return e})(!t&&e&&e.__esModule?i:bv(i,"default",{value:e,enumerable:!0}),e)),r2=(e,t,i)=>(((e,t,i)=>{t in e?bv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),Gde=$c((e,t)=>{var i,n;i=e,n=function(){return i.importState=function(r){var o=new i;return o.importState(r),o},i;function i(){return function(r){var o=0,s=0,a=0,l=1;0==r.length&&(r=[+new Date]);var c=function n(){var r=4022871197,o=function(s){s=s.toString();for(var a=0;a<s.length;a++){var l=.02519603282416938*(r+=s.charCodeAt(a));l-=r=l>>>0,r=(l*=r)>>>0,r+=4294967296*(l-=r)}return 2.3283064365386963e-10*(r>>>0)};return o.version="Mash 0.9",o}();o=c(" "),s=c(" "),a=c(" ");for(var h=0;h<r.length;h++)(o-=c(r[h]))<0&&(o+=1),(s-=c(r[h]))<0&&(s+=1),(a-=c(r[h]))<0&&(a+=1);c=null;var u=function(){var d=2091639*o+2.3283064365386963e-10*l;return o=s,s=a,a=d-(l=0|d)};return u.next=u,u.uint32=function(){return 4294967296*u()},u.fract53=function(){return u()+11102230246251565e-32*(2097152*u()|0)},u.version="Alea 0.9",u.args=r,u.exportState=function(){return[o,s,a,l]},u.importState=function(d){o=+d[0]||0,s=+d[1]||0,a=+d[2]||0,l=+d[3]||0},u}(Array.prototype.slice.call(arguments))}},"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Alea=n()}),JL=$c((e,t)=>{var i,n;i=e,n=function(i){i.SVD=function(n,r,o,s,a){if(r=void 0===r||r,o=void 0===o||o,a=1e-64/(s=s||Math.pow(2,-52)),!n)throw new TypeError("Matrix a is not defined");var l,c,h,u,d,p,f,m,g,v,y,_,b=n[0].length,x=n.length;if(x<b)throw new TypeError("Invalid matrix: m < n");for(var w=[],S=[],C=[],M="f"===r?x:b,z=v=f=0;z<x;z++)S[z]=new Array(M).fill(0);for(z=0;z<b;z++)C[z]=new Array(b).fill(0);var E,D=new Array(b).fill(0);for(z=0;z<x;z++)for(l=0;l<b;l++)S[z][l]=n[z][l];for(z=0;z<b;z++){for(w[z]=f,g=0,h=z+1,l=z;l<x;l++)g+=Math.pow(S[l][z],2);if(g<a)f=0;else for(m=(p=S[z][z])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,S[z][z]=p-f,l=h;l<b;l++){for(g=0,c=z;c<x;c++)g+=S[c][z]*S[c][l];for(p=g/m,c=z;c<x;c++)S[c][l]=S[c][l]+p*S[c][z]}for(D[z]=f,g=0,l=h;l<b;l++)g+=Math.pow(S[z][l],2);if(g<a)f=0;else{for(m=(p=S[z][z+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,S[z][z+1]=p-f,l=h;l<b;l++)w[l]=S[z][l]/m;for(l=h;l<x;l++){for(g=0,c=h;c<b;c++)g+=S[l][c]*S[z][c];for(c=h;c<b;c++)S[l][c]=S[l][c]+g*w[c]}}v<(y=Math.abs(D[z])+Math.abs(w[z]))&&(v=y)}if(o)for(z=b-1;0<=z;z--){if(0!==f){for(m=S[z][z+1]*f,l=h;l<b;l++)C[l][z]=S[z][l]/m;for(l=h;l<b;l++){for(g=0,c=h;c<b;c++)g+=S[z][c]*C[c][l];for(c=h;c<b;c++)C[c][l]=C[c][l]+g*C[c][z]}}for(l=h;l<b;l++)C[z][l]=0,C[l][z]=0;C[z][z]=1,f=w[z],h=z}if(r){if("f"===r)for(z=b;z<x;z++){for(l=b;l<x;l++)S[z][l]=0;S[z][z]=1}for(z=b-1;0<=z;z--){for(f=D[z],l=h=z+1;l<M;l++)S[z][l]=0;if(0!==f){for(m=S[z][z]*f,l=h;l<M;l++){for(g=0,c=h;c<x;c++)g+=S[c][z]*S[c][l];for(p=g/m,c=z;c<x;c++)S[c][l]=S[c][l]+p*S[c][z]}for(l=z;l<x;l++)S[l][z]=S[l][z]/f}else for(l=z;l<x;l++)S[l][z]=0;S[z][z]=S[z][z]+1}}for(s*=v,c=b-1;0<=c;c--)for(var P=0;P<50;P++){for(E=!1,h=c;0<=h;h--){if(Math.abs(w[h])<=s){E=!0;break}if(Math.abs(D[h-1])<=s)break}if(!E)for(d=0,u=h-(g=1),z=h;z<c+1&&(p=g*w[z],w[z]=d*w[z],!(Math.abs(p)<=s));z++)if(f=D[z],D[z]=Math.sqrt(p*p+f*f),d=f/(m=D[z]),g=-p/m,r)for(l=0;l<x;l++)S[l][u]=(y=S[l][u])*d+(_=S[l][z])*g,S[l][z]=-y*g+_*d;if(_=D[c],h===c){if(_<0&&(D[c]=-_,o))for(l=0;l<b;l++)C[l][c]=-C[l][c];break}for(v=D[h],p=(((y=D[c-1])-_)*(y+_)+((f=w[c-1])-(m=w[c]))*(f+m))/(2*m*y),f=Math.sqrt(p*p+1),p=((v-_)*(v+_)+m*(y/(p<0?p-f:p+f)-m))/v,z=h+(g=d=1);z<c+1;z++){if(y=D[z],m=g*(f=w[z]),f*=d,_=Math.sqrt(p*p+m*m),p=v*(d=p/(w[z-1]=_))+f*(g=m/_),f=-v*g+f*d,m=y*g,y*=d,o)for(l=0;l<b;l++)C[l][z-1]=(v=C[l][z-1])*d+(_=C[l][z])*g,C[l][z]=-v*g+_*d;if(_=Math.sqrt(p*p+m*m),p=(d=p/(D[z-1]=_))*f+(g=m/_)*y,v=-g*f+d*y,r)for(l=0;l<x;l++)S[l][z-1]=(y=S[l][z-1])*d+(_=S[l][z])*g,S[l][z]=-y*g+_*d}w[h]=0,w[c]=p,D[c]=v}for(z=0;z<b;z++)D[z]<s&&(D[z]=0);return{u:S,q:D,v:C}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})},"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})}),Wde=$c((e,t)=>{var i,n;i=e,n=function(){var i=function(r,o){if(void 0===r&&(r=[]),void 0===o&&(o=n),this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function n(r,o){return r<o?-1:r>o?1:0}return i.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(0!==this.length){var r=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),r}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(r){for(var s=this.data,a=this.compare,l=s[r];r>0;){var c=r-1>>1,h=s[c];if(a(l,h)>=0)break;s[r]=h,r=c}s[r]=l},i.prototype._down=function(r){for(var s=this.data,a=this.compare,l=this.length>>1,c=s[r];r<l;){var h=1+(r<<1),u=s[h],d=h+1;if(d<this.length&&a(s[d],u)<0&&(h=d,u=s[d]),a(u,c)>=0)break;s[r]=u,r=h}s[r]=c},i},"object"==typeof e&&typeof t<"u"?t.exports=n():"function"==typeof define&&define.amd?define(n):(i=i||self).TinyQueue=n()}),qde=$c((e,t)=>{var i=Wde();function n(c,h,u){h=h||1;for(var d,p,f,m,g=0;g<c[0].length;g++){var v=c[0][g];(!g||v[0]<d)&&(d=v[0]),(!g||v[1]<p)&&(p=v[1]),(!g||v[0]>f)&&(f=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=f-d,_=m-p,b=Math.min(y,_),x=b/2;if(0===b){var w=[d,p];return w.distance=0,w}for(var S=new i(void 0,r),C=d;C<f;C+=b)for(var M=p;M<m;M+=b)S.push(new o(C+x,M+x,x,c));var z=function a(c){for(var h=0,u=0,d=0,p=c[0],f=0,m=p.length,g=m-1;f<m;g=f++){var v=p[f],y=p[g],_=v[0]*y[1]-y[0]*v[1];u+=(v[0]+y[0])*_,d+=(v[1]+y[1])*_,h+=3*_}return 0===h?new o(p[0][0],p[0][1],0,c):new o(u/h,d/h,0,c)}(c),E=new o(d+y/2,p+_/2,0,c);E.d>z.d&&(z=E);for(var D=S.length;S.length;){var P=S.pop();P.d>z.d&&(z=P,u&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),!(P.max-z.d<=h)&&(S.push(new o(P.x-(x=P.h/2),P.y-x,x,c)),S.push(new o(P.x+x,P.y-x,x,c)),S.push(new o(P.x-x,P.y+x,x,c)),S.push(new o(P.x+x,P.y+x,x,c)),D+=4)}u&&(console.log("num probes: "+D),console.log("best distance: "+z.d));var I=[z.x,z.y];return I.distance=z.d,I}function r(c,h){return h.max-c.max}function o(c,h,u,d){this.x=c,this.y=h,this.h=u,this.d=function s(c,h,u){for(var d=!1,p=1/0,f=0;f<u.length;f++)for(var m=u[f],g=0,v=m.length,y=v-1;g<v;y=g++){var _=m[g],b=m[y];_[1]>h!=b[1]>h&&c<(b[0]-_[0])*(h-_[1])/(b[1]-_[1])+_[0]&&(d=!d),p=Math.min(p,l(c,h,_,b))}return 0===p?0:(d?1:-1)*Math.sqrt(p)}(c,h,d),this.max=this.d+this.h*Math.SQRT2}function l(c,h,u,d){var p=u[0],f=u[1],m=d[0]-p,g=d[1]-f;if(0!==m||0!==g){var v=((c-p)*m+(h-f)*g)/(m*m+g*g);v>1?(p=d[0],f=d[1]):v>0&&(p+=m*v,f+=g*v)}return(m=c-p)*m+(g=h-f)*g}i.default&&(i=i.default),t.exports=n,t.exports.default=n}),Xde=$c((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function i(n){if(null===n||!0===n||!1===n)return NaN;var r=Number(n);return isNaN(r)?r:r<0?Math.ceil(r):Math.floor(r)},t.exports=e.default}),$de=$c((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function i(n){var r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return r.setUTCFullYear(n.getFullYear()),n.getTime()-r.getTime()},t.exports=e.default}),Qde=$c((e,t)=>{function n(o,s,a,l){this.message=o,this.expected=s,this.found=a,this.location=l,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function i(o,s){function a(){this.constructor=o}a.prototype=s.prototype,o.prototype=new a})(n,Error),n.buildMessage=function(o,s){var a={literal:function(f){return'"'+c(f.text)+'"'},class:function(f){var g,m="";for(g=0;g<f.parts.length;g++)m+=f.parts[g]instanceof Array?h(f.parts[g][0])+"-"+h(f.parts[g][1]):h(f.parts[g]);return"["+(f.inverted?"^":"")+m+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function l(f){return f.charCodeAt(0).toString(16).toUpperCase()}function c(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function h(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function u(f){return a[f.type](f)}return"Expected "+function d(f){var g,v,m=new Array(f.length);for(g=0;g<f.length;g++)m[g]=u(f[g]);if(m.sort(),m.length>0){for(g=1,v=1;g<m.length;g++)m[g-1]!==m[g]&&(m[v]=m[g],v++);m.length=v}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}(o)+" but "+function p(f){return f?'"'+c(f)+'"':"end of input"}(s)+" found."},t.exports={SyntaxError:n,parse:function r(o,s){s=void 0!==s?s:{};var ct,a={},l={svg_path:wc},c=wc,h=function(A){if(!A)return[];for(var k=[],K=0;K<A.length;K++)k=k.concat.apply(k,A[K]);var H=k[0];return H&&"m"==H.code&&(delete H.relative,H.code="M"),k},u=function(A,k){return function UE(A,k){if(!k)return[A];for(var K=[A],H=0,oe=k.length;H<oe;H++)K[H+1]=k[H][1];return K}(A,k)},d=/^[Mm]/,p=Ei(["M","m"],!1,!1),f=function(A,k,K){var H=H0(A,[k]);return K&&(H=H.concat(H0("M"==A?"L":"l",K[1]))),H},m=/^[Zz]/,g=Ei(["Z","z"],!1,!1),v=function(){return H0("Z")},y=/^[Ll]/,_=Ei(["L","l"],!1,!1),b=function(A,k){return H0(A,k)},x=/^[Hh]/,w=Ei(["H","h"],!1,!1),S=function(A,k){return H0(A,k.map(function(K){return{x:K}}))},C=/^[Vv]/,M=Ei(["V","v"],!1,!1),z=function(A,k){return H0(A,k.map(function(K){return{y:K}}))},E=/^[Cc]/,D=Ei(["C","c"],!1,!1),P=function(A,k,K){return{x1:A.x,y1:A.y,x2:k.x,y2:k.y,x:K.x,y:K.y}},I=/^[Ss]/,B=Ei(["S","s"],!1,!1),V=function(A,k){return{x2:A.x,y2:A.y,x:k.x,y:k.y}},R=/^[Qq]/,N=Ei(["Q","q"],!1,!1),W=function(A,k){return{x1:A.x,y1:A.y,x:k.x,y:k.y}},Q=/^[Tt]/,G=Ei(["T","t"],!1,!1),Y=/^[Aa]/,J=Ei(["A","a"],!1,!1),q=function(A,k,K,H,oe,Ne){return{rx:A,ry:k,xAxisRotation:K,largeArc:H,sweep:oe,x:Ne.x,y:Ne.y}},ee=function(A,k){return{x:A,y:k}},Z=function(A){return 1*A},ce=function(A){return 1*A.join("")},te=/^[01]/,pe=Ei(["0","1"],!1,!1),se=function(A){return"1"==A},ze=function(){return""},_e=",",ge=pn(",",!1),Xe=function(A){return A.join("")},$e=".",Ze=pn(".",!1),rt=/^[eE]/,Ve=Ei(["e","E"],!1,!1),Le=/^[+\-]/,vt=Ei(["+","-"],!1,!1),Ft=/^[0-9]/,j=Ei([["0","9"]],!1,!1),F=function(A){return A.join("")},ue=/^[ \t\n\r]/,Ie=Ei([" ","\t","\n","\r"],!1,!1),O=0,lt=[{line:1,column:1}],We=0,Me=[],Be=0;if("startRule"in s){if(!(s.startRule in l))throw new Error("Can't start parsing from rule \""+s.startRule+'".');c=l[s.startRule]}function pn(A,k){return{type:"literal",text:A,ignoreCase:k}}function Ei(A,k,K){return{type:"class",parts:A,inverted:k,ignoreCase:K}}function Ue(A){var K,k=lt[A];if(k)return k;for(K=A-1;!lt[K];)K--;for(k={line:(k=lt[K]).line,column:k.column};K<A;)10===o.charCodeAt(K)?(k.line++,k.column=1):k.column++,K++;return lt[A]=k,k}function At(A){O<We||(O>We&&(We=O,Me=[]),Me.push(A))}function wc(){var A,k,K,H,oe;for(A=O,k=[],K=gi();K!==a;)k.push(K),K=gi();if(k!==a)if(K=function In(){var A,k,K,H,oe,Ne;if(A=O,(k=ha())!==a){for(K=[],H=O,oe=[],Ne=gi();Ne!==a;)oe.push(Ne),Ne=gi();for(oe!==a&&(Ne=ha())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;){for(K.push(H),H=O,oe=[],Ne=gi();Ne!==a;)oe.push(Ne),Ne=gi();oe!==a&&(Ne=ha())!==a?H=oe=[oe,Ne]:(O=H,H=a)}K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),K===a&&(K=null),K!==a){for(H=[],oe=gi();oe!==a;)H.push(oe),oe=gi();H!==a?A=k=h(K):(O=A,A=a)}else O=A,A=a;else O=A,A=a;return A}function ha(){var A,k,K,H,oe,Ne;if(A=O,k=function $5(){var A,k,K,H,oe,Ne,U0;if(A=O,d.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(p)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a&&(H=jt())!==a?(oe=O,(Ne=bn())===a&&(Ne=null),Ne!==a&&(U0=Q5())!==a?oe=Ne=[Ne,U0]:(O=oe,oe=a),oe===a&&(oe=null),oe!==a?A=k=f(k,H,oe):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}(),k!==a){for(K=[],H=O,oe=[],Ne=gi();Ne!==a;)oe.push(Ne),Ne=gi();for(oe!==a&&(Ne=Cs())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;){for(K.push(H),H=O,oe=[],Ne=gi();Ne!==a;)oe.push(Ne),Ne=gi();oe!==a&&(Ne=Cs())!==a?H=oe=[oe,Ne]:(O=H,H=a)}K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}function Cs(){var A;return(A=function VE(){var k;return O,m.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(g)),k!==a&&(k=v()),k}())===a&&(A=function HE(){var A,k,K,H;if(A=O,y.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(_)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a&&(H=Q5())!==a?A=k=b(k,H):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function U(){var A,k,K,H;if(A=O,x.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(w)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a&&(H=fe())!==a?A=k=S(k,H):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function we(){var A,k,K,H;if(A=O,C.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(M)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a&&(H=fe())!==a?A=k=z(k,H):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function le(){var A,k,K,H;if(A=O,E.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(D)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a?(H=function Ce(){var A,k,K,H,oe,Ne;if(A=O,(k=mt())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=mt())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=mt())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),H!==a?A=k=b(k,H):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function ei(){var A,k,K,H;if(A=O,I.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(B)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a?(H=function fi(){var A,k,K,H,oe,Ne;if(A=O,(k=mi())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=mi())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=mi())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),H!==a?A=k=b(k,H):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function fn(){var A,k,K,H;if(A=O,R.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(N)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a?(H=function Ni(){var A,k,K,H,oe,Ne;if(A=O,(k=xi())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=xi())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=xi())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),H!==a?A=k=b(k,H):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function yo(){var A,k,K,H;if(A=O,Q.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(G)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a?(H=function Ss(){var A,k,K,H,oe,Ne;if(A=O,(k=jt())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=jt())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=jt())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),H!==a?A=k=b(k,H):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}())===a&&(A=function zl(){var A,k,K,H;if(A=O,Y.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(J)),k!==a){for(K=[],H=gi();H!==a;)K.push(H),H=gi();K!==a?(H=function Uh(){var A,k,K,H,oe,Ne;if(A=O,(k=Gn())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=Gn())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=Gn())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}(),H!==a?A=k=b(k,H):(O=A,A=a)):(O=A,A=a)}else O=A,A=a;return A}()),A}function Q5(){var A,k,K,H,oe,Ne;if(A=O,(k=jt())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=jt())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=jt())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}function fe(){var A,k,K,H,oe,Ne;if(A=O,(k=Cc())!==a){for(K=[],H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=Cc())!==a?H=oe=[oe,Ne]:(O=H,H=a);H!==a;)K.push(H),H=O,(oe=bn())===a&&(oe=null),oe!==a&&(Ne=Cc())!==a?H=oe=[oe,Ne]:(O=H,H=a);K!==a?A=k=u(k,K):(O=A,A=a)}else O=A,A=a;return A}function mt(){var A,k,K,H,oe,Ne;return A=O,(k=jt())!==a?((K=bn())===a&&(K=null),K!==a&&(H=jt())!==a?((oe=bn())===a&&(oe=null),oe!==a&&(Ne=jt())!==a?A=k=P(k,H,Ne):(O=A,A=a)):(O=A,A=a)):(O=A,A=a),A}function mi(){var A,k,K,H;return A=O,(k=jt())!==a?((K=bn())===a&&(K=null),K!==a&&(H=jt())!==a?A=k=V(k,H):(O=A,A=a)):(O=A,A=a),A}function xi(){var A,k,K,H;return A=O,(k=jt())!==a?((K=bn())===a&&(K=null),K!==a&&(H=jt())!==a?A=k=W(k,H):(O=A,A=a)):(O=A,A=a),A}function Gn(){var A,k,K,H,oe,Ne,jE,Z5,YE,K5,GE;return A=O,(k=B0())!==a?((K=bn())===a&&(K=null),K!==a&&(H=B0())!==a?((oe=bn())===a&&(oe=null),oe!==a&&(Ne=Cc())!==a&&bn()!==a&&(jE=Sc())!==a?((Z5=bn())===a&&(Z5=null),Z5!==a&&(YE=Sc())!==a?((K5=bn())===a&&(K5=null),K5!==a&&(GE=jt())!==a?A=k=q(k,H,Ne,jE,YE,GE):(O=A,A=a)):(O=A,A=a)):(O=A,A=a)):(O=A,A=a)):(O=A,A=a),A}function jt(){var A,k,K,H;return A=O,(k=Cc())!==a?((K=bn())===a&&(K=null),K!==a&&(H=Cc())!==a?A=k=ee(k,H):(O=A,A=a)):(O=A,A=a),A}function B0(){var k;return O,(k=V0())===a&&(k=br()),k!==a&&(k=Z(k)),k}function Cc(){var k,K,H;return O,k=O,(K=L1())===a&&(K=null),K!==a&&(H=V0())!==a?k=K=[K,H]:(O=k,k=a),k===a&&(k=O,(K=L1())===a&&(K=null),K!==a&&(H=br())!==a?k=K=[K,H]:(O=k,k=a)),k!==a&&(k=ce(k)),k}function Sc(){var k;return O,te.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(pe)),k!==a&&(k=se(k)),k}function bn(){var A,k,K,H,oe;if(A=O,k=[],(K=gi())!==a)for(;K!==a;)k.push(K),K=gi();else k=a;if(k!==a)if((K=Ju())===a&&(K=null),K!==a){for(H=[],oe=gi();oe!==a;)H.push(oe),oe=gi();H!==a?A=k=[k,K,H]:(O=A,A=a)}else O=A,A=a;else O=A,A=a;if(A===a){if(A=O,k=O,(K=Ju())!==a){for(H=[],oe=gi();oe!==a;)H.push(oe),oe=gi();H!==a?k=K=[K,H]:(O=k,k=a)}else O=k,k=a;k!==a&&(k=ze()),A=k}return A}function Ju(){var A;return 44===o.charCodeAt(O)?(A=_e,O++):(A=a,0===Be&&At(ge)),A}function V0(){var k,K,H;return O,k=O,K=function Jr(){var k,K,H,oe;return O,k=O,(K=br())===a&&(K=null),K!==a?(46===o.charCodeAt(O)?(H=$e,O++):(H=a,0===Be&&At(Ze)),H!==a&&(oe=br())!==a?k=K=[K,H,oe]:(O=k,k=a)):(O=k,k=a),k===a&&(k=O,(K=br())!==a?(46===o.charCodeAt(O)?(H=$e,O++):(H=a,0===Be&&At(Ze)),H!==a?k=K=[K,H]:(O=k,k=a)):(O=k,k=a)),k!==a&&(k=Xe(k)),k}(),K!==a?((H=Mc())===a&&(H=null),H!==a?k=K=[K,H]:(O=k,k=a)):(O=k,k=a),k===a&&(k=O,(K=br())!==a&&(H=Mc())!==a?k=K=[K,H]:(O=k,k=a)),k!==a&&(k=Xe(k)),k}function Mc(){var k,K,H,oe;return O,k=O,rt.test(o.charAt(O))?(K=o.charAt(O),O++):(K=a,0===Be&&At(Ve)),K!==a?((H=L1())===a&&(H=null),H!==a&&(oe=br())!==a?k=K=[K,H,oe]:(O=k,k=a)):(O=k,k=a),k!==a&&(k=Xe(k)),k}function L1(){var A;return Le.test(o.charAt(O))?(A=o.charAt(O),O++):(A=a,0===Be&&At(vt)),A}function br(){var k,K;if(O,k=[],Ft.test(o.charAt(O))?(K=o.charAt(O),O++):(K=a,0===Be&&At(j)),K!==a)for(;K!==a;)k.push(K),Ft.test(o.charAt(O))?(K=o.charAt(O),O++):(K=a,0===Be&&At(j));else k=a;return k!==a&&(k=F(k)),k}function gi(){var k;return O,ue.test(o.charAt(O))?(k=o.charAt(O),O++):(k=a,0===Be&&At(Ie)),k!==a&&(k=ze()),k}var R1={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var LK in R1)R1[LK.toUpperCase()]=R1[LK];function H0(A,k){k||(k=[{}]);for(var K=k.length;K--;){var H={code:A,command:R1[A]};for(var oe in A==A.toLowerCase()&&(H.relative=!0),k[K])H[oe]=k[K][oe];k[K]=H}return k}if((ct=c())!==a&&O===o.length)return ct;throw ct!==a&&O<o.length&&At({type:"end"}),function Kr(A,k,K){return new n(n.buildMessage(A,k),A,k,K)}(Me,We<o.length?o.charAt(We):null,function _t(A,k){var K=Ue(A),H=Ue(k);return{start:{offset:A,line:K.line,column:K.column},end:{offset:k,line:H.line,column:H.column}}}(We,We<o.length?We+1:We))}}}),eR=$c((e,t)=>{var i=Qde().parse;i.parseSVG=i,i.makeAbsolute=function n(r){var o,s={x:0,y:0},a={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return r.forEach(function(l){for(var c in"moveto"===l.command&&(o=l),l.x0=s.x,l.y0=s.y,a)c in l&&(l[c]+=l.relative?l[a[c]]:0);"x"in l||(l.x=s.x),"y"in l||(l.y=s.y),l.relative=!1,l.code=l.code.toUpperCase(),"closepath"==l.command&&(l.x=o.x,l.y=o.y),s=l}),r},t.exports=i}),Zde=$c((e,t)=>{t.exports=function(i,n){for(var r=i.split("."),o=n.split("."),s=0;s<3;s++){var a=Number(r[s]),l=Number(o[s]);if(a>l)return 1;if(l>a)return-1;if(!isNaN(a)&&isNaN(l))return 1;if(isNaN(a)&&!isNaN(l))return-1}return 0}}),Bp="149",Kde=0,tR=1,Jde=2,Lb=1,e1e=2,o2=3,Ja=0,io=1,As=2,Mr=0,zd=1,iR=2,nR=3,rR=4,t1e=5,Vp=100,i1e=101,n1e=102,oR=103,sR=104,r1e=200,o1e=201,s1e=202,a1e=203,aR=204,lR=205,l1e=206,c1e=207,h1e=208,u1e=209,d1e=210,p1e=0,f1e=1,m1e=2,Rb=3,g1e=4,v1e=5,y1e=6,_1e=7,cR=0,b1e=1,x1e=2,Hl=0,w1e=1,C1e=2,S1e=3,M1e=4,z1e=5,Td=301,Ed=302,Fb=303,Bb=304,s2=306,Zc=1e3,Rn=1001,Vb=1002,Gi=1003,uR=1004,Hb=1005,ri=1006,T1e=1007,Hp=1008,Uo=1009,E1e=1010,D1e=1011,dR=1012,A1e=1013,Kc=1014,zr=1015,Dd=1016,P1e=1017,I1e=1018,Ad=1020,O1e=1021,no=1023,k1e=1024,N1e=1025,Pd=1026,Id=1027,L1e=1028,R1e=1029,xv=1030,F1e=1031,pR=1033,Ub=33776,jb=33777,Yb=33778,Gb=33779,fR=35840,mR=35841,gR=35842,vR=35843,B1e=36196,yR=37492,_R=37496,bR=37808,xR=37809,wR=37810,CR=37811,SR=37812,MR=37813,zR=37814,TR=37815,ER=37816,DR=37817,AR=37818,PR=37819,IR=37820,OR=37821,Wb=36492,V1e=36283,kR=36284,NR=36285,LR=36286,RR=2200,qb=2202,Up=2400,jp=2401,el=3e3,Zt=3001,Jc=3200,BR=3201,U1e=0,j1e=1,Ul="srgb",Mv="srgb-linear",VR="300 es",Kb=1035,wo=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let n=i.indexOf(t);-1!==n&&i.splice(n,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e);e.target=null}}},jo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],HR=1234567,a2=Math.PI/180,l2=180/Math.PI;function ba(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(jo[255&e]+jo[e>>8&255]+jo[e>>16&255]+jo[e>>24&255]+"-"+jo[255&t]+jo[t>>8&255]+"-"+jo[t>>16&15|64]+jo[t>>24&255]+"-"+jo[63&i|128]+jo[i>>8&255]+"-"+jo[i>>16&255]+jo[i>>24&255]+jo[255&n]+jo[n>>8&255]+jo[n>>16&255]+jo[n>>24&255]).toLowerCase()}function Tr(e,t,i){return Math.max(t,Math.min(i,e))}function Jb(e,t){return(e%t+t)%t}function c2(e,t,i){return(1-i)*e+i*t}function ex(e){return 0==(e&e-1)&&0!==e}function UR(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function zv(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function eh(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Cn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var et=Object.freeze({__proto__:null,DEG2RAD:a2,RAD2DEG:l2,ceilPowerOfTwo:UR,clamp:Tr,damp:function X1e(e,t,i,n){return c2(e,t,1-Math.exp(-i*n))},degToRad:function ipe(e){return e*a2},denormalize:eh,euclideanModulo:Jb,floorPowerOfTwo:zv,generateUUID:ba,inverseLerp:function q1e(e,t,i){return e!==t?(i-e)/(t-e):0},isPowerOfTwo:ex,lerp:c2,mapLinear:function W1e(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},normalize:Cn,pingpong:function $1e(e,t=1){return t-Math.abs(Jb(e,2*t)-t)},radToDeg:function npe(e){return e*l2},randFloat:function J1e(e,t){return e+Math.random()*(t-e)},randFloatSpread:function epe(e){return e*(.5-Math.random())},randInt:function K1e(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function tpe(e){void 0!==e&&(HR=e);let t=HR+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function rpe(e,t,i,n,r){let o=Math.cos,s=Math.sin,a=o(i/2),l=s(i/2),c=o((t+n)/2),h=s((t+n)/2),u=o((t-n)/2),d=s((t-n)/2),p=o((n-t)/2),f=s((n-t)/2);switch(r){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function Z1e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},smoothstep:function Q1e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}}),$=class{constructor(e=0,t=0){$.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Vr=class{constructor(){Vr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,o,s,a,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],b=n[2],x=n[5],w=n[8];return r[0]=o*f+s*v+a*b,r[3]=o*m+s*y+a*x,r[6]=o*g+s*_+a*w,r[1]=l*f+c*v+h*b,r[4]=l*m+c*y+h*x,r[7]=l*g+c*_+h*w,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*x,r[8]=u*g+d*_+p*w,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-i*r*c+i*s*a+n*r*l-n*o*a}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],h=c*o-s*l,u=s*a-c*r,d=l*r-o*a,p=t*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(s*i-n*o)*f,e[3]=u*f,e[4]=(c*t-n*a)*f,e[5]=(n*r-s*t)*f,e[6]=d*f,e[7]=(i*a-l*t)*f,e[8]=(o*t-i*r)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,s){let a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*o+l*s)+o+e,-n*l,n*a,-n*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(tx.makeScale(e,t)),this}rotate(e){return this.premultiply(tx.makeRotation(-e)),this}translate(e,t){return this.premultiply(tx.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},tx=new Vr;function jR(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var ope={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Tv(e,t){return new ope[e](t)}function h2(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Od(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ev(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var ix={[Ul]:{[Mv]:Od},[Mv]:{[Ul]:Ev}},cs={legacyMode:!0,get workingColorSpace(){return Mv},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(ix[t]&&void 0!==ix[t][i]){let n=ix[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},YR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Hr={r:0,g:0,b:0},tl={h:0,s:0,l:0},Dv={h:0,s:0,l:0};function nx(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Av(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Ct=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ul){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,cs.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=cs.workingColorSpace){return this.r=e,this.g=t,this.b=i,cs.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=cs.workingColorSpace){if(e=Jb(e,1),t=Tr(t,0,1),i=Tr(i,0,1),0===t)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=nx(o,r,e+1/3),this.g=nx(o,r,e),this.b=nx(o,r,e-1/3)}return cs.toWorkingColorSpace(this,n),this}setStyle(e,t=Ul){function i(r){void 0!==r&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r,s=n[2];switch(n[1]){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,cs.toWorkingColorSpace(this,t),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,cs.toWorkingColorSpace(this,t),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let a=parseFloat(r[1])/360,l=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return i(r[4]),this.setHSL(a,l,c,t)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],o=r.length;if(3===o)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,cs.toWorkingColorSpace(this,t),this;if(6===o)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,cs.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Ul){let i=YR[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Od(e.r),this.g=Od(e.g),this.b=Od(e.b),this}copyLinearToSRGB(e){return this.r=Ev(e.r),this.g=Ev(e.g),this.b=Ev(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ul){return cs.fromWorkingColorSpace(Av(this,Hr),e),Tr(255*Hr.r,0,255)<<16^Tr(255*Hr.g,0,255)<<8^Tr(255*Hr.b,0,255)<<0}getHexString(e=Ul){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=cs.workingColorSpace){cs.fromWorkingColorSpace(Av(this,Hr),t);let a,l,i=Hr.r,n=Hr.g,r=Hr.b,o=Math.max(i,n,r),s=Math.min(i,n,r),c=(s+o)/2;if(s===o)a=0,l=0;else{let h=o-s;switch(l=c<=.5?h/(o+s):h/(2-o-s),o){case i:a=(n-r)/h+(n<r?6:0);break;case n:a=(r-i)/h+2;break;case r:a=(i-n)/h+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=cs.workingColorSpace){return cs.fromWorkingColorSpace(Av(this,Hr),t),e.r=Hr.r,e.g=Hr.g,e.b=Hr.b,e}getStyle(e=Ul){return cs.fromWorkingColorSpace(Av(this,Hr),e),e!==Ul?`color(${e} ${Hr.r} ${Hr.g} ${Hr.b})`:`rgb(${255*Hr.r|0},${255*Hr.g|0},${255*Hr.b|0})`}offsetHSL(e,t,i){return this.getHSL(tl),tl.h+=e,tl.s+=t,tl.l+=i,this.setHSL(tl.h,tl.s,tl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(tl),e.getHSL(Dv);let i=c2(tl.h,Dv.h,t),n=c2(tl.s,Dv.s,t),r=c2(tl.l,Dv.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Ct.NAMES=YR;var Yp,GR=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Yp&&(Yp=h2("canvas")),Yp.width=e.width,Yp.height=e.height;let i=Yp.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Yp}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=h2("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=255*Od(r[o]/255);return i.putImageData(n,0,0),t}if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Od(t[i]/255)):Od(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},WR=class{constructor(e=null){this.isSource=!0,this.uuid=ba(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let r;if(Array.isArray(n)){r=[];for(let o=0,s=n.length;o<s;o++)r.push(rx(n[o].isDataTexture?n[o].image:n[o]))}else r=rx(n);i.url=r}return t||(e.images[this.uuid]=i),i}};function rx(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?GR.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var spe=0,Zn=class extends wo{constructor(e=Zn.DEFAULT_IMAGE,t=Zn.DEFAULT_MAPPING,i=Rn,n=Rn,r=ri,o=Hp,s=no,a=Uo,l=Zn.DEFAULT_ANISOTROPY,c=el){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:spe++}),this.uuid=ba(),this.name="",this.source=new WR(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new $(0,0),this.repeat=new $(1,1),this.center=new $(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Zc:e.x=e.x-Math.floor(e.x);break;case Rn:e.x=e.x<0?0:1;break;case Vb:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Zc:e.y=e.y-Math.floor(e.y);break;case Rn:e.y=e.y<0?0:1;break;case Vb:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}};Zn.DEFAULT_IMAGE=null,Zn.DEFAULT_MAPPING=300,Zn.DEFAULT_ANISOTROPY=1;var Ut=class{constructor(e=0,t=0,i=0,n=1){Ut.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r,o=e.elements,s=o[0],a=o[4],l=o[8],c=o[1],h=o[5],u=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(s+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(s+1)/2,v=(h+1)/2,y=(f+1)/2,_=(a+c)/4,b=(l+d)/4,x=(u+p)/4;return g>v&&g>y?g<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(g),n=_/i,r=b/i):v>y?v<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=_/n,r=x/n):y<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(y),i=b/r,n=x/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((s+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Wi=class extends wo{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ut(0,0,e,t),this.scissorTest=!1,this.viewport=new Ut(0,0,e,t),this.texture=new Zn({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ri,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new WR(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},qR=class extends Zn{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Gi,this.minFilter=Gi,this.wrapR=Rn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},lpe=class extends Wi{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLMultipleRenderTargets=!0;let r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},qt=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,s){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===s)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||a!==u||l!==d||c!==p){let m=1-s,g=a*u+l*d+c*p+h*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let b=Math.sqrt(y),x=Math.atan2(b,g*v);m=Math.sin(m*x)/b,s=Math.sin(s*x)/b}let _=s*v;if(a=a*m+u*_,l=l*m+d*_,c=c*m+p*_,h=h*m+f*_,m===1-s){let b=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=b,l*=b,c*=b,h*=b}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,o){let s=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[o],u=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*h+a*d-l*u,e[t+1]=a*p+c*u+l*h-s*d,e[t+2]=l*p+c*d+s*u-a*h,e[t+3]=c*p-s*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,n=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(i/2),c=s(n/2),h=s(r/2),u=a(i/2),d=a(n/2),p=a(r/2);switch(o){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+s+h;if(u>0){let d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-a)*d,this._y=(r-l)*d,this._z=(o-n)*d}else if(i>s&&i>h){let d=2*Math.sqrt(1+i-s-h);this._w=(c-a)/d,this._x=.25*d,this._y=(n+o)/d,this._z=(r+l)/d}else if(s>h){let d=2*Math.sqrt(1+s-i-h);this._w=(r-l)/d,this._x=(n+o)/d,this._y=.25*d,this._z=(a+c)/d}else{let d=2*Math.sqrt(1+h-i-s);this._w=(o-n)/d,this._x=(r+l)/d,this._y=(a+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Tr(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+o*s+n*l-r*a,this._y=n*c+o*a+r*s-i*l,this._z=r*c+o*l+i*a-n*s,this._w=o*c-i*s-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,o=this._w,s=o*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;let a=1-s*s;if(a<=Number.EPSILON){let d=1-t;return this._w=d*o+t*this._w,this._x=d*i+t*this._x,this._y=d*n+t*this._y,this._z=d*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(a),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=o*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},T=class{constructor(e=0,t=0,i=0){T.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(XR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(XR.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*i,c=a*i+s*t-r*n,h=a*n+r*i-o*t,u=-r*t-o*i-s*n;return this.x=l*a+u*-r+c*-s-h*-o,this.y=c*a+u*-o+h*-r-l*-s,this.z=h*a+u*-s+l*-o-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ox.copy(this).projectOnVector(e),this.sub(ox)}reflect(e){return this.sub(ox.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Tr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},ox=new T,XR=new qt,dr=class{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){let c=e[a],h=e[a+1],u=e[a+2];c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>s&&(s=u)}return this.min.set(t,i,n),this.max.set(r,o,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.count;a<l;a++){let c=e.getX(a),h=e.getY(a),u=e.getZ(a);c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>s&&(s=u)}return this.min.set(t,i,n),this.max.set(r,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=kd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){let r=i.attributes.position;for(let o=0,s=r.count;o<s;o++)kd.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(kd)}else null===i.boundingBox&&i.computeBoundingBox(),sx.copy(i.boundingBox),sx.applyMatrix4(e.matrixWorld),this.union(sx);let n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,kd),kd.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(u2),Pv.subVectors(this.max,u2),Gp.subVectors(e.a,u2),Wp.subVectors(e.b,u2),qp.subVectors(e.c,u2),nu.subVectors(Wp,Gp),ru.subVectors(qp,Wp),Nd.subVectors(Gp,qp);let t=[0,-nu.z,nu.y,0,-ru.z,ru.y,0,-Nd.z,Nd.y,nu.z,0,-nu.x,ru.z,0,-ru.x,Nd.z,0,-Nd.x,-nu.y,nu.x,0,-ru.y,ru.x,0,-Nd.y,Nd.x,0];return!(!ax(t,Gp,Wp,qp,Pv)||(t=[1,0,0,0,1,0,0,0,1],!ax(t,Gp,Wp,qp,Pv)))&&(Iv.crossVectors(nu,ru),t=[Iv.x,Iv.y,Iv.z],ax(t,Gp,Wp,qp,Pv))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return kd.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(kd).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(th[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),th[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),th[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),th[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),th[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),th[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),th[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),th[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(th)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},th=[new T,new T,new T,new T,new T,new T,new T,new T],kd=new T,sx=new dr,Gp=new T,Wp=new T,qp=new T,nu=new T,ru=new T,Nd=new T,u2=new T,Pv=new T,Iv=new T,Ld=new T;function ax(e,t,i,n,r){for(let o=0,s=e.length-3;o<=s;o+=3){Ld.fromArray(e,o);let a=r.x*Math.abs(Ld.x)+r.y*Math.abs(Ld.y)+r.z*Math.abs(Ld.z),l=t.dot(Ld),c=i.dot(Ld),h=n.dot(Ld);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}var cpe=new dr,d2=new T,lx=new T,Ps=class{constructor(e=new T,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):cpe.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;d2.subVectors(e,this.center);let t=d2.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),n=.5*(i-this.radius);this.center.addScaledVector(d2,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(lx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(d2.copy(e.center).add(lx)),this.expandByPoint(d2.copy(e.center).sub(lx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},ih=new T,cx=new T,Ov=new T,ou=new T,hx=new T,kv=new T,ux=new T,Xp=class{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ih)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=ih.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ih.copy(this.direction).multiplyScalar(t).add(this.origin),ih.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){cx.copy(e).add(t).multiplyScalar(.5),Ov.copy(t).sub(e).normalize(),ou.copy(this.origin).sub(cx);let h,u,d,p,r=.5*e.distanceTo(t),o=-this.direction.dot(Ov),s=ou.dot(this.direction),a=-ou.dot(Ov),l=ou.lengthSq(),c=Math.abs(1-o*o);if(c>0)if(h=o*a-s,u=o*s-a,p=r*c,h>=0)if(u>=-p)if(u<=p){let f=1/c;h*=f,u*=f,d=h*(h+o*u+2*s)+u*(o*h+u+2*a)+l}else u=r,h=Math.max(0,-(o*u+s)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(o*u+s)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-o*r+s)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(o*r+s)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=o>0?-r:r,h=Math.max(0,-(o*u+s)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Ov).multiplyScalar(u).add(cx),d}intersectSphere(e,t){ih.subVectors(e.center,this.origin);let i=ih.dot(this.direction),n=ih.dot(ih)-i*i,r=e.radius*e.radius;if(n>r)return null;let o=Math.sqrt(r-n),s=i-o,a=i+o;return s<0&&a<0?null:this.at(s<0?a:s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,s,a,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),h>=0?(s=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(s=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||s>n)||((s>i||i!=i)&&(i=s),(a<n||n!=n)&&(n=a),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,ih)}intersectTriangle(e,t,i,n,r){hx.subVectors(t,e),kv.subVectors(i,e),ux.crossVectors(hx,kv);let s,o=this.direction.dot(ux);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}ou.subVectors(this.origin,e);let a=s*this.direction.dot(kv.crossVectors(ou,kv));if(a<0)return null;let l=s*this.direction.dot(hx.cross(ou));if(l<0||a+l>o)return null;let c=-s*ou.dot(ux);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},De=class{constructor(){De.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,o,s,a,l,c,h,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new De).fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/$p.setFromMatrixColumn(e,0).length(),r=1/$p.setFromMatrixColumn(e,1).length(),o=1/$p.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let u=o*c,d=o*h,p=s*c,f=s*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-s*a,t[2]=f-u*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u+f*s,t[4]=p*s-d,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-s,t[2]=d*s-p,t[6]=f+u*s,t[10]=o*a}else if("ZXY"===e.order){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u-f*s,t[4]=-o*h,t[8]=p+d*s,t[1]=d+p*s,t[5]=o*c,t[9]=f-u*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){let u=o*c,d=o*h,p=s*c,f=s*h;t[0]=a*c,t[4]=p*l-d,t[8]=u*l+f,t[1]=a*h,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){let u=o*a,d=o*l,p=s*a,f=s*l;t[0]=a*c,t[4]=f-u*h,t[8]=p*h+d,t[1]=h,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=d*h+p,t[10]=u-f*h}else if("XZY"===e.order){let u=o*a,d=o*l,p=s*a,f=s*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=u*h+f,t[5]=o*c,t[9]=d*h-p,t[2]=p*h-d,t[6]=s*c,t[10]=f*h+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hpe,e,upe)}lookAt(e,t,i){let n=this.elements;return Js.subVectors(e,t),0===Js.lengthSq()&&(Js.z=1),Js.normalize(),su.crossVectors(i,Js),0===su.lengthSq()&&(1===Math.abs(i.z)?Js.x+=1e-4:Js.z+=1e-4,Js.normalize(),su.crossVectors(i,Js)),su.normalize(),Nv.crossVectors(Js,su),n[0]=su.x,n[4]=Nv.x,n[8]=Js.x,n[1]=su.y,n[5]=Nv.y,n[9]=Js.y,n[2]=su.z,n[6]=Nv.z,n[10]=Js.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],b=i[15],x=n[0],w=n[4],S=n[8],C=n[12],M=n[1],z=n[5],E=n[9],D=n[13],P=n[2],I=n[6],B=n[10],V=n[14],R=n[3],N=n[7],W=n[11],Q=n[15];return r[0]=o*x+s*M+a*P+l*R,r[4]=o*w+s*z+a*I+l*N,r[8]=o*S+s*E+a*B+l*W,r[12]=o*C+s*D+a*V+l*Q,r[1]=c*x+h*M+u*P+d*R,r[5]=c*w+h*z+u*I+d*N,r[9]=c*S+h*E+u*B+d*W,r[13]=c*C+h*D+u*V+d*Q,r[2]=p*x+f*M+m*P+g*R,r[6]=p*w+f*z+m*I+g*N,r[10]=p*S+f*E+m*B+g*W,r[14]=p*C+f*D+m*V+g*Q,r[3]=v*x+y*M+_*P+b*R,r[7]=v*w+y*z+_*I+b*N,r[11]=v*S+y*E+_*B+b*W,r[15]=v*C+y*D+_*V+b*Q,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*a*h-n*l*h-r*s*u+i*l*u+n*s*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*o*u-n*o*d+n*l*c-r*a*c)+e[11]*(+t*l*h-t*s*d-r*o*h+i*o*d+r*s*c-i*l*c)+e[15]*(-n*s*c-t*a*h+t*s*u+n*o*h-i*o*u+i*a*c)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*a*d-s*m*d-h*a*g+s*u*g,y=p*u*l-c*m*l-p*a*d+o*m*d+c*a*g-o*u*g,_=c*f*l-p*h*l+p*s*d-o*f*d-c*s*g+o*h*g,b=p*h*a-c*f*a-p*s*u+o*f*u+c*s*m-o*h*m,x=t*v+i*y+n*_+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/x;return e[0]=v*w,e[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*w,e[2]=(s*m*r-f*a*r+f*n*l-i*m*l-s*n*g+i*a*g)*w,e[3]=(h*a*r-s*u*r-h*n*l+i*u*l+s*n*d-i*a*d)*w,e[4]=y*w,e[5]=(c*m*r-p*u*r+p*n*d-t*m*d-c*n*g+t*u*g)*w,e[6]=(p*a*r-o*m*r-p*n*l+t*m*l+o*n*g-t*a*g)*w,e[7]=(o*u*r-c*a*r+c*n*l-t*u*l-o*n*d+t*a*d)*w,e[8]=_*w,e[9]=(p*h*r-c*f*r-p*i*d+t*f*d+c*i*g-t*h*g)*w,e[10]=(o*f*r-p*s*r+p*i*l-t*f*l-o*i*g+t*s*g)*w,e[11]=(c*s*r-o*h*r-c*i*l+t*h*l+o*i*d-t*s*d)*w,e[12]=b*w,e[13]=(c*f*n-p*h*n+p*i*u-t*f*u-c*i*m+t*h*m)*w,e[14]=(p*s*n-o*f*n-p*i*a+t*f*a+o*i*m-t*s*m)*w,e[15]=(o*h*n-c*s*n+c*i*a-t*h*a-o*i*u+t*s*u)*w,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*o,0,l*a-n*s,c*a+n*o,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,h=s+s,u=r*l,d=r*c,p=r*h,f=o*c,m=o*h,g=s*h,v=a*l,y=a*c,_=a*h,b=i.x,x=i.y,w=i.z;return n[0]=(1-(f+g))*b,n[1]=(d+_)*b,n[2]=(p-y)*b,n[3]=0,n[4]=(d-_)*x,n[5]=(1-(u+g))*x,n[6]=(m+v)*x,n[7]=0,n[8]=(p+y)*w,n[9]=(m-v)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=$p.set(n[0],n[1],n[2]).length(),o=$p.set(n[4],n[5],n[6]).length(),s=$p.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],il.copy(this);let a=1/r,l=1/o,c=1/s;return il.elements[0]*=a,il.elements[1]*=a,il.elements[2]*=a,il.elements[4]*=l,il.elements[5]*=l,il.elements[6]*=l,il.elements[8]*=c,il.elements[9]*=c,il.elements[10]*=c,t.setFromRotationMatrix(il),i.x=r,i.y=o,i.z=s,this}makePerspective(e,t,i,n,r,o){let s=this.elements,l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=2*r/(t-e),s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,n,r,o){let s=this.elements,a=1/(t-e),l=1/(i-n),c=1/(o-r),h=(t+e)*a,u=(i+n)*l,d=(o+r)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},$p=new T,il=new De,hpe=new T(0,0,0),upe=new T(1,1,1),su=new T,Nv=new T,Js=new T,$R=new De,QR=new qt,Ur=class{constructor(e=0,t=0,i=0,n=Ur.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let n=e.elements,r=n[0],o=n[4],s=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(Tr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Tr(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Tr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Tr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Tr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-Tr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return $R.makeRotationFromQuaternion(e),this.setFromRotationMatrix($R,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return QR.setFromEuler(this),this.setFromQuaternion(QR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ur.DEFAULT_ORDER="XYZ";var dx=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}},dpe=0,ZR=new T,Qp=new qt,nh=new De,Lv=new T,p2=new T,ppe=new T,fpe=new qt,KR=new T(1,0,0),JR=new T(0,1,0),eF=new T(0,0,1),mpe={type:"added"},tF={type:"removed"},en=class extends wo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dpe++}),this.uuid=ba(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=en.DEFAULT_UP.clone();let e=new T,t=new Ur,i=new qt,n=new T(1,1,1);t._onChange(function r(){i.setFromEuler(t,!1)}),i._onChange(function o(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new De},normalMatrix:{value:new Vr}}),this.matrix=new De,this.matrixWorld=new De,this.matrixAutoUpdate=en.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=en.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new dx,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Qp.setFromAxisAngle(e,t),this.quaternion.multiply(Qp),this}rotateOnWorldAxis(e,t){return Qp.setFromAxisAngle(e,t),this.quaternion.premultiply(Qp),this}rotateX(e){return this.rotateOnAxis(KR,e)}rotateY(e){return this.rotateOnAxis(JR,e)}rotateZ(e){return this.rotateOnAxis(eF,e)}translateOnAxis(e,t){return ZR.copy(e).applyQuaternion(this.quaternion),this.position.add(ZR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(KR,e)}translateY(e){return this.translateOnAxis(JR,e)}translateZ(e){return this.translateOnAxis(eF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(nh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Lv.copy(e):Lv.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),p2.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nh.lookAt(p2,Lv,this.up):nh.lookAt(Lv,p2,this.up),this.quaternion.setFromRotationMatrix(nh),n&&(nh.extractRotation(n.matrixWorld),Qp.setFromRotationMatrix(nh),this.quaternion.premultiply(Qp.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(mpe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tF)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(tF)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),nh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),nh.multiply(e.parent.matrixWorld)),e.applyMatrix4(nh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let o=this.children[n].getObjectsByProperty(e,t);o.length>0&&(i=i.concat(o))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(p2,e,ppe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(p2,fpe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let r=t[i];(!0===r.matrixWorldAutoUpdate||!0===e)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let n=this.children;for(let r=0,o=n.length;r<o;r++){let s=n[r];!0===s.matrixWorldAutoUpdate&&s.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function r(s,a){return void 0===s[a.uuid]&&(s[a.uuid]=a.toJSON(e)),a.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){let a=s.shapes;if(Array.isArray(a))for(let l=0,c=a.length;l<c;l++)r(e.shapes,a[l]);else r(e.shapes,a)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let s=[];for(let a=0,l=this.material.length;a<l;a++)s.push(r(e.materials,this.material[a]));n.material=s}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let s=0;s<this.animations.length;s++)n.animations.push(r(e.animations,this.animations[s]))}if(t){let s=o(e.geometries),a=o(e.materials),l=o(e.textures),c=o(e.images),h=o(e.shapes),u=o(e.skeletons),d=o(e.animations),p=o(e.nodes);s.length>0&&(i.geometries=s),a.length>0&&(i.materials=a),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),u.length>0&&(i.skeletons=u),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=n,i;function o(s){let a=[];for(let l in s){let c=s[l];delete c.metadata,a.push(c)}return a}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++)this.add(e.children[i].clone());return this}};en.DEFAULT_UP=new T(0,1,0),en.DEFAULT_MATRIX_AUTO_UPDATE=!0,en.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var nl=new T,rh=new T,px=new T,oh=new T,Zp=new T,Kp=new T,iF=new T,fx=new T,mx=new T,gx=new T,Co=class{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),nl.subVectors(e,t),n.cross(nl);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){nl.subVectors(n,t),rh.subVectors(i,t),px.subVectors(e,t);let o=nl.dot(nl),s=nl.dot(rh),a=nl.dot(px),l=rh.dot(rh),c=rh.dot(px),h=o*l-s*s;if(0===h)return r.set(-2,-1,-1);let u=1/h,d=(l*a-s*c)*u,p=(o*c-s*a)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,oh),oh.x>=0&&oh.y>=0&&oh.x+oh.y<=1}static getUV(e,t,i,n,r,o,s,a){return this.getBarycoord(e,t,i,n,oh),a.set(0,0),a.addScaledVector(r,oh.x),a.addScaledVector(o,oh.y),a.addScaledVector(s,oh.z),a}static isFrontFacing(e,t,i,n){return nl.subVectors(i,t),rh.subVectors(e,t),nl.cross(rh).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return nl.subVectors(this.c,this.b),rh.subVectors(this.a,this.b),.5*nl.cross(rh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Co.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Co.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return Co.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return Co.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Co.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let o,s,i=this.a,n=this.b,r=this.c;Zp.subVectors(n,i),Kp.subVectors(r,i),fx.subVectors(e,i);let a=Zp.dot(fx),l=Kp.dot(fx);if(a<=0&&l<=0)return t.copy(i);mx.subVectors(e,n);let c=Zp.dot(mx),h=Kp.dot(mx);if(c>=0&&h<=c)return t.copy(n);let u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(i).addScaledVector(Zp,o);gx.subVectors(e,r);let d=Zp.dot(gx),p=Kp.dot(gx);if(p>=0&&d<=p)return t.copy(r);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(i).addScaledVector(Kp,s);let m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return iF.subVectors(r,n),s=(h-c)/(h-c+(d-p)),t.copy(n).addScaledVector(iF,s);let g=1/(m+f+u);return o=f*g,s=u*g,t.copy(i).addScaledVector(Zp,o).addScaledVector(Kp,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},gpe=0,f2=class extends wo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gpe++}),this.uuid=ba(),this.name="",this.type="Material",this.blending=zd,this.side=Ja,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=aR,this.blendDst=lR,this.blendEquation=Vp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(r){let o=[];for(let s in r){let a=r[s];delete a.metadata,o.push(a)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==zd&&(i.blending=this.blending),this.side!==Ja&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},Rd=class extends f2{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cR,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Er=new T,Rv=new $,It=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Rv.fromBufferAttribute(this,t),Rv.applyMatrix3(e),this.setXY(t,Rv.x,Rv.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Er.fromBufferAttribute(this,t),Er.applyMatrix3(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Er.fromBufferAttribute(this,t),Er.applyMatrix4(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Er.fromBufferAttribute(this,t),Er.applyNormalMatrix(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Er.fromBufferAttribute(this,t),Er.transformDirection(e),this.setXYZ(t,Er.x,Er.y,Er.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=eh(t,this.array)),t}setX(e,t){return this.normalized&&(t=Cn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=eh(t,this.array)),t}setY(e,t){return this.normalized&&(t=Cn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=eh(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Cn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=eh(t,this.array)),t}setW(e,t){return this.normalized&&(t=Cn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array),n=Cn(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array),n=Cn(n,this.array),r=Cn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},nF=class extends It{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Jp=class extends It{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Ke=class extends It{constructor(e,t,i){super(new Float32Array(e),t,i)}},vpe=0,xa=new De,vx=new en,ef=new T,ea=new dr,m2=new dr,ro=new T,gt=class extends wo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vpe++}),this.uuid=ba(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(jR(e)?Jp:nF)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let r=(new Vr).getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return xa.makeRotationFromQuaternion(e),this.applyMatrix4(xa),this}rotateX(e){return xa.makeRotationX(e),this.applyMatrix4(xa),this}rotateY(e){return xa.makeRotationY(e),this.applyMatrix4(xa),this}rotateZ(e){return xa.makeRotationZ(e),this.applyMatrix4(xa),this}translate(e,t,i){return xa.makeTranslation(e,t,i),this.applyMatrix4(xa),this}scale(e,t,i){return xa.makeScale(e,t,i),this.applyMatrix4(xa),this}lookAt(e){return vx.lookAt(e),vx.updateMatrix(),this.applyMatrix4(vx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ef).negate(),this.translate(ef.x,ef.y,ef.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ke(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new dr);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++)ea.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(ro.addVectors(this.boundingBox.min,ea.min),this.boundingBox.expandByPoint(ro),ro.addVectors(this.boundingBox.max,ea.max),this.boundingBox.expandByPoint(ro)):(this.boundingBox.expandByPoint(ea.min),this.boundingBox.expandByPoint(ea.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ps);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new T,1/0);if(e){let i=this.boundingSphere.center;if(ea.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++)m2.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(ro.addVectors(ea.min,m2.min),ea.expandByPoint(ro),ro.addVectors(ea.max,m2.max),ea.expandByPoint(ro)):(ea.expandByPoint(m2.min),ea.expandByPoint(m2.max));ea.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)ro.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(ro));if(t)for(let r=0,o=t.length;r<o;r++){let s=t[r],a=this.morphTargetsRelative;for(let l=0,c=s.count;l<c;l++)ro.fromBufferAttribute(s,l),a&&(ef.fromBufferAttribute(e,l),ro.add(ef)),n=Math.max(n,i.distanceToSquared(ro))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=e.array,n=t.position.array,r=t.normal.array,o=t.uv.array,s=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new It(new Float32Array(4*s),4));let a=this.getAttribute("tangent").array,l=[],c=[];for(let M=0;M<s;M++)l[M]=new T,c[M]=new T;let h=new T,u=new T,d=new T,p=new $,f=new $,m=new $,g=new T,v=new T;function y(M,z,E){h.fromArray(n,3*M),u.fromArray(n,3*z),d.fromArray(n,3*E),p.fromArray(o,2*M),f.fromArray(o,2*z),m.fromArray(o,2*E),u.sub(h),d.sub(h),f.sub(p),m.sub(p);let D=1/(f.x*m.y-m.x*f.y);!isFinite(D)||(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(D),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(D),l[M].add(g),l[z].add(g),l[E].add(g),c[M].add(v),c[z].add(v),c[E].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let M=0,z=_.length;M<z;++M){let E=_[M],D=E.start;for(let I=D,B=D+E.count;I<B;I+=3)y(i[I+0],i[I+1],i[I+2])}let b=new T,x=new T,w=new T,S=new T;function C(M){w.fromArray(r,3*M),S.copy(w);let z=l[M];b.copy(z),b.sub(w.multiplyScalar(w.dot(z))).normalize(),x.crossVectors(S,z);let E=x.dot(c[M])<0?-1:1;a[4*M]=b.x,a[4*M+1]=b.y,a[4*M+2]=b.z,a[4*M+3]=E}for(let M=0,z=_.length;M<z;++M){let E=_[M],D=E.start;for(let I=D,B=D+E.count;I<B;I+=3)C(i[I+0]),C(i[I+1]),C(i[I+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new It(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let u=0,d=i.count;u<d;u++)i.setXYZ(u,0,0,0);let n=new T,r=new T,o=new T,s=new T,a=new T,l=new T,c=new T,h=new T;if(e)for(let u=0,d=e.count;u<d;u+=3){let p=e.getX(u+0),f=e.getX(u+1),m=e.getX(u+2);n.fromBufferAttribute(t,p),r.fromBufferAttribute(t,f),o.fromBufferAttribute(t,m),c.subVectors(o,r),h.subVectors(n,r),c.cross(h),s.fromBufferAttribute(i,p),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),s.add(c),a.add(c),l.add(c),i.setXYZ(p,s.x,s.y,s.z),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let u=0,d=t.count;u<d;u+=3)n.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),c.subVectors(o,r),h.subVectors(n,r),c.cross(h),i.setXYZ(u+0,c.x,c.y,c.z),i.setXYZ(u+1,c.x,c.y,c.z),i.setXYZ(u+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ro.fromBufferAttribute(e,t),ro.normalize(),e.setXYZ(t,ro.x,ro.y,ro.z)}toNonIndexed(){function e(s,a){let l=s.array,c=s.itemSize,h=s.normalized,u=new l.constructor(a.length*c),d=0,p=0;for(let f=0,m=a.length;f<m;f++){d=s.isInterleavedBufferAttribute?a[f]*s.data.stride+s.offset:a[f]*c;for(let g=0;g<c;g++)u[p++]=l[d++]}return new It(u,c,h)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new gt,i=this.index.array,n=this.attributes;for(let s in n){let l=e(n[s],i);t.setAttribute(s,l)}let r=this.morphAttributes;for(let s in r){let a=[],l=r[s];for(let c=0,h=l.length;c<h;c++){let d=e(l[c],i);a.push(d)}t.morphAttributes[s]=a}t.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let s=0,a=o.length;s<a;s++){let l=o[s];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let a=this.parameters;for(let l in a)void 0!==a[l]&&(e[l]=a[l]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let a in i)e.data.attributes[a]=i[a].toJSON(e.data);let n={},r=!1;for(let a in this.morphAttributes){let l=this.morphAttributes[a],c=[];for(let h=0,u=l.length;h<u;h++)c.push(l[h].toJSON(e.data));c.length>0&&(n[a]=c,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let l in n)this.setAttribute(l,n[l].clone(t));let r=e.morphAttributes;for(let l in r){let c=[],h=r[l];for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let o=e.groups;for(let l=0,c=o.length;l<c;l++){let h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},rF=new De,tf=new Xp,yx=new Ps,g2=new T,v2=new T,y2=new T,_x=new T,Fv=new T,Bv=new $,Vv=new $,Hv=new $,bx=new T,Uv=new T,Dr=class extends en{constructor(e=new gt,t=new Rd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(e,t){let i=this.geometry,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);let s=this.morphTargetInfluences;if(r&&s){Fv.set(0,0,0);for(let a=0,l=r.length;a<l;a++){let c=s[a];0!==c&&(_x.fromBufferAttribute(r[a],e),Fv.addScaledVector(o?_x:_x.sub(t),c))}t.add(Fv)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n||(null===i.boundingSphere&&i.computeBoundingSphere(),yx.copy(i.boundingSphere),yx.applyMatrix4(r),!1===e.ray.intersectsSphere(yx))||(rF.copy(r).invert(),tf.copy(e.ray).applyMatrix4(rF),null!==i.boundingBox&&!1===tf.intersectsBox(i.boundingBox)))return;let o,s=i.index,a=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,u=i.drawRange;if(null!==s)if(Array.isArray(n))for(let d=0,p=h.length;d<p;d++){let f=h[d],m=n[f.materialIndex];for(let y=Math.max(f.start,u.start),_=Math.min(s.count,Math.min(f.start+f.count,u.start+u.count));y<_;y+=3){let b=s.getX(y),x=s.getX(y+1),w=s.getX(y+2);o=jv(this,m,e,tf,l,c,b,x,w),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=f.materialIndex,t.push(o))}}else for(let f=Math.max(0,u.start),m=Math.min(s.count,u.start+u.count);f<m;f+=3){let g=s.getX(f),v=s.getX(f+1),y=s.getX(f+2);o=jv(this,n,e,tf,l,c,g,v,y),o&&(o.faceIndex=Math.floor(f/3),t.push(o))}else if(void 0!==a)if(Array.isArray(n))for(let d=0,p=h.length;d<p;d++){let f=h[d],m=n[f.materialIndex];for(let y=Math.max(f.start,u.start),_=Math.min(a.count,Math.min(f.start+f.count,u.start+u.count));y<_;y+=3)o=jv(this,m,e,tf,l,c,y,y+1,y+2),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=f.materialIndex,t.push(o))}else for(let f=Math.max(0,u.start),m=Math.min(a.count,u.start+u.count);f<m;f+=3)o=jv(this,n,e,tf,l,c,f,f+1,f+2),o&&(o.faceIndex=Math.floor(f/3),t.push(o))}};function jv(e,t,i,n,r,o,s,a,l){e.getVertexPosition(s,g2),e.getVertexPosition(a,v2),e.getVertexPosition(l,y2);let c=function ype(e,t,i,n,r,o,s,a){let l;if(l=t.side===io?n.intersectTriangle(s,o,r,!0,a):n.intersectTriangle(r,o,s,t.side===Ja,a),null===l)return null;Uv.copy(a),Uv.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(Uv);return c<i.near||c>i.far?null:{distance:c,point:Uv.clone(),object:e}}(e,t,i,n,g2,v2,y2,bx);if(c){r&&(Bv.fromBufferAttribute(r,s),Vv.fromBufferAttribute(r,a),Hv.fromBufferAttribute(r,l),c.uv=Co.getUV(bx,g2,v2,y2,Bv,Vv,Hv,new $)),o&&(Bv.fromBufferAttribute(o,s),Vv.fromBufferAttribute(o,a),Hv.fromBufferAttribute(o,l),c.uv2=Co.getUV(bx,g2,v2,y2,Bv,Vv,Hv,new $));let h={a:s,b:a,c:l,normal:new T,materialIndex:0};Co.getNormal(g2,v2,y2,h.normal),c.face=h}return c}var rl=class extends gt{constructor(e=1,t=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};let s=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);let a=[],l=[],c=[],h=[],u=0,d=0;function p(f,m,g,v,y,_,b,x,w,S,C){let M=_/w,z=b/S,E=_/2,D=b/2,P=x/2,I=w+1,B=S+1,V=0,R=0,N=new T;for(let W=0;W<B;W++){let Q=W*z-D;for(let G=0;G<I;G++)N[f]=(G*M-E)*v,N[m]=Q*y,N[g]=P,l.push(N.x,N.y,N.z),N[f]=0,N[m]=0,N[g]=x>0?1:-1,c.push(N.x,N.y,N.z),h.push(G/w),h.push(1-W/S),V+=1}for(let W=0;W<S;W++)for(let Q=0;Q<w;Q++){let Y=u+Q+I*(W+1),J=u+(Q+1)+I*(W+1),q=u+(Q+1)+I*W;a.push(u+Q+I*W,Y,q),a.push(Y,J,q),R+=6}s.addGroup(d,R,C),d+=R,u+=V}p("z","y","x",-1,-1,i,t,e,o,r,0),p("z","y","x",1,-1,i,t,-e,o,r,1),p("x","z","y",1,1,e,i,t,n,o,2),p("x","z","y",1,-1,e,i,-t,n,o,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new Ke(l,3)),this.setAttribute("normal",new Ke(c,3)),this.setAttribute("uv",new Ke(h,2))}static fromJSON(e){return new rl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function nf(e){let t={};for(let i in e){t[i]={};for(let n in e[i]){let r=e[i][n];t[i][n]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return t}function hs(e){let t={};for(let i=0;i<e.length;i++){let n=nf(e[i]);for(let r in n)t[r]=n[r]}return t}function oF(e){return null===e.getRenderTarget()&&e.outputEncoding===Zt?Ul:Mv}var rf={clone:nf,merge:hs},qi=class extends f2{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nf(e.uniforms),this.uniformsGroups=function _pe(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let r=this.uniforms[n].value;t.uniforms[n]=r&&r.isTexture?{type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Fd=class extends en{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new De,this.projectionMatrix=new De,this.projectionMatrixInverse=new De}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},Yo=class extends Fd{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*l2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*a2*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*l2*Math.atan(Math.tan(.5*a2*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*a2*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){let a=o.fullWidth,l=o.fullHeight;r+=o.offsetX*n/a,t-=o.offsetY*i/l,n*=o.width/a,i*=o.height/l}let s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},wpe=class extends en{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new Yo(-90,1,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new Yo(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let o=new Yo(-90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);let s=new Yo(-90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);let a=new Yo(-90,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);let l=new Yo(-90,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,o,s,a,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,u=e.xr.enabled;e.toneMapping=Hl,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},xx=class extends Zn{constructor(e,t,i,n,r,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Td,i,n,r,o,s,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Cpe=class extends Wi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1};this.texture=new xx([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ri}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",n=new rl(5,5,5),r=new qi({name:"CubemapFromEquirect",uniforms:nf(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:io,blending:Mr});r.uniforms.tEquirect.value=t;let o=new Dr(n,r),s=t.minFilter;return t.minFilter===Hp&&(t.minFilter=ri),new wpe(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,n);e.setRenderTarget(r)}},wx=new T,Spe=new T,Mpe=new Vr,ta=class{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=wx.subVectors(i,t).cross(Spe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(wx),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Mpe.getNormalMatrix(e),n=this.coplanarPoint(wx).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},lf=new Ps,Yv=new T,Cx=class{constructor(e=new ta,t=new ta,i=new ta,n=new ta,r=new ta,o=new ta){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-n,h-a,f-u,y-m).normalize(),t[1].setComponents(s+n,h+a,f+u,y+m).normalize(),t[2].setComponents(s+r,h+l,f+d,y+g).normalize(),t[3].setComponents(s-r,h-l,f-d,y-g).normalize(),t[4].setComponents(s-o,h-c,f-p,y-v).normalize(),t[5].setComponents(s+o,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),lf.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(lf)}intersectsSprite(e){return lf.center.set(0,0,0),lf.radius=.7071067811865476,lf.applyMatrix4(e.matrixWorld),this.intersectsSphere(lf)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(Yv.x=n.normal.x>0?e.max.x:e.min.x,Yv.y=n.normal.y>0?e.max.y:e.min.y,Yv.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Yv)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function sF(){let e=null,t=!1,i=null,n=null;function r(o,s){i(o,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(o){i=o},setContext:function(o){e=o}}}function zpe(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let h=n.get(c);h&&(e.deleteBuffer(h.buffer),n.delete(c))},update:function l(c,h){if(c.isGLBufferAttribute){let d=n.get(c);return void((!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);void 0===u?n.set(c,function r(c,h){let f,u=c.array,d=c.usage,p=e.createBuffer();if(e.bindBuffer(h,p),e.bufferData(h,u,d),c.onUploadCallback(),u instanceof Float32Array)f=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");f=5131}else f=5123;else if(u instanceof Int16Array)f=5122;else if(u instanceof Uint32Array)f=5125;else if(u instanceof Int32Array)f=5124;else if(u instanceof Int8Array)f=5120;else if(u instanceof Uint8Array)f=5121;else{if(!(u instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);f=5121}return{buffer:p,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}(c,h)):u.version<c.version&&(function o(c,h,u){let d=h.array,p=h.updateRange;e.bindBuffer(u,c),-1===p.count?e.bufferSubData(u,0,d):(i?e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}(u.buffer,c,h),u.version=c.version)}}}var Bd=class extends gt{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,o=t/2,s=Math.floor(i),a=Math.floor(n),l=s+1,c=a+1,h=e/s,u=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let v=g*u-o;for(let y=0;y<l;y++)p.push(y*h-r,-v,0),f.push(0,0,1),m.push(y/s),m.push(1-g/a)}for(let g=0;g<a;g++)for(let v=0;v<s;v++){let _=v+l*(g+1),b=v+1+l*(g+1),x=v+1+l*g;d.push(v+l*g,_,x),d.push(_,b,x)}this.setIndex(d),this.setAttribute("position",new Ke(p,3)),this.setAttribute("normal",new Ke(f,3)),this.setAttribute("uv",new Ke(m,2))}static fromJSON(e){return new Bd(e.width,e.height,e.widthSegments,e.heightSegments)}},oi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},je={common:{diffuse:{value:new Ct(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vr},uv2Transform:{value:new Vr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vr}},sprite:{diffuse:{value:new Ct(16777215)},opacity:{value:1},center:{value:new $(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vr}}},jl={basic:{uniforms:hs([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.fog]),vertexShader:oi.meshbasic_vert,fragmentShader:oi.meshbasic_frag},lambert:{uniforms:hs([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new Ct(0)}}]),vertexShader:oi.meshlambert_vert,fragmentShader:oi.meshlambert_frag},phong:{uniforms:hs([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new Ct(0)},specular:{value:new Ct(1118481)},shininess:{value:30}}]),vertexShader:oi.meshphong_vert,fragmentShader:oi.meshphong_frag},standard:{uniforms:hs([je.common,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.roughnessmap,je.metalnessmap,je.fog,je.lights,{emissive:{value:new Ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag},toon:{uniforms:hs([je.common,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.gradientmap,je.fog,je.lights,{emissive:{value:new Ct(0)}}]),vertexShader:oi.meshtoon_vert,fragmentShader:oi.meshtoon_frag},matcap:{uniforms:hs([je.common,je.bumpmap,je.normalmap,je.displacementmap,je.fog,{matcap:{value:null}}]),vertexShader:oi.meshmatcap_vert,fragmentShader:oi.meshmatcap_frag},points:{uniforms:hs([je.points,je.fog]),vertexShader:oi.points_vert,fragmentShader:oi.points_frag},dashed:{uniforms:hs([je.common,je.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oi.linedashed_vert,fragmentShader:oi.linedashed_frag},depth:{uniforms:hs([je.common,je.displacementmap]),vertexShader:oi.depth_vert,fragmentShader:oi.depth_frag},normal:{uniforms:hs([je.common,je.bumpmap,je.normalmap,je.displacementmap,{opacity:{value:1}}]),vertexShader:oi.meshnormal_vert,fragmentShader:oi.meshnormal_frag},sprite:{uniforms:hs([je.sprite,je.fog]),vertexShader:oi.sprite_vert,fragmentShader:oi.sprite_frag},background:{uniforms:{uvTransform:{value:new Vr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:oi.background_vert,fragmentShader:oi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:oi.backgroundCube_vert,fragmentShader:oi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:oi.cube_vert,fragmentShader:oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oi.equirect_vert,fragmentShader:oi.equirect_frag},distanceRGBA:{uniforms:hs([je.common,je.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oi.distanceRGBA_vert,fragmentShader:oi.distanceRGBA_frag},shadow:{uniforms:hs([je.lights,je.fog,{color:{value:new Ct(0)},opacity:{value:1}}]),vertexShader:oi.shadow_vert,fragmentShader:oi.shadow_frag}};jl.physical={uniforms:hs([jl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ct(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ct(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ct(1,1,1)},specularColorMap:{value:null}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag};var Gv={r:0,b:0,g:0};function ome(e,t,i,n,r,o,s){let c,h,a=new Ct(0),l=!0===o?0:1,u=null,d=0,p=null;function m(g,v){g.getRGB(Gv,oF(e)),n.buffers.color.setClear(Gv.r,Gv.g,Gv.b,v,s)}return{getClearColor:function(){return a},setClearColor:function(g,v=1){a.set(g),l=v,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(a,l)},render:function f(g,v){let y=!1,_=!0===v.isScene?v.background:null;_&&_.isTexture&&(_=(v.backgroundBlurriness>0?i:t).get(_));let b=e.xr,x=b.getSession&&b.getSession();x&&"additive"===x.environmentBlendMode&&(_=null),null===_?m(a,l):_&&_.isColor&&(m(_,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===s2)?(void 0===h&&(h=new Dr(new rl(1,1,1),new qi({name:"BackgroundCubeMaterial",uniforms:nf(jl.backgroundCube.uniforms),vertexShader:jl.backgroundCube.vertexShader,fragmentShader:jl.backgroundCube.fragmentShader,side:io,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(w,S,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=_.encoding!==Zt,(u!==_||d!==_.version||p!==e.toneMapping)&&(h.material.needsUpdate=!0,u=_,d=_.version,p=e.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(void 0===c&&(c=new Dr(new Bd(2,2),new qi({name:"BackgroundMaterial",uniforms:nf(jl.background.uniforms),vertexShader:jl.background.vertexShader,fragmentShader:jl.background.fragmentShader,side:Ja,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=_.encoding!==Zt,!0===_.matrixAutoUpdate&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(u!==_||d!==_.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,u=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}}}function sme(e,t,i,n){let r=e.getParameter(34921),o=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||null!==o,a={},l=g(null),c=l,h=!1;function p(I){return n.isWebGL2?e.bindVertexArray(I):o.bindVertexArrayOES(I)}function f(I){return n.isWebGL2?e.deleteVertexArray(I):o.deleteVertexArrayOES(I)}function g(I){let B=[],V=[],R=[];for(let N=0;N<r;N++)B[N]=0,V[N]=0,R[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:B,enabledAttributes:V,attributeDivisors:R,object:I,attributes:{},index:null}}function _(){let I=c.newAttributes;for(let B=0,V=I.length;B<V;B++)I[B]=0}function b(I){x(I,0)}function x(I,B){let R=c.enabledAttributes,N=c.attributeDivisors;c.newAttributes[I]=1,0===R[I]&&(e.enableVertexAttribArray(I),R[I]=1),N[I]!==B&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,B),N[I]=B)}function w(){let I=c.newAttributes,B=c.enabledAttributes;for(let V=0,R=B.length;V<R;V++)B[V]!==I[V]&&(e.disableVertexAttribArray(V),B[V]=0)}function S(I,B,V,R,N,W){!0!==n.isWebGL2||5124!==V&&5125!==V?e.vertexAttribPointer(I,B,V,R,N,W):e.vertexAttribIPointer(I,B,V,N,W)}function D(){P(),h=!0,c!==l&&(c=l,p(c.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function u(I,B,V,R,N){let W=!1;if(s){let Q=function m(I,B,V){let R=!0===V.wireframe,N=a[I.id];void 0===N&&(N={},a[I.id]=N);let W=N[B.id];void 0===W&&(W={},N[B.id]=W);let Q=W[R];return void 0===Q&&(Q=g(function d(){return n.isWebGL2?e.createVertexArray():o.createVertexArrayOES()}()),W[R]=Q),Q}(R,V,B);c!==Q&&(c=Q,p(c.object)),W=function v(I,B,V,R){let N=c.attributes,W=B.attributes,Q=0,G=V.getAttributes();for(let Y in G)if(G[Y].location>=0){let J=N[Y],q=W[Y];if(void 0===q&&("instanceMatrix"===Y&&I.instanceMatrix&&(q=I.instanceMatrix),"instanceColor"===Y&&I.instanceColor&&(q=I.instanceColor)),void 0===J||J.attribute!==q||q&&J.data!==q.data)return!0;Q++}return c.attributesNum!==Q||c.index!==R}(I,R,V,N),W&&function y(I,B,V,R){let N={},W=B.attributes,Q=0,G=V.getAttributes();for(let Y in G)if(G[Y].location>=0){let J=W[Y];void 0===J&&("instanceMatrix"===Y&&I.instanceMatrix&&(J=I.instanceMatrix),"instanceColor"===Y&&I.instanceColor&&(J=I.instanceColor));let q={};q.attribute=J,J&&J.data&&(q.data=J.data),N[Y]=q,Q++}c.attributes=N,c.attributesNum=Q,c.index=R}(I,R,V,N)}else{let Q=!0===B.wireframe;(c.geometry!==R.id||c.program!==V.id||c.wireframe!==Q)&&(c.geometry=R.id,c.program=V.id,c.wireframe=Q,W=!0)}null!==N&&i.update(N,34963),(W||h)&&(h=!1,function C(I,B,V,R){if(!1===n.isWebGL2&&(I.isInstancedMesh||R.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;_();let N=R.attributes,W=V.getAttributes(),Q=B.defaultAttributeValues;for(let G in W){let Y=W[G];if(Y.location>=0){let J=N[G];if(void 0===J&&("instanceMatrix"===G&&I.instanceMatrix&&(J=I.instanceMatrix),"instanceColor"===G&&I.instanceColor&&(J=I.instanceColor)),void 0!==J){let q=J.normalized,ee=J.itemSize,Z=i.get(J);if(void 0===Z)continue;let ce=Z.buffer,te=Z.type,pe=Z.bytesPerElement;if(J.isInterleavedBufferAttribute){let se=J.data,ze=se.stride,_e=J.offset;if(se.isInstancedInterleavedBuffer){for(let ge=0;ge<Y.locationSize;ge++)x(Y.location+ge,se.meshPerAttribute);!0!==I.isInstancedMesh&&void 0===R._maxInstanceCount&&(R._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let ge=0;ge<Y.locationSize;ge++)b(Y.location+ge);e.bindBuffer(34962,ce);for(let ge=0;ge<Y.locationSize;ge++)S(Y.location+ge,ee/Y.locationSize,te,q,ze*pe,(_e+ee/Y.locationSize*ge)*pe)}else{if(J.isInstancedBufferAttribute){for(let se=0;se<Y.locationSize;se++)x(Y.location+se,J.meshPerAttribute);!0!==I.isInstancedMesh&&void 0===R._maxInstanceCount&&(R._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let se=0;se<Y.locationSize;se++)b(Y.location+se);e.bindBuffer(34962,ce);for(let se=0;se<Y.locationSize;se++)S(Y.location+se,ee/Y.locationSize,te,q,ee*pe,ee/Y.locationSize*se*pe)}}else if(void 0!==Q){let q=Q[G];if(void 0!==q)switch(q.length){case 2:e.vertexAttrib2fv(Y.location,q);break;case 3:e.vertexAttrib3fv(Y.location,q);break;case 4:e.vertexAttrib4fv(Y.location,q);break;default:e.vertexAttrib1fv(Y.location,q)}}}}w()}(I,B,V,R),null!==N&&e.bindBuffer(34963,i.get(N).buffer))},reset:D,resetDefaultState:P,dispose:function M(){D();for(let I in a){let B=a[I];for(let V in B){let R=B[V];for(let N in R)f(R[N].object),delete R[N];delete B[V]}delete a[I]}},releaseStatesOfGeometry:function z(I){if(void 0===a[I.id])return;let B=a[I.id];for(let V in B){let R=B[V];for(let N in R)f(R[N].object),delete R[N];delete B[V]}delete a[I.id]},releaseStatesOfProgram:function E(I){for(let B in a){let V=a[B];if(void 0===V[I.id])continue;let R=V[I.id];for(let N in R)f(R[N].object),delete R[N];delete V[I.id]}},initAttributes:_,enableAttribute:b,disableUnusedAttributes:w}}function ame(e,t,i,n){let o,r=n.isWebGL2;this.setMode=function s(c){o=c},this.render=function a(c,h){e.drawArrays(o,c,h),i.update(h,o,1)},this.renderInstances=function l(c,h,u){if(0===u)return;let d,p;if(r)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",null===d)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[p](o,c,h,u),i.update(h,o,u)}}function lme(e,t,i){let n;function o(S){if("highp"===S){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";S="mediump"}return"mediump"===S&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",l=o(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=s||t.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),m=e.getParameter(34921),g=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),_=d>0,b=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:function r(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let S=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:o,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:_,floatFragmentTextures:b,floatVertexTextures:_&&b,maxSamples:s?e.getParameter(36183):0}}function cme(e){let t=this,i=null,n=0,r=!1,o=!1,s=new ta,a=new Vr,l={value:null,needsUpdate:!1};function h(u,d,p,f){let m=null!==u?u.length:0,g=null;if(0!==m){if(g=l.value,!0!==f||null===g){let v=p+4*m,y=d.matrixWorldInverse;a.getNormalMatrix(y),(null===g||g.length<v)&&(g=new Float32Array(v));for(let _=0,b=p;_!==m;++_,b+=4)s.copy(u[_]).applyMatrix4(y,a),s.normal.toArray(g,b),g[b+3]=s.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){let p=0!==u.length||d||0!==n||r;return r=d,n=u.length,p},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(u,d){i=h(u,d,0)},this.setState=function(u,d,p){let f=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,v=e.get(u);if(!r||null===f||0===f.length||o&&!g)o?h(null):function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}();else{let y=o?0:n,_=4*y,b=v.clippingState||null;l.value=b,b=h(f,d,_,p);for(let x=0;x!==_;++x)b[x]=i[x];v.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}}}function hme(e){let t=new WeakMap;function i(s,a){return a===Fb?s.mapping=Td:a===Bb&&(s.mapping=Ed),s}function r(s){let a=s.target;a.removeEventListener("dispose",r);let l=t.get(a);void 0!==l&&(t.delete(a),l.dispose())}return{get:function n(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){let a=s.mapping;if(a===Fb||a===Bb){if(t.has(s))return i(t.get(s).texture,s.mapping);{let l=s.image;if(l&&l.height>0){let c=new Cpe(l.height/2);return c.fromEquirectangularTexture(e,s),t.set(s,c),s.addEventListener("dispose",r),i(c.texture,s.mapping)}return null}}}return s},dispose:function o(){t=new WeakMap}}}var Sx=class extends Fd{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,o=i+e,s=n+t,a=n-t;if(null!==this.view&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,o=r+l*this.view.width,s-=c*this.view.offsetY,a=s-c*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},aF=[.125,.215,.35,.446,.526,.582],Mx=new Sx,lF=new Ct,zx=null,Hd=(1+Math.sqrt(5))/2,hf=1/Hd,cF=[new T(1,1,1),new T(-1,1,1),new T(1,1,-1),new T(-1,1,-1),new T(0,Hd,hf),new T(0,Hd,-hf),new T(hf,0,Hd),new T(-hf,0,Hd),new T(Hd,hf,0),new T(-Hd,hf,0)],hF=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){zx=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=pF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=dF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(zx),e.scissorTest=!1,Wv(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Td||e.mapping===Ed?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),zx=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ri,minFilter:ri,generateMipmaps:!1,type:Dd,format:no,encoding:el,depthBuffer:!1},n=uF(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=uF(e,t,i);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function ume(e){let t=[],i=[],n=[],r=e,o=e-4+1+aF.length;for(let s=0;s<o;s++){let a=Math.pow(2,r);i.push(a);let l=1/a;s>e-4?l=aF[s-e+4-1]:0===s&&(l=0),n.push(l);let c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),_=new Float32Array(g*f*p),b=new Float32Array(v*f*p);for(let w=0;w<p;w++){let S=w%3*2/3-1,C=w>2?0:-1;y.set([S,C,0,S+2/3,C,0,S+2/3,C+1,0,S,C,0,S+2/3,C+1,0,S,C+1,0],m*f*w),_.set(d,g*f*w),b.set([w,w,w,w,w,w],v*f*w)}let x=new gt;x.setAttribute("position",new It(y,m)),x.setAttribute("uv",new It(_,g)),x.setAttribute("faceIndex",new It(b,v)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(r)),this._blurMaterial=function dme(e,t,i){let n=new Float32Array(20),r=new T(0,1,0);return new qi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Mr,depthTest:!1,depthWrite:!1})}(r,e,t)}return n}_compileMaterial(e){let t=new Dr(this._lodPlanes[0],e);this._renderer.compile(t,Mx)}_sceneToCubeUV(e,t,i,n){let r=new Yo(90,1,t,i),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(lF),a.toneMapping=Hl,a.autoClear=!1;let h=new Rd({name:"PMREM.Background",side:io,depthWrite:!1,depthTest:!1}),u=new Dr(new rl,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(lF),d=!0);for(let f=0;f<6;f++){let m=f%3;0===m?(r.up.set(0,o[f],0),r.lookAt(s[f],0,0)):1===m?(r.up.set(0,0,o[f]),r.lookAt(0,s[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,s[f]));let g=this._cubeSize;Wv(n,m*g,f>2?g:0,g,g),a.setRenderTarget(n),d&&a.render(u,r),a.render(e,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=e.mapping===Td||e.mapping===Ed;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=pF()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=dF());let r=n?this._cubemapMaterial:this._equirectMaterial,o=new Dr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let a=this._cubeSize;Wv(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,Mx)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]);this._blur(e,n-1,n,r,cF[(n-1)%cF.length])}t.autoClear=i}_blur(e,t,i,n,r){let o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,s){let a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new Dr(this._lodPlanes[n],l),u=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,f=r/p,m=isFinite(r)?1+Math.floor(3*f):20;m>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);let g=[],v=0;for(let w=0;w<20;++w){let S=w/f,C=Math.exp(-S*S/2);g.push(C),0===w?v+=C:w<m&&(v+=2*C)}for(let w=0;w<g.length;w++)g[w]=g[w]/v;u.envMap.value=e.texture,u.samples.value=m,u.weights.value=g,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);let{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-i;let _=this._sizeLods[n];Wv(t,3*_*(n>y-4?n-y+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(t),a.render(h,Mx)}};function uF(e,t,i){let n=new Wi(e,t,i);return n.texture.mapping=s2,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Wv(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function dF(){return new qi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Mr,depthTest:!1,depthWrite:!1})}function pF(){return new qi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Mr,depthTest:!1,depthWrite:!1})}function pme(e){let t=new WeakMap,i=null;function o(a){let l=a.target;l.removeEventListener("dispose",o);let c=t.get(l);void 0!==c&&(t.delete(l),c.dispose())}return{get:function n(a){if(a&&a.isTexture){let l=a.mapping,c=l===Fb||l===Bb,h=l===Td||l===Ed;if(c||h){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let u=t.get(a);return null===i&&(i=new hF(e)),u=c?i.fromEquirectangular(a,u):i.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;{let u=a.image;if(c&&u&&u.height>0||h&&u&&function r(a){let l=0;for(let h=0;h<6;h++)void 0!==a[h]&&l++;return 6===l}(u)){null===i&&(i=new hF(e));let d=c?i.fromEquirectangular(a):i.fromCubemap(a);return t.set(a,d),a.addEventListener("dispose",o),d.texture}return null}}}return a},dispose:function s(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function fme(e){let t={};function i(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(n){return null!==i(n)},init:function(n){n.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(n){let r=i(n);return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function mme(e,t,i,n){let r={},o=new WeakMap;function s(u){let d=u.target;null!==d.index&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",s),delete r[d.id];let p=o.get(d);p&&(t.remove(p),o.delete(d)),n.releaseStatesOfGeometry(d),!0===d.isInstancedBufferGeometry&&delete d._maxInstanceCount,i.memory.geometries--}function c(u){let d=[],p=u.index,f=u.attributes.position,m=0;if(null!==p){let y=p.array;m=p.version;for(let _=0,b=y.length;_<b;_+=3){let x=y[_+0],w=y[_+1],S=y[_+2];d.push(x,w,w,S,S,x)}}else{m=f.version;for(let _=0,b=f.array.length/3-1;_<b;_+=3){let x=_+0,w=_+1,S=_+2;d.push(x,w,w,S,S,x)}}let g=new(jR(d)?Jp:nF)(d,1);g.version=m;let v=o.get(u);v&&t.remove(v),o.set(u,g)}return{get:function a(u,d){return!0===r[d.id]||(d.addEventListener("dispose",s),r[d.id]=!0,i.memory.geometries++),d},update:function l(u){let d=u.attributes;for(let f in d)t.update(d[f],34962);let p=u.morphAttributes;for(let f in p){let m=p[f];for(let g=0,v=m.length;g<v;g++)t.update(m[g],34962)}},getWireframeAttribute:function h(u){let d=o.get(u);if(d){let p=u.index;null!==p&&d.version<p.version&&c(u)}else c(u);return o.get(u)}}}function gme(e,t,i,n){let o,a,l,r=n.isWebGL2;this.setMode=function s(d){o=d},this.setIndex=function c(d){a=d.type,l=d.bytesPerElement},this.render=function h(d,p){e.drawElements(o,p,a,d*l),i.update(p,o,1)},this.renderInstances=function u(d,p,f){if(0===f)return;let m,g;if(r)m=e,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[g](o,p,a,d*l,f),i.update(p,o,f)}}function vme(e){let i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function r(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function n(o,s,a){switch(i.calls++,s){case 4:i.triangles+=a*(o/3);break;case 1:i.lines+=a*(o/2);break;case 3:i.lines+=a*(o-1);break;case 2:i.lines+=a*o;break;case 0:i.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s)}}}}function yme(e,t){return e[0]-t[0]}function _me(e,t){return Math.abs(t[1])-Math.abs(e[1])}function bme(e,t,i){let n={},r=new Float32Array(8),o=new WeakMap,s=new Ut,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,h,u,d){let p=c.morphTargetInfluences;if(!0===t.isWebGL2){let f=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=void 0!==f?f.length:0,g=o.get(h);if(void 0===g||g.count!==m){let _=function(){I.dispose(),o.delete(h),h.removeEventListener("dispose",_)};void 0!==g&&g.texture.dispose();let b=void 0!==h.morphAttributes.position,x=void 0!==h.morphAttributes.normal,w=void 0!==h.morphAttributes.color,S=h.morphAttributes.position||[],C=h.morphAttributes.normal||[],M=h.morphAttributes.color||[],z=0;!0===b&&(z=1),!0===x&&(z=2),!0===w&&(z=3);let E=h.attributes.position.count*z,D=1;E>t.maxTextureSize&&(D=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);let P=new Float32Array(E*D*4*m),I=new qR(P,E,D,m);I.type=zr,I.needsUpdate=!0;let B=4*z;for(let V=0;V<m;V++){let R=S[V],N=C[V],W=M[V],Q=E*D*4*V;for(let G=0;G<R.count;G++){let Y=G*B;!0===b&&(s.fromBufferAttribute(R,G),P[Q+Y+0]=s.x,P[Q+Y+1]=s.y,P[Q+Y+2]=s.z,P[Q+Y+3]=0),!0===x&&(s.fromBufferAttribute(N,G),P[Q+Y+4]=s.x,P[Q+Y+5]=s.y,P[Q+Y+6]=s.z,P[Q+Y+7]=0),!0===w&&(s.fromBufferAttribute(W,G),P[Q+Y+8]=s.x,P[Q+Y+9]=s.y,P[Q+Y+10]=s.z,P[Q+Y+11]=4===W.itemSize?s.w:1)}}g={count:m,texture:I,size:new $(E,D)},o.set(h,g),h.addEventListener("dispose",_)}let v=0;for(let _=0;_<p.length;_++)v+=p[_];let y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let f=void 0===p?0:p.length,m=n[h.id];if(void 0===m||m.length!==f){m=[];for(let b=0;b<f;b++)m[b]=[b,0];n[h.id]=m}for(let b=0;b<f;b++){let x=m[b];x[0]=b,x[1]=p[b]}m.sort(_me);for(let b=0;b<8;b++)b<f&&m[b][1]?(a[b][0]=m[b][0],a[b][1]=m[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(yme);let g=h.morphAttributes.position,v=h.morphAttributes.normal,y=0;for(let b=0;b<8;b++){let x=a[b],w=x[0],S=x[1];w!==Number.MAX_SAFE_INTEGER&&S?(g&&h.getAttribute("morphTarget"+b)!==g[w]&&h.setAttribute("morphTarget"+b,g[w]),v&&h.getAttribute("morphNormal"+b)!==v[w]&&h.setAttribute("morphNormal"+b,v[w]),r[b]=S,y+=S):(g&&!0===h.hasAttribute("morphTarget"+b)&&h.deleteAttribute("morphTarget"+b),v&&!0===h.hasAttribute("morphNormal"+b)&&h.deleteAttribute("morphNormal"+b),r[b]=0)}let _=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",_),d.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function xme(e,t,i,n){let r=new WeakMap;function a(l){let c=l.target;c.removeEventListener("dispose",a),i.remove(c.instanceMatrix),null!==c.instanceColor&&i.remove(c.instanceColor)}return{update:function o(l){let c=n.render.frame,u=t.get(l,l.geometry);return r.get(u)!==c&&(t.update(u),r.set(u,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),i.update(l.instanceMatrix,34962),null!==l.instanceColor&&i.update(l.instanceColor,34962)),u},dispose:function s(){r=new WeakMap}}}var fF=new Zn,mF=new qR,gF=new class extends Zn{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Gi,this.minFilter=Gi,this.wrapR=Rn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},vF=new xx,yF=[],_F=[],bF=new Float32Array(16),xF=new Float32Array(9),wF=new Float32Array(4);function uf(e,t,i){let n=e[0];if(n<=0||n>0)return e;let r=t*i,o=yF[r];if(void 0===o&&(o=new Float32Array(r),yF[r]=o),0!==t){n.toArray(o,0);for(let s=1,a=0;s!==t;++s)a+=i,e[s].toArray(o,a)}return o}function jr(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Yr(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function qv(e,t){let i=_F[t];void 0===i&&(i=new Int32Array(t),_F[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function wme(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Cme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jr(i,t))return;e.uniform2fv(this.addr,t),Yr(i,t)}}function Sme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(jr(i,t))return;e.uniform3fv(this.addr,t),Yr(i,t)}}function Mme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jr(i,t))return;e.uniform4fv(this.addr,t),Yr(i,t)}}function zme(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(jr(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Yr(i,t)}else{if(jr(i,n))return;wF.set(n),e.uniformMatrix2fv(this.addr,!1,wF),Yr(i,n)}}function Tme(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(jr(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Yr(i,t)}else{if(jr(i,n))return;xF.set(n),e.uniformMatrix3fv(this.addr,!1,xF),Yr(i,n)}}function Eme(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(jr(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Yr(i,t)}else{if(jr(i,n))return;bF.set(n),e.uniformMatrix4fv(this.addr,!1,bF),Yr(i,n)}}function Dme(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Ame(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jr(i,t))return;e.uniform2iv(this.addr,t),Yr(i,t)}}function Pme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(jr(i,t))return;e.uniform3iv(this.addr,t),Yr(i,t)}}function Ime(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jr(i,t))return;e.uniform4iv(this.addr,t),Yr(i,t)}}function Ome(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function kme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jr(i,t))return;e.uniform2uiv(this.addr,t),Yr(i,t)}}function Nme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(jr(i,t))return;e.uniform3uiv(this.addr,t),Yr(i,t)}}function Lme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jr(i,t))return;e.uniform4uiv(this.addr,t),Yr(i,t)}}function Rme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||fF,r)}function Fme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||gF,r)}function Bme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||vF,r)}function Vme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||mF,r)}function Ume(e,t){e.uniform1fv(this.addr,t)}function jme(e,t){let i=uf(t,this.size,2);e.uniform2fv(this.addr,i)}function Yme(e,t){let i=uf(t,this.size,3);e.uniform3fv(this.addr,i)}function Gme(e,t){let i=uf(t,this.size,4);e.uniform4fv(this.addr,i)}function Wme(e,t){let i=uf(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function qme(e,t){let i=uf(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Xme(e,t){let i=uf(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function $me(e,t){e.uniform1iv(this.addr,t)}function Qme(e,t){e.uniform2iv(this.addr,t)}function Zme(e,t){e.uniform3iv(this.addr,t)}function Kme(e,t){e.uniform4iv(this.addr,t)}function Jme(e,t){e.uniform1uiv(this.addr,t)}function e2e(e,t){e.uniform2uiv(this.addr,t)}function t2e(e,t){e.uniform3uiv(this.addr,t)}function i2e(e,t){e.uniform4uiv(this.addr,t)}function n2e(e,t,i){let n=this.cache,r=t.length,o=qv(i,r);jr(n,o)||(e.uniform1iv(this.addr,o),Yr(n,o));for(let s=0;s!==r;++s)i.setTexture2D(t[s]||fF,o[s])}function r2e(e,t,i){let n=this.cache,r=t.length,o=qv(i,r);jr(n,o)||(e.uniform1iv(this.addr,o),Yr(n,o));for(let s=0;s!==r;++s)i.setTexture3D(t[s]||gF,o[s])}function o2e(e,t,i){let n=this.cache,r=t.length,o=qv(i,r);jr(n,o)||(e.uniform1iv(this.addr,o),Yr(n,o));for(let s=0;s!==r;++s)i.setTextureCube(t[s]||vF,o[s])}function s2e(e,t,i){let n=this.cache,r=t.length,o=qv(i,r);jr(n,o)||(e.uniform1iv(this.addr,o),Yr(n,o));for(let s=0;s!==r;++s)i.setTexture2DArray(t[s]||mF,o[s])}var l2e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function Hme(e){switch(e){case 5126:return wme;case 35664:return Cme;case 35665:return Sme;case 35666:return Mme;case 35674:return zme;case 35675:return Tme;case 35676:return Eme;case 5124:case 35670:return Dme;case 35667:case 35671:return Ame;case 35668:case 35672:return Pme;case 35669:case 35673:return Ime;case 5125:return Ome;case 36294:return kme;case 36295:return Nme;case 36296:return Lme;case 35678:case 36198:case 36298:case 36306:case 35682:return Rme;case 35679:case 36299:case 36307:return Fme;case 35680:case 36300:case 36308:case 36293:return Bme;case 36289:case 36303:case 36311:case 36292:return Vme}}(t.type)}},c2e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function a2e(e){switch(e){case 5126:return Ume;case 35664:return jme;case 35665:return Yme;case 35666:return Gme;case 35674:return Wme;case 35675:return qme;case 35676:return Xme;case 5124:case 35670:return $me;case 35667:case 35671:return Qme;case 35668:case 35672:return Zme;case 35669:case 35673:return Kme;case 5125:return Jme;case 36294:return e2e;case 36295:return t2e;case 36296:return i2e;case 35678:case 36198:case 36298:case 36306:case 35682:return n2e;case 35679:case 36299:case 36307:return r2e;case 35680:case 36300:case 36308:case 36293:return o2e;case 36289:case 36303:case 36311:case 36292:return s2e}}(t.type)}},h2e=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let n=this.seq;for(let r=0,o=n.length;r!==o;++r){let s=n[r];s.setValue(e,t[s.id],i)}}},Ex=/(\w+)(\])?(\[|\.)?/g;function CF(e,t){e.seq.push(t),e.map[t.id]=t}function u2e(e,t,i){let n=e.name,r=n.length;for(Ex.lastIndex=0;;){let o=Ex.exec(n),a=o[1],c=o[3];if("]"===o[2]&&(a|=0),void 0===c||"["===c&&Ex.lastIndex+2===r){CF(i,void 0===c?new l2e(a,e,t):new c2e(a,e,t));break}{let h=i.map[a];void 0===h&&(h=new h2e(a),CF(i,h)),i=h}}}var Xv=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){let r=e.getActiveUniform(t,n);u2e(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,o=t.length;r!==o;++r){let s=t[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let o=e[n];o.id in t&&i.push(o)}return i}};function SF(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var d2e=0;function MF(e,t,i){let n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let o=/ERROR: 0:(\d+)/.exec(r);if(o){let s=parseInt(o[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function p2e(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),o=Math.min(t+6,i.length);for(let s=r;s<o;s++){let a=s+1;n.push(`${a===t?">":" "} ${a}: ${i[s]}`)}return n.join("\n")}(e.getShaderSource(t),s)}return r}function m2e(e,t){let i=function f2e(e){switch(e){case el:return["Linear","( value )"];case Zt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function g2e(e,t){let i;switch(t){case w1e:i="Linear";break;case C1e:i="Reinhard";break;case S1e:i="OptimizedCineon";break;case M1e:i="ACESFilmic";break;case z1e:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function _2(e){return""!==e}function zF(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function TF(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var b2e=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dx(e){return e.replace(b2e,x2e)}function x2e(e,t){let i=oi[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Dx(i)}var w2e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function EF(e){return e.replace(w2e,C2e)}function C2e(e,t,i,n){let r="";for(let o=parseInt(t);o<parseInt(i);o++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function DF(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function D2e(e,t,i,n){let g,v,r=e.getContext(),o=i.defines,s=i.vertexShader,a=i.fragmentShader,l=function S2e(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Lb?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===e1e?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===o2&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function M2e(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Td:case Ed:t="ENVMAP_TYPE_CUBE";break;case s2:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function z2e(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===Ed&&(t="ENVMAP_MODE_REFRACTION"),t}(i),u=function T2e(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case cR:t="ENVMAP_BLENDING_MULTIPLY";break;case b1e:t="ENVMAP_BLENDING_MIX";break;case x1e:t="ENVMAP_BLENDING_ADD"}return t}(i),d=function E2e(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=i.isWebGL2?"":function v2e(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_2).join("\n")}(i),f=function y2e(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),m=r.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[f].filter(_2).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(_2).join("\n"),v.length>0&&(v+="\n")):(g=[DF(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_2).join("\n"),v=[p,DF(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Hl?"#define TONE_MAPPING":"",i.toneMapping!==Hl?oi.tonemapping_pars_fragment:"",i.toneMapping!==Hl?g2e("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",oi.encodings_pars_fragment,m2e("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(_2).join("\n")),s=Dx(s),s=zF(s,i),s=TF(s,i),a=Dx(a),a=zF(a,i),a=TF(a,i),s=EF(s),a=EF(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===VR?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===VR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);let S,C,b=y+v+a,x=SF(r,35633,y+g+s),w=SF(r,35632,b);if(r.attachShader(m,x),r.attachShader(m,w),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){let M=r.getProgramInfoLog(m).trim(),z=r.getShaderInfoLog(x).trim(),E=r.getShaderInfoLog(w).trim(),D=!0,P=!0;if(!1===r.getProgramParameter(m,35714)){D=!1;let I=MF(r,x,"vertex"),B=MF(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+M+"\n"+I+"\n"+B)}else""!==M?console.warn("THREE.WebGLProgram: Program Info Log:",M):(""===z||""===E)&&(P=!1);P&&(this.diagnostics={runnable:D,programLog:M,vertexShader:{log:z,prefix:g},fragmentShader:{log:E,prefix:v}})}return r.deleteShader(x),r.deleteShader(w),this.getUniforms=function(){return void 0===S&&(S=new Xv(r,m)),S},this.getAttributes=function(){return void 0===C&&(C=function _2e(e,t){let i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){let o=e.getActiveAttrib(t,r),s=o.name,a=1;35674===o.type&&(a=2),35675===o.type&&(a=3),35676===o.type&&(a=4),i[s]={type:o.type,location:e.getAttribLocation(t,s),locationSize:a}}return i}(r,m)),C},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=d2e++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}var A2e=0,P2e=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.fragmentShader,n=this._getShaderStage(e.vertexShader),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(n)&&(o.add(n),n.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new I2e(e),t.set(e,i)),i}},I2e=class{constructor(e){this.id=A2e++,this.code=e,this.usedTimes=0}};function O2e(e,t,i,n,r,o,s){let a=new dx,l=new P2e,c=[],h=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function m(C,M,z,E,D){let P=E.fog,I=D.geometry,V=(C.isMeshStandardMaterial?i:t).get(C.envMap||(C.isMeshStandardMaterial?E.environment:null)),R=V&&V.mapping===s2?V.image.height:null,N=f[C.type];null!==C.precision&&(p=r.getMaxPrecision(C.precision),p!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",p,"instead."));let Y,J,q,ee,W=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,Q=void 0!==W?W.length:0,G=0;if(void 0!==I.morphAttributes.position&&(G=1),void 0!==I.morphAttributes.normal&&(G=2),void 0!==I.morphAttributes.color&&(G=3),N){let se=jl[N];Y=se.vertexShader,J=se.fragmentShader}else Y=C.vertexShader,J=C.fragmentShader,l.update(C),q=l.getVertexShaderID(C),ee=l.getFragmentShaderID(C);let Z=e.getRenderTarget(),te=C.clearcoat>0,pe=C.iridescence>0;return{isWebGL2:h,shaderID:N,shaderName:C.type,vertexShader:Y,fragmentShader:J,defines:C.defines,customVertexShaderID:q,customFragmentShaderID:ee,isRawShaderMaterial:!0===C.isRawShaderMaterial,glslVersion:C.glslVersion,precision:p,instancing:!0===D.isInstancedMesh,instancingColor:!0===D.isInstancedMesh&&null!==D.instanceColor,supportsVertexTextures:d,outputEncoding:null===Z?e.outputEncoding:!0===Z.isXRRenderTarget?Z.texture.encoding:el,map:!!C.map,matcap:!!C.matcap,envMap:!!V,envMapMode:V&&V.mapping,envMapCubeUVHeight:R,lightMap:!!C.lightMap,aoMap:!!C.aoMap,emissiveMap:!!C.emissiveMap,bumpMap:!!C.bumpMap,normalMap:!!C.normalMap,objectSpaceNormalMap:C.normalMapType===j1e,tangentSpaceNormalMap:C.normalMapType===U1e,decodeVideoTexture:!!C.map&&!0===C.map.isVideoTexture&&C.map.encoding===Zt,clearcoat:te,clearcoatMap:te&&!!C.clearcoatMap,clearcoatRoughnessMap:te&&!!C.clearcoatRoughnessMap,clearcoatNormalMap:te&&!!C.clearcoatNormalMap,iridescence:pe,iridescenceMap:pe&&!!C.iridescenceMap,iridescenceThicknessMap:pe&&!!C.iridescenceThicknessMap,displacementMap:!!C.displacementMap,roughnessMap:!!C.roughnessMap,metalnessMap:!!C.metalnessMap,specularMap:!!C.specularMap,specularIntensityMap:!!C.specularIntensityMap,specularColorMap:!!C.specularColorMap,opaque:!1===C.transparent&&C.blending===zd,alphaMap:!!C.alphaMap,alphaTest:C.alphaTest>0,gradientMap:!!C.gradientMap,sheen:C.sheen>0,sheenColorMap:!!C.sheenColorMap,sheenRoughnessMap:!!C.sheenRoughnessMap,transmission:C.transmission>0,transmissionMap:!!C.transmissionMap,thicknessMap:!!C.thicknessMap,combine:C.combine,vertexTangents:!!C.normalMap&&!!I.attributes.tangent,vertexColors:C.vertexColors,vertexAlphas:!0===C.vertexColors&&!!I.attributes.color&&4===I.attributes.color.itemSize,vertexUvs:!!(C.map||C.bumpMap||C.normalMap||C.specularMap||C.alphaMap||C.emissiveMap||C.roughnessMap||C.metalnessMap||C.clearcoatMap||C.clearcoatRoughnessMap||C.clearcoatNormalMap||C.iridescenceMap||C.iridescenceThicknessMap||C.displacementMap||C.transmissionMap||C.thicknessMap||C.specularIntensityMap||C.specularColorMap||C.sheenColorMap||C.sheenRoughnessMap),uvsVertexOnly:!(C.map||C.bumpMap||C.normalMap||C.specularMap||C.alphaMap||C.emissiveMap||C.roughnessMap||C.metalnessMap||C.clearcoatNormalMap||C.iridescenceMap||C.iridescenceThicknessMap||C.transmission>0||C.transmissionMap||C.thicknessMap||C.specularIntensityMap||C.specularColorMap||C.sheen>0||C.sheenColorMap||C.sheenRoughnessMap||!C.displacementMap),fog:!!P,useFog:!0===C.fog,fogExp2:P&&P.isFogExp2,flatShading:!!C.flatShading,sizeAttenuation:C.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===D.isSkinnedMesh,morphTargets:void 0!==I.morphAttributes.position,morphNormals:void 0!==I.morphAttributes.normal,morphColors:void 0!==I.morphAttributes.color,morphTargetsCount:Q,morphTextureStride:G,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:C.dithering,shadowMapEnabled:e.shadowMap.enabled&&z.length>0,shadowMapType:e.shadowMap.type,toneMapping:C.toneMapped?e.toneMapping:Hl,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===As,flipSided:C.side===io,useDepthPacking:!!C.depthPacking,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:C.extensions&&C.extensions.derivatives,extensionFragDepth:C.extensions&&C.extensions.fragDepth,extensionDrawBuffers:C.extensions&&C.extensions.drawBuffers,extensionShaderTextureLOD:C.extensions&&C.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:C.customProgramCacheKey()}},getProgramCacheKey:function g(C){let M=[];if(C.shaderID?M.push(C.shaderID):(M.push(C.customVertexShaderID),M.push(C.customFragmentShaderID)),void 0!==C.defines)for(let z in C.defines)M.push(z),M.push(C.defines[z]);return!1===C.isRawShaderMaterial&&(function v(C,M){C.push(M.precision),C.push(M.outputEncoding),C.push(M.envMapMode),C.push(M.envMapCubeUVHeight),C.push(M.combine),C.push(M.vertexUvs),C.push(M.fogExp2),C.push(M.sizeAttenuation),C.push(M.morphTargetsCount),C.push(M.morphAttributeCount),C.push(M.numDirLights),C.push(M.numPointLights),C.push(M.numSpotLights),C.push(M.numSpotLightMaps),C.push(M.numHemiLights),C.push(M.numRectAreaLights),C.push(M.numDirLightShadows),C.push(M.numPointLightShadows),C.push(M.numSpotLightShadows),C.push(M.numSpotLightShadowsWithMaps),C.push(M.shadowMapType),C.push(M.toneMapping),C.push(M.numClippingPlanes),C.push(M.numClipIntersection),C.push(M.depthPacking)}(M,C),function y(C,M){a.disableAll(),M.isWebGL2&&a.enable(0),M.supportsVertexTextures&&a.enable(1),M.instancing&&a.enable(2),M.instancingColor&&a.enable(3),M.map&&a.enable(4),M.matcap&&a.enable(5),M.envMap&&a.enable(6),M.lightMap&&a.enable(7),M.aoMap&&a.enable(8),M.emissiveMap&&a.enable(9),M.bumpMap&&a.enable(10),M.normalMap&&a.enable(11),M.objectSpaceNormalMap&&a.enable(12),M.tangentSpaceNormalMap&&a.enable(13),M.clearcoat&&a.enable(14),M.clearcoatMap&&a.enable(15),M.clearcoatRoughnessMap&&a.enable(16),M.clearcoatNormalMap&&a.enable(17),M.iridescence&&a.enable(18),M.iridescenceMap&&a.enable(19),M.iridescenceThicknessMap&&a.enable(20),M.displacementMap&&a.enable(21),M.specularMap&&a.enable(22),M.roughnessMap&&a.enable(23),M.metalnessMap&&a.enable(24),M.gradientMap&&a.enable(25),M.alphaMap&&a.enable(26),M.alphaTest&&a.enable(27),M.vertexColors&&a.enable(28),M.vertexAlphas&&a.enable(29),M.vertexUvs&&a.enable(30),M.vertexTangents&&a.enable(31),M.uvsVertexOnly&&a.enable(32),C.push(a.mask),a.disableAll(),M.fog&&a.enable(0),M.useFog&&a.enable(1),M.flatShading&&a.enable(2),M.logarithmicDepthBuffer&&a.enable(3),M.skinning&&a.enable(4),M.morphTargets&&a.enable(5),M.morphNormals&&a.enable(6),M.morphColors&&a.enable(7),M.premultipliedAlpha&&a.enable(8),M.shadowMapEnabled&&a.enable(9),M.physicallyCorrectLights&&a.enable(10),M.doubleSided&&a.enable(11),M.flipSided&&a.enable(12),M.useDepthPacking&&a.enable(13),M.dithering&&a.enable(14),M.specularIntensityMap&&a.enable(15),M.specularColorMap&&a.enable(16),M.transmission&&a.enable(17),M.transmissionMap&&a.enable(18),M.thicknessMap&&a.enable(19),M.sheen&&a.enable(20),M.sheenColorMap&&a.enable(21),M.sheenRoughnessMap&&a.enable(22),M.decodeVideoTexture&&a.enable(23),M.opaque&&a.enable(24),C.push(a.mask)}(M,C),M.push(e.outputEncoding)),M.push(C.customProgramCacheKey),M.join()},getUniforms:function _(C){let z,M=f[C.type];return z=M?rf.clone(jl[M].uniforms):C.uniforms,z},acquireProgram:function b(C,M){let z;for(let E=0,D=c.length;E<D;E++){let P=c[E];if(P.cacheKey===M){z=P,++z.usedTimes;break}}return void 0===z&&(z=new D2e(e,M,C,o),c.push(z)),z},releaseProgram:function x(C){if(0==--C.usedTimes){let M=c.indexOf(C);c[M]=c[c.length-1],c.pop(),C.destroy()}},releaseShaderCache:function w(C){l.remove(C)},programs:c,dispose:function S(){l.dispose()}}}function k2e(){let e=new WeakMap;return{get:function t(o){let s=e.get(o);return void 0===s&&(s={},e.set(o,s)),s},remove:function i(o){e.delete(o)},update:function n(o,s,a){e.get(o)[s]=a},dispose:function r(){e=new WeakMap}}}function N2e(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function AF(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function PF(){let e=[],t=0,i=[],n=[],r=[];function s(u,d,p,f,m,g){let v=e[t];return void 0===v?(v={id:u.id,object:u,geometry:d,material:p,groupOrder:f,renderOrder:u.renderOrder,z:m,group:g},e[t]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=u.renderOrder,v.z=m,v.group=g),t++,v}return{opaque:i,transmissive:n,transparent:r,init:function o(){t=0,i.length=0,n.length=0,r.length=0},push:function a(u,d,p,f,m,g){let v=s(u,d,p,f,m,g);p.transmission>0?n.push(v):!0===p.transparent?r.push(v):i.push(v)},unshift:function l(u,d,p,f,m,g){let v=s(u,d,p,f,m,g);p.transmission>0?n.unshift(v):!0===p.transparent?r.unshift(v):i.unshift(v)},finish:function h(){for(let u=t,d=e.length;u<d;u++){let p=e[u];if(null===p.id)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}},sort:function c(u,d){i.length>1&&i.sort(u||N2e),n.length>1&&n.sort(d||AF),r.length>1&&r.sort(d||AF)}}}function L2e(){let e=new WeakMap;return{get:function t(n,r){let s,o=e.get(n);return void 0===o?(s=new PF,e.set(n,[s])):r>=o.length?(s=new PF,o.push(s)):s=o[r],s},dispose:function i(){e=new WeakMap}}}function R2e(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new T,color:new Ct};break;case"SpotLight":i={position:new T,direction:new T,color:new Ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new T,color:new Ct,distance:0,decay:0};break;case"HemisphereLight":i={direction:new T,skyColor:new Ct,groundColor:new Ct};break;case"RectAreaLight":i={color:new Ct,position:new T,halfWidth:new T,halfHeight:new T}}return e[t.id]=i,i}}}var B2e=0;function V2e(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function H2e(e,t){let i=new R2e,n=function F2e(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)r.probe.push(new T);let o=new T,s=new De,a=new De;return{setup:function l(h,u){let d=0,p=0,f=0;for(let E=0;E<9;E++)r.probe[E].set(0,0,0);let m=0,g=0,v=0,y=0,_=0,b=0,x=0,w=0,S=0,C=0;h.sort(V2e);let M=!0!==u?Math.PI:1;for(let E=0,D=h.length;E<D;E++){let P=h[E],I=P.color,B=P.intensity,V=P.distance,R=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)d+=I.r*B*M,p+=I.g*B*M,f+=I.b*B*M;else if(P.isLightProbe)for(let N=0;N<9;N++)r.probe[N].addScaledVector(P.sh.coefficients[N],B);else if(P.isDirectionalLight){let N=i.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity*M),P.castShadow){let W=P.shadow,Q=n.get(P);Q.shadowBias=W.bias,Q.shadowNormalBias=W.normalBias,Q.shadowRadius=W.radius,Q.shadowMapSize=W.mapSize,r.directionalShadow[m]=Q,r.directionalShadowMap[m]=R,r.directionalShadowMatrix[m]=P.shadow.matrix,b++}r.directional[m]=N,m++}else if(P.isSpotLight){let N=i.get(P);N.position.setFromMatrixPosition(P.matrixWorld),N.color.copy(I).multiplyScalar(B*M),N.distance=V,N.coneCos=Math.cos(P.angle),N.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),N.decay=P.decay,r.spot[v]=N;let W=P.shadow;if(P.map&&(r.spotLightMap[S]=P.map,S++,W.updateMatrices(P),P.castShadow&&C++),r.spotLightMatrix[v]=W.matrix,P.castShadow){let Q=n.get(P);Q.shadowBias=W.bias,Q.shadowNormalBias=W.normalBias,Q.shadowRadius=W.radius,Q.shadowMapSize=W.mapSize,r.spotShadow[v]=Q,r.spotShadowMap[v]=R,w++}v++}else if(P.isRectAreaLight){let N=i.get(P);N.color.copy(I).multiplyScalar(B),N.halfWidth.set(.5*P.width,0,0),N.halfHeight.set(0,.5*P.height,0),r.rectArea[y]=N,y++}else if(P.isPointLight){let N=i.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity*M),N.distance=P.distance,N.decay=P.decay,P.castShadow){let W=P.shadow,Q=n.get(P);Q.shadowBias=W.bias,Q.shadowNormalBias=W.normalBias,Q.shadowRadius=W.radius,Q.shadowMapSize=W.mapSize,Q.shadowCameraNear=W.camera.near,Q.shadowCameraFar=W.camera.far,r.pointShadow[g]=Q,r.pointShadowMap[g]=R,r.pointShadowMatrix[g]=P.shadow.matrix,x++}r.point[g]=N,g++}else if(P.isHemisphereLight){let N=i.get(P);N.skyColor.copy(P.color).multiplyScalar(B*M),N.groundColor.copy(P.groundColor).multiplyScalar(B*M),r.hemi[_]=N,_++}}y>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=je.LTC_FLOAT_1,r.rectAreaLTC2=je.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=je.LTC_HALF_1,r.rectAreaLTC2=je.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=p,r.ambient[2]=f;let z=r.hash;(z.directionalLength!==m||z.pointLength!==g||z.spotLength!==v||z.rectAreaLength!==y||z.hemiLength!==_||z.numDirectionalShadows!==b||z.numPointShadows!==x||z.numSpotShadows!==w||z.numSpotMaps!==S)&&(r.directional.length=m,r.spot.length=v,r.rectArea.length=y,r.point.length=g,r.hemi.length=_,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=x,r.pointShadowMap.length=x,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=x,r.spotLightMatrix.length=w+S-C,r.spotLightMap.length=S,r.numSpotLightShadowsWithMaps=C,z.directionalLength=m,z.pointLength=g,z.spotLength=v,z.rectAreaLength=y,z.hemiLength=_,z.numDirectionalShadows=b,z.numPointShadows=x,z.numSpotShadows=w,z.numSpotMaps=S,r.version=B2e++)},setupView:function c(h,u){let d=0,p=0,f=0,m=0,g=0,v=u.matrixWorldInverse;for(let y=0,_=h.length;y<_;y++){let b=h[y];if(b.isDirectionalLight){let x=r.directional[d];x.direction.setFromMatrixPosition(b.matrixWorld),o.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(o),x.direction.transformDirection(v),d++}else if(b.isSpotLight){let x=r.spot[f];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(v),x.direction.setFromMatrixPosition(b.matrixWorld),o.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(o),x.direction.transformDirection(v),f++}else if(b.isRectAreaLight){let x=r.rectArea[m];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(v),a.identity(),s.copy(b.matrixWorld),s.premultiply(v),a.extractRotation(s),x.halfWidth.set(.5*b.width,0,0),x.halfHeight.set(0,.5*b.height,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),m++}else if(b.isPointLight){let x=r.point[p];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(v),p++}else if(b.isHemisphereLight){let x=r.hemi[g];x.direction.setFromMatrixPosition(b.matrixWorld),x.direction.transformDirection(v),g++}}},state:r}}function IF(e,t){let i=new H2e(e,t),n=[],r=[];return{init:function o(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function l(h){i.setup(n,h)},setupLightsView:function c(h){i.setupView(n,h)},pushLight:function s(h){n.push(h)},pushShadow:function a(h){r.push(h)}}}function U2e(e,t){let i=new WeakMap;return{get:function n(o,s=0){let l,a=i.get(o);return void 0===a?(l=new IF(e,t),i.set(o,[l])):s>=a.length?(l=new IF(e,t),a.push(l)):l=a[s],l},dispose:function r(){i=new WeakMap}}}var OF=class extends f2{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Jc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},j2e=class extends f2{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new T,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Y2e="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",G2e="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function W2e(e,t,i){let n=new Cx,r=new $,o=new $,s=new Ut,a=new OF({depthPacking:BR}),l=new j2e,c={},h=i.maxTextureSize,u={[Ja]:io,[io]:Ja,[As]:As},d=new qi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $},radius:{value:4}},vertexShader:Y2e,fragmentShader:G2e}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new gt;f.setAttribute("position",new It(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Dr(f,d),g=this;function v(b,x){let w=t.update(m);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===b.mapPass&&(b.mapPass=new Wi(r.x,r.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,e.setRenderTarget(b.mapPass),e.clear(),e.renderBufferDirect(x,null,w,d,m,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,e.setRenderTarget(b.map),e.clear(),e.renderBufferDirect(x,null,w,p,m,null)}function y(b,x,w,S,C,M){let z=null,E=!0===w.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==E)z=E;else if(z=!0===w.isPointLight?l:a,e.localClippingEnabled&&!0===x.clipShadows&&Array.isArray(x.clippingPlanes)&&0!==x.clippingPlanes.length||x.displacementMap&&0!==x.displacementScale||x.alphaMap&&x.alphaTest>0||x.map&&x.alphaTest>0){let D=z.uuid,P=x.uuid,I=c[D];void 0===I&&(I={},c[D]=I);let B=I[P];void 0===B&&(B=z.clone(),I[P]=B),z=B}return z.visible=x.visible,z.wireframe=x.wireframe,z.side=M===o2?null!==x.shadowSide?x.shadowSide:x.side:null!==x.shadowSide?x.shadowSide:u[x.side],z.alphaMap=x.alphaMap,z.alphaTest=x.alphaTest,z.map=x.map,z.clipShadows=x.clipShadows,z.clippingPlanes=x.clippingPlanes,z.clipIntersection=x.clipIntersection,z.displacementMap=x.displacementMap,z.displacementScale=x.displacementScale,z.displacementBias=x.displacementBias,z.wireframeLinewidth=x.wireframeLinewidth,z.linewidth=x.linewidth,!0===w.isPointLight&&!0===z.isMeshDistanceMaterial&&(z.referencePosition.setFromMatrixPosition(w.matrixWorld),z.nearDistance=S,z.farDistance=C),z}function _(b,x,w,S,C){if(!1===b.visible)return;if(b.layers.test(x.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&C===o2)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,b.matrixWorld);let z=t.update(b),E=b.material;if(Array.isArray(E)){let D=z.groups;for(let P=0,I=D.length;P<I;P++){let B=D[P],V=E[B.materialIndex];if(V&&V.visible){let R=y(b,V,S,w.near,w.far,C);e.renderBufferDirect(w,null,z,R,b,B)}}}else if(E.visible){let D=y(b,E,S,w.near,w.far,C);e.renderBufferDirect(w,null,z,D,b,null)}}let M=b.children;for(let z=0,E=M.length;z<E;z++)_(M[z],x,w,S,C)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Lb,this.render=function(b,x,w){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===b.length)return;let S=e.getRenderTarget(),C=e.getActiveCubeFace(),M=e.getActiveMipmapLevel(),z=e.state;z.setBlending(Mr),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);for(let E=0,D=b.length;E<D;E++){let P=b[E],I=P.shadow;if(void 0===I){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(!1===I.autoUpdate&&!1===I.needsUpdate)continue;r.copy(I.mapSize);let B=I.getFrameExtents();r.multiply(B),o.copy(I.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(o.x=Math.floor(h/B.x),r.x=o.x*B.x,I.mapSize.x=o.x),r.y>h&&(o.y=Math.floor(h/B.y),r.y=o.y*B.y,I.mapSize.y=o.y)),null===I.map&&(I.map=new Wi(r.x,r.y,this.type!==o2?{minFilter:Gi,magFilter:Gi}:{}),I.map.texture.name=P.name+".shadowMap",I.camera.updateProjectionMatrix()),e.setRenderTarget(I.map),e.clear();let V=I.getViewportCount();for(let R=0;R<V;R++){let N=I.getViewport(R);s.set(o.x*N.x,o.y*N.y,o.x*N.z,o.y*N.w),z.viewport(s),I.updateMatrices(P,R),n=I.getFrustum(),_(x,w,I.camera,P,this.type)}!0!==I.isPointLightShadow&&this.type===o2&&v(I,w),I.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(S,C,M)}}function q2e(e,t,i){let n=i.isWebGL2,a=new function r(){let re=!1,ye=new Ut,ke=null,Ue=new Ut(0,0,0,0);return{setMask:function(_t){ke!==_t&&!re&&(e.colorMask(_t,_t,_t,_t),ke=_t)},setLocked:function(_t){re=_t},setClear:function(_t,At,Hn,Kr,wc){!0===wc&&(_t*=Kr,At*=Kr,Hn*=Kr),ye.set(_t,At,Hn,Kr),!1===Ue.equals(ye)&&(e.clearColor(_t,At,Hn,Kr),Ue.copy(ye))},reset:function(){re=!1,ke=null,Ue.set(-1,0,0,0)}}},l=new function o(){let re=!1,ye=null,ke=null,Ue=null;return{setTest:function(_t){_t?ce(2929):te(2929)},setMask:function(_t){ye!==_t&&!re&&(e.depthMask(_t),ye=_t)},setFunc:function(_t){if(ke!==_t){switch(_t){case p1e:e.depthFunc(512);break;case f1e:e.depthFunc(519);break;case m1e:e.depthFunc(513);break;case Rb:e.depthFunc(515);break;case g1e:e.depthFunc(514);break;case v1e:e.depthFunc(518);break;case y1e:e.depthFunc(516);break;case _1e:e.depthFunc(517);break;default:e.depthFunc(515)}ke=_t}},setLocked:function(_t){re=_t},setClear:function(_t){Ue!==_t&&(e.clearDepth(_t),Ue=_t)},reset:function(){re=!1,ye=null,ke=null,Ue=null}}},c=new function s(){let re=!1,ye=null,ke=null,Ue=null,_t=null,At=null,Hn=null,Kr=null,wc=null;return{setTest:function(In){re||(In?ce(2960):te(2960))},setMask:function(In){ye!==In&&!re&&(e.stencilMask(In),ye=In)},setFunc:function(In,ha,Cs){(ke!==In||Ue!==ha||_t!==Cs)&&(e.stencilFunc(In,ha,Cs),ke=In,Ue=ha,_t=Cs)},setOp:function(In,ha,Cs){(At!==In||Hn!==ha||Kr!==Cs)&&(e.stencilOp(In,ha,Cs),At=In,Hn=ha,Kr=Cs)},setLocked:function(In){re=In},setClear:function(In){wc!==In&&(e.clearStencil(In),wc=In)},reset:function(){re=!1,ye=null,ke=null,Ue=null,_t=null,At=null,Hn=null,Kr=null,wc=null}}},h=new WeakMap,u=new WeakMap,d={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,_=null,b=null,x=null,w=null,S=null,C=null,M=!1,z=null,E=null,D=null,P=null,I=null,B=e.getParameter(35661),V=!1,R=0,N=e.getParameter(7938);-1!==N.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(N)[1]),V=R>=1):-1!==N.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),V=R>=2);let W=null,Q={},G=e.getParameter(3088),Y=e.getParameter(2978),J=(new Ut).fromArray(G),q=(new Ut).fromArray(Y);function ee(re,ye,ke){let Ue=new Uint8Array(4),_t=e.createTexture();e.bindTexture(re,_t),e.texParameteri(re,10241,9728),e.texParameteri(re,10240,9728);for(let At=0;At<ke;At++)e.texImage2D(ye+At,0,6408,1,1,0,6408,5121,Ue);return _t}let Z={};function ce(re){!0!==d[re]&&(e.enable(re),d[re]=!0)}function te(re){!1!==d[re]&&(e.disable(re),d[re]=!1)}Z[3553]=ee(3553,3553,1),Z[34067]=ee(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ce(2929),l.setFunc(Rb),Ze(!1),rt(tR),ce(2884),Xe(Mr);let _e={[Vp]:32774,[i1e]:32778,[n1e]:32779};if(n)_e[oR]=32775,_e[sR]=32776;else{let re=t.get("EXT_blend_minmax");null!==re&&(_e[oR]=re.MIN_EXT,_e[sR]=re.MAX_EXT)}let ge={[r1e]:0,[o1e]:1,[s1e]:768,[aR]:770,[d1e]:776,[h1e]:774,[l1e]:772,[a1e]:769,[lR]:771,[u1e]:775,[c1e]:773};function Xe(re,ye,ke,Ue,_t,At,Hn,Kr){if(re!==Mr){if(!1===v&&(ce(3042),v=!0),re===t1e)_t=_t||ye,At=At||ke,Hn=Hn||Ue,(ye!==_||_t!==w)&&(e.blendEquationSeparate(_e[ye],_e[_t]),_=ye,w=_t),(ke!==b||Ue!==x||At!==S||Hn!==C)&&(e.blendFuncSeparate(ge[ke],ge[Ue],ge[At],ge[Hn]),b=ke,x=Ue,S=At,C=Hn),y=re,M=!1;else if(re!==y||Kr!==M){if((_!==Vp||w!==Vp)&&(e.blendEquation(32774),_=Vp,w=Vp),Kr)switch(re){case zd:e.blendFuncSeparate(1,771,1,771);break;case iR:e.blendFunc(1,1);break;case nR:e.blendFuncSeparate(0,769,0,1);break;case rR:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",re)}else switch(re){case zd:e.blendFuncSeparate(770,771,1,771);break;case iR:e.blendFunc(770,1);break;case nR:e.blendFuncSeparate(0,769,0,1);break;case rR:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",re)}b=null,x=null,S=null,C=null,y=re,M=Kr}}else!0===v&&(te(3042),v=!1)}function Ze(re){z!==re&&(e.frontFace(re?2304:2305),z=re)}function rt(re){re!==Kde?(ce(2884),re!==E&&e.cullFace(re===tR?1029:re===Jde?1028:1032)):te(2884),E=re}function Le(re,ye,ke){re?(ce(32823),(P!==ye||I!==ke)&&(e.polygonOffset(ye,ke),P=ye,I=ke)):te(32823)}return{buffers:{color:a,depth:l,stencil:c},enable:ce,disable:te,bindFramebuffer:function pe(re,ye){return p[re]!==ye&&(e.bindFramebuffer(re,ye),p[re]=ye,n&&(36009===re&&(p[36160]=ye),36160===re&&(p[36009]=ye)),!0)},drawBuffers:function se(re,ye){let ke=m,Ue=!1;if(re)if(ke=f.get(ye),void 0===ke&&(ke=[],f.set(ye,ke)),re.isWebGLMultipleRenderTargets){let _t=re.texture;if(ke.length!==_t.length||36064!==ke[0]){for(let At=0,Hn=_t.length;At<Hn;At++)ke[At]=36064+At;ke.length=_t.length,Ue=!0}}else 36064!==ke[0]&&(ke[0]=36064,Ue=!0);else 1029!==ke[0]&&(ke[0]=1029,Ue=!0);Ue&&(i.isWebGL2?e.drawBuffers(ke):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ke))},useProgram:function ze(re){return g!==re&&(e.useProgram(re),g=re,!0)},setBlending:Xe,setMaterial:function $e(re,ye){re.side===As?te(2884):ce(2884);let ke=re.side===io;ye&&(ke=!ke),Ze(ke),re.blending===zd&&!1===re.transparent?Xe(Mr):Xe(re.blending,re.blendEquation,re.blendSrc,re.blendDst,re.blendEquationAlpha,re.blendSrcAlpha,re.blendDstAlpha,re.premultipliedAlpha),l.setFunc(re.depthFunc),l.setTest(re.depthTest),l.setMask(re.depthWrite),a.setMask(re.colorWrite);let Ue=re.stencilWrite;c.setTest(Ue),Ue&&(c.setMask(re.stencilWriteMask),c.setFunc(re.stencilFunc,re.stencilRef,re.stencilFuncMask),c.setOp(re.stencilFail,re.stencilZFail,re.stencilZPass)),Le(re.polygonOffset,re.polygonOffsetFactor,re.polygonOffsetUnits),!0===re.alphaToCoverage?ce(32926):te(32926)},setFlipSided:Ze,setCullFace:rt,setLineWidth:function Ve(re){re!==D&&(V&&e.lineWidth(re),D=re)},setPolygonOffset:Le,setScissorTest:function vt(re){re?ce(3089):te(3089)},activeTexture:function Ft(re){void 0===re&&(re=33984+B-1),W!==re&&(e.activeTexture(re),W=re)},bindTexture:function j(re,ye,ke){void 0===ke&&(ke=null===W?33984+B-1:W);let Ue=Q[ke];void 0===Ue&&(Ue={type:void 0,texture:void 0},Q[ke]=Ue),(Ue.type!==re||Ue.texture!==ye)&&(W!==ke&&(e.activeTexture(ke),W=ke),e.bindTexture(re,ye||Z[re]),Ue.type=re,Ue.texture=ye)},unbindTexture:function F(){let re=Q[W];void 0!==re&&void 0!==re.type&&(e.bindTexture(re.type,null),re.type=void 0,re.texture=void 0)},compressedTexImage2D:function ue(){try{e.compressedTexImage2D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},compressedTexImage3D:function Ie(){try{e.compressedTexImage3D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},texImage2D:function ct(){try{e.texImage2D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},texImage3D:function st(){try{e.texImage3D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},updateUBOMapping:function Ii(re,ye){let ke=u.get(ye);void 0===ke&&(ke=new WeakMap,u.set(ye,ke));let Ue=ke.get(re);void 0===Ue&&(Ue=e.getUniformBlockIndex(ye,re.name),ke.set(re,Ue))},uniformBlockBinding:function pn(re,ye){let ke=u.get(ye).get(re);h.get(ye)!==ke&&(e.uniformBlockBinding(ye,ke,re.__bindingPointIndex),h.set(ye,ke))},texStorage2D:function Me(){try{e.texStorage2D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},texStorage3D:function Be(){try{e.texStorage3D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},texSubImage2D:function O(){try{e.texSubImage2D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},texSubImage3D:function be(){try{e.texSubImage3D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},compressedTexSubImage2D:function lt(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},compressedTexSubImage3D:function We(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(re){console.error("THREE.WebGLState:",re)}},scissor:function Lt(re){!1===J.equals(re)&&(e.scissor(re.x,re.y,re.z,re.w),J.copy(re))},viewport:function St(re){!1===q.equals(re)&&(e.viewport(re.x,re.y,re.z,re.w),q.copy(re))},reset:function Ei(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},W=null,Q={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,_=null,b=null,x=null,w=null,S=null,C=null,M=!1,z=null,E=null,D=null,P=null,I=null,J.set(0,0,e.canvas.width,e.canvas.height),q.set(0,0,e.canvas.width,e.canvas.height),a.reset(),l.reset(),c.reset()}}}function X2e(e,t,i,n,r,o,s){let m,a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(j,F){return v?new OffscreenCanvas(j,F):h2("canvas")}function _(j,F,ue,Ie){let O=1;if((j.width>Ie||j.height>Ie)&&(O=Ie/Math.max(j.width,j.height)),O<1||!0===F){if(typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&j instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&j instanceof ImageBitmap){let be=F?zv:Math.floor,lt=be(O*j.width),We=be(O*j.height);void 0===m&&(m=y(lt,We));let Me=ue?y(lt,We):m;return Me.width=lt,Me.height=We,Me.getContext("2d").drawImage(j,0,0,lt,We),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+j.width+"x"+j.height+") to ("+lt+"x"+We+")."),Me}return"data"in j&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+j.width+"x"+j.height+")."),j}return j}function b(j){return ex(j.width)&&ex(j.height)}function w(j,F){return j.generateMipmaps&&F&&j.minFilter!==Gi&&j.minFilter!==ri}function S(j){e.generateMipmap(j)}function C(j,F,ue,Ie,O=!1){if(!1===a)return F;if(null!==j){if(void 0!==e[j])return e[j];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+j+"'")}let be=F;return 6403===F&&(5126===ue&&(be=33326),5131===ue&&(be=33325),5121===ue&&(be=33321)),33319===F&&(5126===ue&&(be=33328),5131===ue&&(be=33327),5121===ue&&(be=33323)),6408===F&&(5126===ue&&(be=34836),5131===ue&&(be=34842),5121===ue&&(be=Ie===Zt&&!1===O?35907:32856),32819===ue&&(be=32854),32820===ue&&(be=32855)),(33325===be||33326===be||33327===be||33328===be||34842===be||34836===be)&&t.get("EXT_color_buffer_float"),be}function M(j,F,ue){return!0===w(j,ue)||j.isFramebufferTexture&&j.minFilter!==Gi&&j.minFilter!==ri?Math.log2(Math.max(F.width,F.height))+1:void 0!==j.mipmaps&&j.mipmaps.length>0?j.mipmaps.length:j.isCompressedTexture&&Array.isArray(j.image)?F.mipmaps.length:1}function z(j){return j===Gi||j===uR||j===Hb?9728:9729}function E(j){let F=j.target;F.removeEventListener("dispose",E),function P(j){let F=n.get(j);if(void 0===F.__webglInit)return;let ue=j.source,Ie=g.get(ue);if(Ie){let O=Ie[F.__cacheKey];O.usedTimes--,0===O.usedTimes&&I(j),0===Object.keys(Ie).length&&g.delete(ue)}n.remove(j)}(F),F.isVideoTexture&&f.delete(F)}function D(j){let F=j.target;F.removeEventListener("dispose",D),function B(j){let F=j.texture,ue=n.get(j),Ie=n.get(F);if(void 0!==Ie.__webglTexture&&(e.deleteTexture(Ie.__webglTexture),s.memory.textures--),j.depthTexture&&j.depthTexture.dispose(),j.isWebGLCubeRenderTarget)for(let O=0;O<6;O++)e.deleteFramebuffer(ue.__webglFramebuffer[O]),ue.__webglDepthbuffer&&e.deleteRenderbuffer(ue.__webglDepthbuffer[O]);else{if(e.deleteFramebuffer(ue.__webglFramebuffer),ue.__webglDepthbuffer&&e.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&e.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer)for(let O=0;O<ue.__webglColorRenderbuffer.length;O++)ue.__webglColorRenderbuffer[O]&&e.deleteRenderbuffer(ue.__webglColorRenderbuffer[O]);ue.__webglDepthRenderbuffer&&e.deleteRenderbuffer(ue.__webglDepthRenderbuffer)}if(j.isWebGLMultipleRenderTargets)for(let O=0,be=F.length;O<be;O++){let lt=n.get(F[O]);lt.__webglTexture&&(e.deleteTexture(lt.__webglTexture),s.memory.textures--),n.remove(F[O])}n.remove(F),n.remove(j)}(F)}function I(j){let F=n.get(j);e.deleteTexture(F.__webglTexture),delete g.get(j.source)[F.__cacheKey],s.memory.textures--}let V=0;function Q(j,F){let ue=n.get(j);if(j.isVideoTexture&&function vt(j){let F=s.render.frame;f.get(j)!==F&&(f.set(j,F),j.update())}(j),!1===j.isRenderTargetTexture&&j.version>0&&ue.__version!==j.version){let Ie=j.image;if(null===Ie)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==Ie.complete)return void te(ue,j,F);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,ue.__webglTexture,33984+F)}let q={[Zc]:10497,[Rn]:33071,[Vb]:33648},ee={[Gi]:9728,[uR]:9984,[Hb]:9986,[ri]:9729,[T1e]:9985,[Hp]:9987};function Z(j,F,ue){if(ue?(e.texParameteri(j,10242,q[F.wrapS]),e.texParameteri(j,10243,q[F.wrapT]),(32879===j||35866===j)&&e.texParameteri(j,32882,q[F.wrapR]),e.texParameteri(j,10240,ee[F.magFilter]),e.texParameteri(j,10241,ee[F.minFilter])):(e.texParameteri(j,10242,33071),e.texParameteri(j,10243,33071),(32879===j||35866===j)&&e.texParameteri(j,32882,33071),(F.wrapS!==Rn||F.wrapT!==Rn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(j,10240,z(F.magFilter)),e.texParameteri(j,10241,z(F.minFilter)),F.minFilter!==Gi&&F.minFilter!==ri&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let Ie=t.get("EXT_texture_filter_anisotropic");if(F.magFilter===Gi||F.minFilter!==Hb&&F.minFilter!==Hp||F.type===zr&&!1===t.has("OES_texture_float_linear")||!1===a&&F.type===Dd&&!1===t.has("OES_texture_half_float_linear"))return;(F.anisotropy>1||n.get(F).__currentAnisotropy)&&(e.texParameterf(j,Ie.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,r.getMaxAnisotropy())),n.get(F).__currentAnisotropy=F.anisotropy)}}function ce(j,F){let ue=!1;void 0===j.__webglInit&&(j.__webglInit=!0,F.addEventListener("dispose",E));let Ie=F.source,O=g.get(Ie);void 0===O&&(O={},g.set(Ie,O));let be=function W(j){let F=[];return F.push(j.wrapS),F.push(j.wrapT),F.push(j.wrapR||0),F.push(j.magFilter),F.push(j.minFilter),F.push(j.anisotropy),F.push(j.internalFormat),F.push(j.format),F.push(j.type),F.push(j.generateMipmaps),F.push(j.premultiplyAlpha),F.push(j.flipY),F.push(j.unpackAlignment),F.push(j.encoding),F.join()}(F);if(be!==j.__cacheKey){void 0===O[be]&&(O[be]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,ue=!0),O[be].usedTimes++;let lt=O[j.__cacheKey];void 0!==lt&&(O[j.__cacheKey].usedTimes--,0===lt.usedTimes&&I(F)),j.__cacheKey=be,j.__webglTexture=O[be].texture}return ue}function te(j,F,ue){let Ie=3553;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ie=35866),F.isData3DTexture&&(Ie=32879);let O=ce(j,F),be=F.source;i.bindTexture(Ie,j.__webglTexture,33984+ue);let lt=n.get(be);if(be.version!==lt.__version||!0===O){i.activeTexture(33984+ue),e.pixelStorei(37440,F.flipY),e.pixelStorei(37441,F.premultiplyAlpha),e.pixelStorei(3317,F.unpackAlignment),e.pixelStorei(37443,0);let We=function x(j){return!a&&(j.wrapS!==Rn||j.wrapT!==Rn||j.minFilter!==Gi&&j.minFilter!==ri)}(F)&&!1===b(F.image),Me=_(F.image,We,!1,h);Me=Ft(F,Me);let Be=b(Me)||a,ct=o.convert(F.format,F.encoding),st=o.convert(F.type),Lt=C(F.internalFormat,ct,st,F.encoding,F.isVideoTexture);Z(Ie,F,Be);let St,Ii=F.mipmaps,pn=a&&!0!==F.isVideoTexture,Ei=void 0===lt.__version||!0===O,re=M(F,Me,Be);if(F.isDepthTexture)Lt=6402,a?Lt=F.type===zr?36012:F.type===Kc?33190:F.type===Ad?35056:33189:F.type===zr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===Pd&&6402===Lt&&F.type!==dR&&F.type!==Kc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=Kc,st=o.convert(F.type)),F.format===Id&&6402===Lt&&(Lt=34041,F.type!==Ad&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=Ad,st=o.convert(F.type))),Ei&&(pn?i.texStorage2D(3553,1,Lt,Me.width,Me.height):i.texImage2D(3553,0,Lt,Me.width,Me.height,0,ct,st,null));else if(F.isDataTexture)if(Ii.length>0&&Be){pn&&Ei&&i.texStorage2D(3553,re,Lt,Ii[0].width,Ii[0].height);for(let ye=0,ke=Ii.length;ye<ke;ye++)St=Ii[ye],pn?i.texSubImage2D(3553,ye,0,0,St.width,St.height,ct,st,St.data):i.texImage2D(3553,ye,Lt,St.width,St.height,0,ct,st,St.data);F.generateMipmaps=!1}else pn?(Ei&&i.texStorage2D(3553,re,Lt,Me.width,Me.height),i.texSubImage2D(3553,0,0,0,Me.width,Me.height,ct,st,Me.data)):i.texImage2D(3553,0,Lt,Me.width,Me.height,0,ct,st,Me.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){pn&&Ei&&i.texStorage3D(35866,re,Lt,Ii[0].width,Ii[0].height,Me.depth);for(let ye=0,ke=Ii.length;ye<ke;ye++)St=Ii[ye],F.format!==no?null!==ct?pn?i.compressedTexSubImage3D(35866,ye,0,0,0,St.width,St.height,Me.depth,ct,St.data,0,0):i.compressedTexImage3D(35866,ye,Lt,St.width,St.height,Me.depth,0,St.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pn?i.texSubImage3D(35866,ye,0,0,0,St.width,St.height,Me.depth,ct,st,St.data):i.texImage3D(35866,ye,Lt,St.width,St.height,Me.depth,0,ct,st,St.data)}else{pn&&Ei&&i.texStorage2D(3553,re,Lt,Ii[0].width,Ii[0].height);for(let ye=0,ke=Ii.length;ye<ke;ye++)St=Ii[ye],F.format!==no?null!==ct?pn?i.compressedTexSubImage2D(3553,ye,0,0,St.width,St.height,ct,St.data):i.compressedTexImage2D(3553,ye,Lt,St.width,St.height,0,St.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pn?i.texSubImage2D(3553,ye,0,0,St.width,St.height,ct,st,St.data):i.texImage2D(3553,ye,Lt,St.width,St.height,0,ct,st,St.data)}else if(F.isDataArrayTexture)pn?(Ei&&i.texStorage3D(35866,re,Lt,Me.width,Me.height,Me.depth),i.texSubImage3D(35866,0,0,0,0,Me.width,Me.height,Me.depth,ct,st,Me.data)):i.texImage3D(35866,0,Lt,Me.width,Me.height,Me.depth,0,ct,st,Me.data);else if(F.isData3DTexture)pn?(Ei&&i.texStorage3D(32879,re,Lt,Me.width,Me.height,Me.depth),i.texSubImage3D(32879,0,0,0,0,Me.width,Me.height,Me.depth,ct,st,Me.data)):i.texImage3D(32879,0,Lt,Me.width,Me.height,Me.depth,0,ct,st,Me.data);else if(F.isFramebufferTexture){if(Ei)if(pn)i.texStorage2D(3553,re,Lt,Me.width,Me.height);else{let ye=Me.width,ke=Me.height;for(let Ue=0;Ue<re;Ue++)i.texImage2D(3553,Ue,Lt,ye,ke,0,ct,st,null),ye>>=1,ke>>=1}}else if(Ii.length>0&&Be){pn&&Ei&&i.texStorage2D(3553,re,Lt,Ii[0].width,Ii[0].height);for(let ye=0,ke=Ii.length;ye<ke;ye++)St=Ii[ye],pn?i.texSubImage2D(3553,ye,0,0,ct,st,St):i.texImage2D(3553,ye,Lt,ct,st,St);F.generateMipmaps=!1}else pn?(Ei&&i.texStorage2D(3553,re,Lt,Me.width,Me.height),i.texSubImage2D(3553,0,0,0,ct,st,Me)):i.texImage2D(3553,0,Lt,ct,st,Me);w(F,Be)&&S(Ie),lt.__version=be.version,F.onUpdate&&F.onUpdate(F)}j.__version=F.version}function se(j,F,ue,Ie,O){let be=o.convert(ue.format,ue.encoding),lt=o.convert(ue.type),We=C(ue.internalFormat,be,lt,ue.encoding);n.get(F).__hasExternalTextures||(32879===O||35866===O?i.texImage3D(O,0,We,F.width,F.height,F.depth,0,be,lt,null):i.texImage2D(O,0,We,F.width,F.height,0,be,lt,null)),i.bindFramebuffer(36160,j),Le(F)?d.framebufferTexture2DMultisampleEXT(36160,Ie,O,n.get(ue).__webglTexture,0,Ve(F)):(3553===O||O>=34069&&O<=34074)&&e.framebufferTexture2D(36160,Ie,O,n.get(ue).__webglTexture,0),i.bindFramebuffer(36160,null)}function ze(j,F,ue){if(e.bindRenderbuffer(36161,j),F.depthBuffer&&!F.stencilBuffer){let Ie=33189;if(ue||Le(F)){let O=F.depthTexture;O&&O.isDepthTexture&&(O.type===zr?Ie=36012:O.type===Kc&&(Ie=33190));let be=Ve(F);Le(F)?d.renderbufferStorageMultisampleEXT(36161,be,Ie,F.width,F.height):e.renderbufferStorageMultisample(36161,be,Ie,F.width,F.height)}else e.renderbufferStorage(36161,Ie,F.width,F.height);e.framebufferRenderbuffer(36160,36096,36161,j)}else if(F.depthBuffer&&F.stencilBuffer){let Ie=Ve(F);ue&&!1===Le(F)?e.renderbufferStorageMultisample(36161,Ie,35056,F.width,F.height):Le(F)?d.renderbufferStorageMultisampleEXT(36161,Ie,35056,F.width,F.height):e.renderbufferStorage(36161,34041,F.width,F.height),e.framebufferRenderbuffer(36160,33306,36161,j)}else{let Ie=!0===F.isWebGLMultipleRenderTargets?F.texture:[F.texture];for(let O=0;O<Ie.length;O++){let be=Ie[O],lt=o.convert(be.format,be.encoding),We=o.convert(be.type),Me=C(be.internalFormat,lt,We,be.encoding),Be=Ve(F);ue&&!1===Le(F)?e.renderbufferStorageMultisample(36161,Be,Me,F.width,F.height):Le(F)?d.renderbufferStorageMultisampleEXT(36161,Be,Me,F.width,F.height):e.renderbufferStorage(36161,Me,F.width,F.height)}}e.bindRenderbuffer(36161,null)}function ge(j){let F=n.get(j),ue=!0===j.isWebGLCubeRenderTarget;if(j.depthTexture&&!F.__autoAllocateDepthBuffer){if(ue)throw new Error("target.depthTexture not supported in Cube render targets");!function _e(j,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,j),!F.depthTexture||!F.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),Q(F.depthTexture,0);let ue=n.get(F.depthTexture).__webglTexture,Ie=Ve(F);if(F.depthTexture.format===Pd)Le(F)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,ue,0,Ie):e.framebufferTexture2D(36160,36096,3553,ue,0);else{if(F.depthTexture.format!==Id)throw new Error("Unknown depthTexture format");Le(F)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,ue,0,Ie):e.framebufferTexture2D(36160,33306,3553,ue,0)}}(F.__webglFramebuffer,j)}else if(ue){F.__webglDepthbuffer=[];for(let Ie=0;Ie<6;Ie++)i.bindFramebuffer(36160,F.__webglFramebuffer[Ie]),F.__webglDepthbuffer[Ie]=e.createRenderbuffer(),ze(F.__webglDepthbuffer[Ie],j,!1)}else i.bindFramebuffer(36160,F.__webglFramebuffer),F.__webglDepthbuffer=e.createRenderbuffer(),ze(F.__webglDepthbuffer,j,!1);i.bindFramebuffer(36160,null)}function Ve(j){return Math.min(u,j.samples)}function Le(j){let F=n.get(j);return a&&j.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==F.__useRenderToTexture}function Ft(j,F){let ue=j.encoding,Ie=j.format,O=j.type;return!0===j.isCompressedTexture||!0===j.isVideoTexture||j.format===Kb||ue!==el&&(ue===Zt?!1===a?!0===t.has("EXT_sRGB")&&Ie===no?(j.format=Kb,j.minFilter=ri,j.generateMipmaps=!1):F=GR.sRGBToLinear(F):(Ie!==no||O!==Uo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ue)),F}this.allocateTextureUnit=function N(){let j=V;return j>=l&&console.warn("THREE.WebGLTextures: Trying to use "+j+" texture units while this GPU supports only "+l),V+=1,j},this.resetTextureUnits=function R(){V=0},this.setTexture2D=Q,this.setTexture2DArray=function G(j,F){let ue=n.get(j);j.version>0&&ue.__version!==j.version?te(ue,j,F):i.bindTexture(35866,ue.__webglTexture,33984+F)},this.setTexture3D=function Y(j,F){let ue=n.get(j);j.version>0&&ue.__version!==j.version?te(ue,j,F):i.bindTexture(32879,ue.__webglTexture,33984+F)},this.setTextureCube=function J(j,F){let ue=n.get(j);j.version>0&&ue.__version!==j.version?function pe(j,F,ue){if(6!==F.image.length)return;let Ie=ce(j,F),O=F.source;i.bindTexture(34067,j.__webglTexture,33984+ue);let be=n.get(O);if(O.version!==be.__version||!0===Ie){i.activeTexture(33984+ue),e.pixelStorei(37440,F.flipY),e.pixelStorei(37441,F.premultiplyAlpha),e.pixelStorei(3317,F.unpackAlignment),e.pixelStorei(37443,0);let lt=F.isCompressedTexture||F.image[0].isCompressedTexture,We=F.image[0]&&F.image[0].isDataTexture,Me=[];for(let ye=0;ye<6;ye++)Me[ye]=lt||We?We?F.image[ye].image:F.image[ye]:_(F.image[ye],!1,!0,c),Me[ye]=Ft(F,Me[ye]);let re,Be=Me[0],ct=b(Be)||a,st=o.convert(F.format,F.encoding),Lt=o.convert(F.type),St=C(F.internalFormat,st,Lt,F.encoding),Ii=a&&!0!==F.isVideoTexture,pn=void 0===be.__version||!0===Ie,Ei=M(F,Be,ct);if(Z(34067,F,ct),lt){Ii&&pn&&i.texStorage2D(34067,Ei,St,Be.width,Be.height);for(let ye=0;ye<6;ye++){re=Me[ye].mipmaps;for(let ke=0;ke<re.length;ke++){let Ue=re[ke];F.format!==no?null!==st?Ii?i.compressedTexSubImage2D(34069+ye,ke,0,0,Ue.width,Ue.height,st,Ue.data):i.compressedTexImage2D(34069+ye,ke,St,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ii?i.texSubImage2D(34069+ye,ke,0,0,Ue.width,Ue.height,st,Lt,Ue.data):i.texImage2D(34069+ye,ke,St,Ue.width,Ue.height,0,st,Lt,Ue.data)}}}else{re=F.mipmaps,Ii&&pn&&(re.length>0&&Ei++,i.texStorage2D(34067,Ei,St,Me[0].width,Me[0].height));for(let ye=0;ye<6;ye++)if(We){Ii?i.texSubImage2D(34069+ye,0,0,0,Me[ye].width,Me[ye].height,st,Lt,Me[ye].data):i.texImage2D(34069+ye,0,St,Me[ye].width,Me[ye].height,0,st,Lt,Me[ye].data);for(let ke=0;ke<re.length;ke++){let Ue=re[ke].image[ye].image;Ii?i.texSubImage2D(34069+ye,ke+1,0,0,Ue.width,Ue.height,st,Lt,Ue.data):i.texImage2D(34069+ye,ke+1,St,Ue.width,Ue.height,0,st,Lt,Ue.data)}}else{Ii?i.texSubImage2D(34069+ye,0,0,0,st,Lt,Me[ye]):i.texImage2D(34069+ye,0,St,st,Lt,Me[ye]);for(let ke=0;ke<re.length;ke++){let Ue=re[ke];Ii?i.texSubImage2D(34069+ye,ke+1,0,0,st,Lt,Ue.image[ye]):i.texImage2D(34069+ye,ke+1,St,st,Lt,Ue.image[ye])}}}w(F,ct)&&S(34067),be.__version=O.version,F.onUpdate&&F.onUpdate(F)}j.__version=F.version}(ue,j,F):i.bindTexture(34067,ue.__webglTexture,33984+F)},this.rebindTextures=function Xe(j,F,ue){let Ie=n.get(j);void 0!==F&&se(Ie.__webglFramebuffer,j,j.texture,36064,3553),void 0!==ue&&ge(j)},this.setupRenderTarget=function $e(j){let F=j.texture,ue=n.get(j),Ie=n.get(F);j.addEventListener("dispose",D),!0!==j.isWebGLMultipleRenderTargets&&(void 0===Ie.__webglTexture&&(Ie.__webglTexture=e.createTexture()),Ie.__version=F.version,s.memory.textures++);let O=!0===j.isWebGLCubeRenderTarget,be=!0===j.isWebGLMultipleRenderTargets,lt=b(j)||a;if(O){ue.__webglFramebuffer=[];for(let We=0;We<6;We++)ue.__webglFramebuffer[We]=e.createFramebuffer()}else{if(ue.__webglFramebuffer=e.createFramebuffer(),be)if(r.drawBuffers){let We=j.texture;for(let Me=0,Be=We.length;Me<Be;Me++){let ct=n.get(We[Me]);void 0===ct.__webglTexture&&(ct.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&j.samples>0&&!1===Le(j)){let We=be?F:[F];ue.__webglMultisampledFramebuffer=e.createFramebuffer(),ue.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,ue.__webglMultisampledFramebuffer);for(let Me=0;Me<We.length;Me++){let Be=We[Me];ue.__webglColorRenderbuffer[Me]=e.createRenderbuffer(),e.bindRenderbuffer(36161,ue.__webglColorRenderbuffer[Me]);let ct=o.convert(Be.format,Be.encoding),st=o.convert(Be.type),Lt=C(Be.internalFormat,ct,st,Be.encoding,!0===j.isXRRenderTarget),St=Ve(j);e.renderbufferStorageMultisample(36161,St,Lt,j.width,j.height),e.framebufferRenderbuffer(36160,36064+Me,36161,ue.__webglColorRenderbuffer[Me])}e.bindRenderbuffer(36161,null),j.depthBuffer&&(ue.__webglDepthRenderbuffer=e.createRenderbuffer(),ze(ue.__webglDepthRenderbuffer,j,!0)),i.bindFramebuffer(36160,null)}}if(O){i.bindTexture(34067,Ie.__webglTexture),Z(34067,F,lt);for(let We=0;We<6;We++)se(ue.__webglFramebuffer[We],j,F,36064,34069+We);w(F,lt)&&S(34067),i.unbindTexture()}else if(be){let We=j.texture;for(let Me=0,Be=We.length;Me<Be;Me++){let ct=We[Me],st=n.get(ct);i.bindTexture(3553,st.__webglTexture),Z(3553,ct,lt),se(ue.__webglFramebuffer,j,ct,36064+Me,3553),w(ct,lt)&&S(3553)}i.unbindTexture()}else{let We=3553;(j.isWebGL3DRenderTarget||j.isWebGLArrayRenderTarget)&&(a?We=j.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(We,Ie.__webglTexture),Z(We,F,lt),se(ue.__webglFramebuffer,j,F,36064,We),w(F,lt)&&S(We),i.unbindTexture()}j.depthBuffer&&ge(j)},this.updateRenderTargetMipmap=function Ze(j){let F=b(j)||a,ue=!0===j.isWebGLMultipleRenderTargets?j.texture:[j.texture];for(let Ie=0,O=ue.length;Ie<O;Ie++){let be=ue[Ie];if(w(be,F)){let lt=j.isWebGLCubeRenderTarget?34067:3553,We=n.get(be).__webglTexture;i.bindTexture(lt,We),S(lt),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function rt(j){if(a&&j.samples>0&&!1===Le(j)){let F=j.isWebGLMultipleRenderTargets?j.texture:[j.texture],ue=j.width,Ie=j.height,O=16384,be=[],lt=j.stencilBuffer?33306:36096,We=n.get(j),Me=!0===j.isWebGLMultipleRenderTargets;if(Me)for(let Be=0;Be<F.length;Be++)i.bindFramebuffer(36160,We.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Be,36161,null),i.bindFramebuffer(36160,We.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Be,3553,null,0);i.bindFramebuffer(36008,We.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,We.__webglFramebuffer);for(let Be=0;Be<F.length;Be++){be.push(36064+Be),j.depthBuffer&&be.push(lt);let ct=void 0!==We.__ignoreDepthValues&&We.__ignoreDepthValues;if(!1===ct&&(j.depthBuffer&&(O|=256),j.stencilBuffer&&(O|=1024)),Me&&e.framebufferRenderbuffer(36008,36064,36161,We.__webglColorRenderbuffer[Be]),!0===ct&&(e.invalidateFramebuffer(36008,[lt]),e.invalidateFramebuffer(36009,[lt])),Me){let st=n.get(F[Be]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,st,0)}e.blitFramebuffer(0,0,ue,Ie,0,0,ue,Ie,O,9728),p&&e.invalidateFramebuffer(36008,be)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Me)for(let Be=0;Be<F.length;Be++){i.bindFramebuffer(36160,We.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Be,36161,We.__webglColorRenderbuffer[Be]);let ct=n.get(F[Be]).__webglTexture;i.bindFramebuffer(36160,We.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Be,3553,ct,0)}i.bindFramebuffer(36009,We.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ge,this.setupFrameBufferTexture=se,this.useMultisampledRTT=Le}function $2e(e,t,i){let n=i.isWebGL2;return{convert:function r(o,s=null){let a;if(o===Uo)return 5121;if(o===P1e)return 32819;if(o===I1e)return 32820;if(o===E1e)return 5120;if(o===D1e)return 5122;if(o===dR)return 5123;if(o===A1e)return 5124;if(o===Kc)return 5125;if(o===zr)return 5126;if(o===Dd)return n?5131:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(o===O1e)return 6406;if(o===no)return 6408;if(o===k1e)return 6409;if(o===N1e)return 6410;if(o===Pd)return 6402;if(o===Id)return 34041;if(o===Kb)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(o===L1e)return 6403;if(o===R1e)return 36244;if(o===xv)return 33319;if(o===F1e)return 33320;if(o===pR)return 36249;if(o===Ub||o===jb||o===Yb||o===Gb)if(s===Zt){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(o===Ub)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===jb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===Yb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===Gb)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(o===Ub)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===jb)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===Yb)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===Gb)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(o===fR||o===mR||o===gR||o===vR){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(o===fR)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===mR)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===gR)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===vR)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(o===B1e)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===yR||o===_R){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(o===yR)return s===Zt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(o===_R)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(o===bR||o===xR||o===wR||o===CR||o===SR||o===MR||o===zR||o===TR||o===ER||o===DR||o===AR||o===PR||o===IR||o===OR){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(o===bR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===xR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===wR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===CR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===SR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===MR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===zR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===TR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===ER)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===DR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===AR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===PR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===IR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===OR)return s===Zt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(o===Wb){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(o===Wb)return s===Zt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(o===V1e||o===kR||o===NR||o===LR){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(o===Wb)return a.COMPRESSED_RED_RGTC1_EXT;if(o===kR)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===NR)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===LR)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return o===Ad?n?34042:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[o]?e[o]:null}}}var Q2e=class extends Yo{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Ud=class extends en{constructor(){super(),this.isGroup=!0,this.type="Group"}},Z2e={type:"move"},Ax=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ud,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ud,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ud,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,o=null,s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(let f of e.hand.values()){let m=t.getJointPose(f,i),g=this._getHandJoint(l,f);null!==m&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=null!==m}let u=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),d=.02,p=.005;l.inputState.pinching&&u>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Z2e)))}return null!==s&&(s.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new Ud;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},df=class extends Zn{constructor(e,t,i,n,r,o,s,a,l,c){if((c=void 0!==c?c:Pd)!==Pd&&c!==Id)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Pd&&(i=Kc),void 0===i&&c===Id&&(i=Ad),super(null,n,r,o,s,a,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:Gi,this.minFilter=void 0!==a?a:Gi,this.flipY=!1,this.generateMipmaps=!1}},K2e=class extends wo{constructor(e,t){super();let i=this,n=null,r=1,o=null,s="local-floor",a=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],_=new Set,b=new Map,x=new Yo;x.layers.enable(1),x.viewport=new Ut;let w=new Yo;w.layers.enable(2),w.viewport=new Ut;let S=[x,w],C=new Q2e;C.layers.enable(1),C.layers.enable(2);let M=null,z=null;function E(G){let Y=y.indexOf(G.inputSource);if(-1===Y)return;let J=v[Y];void 0!==J&&J.dispatchEvent({type:G.type,data:G.inputSource})}function D(){n.removeEventListener("select",E),n.removeEventListener("selectstart",E),n.removeEventListener("selectend",E),n.removeEventListener("squeeze",E),n.removeEventListener("squeezestart",E),n.removeEventListener("squeezeend",E),n.removeEventListener("end",D),n.removeEventListener("inputsourceschange",P);for(let G=0;G<v.length;G++){let Y=y[G];null!==Y&&(y[G]=null,v[G].disconnect(Y))}M=null,z=null,e.setRenderTarget(m),d=null,u=null,h=null,n=null,g=null,Q.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function P(G){for(let Y=0;Y<G.removed.length;Y++){let J=G.removed[Y],q=y.indexOf(J);q>=0&&(y[q]=null,v[q].disconnect(J))}for(let Y=0;Y<G.added.length;Y++){let J=G.added[Y],q=y.indexOf(J);if(-1===q){for(let Z=0;Z<v.length;Z++){if(Z>=y.length){y.push(J),q=Z;break}if(null===y[Z]){y[Z]=J,q=Z;break}}if(-1===q)break}let ee=v[q];ee&&ee.connect(J)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let Y=v[G];return void 0===Y&&(Y=new Ax,v[G]=Y),Y.getTargetRaySpace()},this.getControllerGrip=function(G){let Y=v[G];return void 0===Y&&(Y=new Ax,v[G]=Y),Y.getGripSpace()},this.getHand=function(G){let Y=v[G];return void 0===Y&&(Y=new Ax,v[G]=Y),Y.getHandSpace()},this.setFramebufferScaleFactor=function(G){r=G,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){s=G,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(G){l=G},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=function(){var G=(0,Dn.Z)(function*(Y){if(n=Y,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",E),n.addEventListener("selectstart",E),n.addEventListener("selectend",E),n.addEventListener("squeeze",E),n.addEventListener("squeezestart",E),n.addEventListener("squeezeend",E),n.addEventListener("end",D),n.addEventListener("inputsourceschange",P),!0!==f.xrCompatible&&(yield t.makeXRCompatible()),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2)d=new XRWebGLLayer(n,t,{antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r}),n.updateRenderState({baseLayer:d}),g=new Wi(d.framebufferWidth,d.framebufferHeight,{format:no,type:Uo,encoding:e.outputEncoding,stencilBuffer:f.stencil});else{let J=null,q=null,ee=null;f.depth&&(ee=f.stencil?35056:33190,J=f.stencil?Id:Pd,q=f.stencil?Ad:Kc);let Z={colorFormat:32856,depthFormat:ee,scaleFactor:r};h=new XRWebGLBinding(n,t),u=h.createProjectionLayer(Z),n.updateRenderState({layers:[u]}),g=new Wi(u.textureWidth,u.textureHeight,{format:no,type:Uo,depthTexture:new df(u.textureWidth,u.textureHeight,q,void 0,void 0,void 0,void 0,void 0,void 0,J),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,o=yield n.requestReferenceSpace(s),Q.setContext(n),Q.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Y){return G.apply(this,arguments)}}();let I=new T,B=new T;function R(G,Y){null===Y?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(Y.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}this.updateCamera=function(G){if(null===n)return;C.near=w.near=x.near=G.near,C.far=w.far=x.far=G.far,(M!==C.near||z!==C.far)&&(n.updateRenderState({depthNear:C.near,depthFar:C.far}),M=C.near,z=C.far);let Y=G.parent,J=C.cameras;R(C,Y);for(let ee=0;ee<J.length;ee++)R(J[ee],Y);C.matrixWorld.decompose(C.position,C.quaternion,C.scale),G.matrix.copy(C.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale);let q=G.children;for(let ee=0,Z=q.length;ee<Z;ee++)q[ee].updateMatrixWorld(!0);2===J.length?function V(G,Y,J){I.setFromMatrixPosition(Y.matrixWorld),B.setFromMatrixPosition(J.matrixWorld);let q=I.distanceTo(B),ee=Y.projectionMatrix.elements,Z=J.projectionMatrix.elements,ce=ee[14]/(ee[10]-1),te=ee[14]/(ee[10]+1),pe=(ee[9]+1)/ee[5],se=(ee[9]-1)/ee[5],ze=(ee[8]-1)/ee[0],_e=(Z[8]+1)/Z[0],ge=ce*ze,Xe=ce*_e,$e=q/(-ze+_e),Ze=$e*-ze;Y.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(Ze),G.translateZ($e),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();let rt=ce+$e,Ve=te+$e;G.projectionMatrix.makePerspective(ge-Ze,Xe+(q-Ze),pe*te/Ve*rt,se*te/Ve*rt,rt,Ve)}(C,x,w):C.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return C},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(G){a=G,null!==u&&(u.fixedFoveation=G),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=G)},this.getPlanes=function(){return _};let N=null,Q=new sF;Q.setAnimationLoop(function W(G,Y){if(c=Y.getViewerPose(l||o),p=Y,null!==c){let J=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let q=!1;J.length!==C.cameras.length&&(C.cameras.length=0,q=!0);for(let ee=0;ee<J.length;ee++){let Z=J[ee],ce=null;if(null!==d)ce=d.getViewport(Z);else{let pe=h.getViewSubImage(u,Z);ce=pe.viewport,0===ee&&(e.setRenderTargetTextures(g,pe.colorTexture,u.ignoreDepthValues?void 0:pe.depthStencilTexture),e.setRenderTarget(g))}let te=S[ee];void 0===te&&(te=new Yo,te.layers.enable(ee),te.viewport=new Ut,S[ee]=te),te.matrix.fromArray(Z.transform.matrix),te.projectionMatrix.fromArray(Z.projectionMatrix),te.viewport.set(ce.x,ce.y,ce.width,ce.height),0===ee&&C.matrix.copy(te.matrix),!0===q&&C.cameras.push(te)}}for(let J=0;J<v.length;J++){let q=y[J],ee=v[J];null!==q&&void 0!==ee&&ee.update(q,Y,l||o)}if(N&&N(G,Y),Y.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Y.detectedPlanes});let J=null;for(let q of _)Y.detectedPlanes.has(q)||(null===J&&(J=[]),J.push(q));if(null!==J)for(let q of J)_.delete(q),b.delete(q),i.dispatchEvent({type:"planeremoved",data:q});for(let q of Y.detectedPlanes)if(_.has(q)){let ee=b.get(q);q.lastChangedTime>ee&&(b.set(q,q.lastChangedTime),i.dispatchEvent({type:"planechanged",data:q}))}else _.add(q),b.set(q,Y.lastChangedTime),i.dispatchEvent({type:"planeadded",data:q})}p=null}),this.setAnimationLoop=function(G){N=G},this.dispose=function(){}}};function J2e(e,t){function r(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===io&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===io&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let y,_,v=t.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let b=!0!==e.physicallyCorrectLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity),g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix)),g.aoMap?_=g.aoMap:g.lightMap&&(_=g.lightMap),void 0!==_&&(_.isWebGLRenderTarget&&(_=_.texture),!0===_.matrixAutoUpdate&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}return{refreshFogUniforms:function i(m,g){g.color.getRGB(m.fogColor.value,oF(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function n(m,g,v,y,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?r(m,g):g.isMeshToonMaterial?(r(m,g),function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(r(m,g),function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(r(m,g),function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===io&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}(m,g,_)):g.isMeshMatcapMaterial?(r(m,g),function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?r(m,g):g.isMeshDistanceMaterial?(r(m,g),function f(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}(m,g)):g.isMeshNormalMaterial?r(m,g):g.isLineBasicMaterial?(function o(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}(m,g),g.isLineDashedMaterial&&function s(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function a(m,g,v,y){let _;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=.5*y,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),void 0!==_&&(!0===_.matrixAutoUpdate&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}(m,g,v,y):g.isSpriteMaterial?function l(m,g){let v;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),void 0!==v&&(!0===v.matrixAutoUpdate&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function e4e(e,t,i,n){let r={},o={},s=[],a=i.isWebGL2?e.getParameter(35375):0;function p(y,_,b){let x=y.value;if(void 0===b[_]){if("number"==typeof x)b[_]=x;else{let w=Array.isArray(x)?x:[x],S=[];for(let C=0;C<w.length;C++)S.push(w[C].clone());b[_]=S}return!0}if("number"==typeof x){if(b[_]!==x)return b[_]=x,!0}else{let w=Array.isArray(b[_])?b[_]:[b[_]],S=Array.isArray(x)?x:[x];for(let C=0;C<w.length;C++){let M=w[C];if(!1===M.equals(S[C]))return M.copy(S[C]),!0}}return!1}function m(y){let _={boundary:0,storage:0};return"number"==typeof y?(_.boundary=4,_.storage=4):y.isVector2?(_.boundary=8,_.storage=8):y.isVector3||y.isColor?(_.boundary=16,_.storage=12):y.isVector4?(_.boundary=16,_.storage=16):y.isMatrix3?(_.boundary=48,_.storage=48):y.isMatrix4?(_.boundary=64,_.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),_}function g(y){let _=y.target;_.removeEventListener("dispose",g);let b=s.indexOf(_.__bindingPointIndex);s.splice(b,1),e.deleteBuffer(r[_.id]),delete r[_.id],delete o[_.id]}return{bind:function l(y,_){n.uniformBlockBinding(y,_.program)},update:function c(y,_){let b=r[y.id];void 0===b&&(function f(y){let _=y.uniforms,b=0,w=0;for(let S=0,C=_.length;S<C;S++){let M=_[S],z={boundary:0,storage:0},E=Array.isArray(M.value)?M.value:[M.value];for(let D=0,P=E.length;D<P;D++){let B=m(E[D]);z.boundary+=B.boundary,z.storage+=B.storage}M.__data=new Float32Array(z.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=b,S>0&&(w=b%16,0!==w&&16-w-z.boundary<0&&(b+=16-w,M.__offset=b)),b+=z.storage}w=b%16,w>0&&(b+=16-w),y.__size=b,y.__cache={}}(y),b=function h(y){let _=function u(){for(let y=0;y<a;y++)if(-1===s.indexOf(y))return s.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();y.__bindingPointIndex=_;let b=e.createBuffer(),x=y.__size,w=y.usage;return e.bindBuffer(35345,b),e.bufferData(35345,x,w),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,b),b}(y),r[y.id]=b,y.addEventListener("dispose",g)),n.updateUBOMapping(y,_.program);let w=t.render.frame;o[y.id]!==w&&(function d(y){let b=y.uniforms,x=y.__cache;e.bindBuffer(35345,r[y.id]);for(let w=0,S=b.length;w<S;w++){let C=b[w];if(!0===p(C,w,x)){let M=C.__offset,z=Array.isArray(C.value)?C.value:[C.value],E=0;for(let D=0;D<z.length;D++){let P=z[D],I=m(P);"number"==typeof P?(C.__data[0]=P,e.bufferSubData(35345,M+E,C.__data)):P.isMatrix3?(C.__data[0]=P.elements[0],C.__data[1]=P.elements[1],C.__data[2]=P.elements[2],C.__data[3]=P.elements[0],C.__data[4]=P.elements[3],C.__data[5]=P.elements[4],C.__data[6]=P.elements[5],C.__data[7]=P.elements[0],C.__data[8]=P.elements[6],C.__data[9]=P.elements[7],C.__data[10]=P.elements[8],C.__data[11]=P.elements[0]):(P.toArray(C.__data,E),E+=I.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,M,C.__data)}}e.bindBuffer(35345,null)}(y),o[y.id]=w)},dispose:function v(){for(let y in r)e.deleteBuffer(r[y]);s=[],r={},o={}}}}function kF(e={}){this.isWebGLRenderer=!0;let h,t=void 0!==e.canvas?e.canvas:function t4e(){let e=h2("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,a=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;h=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let u=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=el,this.physicallyCorrectLights=!1,this.toneMapping=Hl,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,_=null,b=-1,x=null,w=new Ut,S=new Ut,C=null,M=t.width,z=t.height,E=1,D=null,P=null,I=new Ut(0,0,M,z),B=new Ut(0,0,M,z),V=!1,R=new Cx,N=!1,W=!1,Q=null,G=new De,Y=new $,J=new T,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ee(){return null===_?E:1}let te,pe,se,ze,_e,ge,Xe,$e,Ze,rt,Ve,Le,vt,Ft,j,F,ue,Ie,O,be,lt,We,Me,Be,Z=i;function ce(U,fe){for(let we=0;we<U.length;we++){let Ce=t.getContext(U[we],fe);if(null!==Ce)return Ce}return null}try{let U={alpha:!0,depth:n,stencil:r,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Bp}`),t.addEventListener("webglcontextlost",Lt,!1),t.addEventListener("webglcontextrestored",St,!1),t.addEventListener("webglcontextcreationerror",Ii,!1),null===Z){let fe=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&fe.shift(),Z=ce(fe,U),null===Z)throw ce(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Z.getShaderPrecisionFormat&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(U){throw console.error("THREE.WebGLRenderer: "+U.message),U}function ct(){te=new fme(Z),pe=new lme(Z,te,e),te.init(pe),We=new $2e(Z,te,pe),se=new q2e(Z,te,pe),ze=new vme,_e=new k2e,ge=new X2e(Z,te,se,_e,pe,We,ze),Xe=new hme(m),$e=new pme(m),Ze=new zpe(Z,pe),Me=new sme(Z,te,Ze,pe),rt=new mme(Z,Ze,ze,Me),Ve=new xme(Z,rt,Ze,ze),O=new bme(Z,pe,ge),F=new cme(_e),Le=new O2e(m,Xe,$e,te,pe,Me,F),vt=new J2e(m,_e),Ft=new L2e,j=new U2e(te,pe),Ie=new ome(m,Xe,$e,se,Ve,h,s),ue=new W2e(m,Ve,pe),Be=new e4e(Z,ze,pe,se),be=new ame(Z,te,ze,pe),lt=new gme(Z,te,ze,pe),ze.programs=Le.programs,m.capabilities=pe,m.extensions=te,m.properties=_e,m.renderLists=Ft,m.shadowMap=ue,m.state=se,m.info=ze}ct();let st=new K2e(m,Z);function Lt(U){U.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let U=ze.autoReset,fe=ue.enabled,we=ue.autoUpdate,le=ue.needsUpdate,Ce=ue.type;ct(),ze.autoReset=U,ue.enabled=fe,ue.autoUpdate=we,ue.needsUpdate=le,ue.type=Ce}function Ii(U){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",U.statusMessage)}function pn(U){let fe=U.target;fe.removeEventListener("dispose",pn),function Ei(U){(function re(U){let fe=_e.get(U).programs;void 0!==fe&&(fe.forEach(function(we){Le.releaseProgram(we)}),U.isShaderMaterial&&Le.releaseShaderCache(U))})(U),_e.remove(U)}(fe)}this.xr=st,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){let U=te.get("WEBGL_lose_context");U&&U.loseContext()},this.forceContextRestore=function(){let U=te.get("WEBGL_lose_context");U&&U.restoreContext()},this.getPixelRatio=function(){return E},this.setPixelRatio=function(U){void 0!==U&&(E=U,this.setSize(M,z,!1))},this.getSize=function(U){return U.set(M,z)},this.setSize=function(U,fe,we){st.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=U,z=fe,t.width=Math.floor(U*E),t.height=Math.floor(fe*E),!1!==we&&(t.style.width=U+"px",t.style.height=fe+"px"),this.setViewport(0,0,U,fe))},this.getDrawingBufferSize=function(U){return U.set(M*E,z*E).floor()},this.setDrawingBufferSize=function(U,fe,we){M=U,z=fe,E=we,t.width=Math.floor(U*we),t.height=Math.floor(fe*we),this.setViewport(0,0,U,fe)},this.getCurrentViewport=function(U){return U.copy(w)},this.getViewport=function(U){return U.copy(I)},this.setViewport=function(U,fe,we,le){U.isVector4?I.set(U.x,U.y,U.z,U.w):I.set(U,fe,we,le),se.viewport(w.copy(I).multiplyScalar(E).floor())},this.getScissor=function(U){return U.copy(B)},this.setScissor=function(U,fe,we,le){U.isVector4?B.set(U.x,U.y,U.z,U.w):B.set(U,fe,we,le),se.scissor(S.copy(B).multiplyScalar(E).floor())},this.getScissorTest=function(){return V},this.setScissorTest=function(U){se.setScissorTest(V=U)},this.setOpaqueSort=function(U){D=U},this.setTransparentSort=function(U){P=U},this.getClearColor=function(U){return U.copy(Ie.getClearColor())},this.setClearColor=function(){Ie.setClearColor.apply(Ie,arguments)},this.getClearAlpha=function(){return Ie.getClearAlpha()},this.setClearAlpha=function(){Ie.setClearAlpha.apply(Ie,arguments)},this.clear=function(U=!0,fe=!0,we=!0){let le=0;U&&(le|=16384),fe&&(le|=256),we&&(le|=1024),Z.clear(le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Lt,!1),t.removeEventListener("webglcontextrestored",St,!1),t.removeEventListener("webglcontextcreationerror",Ii,!1),Ft.dispose(),j.dispose(),_e.dispose(),Xe.dispose(),$e.dispose(),Ve.dispose(),Me.dispose(),Be.dispose(),Le.dispose(),st.dispose(),st.removeEventListener("sessionstart",Ue),st.removeEventListener("sessionend",_t),Q&&(Q.dispose(),Q=null),At.stop()},this.renderBufferDirect=function(U,fe,we,le,Ce,mt){null===fe&&(fe=q);let ei=Ce.isMesh&&Ce.matrixWorld.determinant()<0,fi=function VE(U,fe,we,le,Ce){!0!==fe.isScene&&(fe=q),ge.resetTextureUnits();let mt=fe.fog,fi=null===_?m.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:el,mi=(le.isMeshStandardMaterial?$e:Xe).get(le.envMap||(le.isMeshStandardMaterial?fe.environment:null)),fn=!0===le.vertexColors&&!!we.attributes.color&&4===we.attributes.color.itemSize,Ni=!!le.normalMap&&!!we.attributes.tangent,xi=!!we.morphAttributes.position,yo=!!we.morphAttributes.normal,Ss=!!we.morphAttributes.color,zl=le.toneMapped?m.toneMapping:Hl,Uh=we.morphAttributes.position||we.morphAttributes.normal||we.morphAttributes.color,Gn=void 0!==Uh?Uh.length:0,jt=_e.get(le),B0=d.state.lights;!0!==N||!0!==W&&U===x||F.setState(le,U,U===x&&le.id===b);let Cc=!1;le.version===jt.__version?(jt.needsLights&&jt.lightsStateVersion!==B0.state.version||jt.outputEncoding!==fi||Ce.isInstancedMesh&&!1===jt.instancing||!Ce.isInstancedMesh&&!0===jt.instancing||Ce.isSkinnedMesh&&!1===jt.skinning||!Ce.isSkinnedMesh&&!0===jt.skinning||jt.envMap!==mi||!0===le.fog&&jt.fog!==mt||void 0!==jt.numClippingPlanes&&(jt.numClippingPlanes!==F.numPlanes||jt.numIntersection!==F.numIntersection)||jt.vertexAlphas!==fn||jt.vertexTangents!==Ni||jt.morphTargets!==xi||jt.morphNormals!==yo||jt.morphColors!==Ss||jt.toneMapping!==zl||!0===pe.isWebGL2&&jt.morphTargetsCount!==Gn)&&(Cc=!0):(Cc=!0,jt.__version=le.version);let Sc=jt.currentProgram;!0===Cc&&(Sc=Cs(le,fe,Ce));let bn=!1,Ju=!1,V0=!1,Jr=Sc.getUniforms(),Mc=jt.uniforms;if(se.useProgram(Sc.program)&&(bn=!0,Ju=!0,V0=!0),le.id!==b&&(b=le.id,Ju=!0),bn||x!==U){if(Jr.setValue(Z,"projectionMatrix",U.projectionMatrix),pe.logarithmicDepthBuffer&&Jr.setValue(Z,"logDepthBufFC",2/(Math.log(U.far+1)/Math.LN2)),x!==U&&(x=U,Ju=!0,V0=!0),le.isShaderMaterial||le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshStandardMaterial||le.envMap){let br=Jr.map.cameraPosition;void 0!==br&&br.setValue(Z,J.setFromMatrixPosition(U.matrixWorld))}(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial)&&Jr.setValue(Z,"isOrthographic",!0===U.isOrthographicCamera),(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial||le.isShadowMaterial||Ce.isSkinnedMesh)&&Jr.setValue(Z,"viewMatrix",U.matrixWorldInverse)}if(Ce.isSkinnedMesh){Jr.setOptional(Z,Ce,"bindMatrix"),Jr.setOptional(Z,Ce,"bindMatrixInverse");let br=Ce.skeleton;br&&(pe.floatVertexTextures?(null===br.boneTexture&&br.computeBoneTexture(),Jr.setValue(Z,"boneTexture",br.boneTexture,ge),Jr.setValue(Z,"boneTextureSize",br.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let L1=we.morphAttributes;if((void 0!==L1.position||void 0!==L1.normal||void 0!==L1.color&&!0===pe.isWebGL2)&&O.update(Ce,we,le,Sc),(Ju||jt.receiveShadow!==Ce.receiveShadow)&&(jt.receiveShadow=Ce.receiveShadow,Jr.setValue(Z,"receiveShadow",Ce.receiveShadow)),le.isMeshGouraudMaterial&&null!==le.envMap&&(Mc.envMap.value=mi,Mc.flipEnvMap.value=mi.isCubeTexture&&!1===mi.isRenderTargetTexture?-1:1),Ju&&(Jr.setValue(Z,"toneMappingExposure",m.toneMappingExposure),jt.needsLights&&function HE(U,fe){U.ambientLightColor.needsUpdate=fe,U.lightProbe.needsUpdate=fe,U.directionalLights.needsUpdate=fe,U.directionalLightShadows.needsUpdate=fe,U.pointLights.needsUpdate=fe,U.pointLightShadows.needsUpdate=fe,U.spotLights.needsUpdate=fe,U.spotLightShadows.needsUpdate=fe,U.rectAreaLights.needsUpdate=fe,U.hemisphereLights.needsUpdate=fe}(Mc,V0),mt&&!0===le.fog&&vt.refreshFogUniforms(Mc,mt),vt.refreshMaterialUniforms(Mc,le,E,z,Q),Xv.upload(Z,jt.uniformsList,Mc,ge)),le.isShaderMaterial&&!0===le.uniformsNeedUpdate&&(Xv.upload(Z,jt.uniformsList,Mc,ge),le.uniformsNeedUpdate=!1),le.isSpriteMaterial&&Jr.setValue(Z,"center",Ce.center),Jr.setValue(Z,"modelViewMatrix",Ce.modelViewMatrix),Jr.setValue(Z,"normalMatrix",Ce.normalMatrix),Jr.setValue(Z,"modelMatrix",Ce.matrixWorld),Ce.previousModelViewMatrix&&Jr.setValue(Z,"previousModelViewMatrix",Ce.previousModelViewMatrix),U.previousProjectionMatrix&&Jr.setValue(Z,"previousProjectionMatrix",U.previousProjectionMatrix),le.isShaderMaterial||le.isRawShaderMaterial){let br=le.uniformsGroups;for(let gi=0,UE=br.length;gi<UE;gi++)if(pe.isWebGL2){let R1=br[gi];Be.update(R1,Sc),Be.bind(R1,Sc)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Sc}(U,fe,we,le,Ce);se.setMaterial(le,ei);let mi=we.index,fn=1;!0===le.wireframe&&(mi=rt.getWireframeAttribute(we),fn=2);let Ni=we.drawRange,xi=we.attributes.position,yo=Ni.start*fn,Ss=(Ni.start+Ni.count)*fn;null!==mt&&(yo=Math.max(yo,mt.start*fn),Ss=Math.min(Ss,(mt.start+mt.count)*fn)),null!==mi?(yo=Math.max(yo,0),Ss=Math.min(Ss,mi.count)):null!=xi&&(yo=Math.max(yo,0),Ss=Math.min(Ss,xi.count));let zl=Ss-yo;if(zl<0||zl===1/0)return;Me.setup(Ce,le,fi,we,mi);let Uh,Gn=be;if(null!==mi&&(Uh=Ze.get(mi),Gn=lt,Gn.setIndex(Uh)),Ce.isMesh)!0===le.wireframe?(se.setLineWidth(le.wireframeLinewidth*ee()),Gn.setMode(1)):Gn.setMode(4);else if(Ce.isLine){let jt=le.linewidth;void 0===jt&&(jt=1),se.setLineWidth(jt*ee()),Gn.setMode(Ce.isLineSegments?1:Ce.isLineLoop?2:3)}else Ce.isPoints?Gn.setMode(0):Ce.isSprite&&Gn.setMode(4);if(Ce.isInstancedMesh)Gn.renderInstances(yo,zl,Ce.count);else if(we.isInstancedBufferGeometry){let B0=Math.min(we.instanceCount,void 0!==we._maxInstanceCount?we._maxInstanceCount:1/0);Gn.renderInstances(yo,zl,B0)}else Gn.render(yo,zl)},this.compile=function(U,fe){function we(le,Ce,mt){!0===le.transparent&&le.side===As&&!1===le.forceSinglePass?(le.side=io,le.needsUpdate=!0,Cs(le,Ce,mt),le.side=Ja,le.needsUpdate=!0,Cs(le,Ce,mt),le.side=As):Cs(le,Ce,mt)}d=j.get(U),d.init(),f.push(d),U.traverseVisible(function(le){le.isLight&&le.layers.test(fe.layers)&&(d.pushLight(le),le.castShadow&&d.pushShadow(le))}),d.setupLights(m.physicallyCorrectLights),U.traverse(function(le){let Ce=le.material;if(Ce)if(Array.isArray(Ce))for(let mt=0;mt<Ce.length;mt++)we(Ce[mt],U,le);else we(Ce,U,le)}),f.pop(),d=null};let ye=null;function Ue(){At.stop()}function _t(){At.start()}let At=new sF;function Hn(U,fe,we,le){if(!1===U.visible)return;if(U.layers.test(fe.layers))if(U.isGroup)we=U.renderOrder;else if(U.isLOD)!0===U.autoUpdate&&U.update(fe);else if(U.isLight)d.pushLight(U),U.castShadow&&d.pushShadow(U);else if(U.isSprite){if(!U.frustumCulled||R.intersectsSprite(U)){le&&J.setFromMatrixPosition(U.matrixWorld).applyMatrix4(G);let mt=Ve.update(U),ei=U.material;ei.visible&&u.push(U,mt,ei,we,J.z,null)}}else if((U.isMesh||U.isLine||U.isPoints)&&(U.isSkinnedMesh&&U.skeleton.frame!==ze.render.frame&&(U.skeleton.update(),U.skeleton.frame=ze.render.frame),!U.frustumCulled||R.intersectsObject(U))){le&&J.setFromMatrixPosition(U.matrixWorld).applyMatrix4(G);let mt=Ve.update(U),ei=U.material;if(Array.isArray(ei)){let fi=mt.groups;for(let mi=0,fn=fi.length;mi<fn;mi++){let Ni=fi[mi],xi=ei[Ni.materialIndex];xi&&xi.visible&&u.push(U,mt,xi,we,J.z,Ni)}}else ei.visible&&u.push(U,mt,ei,we,J.z,null)}let Ce=U.children;for(let mt=0,ei=Ce.length;mt<ei;mt++)Hn(Ce[mt],fe,we,le)}function Kr(U,fe,we,le){let Ce=U.opaque,mt=U.transmissive,ei=U.transparent;d.setupLightsView(we),!0===N&&F.setGlobalState(m.clippingPlanes,we),mt.length>0&&function wc(U,fe,we){let le=pe.isWebGL2;null===Q&&(Q=new Wi(1,1,{generateMipmaps:!0,type:te.has("EXT_color_buffer_half_float")?Dd:Uo,minFilter:Hp,samples:le&&!0===o?4:0})),m.getDrawingBufferSize(Y),le?Q.setSize(Y.x,Y.y):Q.setSize(zv(Y.x),zv(Y.y));let Ce=m.getRenderTarget();m.setRenderTarget(Q),m.clear();let mt=m.toneMapping;m.toneMapping=Hl,In(U,fe,we),m.toneMapping=mt,ge.updateMultisampleRenderTarget(Q),ge.updateRenderTargetMipmap(Q),m.setRenderTarget(Ce)}(Ce,fe,we),le&&se.viewport(w.copy(le)),Ce.length>0&&In(Ce,fe,we),mt.length>0&&In(mt,fe,we),ei.length>0&&In(ei,fe,we),se.buffers.depth.setTest(!0),se.buffers.depth.setMask(!0),se.buffers.color.setMask(!0),se.setPolygonOffset(!1)}function In(U,fe,we){let le=!0===fe.isScene?fe.overrideMaterial:null;for(let Ce=0,mt=U.length;Ce<mt;Ce++){let ei=U[Ce],fi=ei.object,mi=ei.geometry,fn=null===le?ei.material:le,Ni=ei.group;fi.layers.test(we.layers)&&ha(fi,fe,we,mi,fn,Ni)}}function ha(U,fe,we,le,Ce,mt){U.onBeforeRender(m,fe,we,le,Ce,mt),U.modelViewMatrix.multiplyMatrices(we.matrixWorldInverse,U.matrixWorld),U.normalMatrix.getNormalMatrix(U.modelViewMatrix),Ce.onBeforeRender(m,fe,we,le,U,mt),!0===Ce.transparent&&Ce.side===As&&!1===Ce.forceSinglePass?(Ce.side=io,Ce.needsUpdate=!0,m.renderBufferDirect(we,fe,le,Ce,U,mt),Ce.side=Ja,Ce.needsUpdate=!0,m.renderBufferDirect(we,fe,le,Ce,U,mt),Ce.side=As):m.renderBufferDirect(we,fe,le,Ce,U,mt),U.onAfterRender(m,fe,we,le,Ce,mt)}function Cs(U,fe,we){!0!==fe.isScene&&(fe=q);let le=_e.get(U),Ce=d.state.lights,ei=Ce.state.version,fi=Le.getParameters(U,Ce.state,d.state.shadowsArray,fe,we),mi=Le.getProgramCacheKey(fi),fn=le.programs;le.environment=U.isMeshStandardMaterial?fe.environment:null,le.fog=fe.fog,le.envMap=(U.isMeshStandardMaterial?$e:Xe).get(U.envMap||le.environment),void 0===fn&&(U.addEventListener("dispose",pn),fn=new Map,le.programs=fn);let Ni=fn.get(mi);if(void 0!==Ni){if(le.currentProgram===Ni&&le.lightsStateVersion===ei)return $5(U,fi),Ni}else fi.uniforms=Le.getUniforms(U),U.onBuild(we,fi,m),U.onBeforeCompile(fi,m),Ni=Le.acquireProgram(fi,mi),fn.set(mi,Ni),le.uniforms=fi.uniforms;let xi=le.uniforms;(!U.isShaderMaterial&&!U.isRawShaderMaterial||!0===U.clipping)&&(xi.clippingPlanes=F.uniform),$5(U,fi),le.needsLights=function Q5(U){return U.isMeshLambertMaterial||U.isMeshToonMaterial||U.isMeshPhongMaterial||U.isMeshStandardMaterial||U.isShadowMaterial||U.isShaderMaterial&&!0===U.lights}(U),le.lightsStateVersion=ei,le.needsLights&&(xi.ambientLightColor.value=Ce.state.ambient,xi.lightProbe.value=Ce.state.probe,xi.directionalLights.value=Ce.state.directional,xi.directionalLightShadows.value=Ce.state.directionalShadow,xi.spotLights.value=Ce.state.spot,xi.spotLightShadows.value=Ce.state.spotShadow,xi.rectAreaLights.value=Ce.state.rectArea,xi.ltc_1.value=Ce.state.rectAreaLTC1,xi.ltc_2.value=Ce.state.rectAreaLTC2,xi.pointLights.value=Ce.state.point,xi.pointLightShadows.value=Ce.state.pointShadow,xi.hemisphereLights.value=Ce.state.hemi,xi.directionalShadowMap.value=Ce.state.directionalShadowMap,xi.directionalShadowMatrix.value=Ce.state.directionalShadowMatrix,xi.spotShadowMap.value=Ce.state.spotShadowMap,xi.spotLightMatrix.value=Ce.state.spotLightMatrix,xi.spotLightMap.value=Ce.state.spotLightMap,xi.pointShadowMap.value=Ce.state.pointShadowMap,xi.pointShadowMatrix.value=Ce.state.pointShadowMatrix);let yo=Ni.getUniforms(),Ss=Xv.seqWithValue(yo.seq,xi);return le.currentProgram=Ni,le.uniformsList=Ss,Ni}function $5(U,fe){let we=_e.get(U);we.outputEncoding=fe.outputEncoding,we.instancing=fe.instancing,we.skinning=fe.skinning,we.morphTargets=fe.morphTargets,we.morphNormals=fe.morphNormals,we.morphColors=fe.morphColors,we.morphTargetsCount=fe.morphTargetsCount,we.numClippingPlanes=fe.numClippingPlanes,we.numIntersection=fe.numClipIntersection,we.vertexAlphas=fe.vertexAlphas,we.vertexTangents=fe.vertexTangents,we.toneMapping=fe.toneMapping}At.setAnimationLoop(function ke(U){ye&&ye(U)}),typeof self<"u"&&At.setContext(self),this.setAnimationLoop=function(U){ye=U,st.setAnimationLoop(U),null===U?At.stop():At.start()},st.addEventListener("sessionstart",Ue),st.addEventListener("sessionend",_t),this.render=function(U,fe){if(void 0===fe||!0===fe.isCamera){if(!0!==g){if(!0===U.matrixWorldAutoUpdate&&U.updateMatrixWorld(),null===fe.parent&&!0===fe.matrixWorldAutoUpdate&&fe.updateMatrixWorld(),!0===st.enabled&&!0===st.isPresenting&&(!0===st.cameraAutoUpdate&&st.updateCamera(fe),fe=st.getCamera()),!0===U.isScene&&U.onBeforeRender(m,U,fe,_),d=j.get(U,f.length),d.init(),f.push(d),G.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),R.setFromProjectionMatrix(G),W=this.localClippingEnabled,N=F.init(this.clippingPlanes,W),u=Ft.get(U,p.length),u.init(),p.push(u),Hn(U,fe,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(D,P),!0===N&&F.beginShadows(),ue.render(d.state.shadowsArray,U,fe),!0===N&&F.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ie.render(u,U),d.setupLights(m.physicallyCorrectLights),fe.isArrayCamera){let le=fe.cameras;for(let Ce=0,mt=le.length;Ce<mt;Ce++){let ei=le[Ce];Kr(u,U,ei,ei.viewport)}}else Kr(u,U,fe);null!==_&&(ge.updateMultisampleRenderTarget(_),ge.updateRenderTargetMipmap(_)),!0===U.isScene&&U.onAfterRender(m,U,fe),Me.resetDefaultState(),b=-1,x=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(U,fe,we){_e.get(U.texture).__webglTexture=fe,_e.get(U.depthTexture).__webglTexture=we;let le=_e.get(U);le.__hasExternalTextures=!0,le.__hasExternalTextures&&(le.__autoAllocateDepthBuffer=void 0===we,le.__autoAllocateDepthBuffer||!0===te.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),le.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(U,fe){let we=_e.get(U);we.__webglFramebuffer=fe,we.__useDefaultFramebuffer=void 0===fe},this.setRenderTarget=function(U,fe=0,we=0){_=U,v=fe,y=we;let le=!0,Ce=null,mt=!1,ei=!1;if(U){let fi=_e.get(U);void 0!==fi.__useDefaultFramebuffer?(se.bindFramebuffer(36160,null),le=!1):void 0===fi.__webglFramebuffer?ge.setupRenderTarget(U):fi.__hasExternalTextures&&ge.rebindTextures(U,_e.get(U.texture).__webglTexture,_e.get(U.depthTexture).__webglTexture);let mi=U.texture;(mi.isData3DTexture||mi.isDataArrayTexture||mi.isCompressedArrayTexture)&&(ei=!0);let fn=_e.get(U).__webglFramebuffer;U.isWebGLCubeRenderTarget?(Ce=fn[fe],mt=!0):Ce=pe.isWebGL2&&U.samples>0&&!1===ge.useMultisampledRTT(U)?_e.get(U).__webglMultisampledFramebuffer:fn,w.copy(U.viewport),S.copy(U.scissor),C=U.scissorTest}else w.copy(I).multiplyScalar(E).floor(),S.copy(B).multiplyScalar(E).floor(),C=V;if(se.bindFramebuffer(36160,Ce)&&pe.drawBuffers&&le&&se.drawBuffers(U,Ce),se.viewport(w),se.scissor(S),se.setScissorTest(C),mt){let fi=_e.get(U.texture);Z.framebufferTexture2D(36160,36064,34069+fe,fi.__webglTexture,we)}else if(ei){let fi=_e.get(U.texture);Z.framebufferTextureLayer(36160,36064,fi.__webglTexture,we||0,fe||0)}b=-1},this.readRenderTargetPixels=function(U,fe,we,le,Ce,mt,ei){if(!U||!U.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let fi=_e.get(U).__webglFramebuffer;if(U.isWebGLCubeRenderTarget&&void 0!==ei&&(fi=fi[ei]),fi){se.bindFramebuffer(36160,fi);try{let mi=U.texture,fn=mi.format,Ni=mi.type;if(fn!==no&&We.convert(fn)!==Z.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let xi=Ni===Dd&&(te.has("EXT_color_buffer_half_float")||pe.isWebGL2&&te.has("EXT_color_buffer_float"));if(!(Ni===Uo||We.convert(Ni)===Z.getParameter(35738)||Ni===zr&&(pe.isWebGL2||te.has("OES_texture_float")||te.has("WEBGL_color_buffer_float"))||xi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fe>=0&&fe<=U.width-le&&we>=0&&we<=U.height-Ce&&Z.readPixels(fe,we,le,Ce,We.convert(fn),We.convert(Ni),mt)}finally{let mi=null!==_?_e.get(_).__webglFramebuffer:null;se.bindFramebuffer(36160,mi)}}},this.copyFramebufferToTexture=function(U,fe,we=0){let le=Math.pow(2,-we),Ce=Math.floor(fe.image.width*le),mt=Math.floor(fe.image.height*le);ge.setTexture2D(fe,0),Z.copyTexSubImage2D(3553,we,0,0,U.x,U.y,Ce,mt),se.unbindTexture()},this.copyTextureToTexture=function(U,fe,we,le=0){let Ce=fe.image.width,mt=fe.image.height,ei=We.convert(we.format),fi=We.convert(we.type);ge.setTexture2D(we,0),Z.pixelStorei(37440,we.flipY),Z.pixelStorei(37441,we.premultiplyAlpha),Z.pixelStorei(3317,we.unpackAlignment),fe.isDataTexture?Z.texSubImage2D(3553,le,U.x,U.y,Ce,mt,ei,fi,fe.image.data):fe.isCompressedTexture?Z.compressedTexSubImage2D(3553,le,U.x,U.y,fe.mipmaps[0].width,fe.mipmaps[0].height,ei,fe.mipmaps[0].data):Z.texSubImage2D(3553,le,U.x,U.y,ei,fi,fe.image),0===le&&we.generateMipmaps&&Z.generateMipmap(3553),se.unbindTexture()},this.copyTextureToTexture3D=function(U,fe,we,le,Ce=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let Ni,mt=U.max.x-U.min.x+1,ei=U.max.y-U.min.y+1,fi=U.max.z-U.min.z+1,mi=We.convert(le.format),fn=We.convert(le.type);if(le.isData3DTexture)ge.setTexture3D(le,0),Ni=32879;else{if(!le.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ge.setTexture2DArray(le,0),Ni=35866}Z.pixelStorei(37440,le.flipY),Z.pixelStorei(37441,le.premultiplyAlpha),Z.pixelStorei(3317,le.unpackAlignment);let xi=Z.getParameter(3314),yo=Z.getParameter(32878),Ss=Z.getParameter(3316),zl=Z.getParameter(3315),Uh=Z.getParameter(32877),Gn=we.isCompressedTexture?we.mipmaps[0]:we.image;Z.pixelStorei(3314,Gn.width),Z.pixelStorei(32878,Gn.height),Z.pixelStorei(3316,U.min.x),Z.pixelStorei(3315,U.min.y),Z.pixelStorei(32877,U.min.z),we.isDataTexture||we.isData3DTexture?Z.texSubImage3D(Ni,Ce,fe.x,fe.y,fe.z,mt,ei,fi,mi,fn,Gn.data):we.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(Ni,Ce,fe.x,fe.y,fe.z,mt,ei,fi,mi,Gn.data)):Z.texSubImage3D(Ni,Ce,fe.x,fe.y,fe.z,mt,ei,fi,mi,fn,Gn),Z.pixelStorei(3314,xi),Z.pixelStorei(32878,yo),Z.pixelStorei(3316,Ss),Z.pixelStorei(3315,zl),Z.pixelStorei(32877,Uh),0===Ce&&le.generateMipmaps&&Z.generateMipmap(Ni),se.unbindTexture()},this.initTexture=function(U){U.isCubeTexture?ge.setTextureCube(U,0):U.isData3DTexture?ge.setTexture3D(U,0):U.isDataArrayTexture||U.isCompressedArrayTexture?ge.setTexture2DArray(U,0):ge.setTexture2D(U,0),se.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,se.reset(),Me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends kF{}).prototype.isWebGL1Renderer=!0;var NF=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ct(e),this.near=t,this.far=i}clone(){return new NF(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},sh=class extends en{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},n4e=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ba()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ba()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ba()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},us=new T,Px=class{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)us.fromBufferAttribute(this,t),us.applyMatrix4(e),this.setXYZ(t,us.x,us.y,us.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)us.fromBufferAttribute(this,t),us.applyNormalMatrix(e),this.setXYZ(t,us.x,us.y,us.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)us.fromBufferAttribute(this,t),us.transformDirection(e),this.setXYZ(t,us.x,us.y,us.z);return this}setX(e,t){return this.normalized&&(t=Cn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=eh(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=eh(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=eh(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=eh(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array),n=Cn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cn(t,this.array),i=Cn(i,this.array),n=Cn(n,this.array),r=Cn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new It(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Px(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},LF=class extends en{constructor(){super(),this.isBone=!0,this.type="Bone"}},wa=class extends Zn{constructor(e=null,t=1,i=1,n,r,o,s,a,l=Gi,c=Gi,h,u){super(null,o,s,a,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},RF=new De,r4e=new De,Ix=class{constructor(e=[],t=[]){this.uuid=ba(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new De)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new De;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++)RF.multiplyMatrices(e[r]?e[r].matrixWorld:r4e,t[r]),RF.toArray(i,16*r);null!==n&&(n.needsUpdate=!0)}clone(){return new Ix(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=UR(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new wa(t,e,e,no,zr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let r=e.bones[i],o=t[r];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new LF),this.bones.push(o),this.boneInverses.push((new De).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++)e.bones.push(t[n].uuid),e.boneInverses.push(i[n].toArray());return e}},b2=class extends It{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},FF=new De,BF=new De,$v=[],o4e=new De,x2=new Dr,s4e=class extends Dr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new b2(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let n=0;n<i;n++)this.setMatrixAt(n,o4e)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(x2.geometry=this.geometry,x2.material=this.material,void 0!==x2.material)for(let r=0;r<n;r++){this.getMatrixAt(r,FF),BF.multiplyMatrices(i,FF),x2.matrixWorld=BF,x2.raycast(e,$v);for(let o=0,s=$v.length;o<s;o++){let a=$v[o];a.instanceId=r,a.object=this,t.push(a)}$v.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new b2(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},au=class extends f2{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ct(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},VF=new T,HF=new T,UF=new De,Ox=new Xp,Qv=new Ps,Zv=class extends en{constructor(e=new gt,t=new au){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)VF.fromBufferAttribute(t,n-1),HF.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=VF.distanceTo(HF);e.setAttribute("lineDistance",new Ke(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Qv.copy(i.boundingSphere),Qv.applyMatrix4(n),Qv.radius+=r,!1===e.ray.intersectsSphere(Qv))return;UF.copy(n).invert(),Ox.copy(e.ray).applyMatrix4(UF);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new T,c=new T,h=new T,u=new T,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p)for(let v=Math.max(0,o.start),y=Math.min(p.count,o.start+o.count)-1;v<y;v+=d){let _=p.getX(v),b=p.getX(v+1);if(l.fromBufferAttribute(f,_),c.fromBufferAttribute(f,b),Ox.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(u);x<e.near||x>e.far||t.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(let v=Math.max(0,o.start),y=Math.min(f.count,o.start+o.count)-1;v<y;v+=d){if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,v+1),Ox.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(u);_<e.near||_>e.far||t.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}},jF=new T,YF=new T,w2=class extends Zv{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)jF.fromBufferAttribute(t,n),YF.fromBufferAttribute(t,n+1),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+jF.distanceTo(YF);e.setAttribute("lineDistance",new Ke(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},a4e=class extends Zn{constructor(e,t,i,n,r,o,s,a,l){super(e,t,i,n,r,o,s,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:ri,this.magFilter=void 0!==r?r:ri,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function h(){c.needsUpdate=!0,e.requestVideoFrameCallback(h)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},l4e=class extends Zn{constructor(e,t,i,n,r,o,s,a,l){super(e,t,i,n,r,o,s,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Yl=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i,t=[],n=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let o,i=this.getLengths(),n=0,r=i.length;o=t||e*i[r-1];let l,s=0,a=r-1;for(;s<=a;)if(n=Math.floor(s+(a-s)/2),l=i[n]-o,l<0)s=n+1;else{if(!(l>0)){a=n;break}a=n-1}if(n=a,i[n]===o)return n/(r-1);let c=i[n];return(n+(o-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),o=this.getPoint(n),s=t||(r.isVector2?new $:new T);return s.copy(o).sub(r).normalize(),s}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new T,n=[],r=[],o=[],s=new T,a=new De;for(let d=0;d<=e;d++)n[d]=this.getTangentAt(d/e,new T);r[0]=new T,o[0]=new T;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),o[0].crossVectors(n[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(n[d-1],n[d]),s.length()>Number.EPSILON){s.normalize();let p=Math.acos(Tr(n[d-1].dot(n[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,p))}o[d].crossVectors(n[d],r[d])}if(!0===t){let d=Math.acos(Tr(r[0].dot(r[e]),-1,1));d/=e,n[0].dot(s.crossVectors(r[0],r[e]))>0&&(d=-d);for(let p=1;p<=e;p++)r[p].applyMatrix4(a.makeRotationAxis(n[p],d*p)),o[p].crossVectors(n[p],r[p])}return{tangents:n,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Kv=class extends Yl{constructor(e=0,t=0,i=1,n=1,r=0,o=2*Math.PI,s=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){let i=t||new $,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0===this.aClockwise&&!o&&(r===n?r=-n:r-=n);let s=this.aStartAngle+e*r,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=a-this.aX,d=l-this.aY;a=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};function kx(){let e=0,t=0,i=0,n=0;function r(o,s,a,l){e=o,t=a,i=-3*o+3*s-2*a-l,n=2*o-2*s+a+l}return{initCatmullRom:function(o,s,a,l,c){r(s,a,c*(a-o),c*(l-s))},initNonuniformCatmullRom:function(o,s,a,l,c,h,u){let d=(s-o)/c-(a-o)/(c+h)+(a-s)/h,p=(a-s)/h-(l-s)/(h+u)+(l-a)/u;d*=h,p*=h,r(s,a,d,p)},calc:function(o){let s=o*o;return e+t*o+i*s+n*(s*o)}}}var Jv=new T,Nx=new kx,Lx=new kx,Rx=new kx;function GF(e,t,i,n,r){let o=.5*(n-t),s=.5*(r-i),a=e*e;return(2*i-2*n+o+s)*(e*a)+(-3*i+3*n-2*o-s)*a+o*e+i}function C2(e,t,i,n){return function u4e(e,t){let i=1-e;return i*i*t}(e,t)+function d4e(e,t){return 2*(1-e)*e*t}(e,i)+function p4e(e,t){return e*e*t}(e,n)}function S2(e,t,i,n,r){return function f4e(e,t){let i=1-e;return i*i*i*t}(e,t)+function m4e(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+function g4e(e,t){return 3*(1-e)*e*e*t}(e,n)+function v4e(e,t){return e*e*e*t}(e,r)}var ol=class extends Yl{constructor(e=new $,t=new $,i=new $,n=new $){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new $){let i=t,n=this.v0,r=this.v1,o=this.v2,s=this.v3;return i.set(S2(e,n.x,r.x,o.x,s.x),S2(e,n.y,r.y,o.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},e8=class extends Yl{constructor(e=new T,t=new T,i=new T,n=new T){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new T){let i=t,n=this.v0,r=this.v1,o=this.v2,s=this.v3;return i.set(S2(e,n.x,r.x,o.x,s.x),S2(e,n.y,r.y,o.y,s.y),S2(e,n.z,r.z,o.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},sl=class extends Yl{constructor(e=new $,t=new $){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new $){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new $;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},WF=class extends Yl{constructor(e=new T,t=new T){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new T){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},lu=class extends Yl{constructor(e=new $,t=new $,i=new $){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new $){let i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(C2(e,n.x,r.x,o.x),C2(e,n.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Fx=class extends Yl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new $){let i=t,n=this.points,r=(n.length-1)*e,o=Math.floor(r),s=r-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],h=n[o>n.length-3?n.length-1:o+2];return i.set(GF(s,a.x,l.x,c.x,h.x),GF(s,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push((new $).fromArray(n))}return this}},_4e=Object.freeze({__proto__:null,ArcCurve:class extends Kv{constructor(e,t,i,n,r,o){super(e,t,i,i,n,r,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Yl{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new T){let l,c,i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*e,s=Math.floor(o),a=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/r)+1)*r:0===a&&s===r-1&&(s=r-2,a=1),this.closed||s>0?l=n[(s-1)%r]:(Jv.subVectors(n[0],n[1]).add(n[0]),l=Jv);let h=n[s%r],u=n[(s+1)%r];if(this.closed||s+2<r?c=n[(s+2)%r]:(Jv.subVectors(n[r-1],n[r-2]).add(n[r-1]),c=Jv),"centripetal"===this.curveType||"chordal"===this.curveType){let d="chordal"===this.curveType?.5:.25,p=Math.pow(l.distanceToSquared(h),d),f=Math.pow(h.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Nx.initNonuniformCatmullRom(l.x,h.x,u.x,c.x,p,f,m),Lx.initNonuniformCatmullRom(l.y,h.y,u.y,c.y,p,f,m),Rx.initNonuniformCatmullRom(l.z,h.z,u.z,c.z,p,f,m)}else"catmullrom"===this.curveType&&(Nx.initCatmullRom(l.x,h.x,u.x,c.x,this.tension),Lx.initCatmullRom(l.y,h.y,u.y,c.y,this.tension),Rx.initCatmullRom(l.z,h.z,u.z,c.z,this.tension));return i.set(Nx.calc(a),Lx.calc(a),Rx.calc(a)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push((new T).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:ol,CubicBezierCurve3:e8,EllipseCurve:Kv,LineCurve:sl,LineCurve3:WF,QuadraticBezierCurve:lu,QuadraticBezierCurve3:class extends Yl{constructor(e=new T,t=new T,i=new T){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new T){let i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(C2(e,n.x,r.x,o.x),C2(e,n.y,r.y,o.y),C2(e,n.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:Fx}),qF=class extends Yl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new sl(t,e))}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let o=n[r]-i,s=this.curves[r],a=s.getLength();return s.getPointAt(0===a?0:1-o/a,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let i,t=[];for(let n=0,r=this.curves;n<r.length;n++){let o=r[n],a=o.getPoints(o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e);for(let l=0;l<a.length;l++){let c=a[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let n=e.curves[t];this.curves.push((new _4e[n.type]).fromJSON(n))}return this}},t8=class extends qF{constructor(e){super(),this.type="Path",this.currentPoint=new $,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new sl(this.currentPoint.clone(),new $(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new lu(this.currentPoint.clone(),new $(e,t),new $(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,o){let s=new ol(this.currentPoint.clone(),new $(e,t),new $(i,n),new $(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new Fx(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o),this}absarc(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this}ellipse(e,t,i,n,r,o,s,a){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o,s,a),this}absellipse(e,t,i,n,r,o,s,a){let l=new Kv(e,t,i,n,r,o,s,a);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},XF=class extends gt{constructor(e=[new $(0,-.5),new $(.5,0),new $(0,.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Tr(n,0,2*Math.PI);let r=[],o=[],s=[],a=[],l=[],c=1/t,h=new T,u=new $,d=new T,p=new T,f=new T,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let y=i+v*c*n,_=Math.sin(y),b=Math.cos(y);for(let x=0;x<=e.length-1;x++)h.x=e[x].x*_,h.y=e[x].y,h.z=e[x].x*b,o.push(h.x,h.y,h.z),u.x=v/t,u.y=x/(e.length-1),s.push(u.x,u.y),l.push(a[3*x+0]*_,a[3*x+1],a[3*x+0]*b)}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let _=y+v*e.length,x=_+e.length,w=_+e.length+1,S=_+1;r.push(_,x,S),r.push(w,S,x)}this.setIndex(r),this.setAttribute("position",new Ke(o,3)),this.setAttribute("uv",new Ke(s,2)),this.setAttribute("normal",new Ke(l,3))}static fromJSON(e){return new XF(e.points,e.segments,e.phiStart,e.phiLength)}},Bx=class extends gt{constructor(e=1,t=1,i=1,n=32,r=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],u=[],d=[],p=0,f=[],m=i/2,g=0;function y(_){let b=p,x=new $,w=new T,S=0,C=!0===_?e:t,M=!0===_?1:-1;for(let E=1;E<=n;E++)h.push(0,m*M,0),u.push(0,M,0),d.push(.5,.5),p++;let z=p;for(let E=0;E<=n;E++){let D=E/n*a+s,P=Math.cos(D),I=Math.sin(D);w.x=C*I,w.y=m*M,w.z=C*P,h.push(w.x,w.y,w.z),u.push(0,M,0),x.x=.5*P+.5,x.y=.5*I*M+.5,d.push(x.x,x.y),p++}for(let E=0;E<n;E++){let D=b+E,P=z+E;!0===_?c.push(P,P+1,D):c.push(P+1,P,D),S+=3}l.addGroup(g,S,!0===_?1:2),g+=S}(function v(){let _=new T,b=new T,x=0,w=(t-e)/i;for(let S=0;S<=r;S++){let C=[],M=S/r,z=M*(t-e)+e;for(let E=0;E<=n;E++){let D=E/n,P=D*a+s,I=Math.sin(P),B=Math.cos(P);b.x=z*I,b.y=-M*i+m,b.z=z*B,h.push(b.x,b.y,b.z),_.set(I,w,B).normalize(),u.push(_.x,_.y,_.z),d.push(D,1-M),C.push(p++)}f.push(C)}for(let S=0;S<n;S++)for(let C=0;C<r;C++){let z=f[C+1][S],E=f[C+1][S+1],D=f[C][S+1];c.push(f[C][S],z,D),c.push(z,E,D),x+=6}l.addGroup(g,x,0),g+=x})(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Ke(h,3)),this.setAttribute("normal",new Ke(u,3)),this.setAttribute("uv",new Ke(d,2))}static fromJSON(e){return new Bx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Vx=class extends Bx{constructor(e=1,t=1,i=32,n=1,r=!1,o=0,s=2*Math.PI){super(0,e,t,i,n,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}}static fromJSON(e){return new Vx(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Hx=class extends gt{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],o=[];function a(v,y,_,b){let x=b+1,w=[];for(let S=0;S<=x;S++){w[S]=[];let C=v.clone().lerp(_,S/x),M=y.clone().lerp(_,S/x),z=x-S;for(let E=0;E<=z;E++)w[S][E]=0===E&&S===x?C:C.clone().lerp(M,E/z)}for(let S=0;S<x;S++)for(let C=0;C<2*(x-S)-1;C++){let M=Math.floor(C/2);C%2==0?(u(w[S][M+1]),u(w[S+1][M]),u(w[S][M])):(u(w[S][M+1]),u(w[S+1][M+1]),u(w[S+1][M]))}}function u(v){r.push(v.x,v.y,v.z)}function d(v,y){let _=3*v;y.x=e[_+0],y.y=e[_+1],y.z=e[_+2]}function f(v,y,_,b){b<0&&1===v.x&&(o[y]=v.x-1),0===_.x&&0===_.z&&(o[y]=b/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}(function s(v){let y=new T,_=new T,b=new T;for(let x=0;x<t.length;x+=3)d(t[x+0],y),d(t[x+1],_),d(t[x+2],b),a(y,_,b,v)})(n),function l(v){let y=new T;for(let _=0;_<r.length;_+=3)y.x=r[_+0],y.y=r[_+1],y.z=r[_+2],y.normalize().multiplyScalar(v),r[_+0]=y.x,r[_+1]=y.y,r[_+2]=y.z}(i),function c(){let v=new T;for(let y=0;y<r.length;y+=3){v.x=r[y+0],v.y=r[y+1],v.z=r[y+2];let _=m(v)/2/Math.PI+.5,b=g(v)/Math.PI+.5;o.push(_,1-b)}(function p(){let v=new T,y=new T,_=new T,b=new T,x=new $,w=new $,S=new $;for(let C=0,M=0;C<r.length;C+=9,M+=6){v.set(r[C+0],r[C+1],r[C+2]),y.set(r[C+3],r[C+4],r[C+5]),_.set(r[C+6],r[C+7],r[C+8]),x.set(o[M+0],o[M+1]),w.set(o[M+2],o[M+3]),S.set(o[M+4],o[M+5]),b.copy(v).add(y).add(_).divideScalar(3);let z=m(b);f(x,M+0,v,z),f(w,M+2,y,z),f(S,M+4,_,z)}})(),function h(){for(let v=0;v<o.length;v+=6){let y=o[v+0],_=o[v+2],b=o[v+4],x=Math.max(y,_,b),w=Math.min(y,_,b);x>.9&&w<.1&&(y<.2&&(o[v+0]+=1),_<.2&&(o[v+2]+=1),b<.2&&(o[v+4]+=1))}}()}(),this.setAttribute("position",new Ke(r,3)),this.setAttribute("normal",new Ke(r.slice(),3)),this.setAttribute("uv",new Ke(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Hx(e.vertices,e.indices,e.radius,e.details)}},$F=class extends Hx{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $F(e.radius,e.detail)}},n8=class extends t8{constructor(e){super(e),this.uuid=ba(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let n=e.holes[t];this.holes.push((new t8).fromJSON(n))}return this}};function QF(e,t,i,n,r){let o,s;if(r===function L4e(e,t,i,n){let r=0;for(let o=t,s=i-n;o<i;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,i,n)>0)for(o=t;o<i;o+=n)s=JF(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=JF(o,e[o],e[o+1],s);return s&&r8(s,s.next)&&(T2(s),s=s.next),s}function jd(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!r8(i,i.next)&&0!==Kn(i.prev,i,i.next))i=i.next;else{if(T2(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function M2(e,t,i,n,r,o,s){if(!e)return;!s&&o&&function A4e(e,t,i,n){let r=e;do{0===r.z&&(r.z=Ux(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function P4e(e){let t,i,n,r,o,s,a,l,c=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(e,n,r,o);let l,c,a=e;for(;e.prev!==e.next;)if(l=e.prev,c=e.next,o?w4e(e,n,r,o):x4e(e))t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),T2(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?M2(e=C4e(jd(e),t,i),t,i,n,r,o,2):2===s&&S4e(e,t,i,n,r,o):M2(jd(e),t,i,n,r,o,1);break}}function x4e(e){let t=e.prev,i=e,n=e.next;if(Kn(t,i,n)>=0)return!1;let r=t.x,o=i.x,s=n.x,a=t.y,l=i.y,c=n.y,h=r<o?r<s?r:s:o<s?o:s,u=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=n.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&pf(r,a,o,l,s,c,f.x,f.y)&&Kn(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function w4e(e,t,i,n){let r=e.prev,o=e,s=e.next;if(Kn(r,o,s)>=0)return!1;let a=r.x,l=o.x,c=s.x,h=r.y,u=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=a>l?a>c?a:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=Ux(p,f,t,i,n),y=Ux(m,g,t,i,n),_=e.prevZ,b=e.nextZ;for(;_&&_.z>=v&&b&&b.z<=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==s&&pf(a,h,l,u,c,d,_.x,_.y)&&Kn(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&pf(a,h,l,u,c,d,b.x,b.y)&&Kn(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==s&&pf(a,h,l,u,c,d,_.x,_.y)&&Kn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&pf(a,h,l,u,c,d,b.x,b.y)&&Kn(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function C4e(e,t,i){let n=e;do{let r=n.prev,o=n.next.next;!r8(r,o)&&ZF(r,n,n.next,o)&&z2(r,o)&&z2(o,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(o.i/i|0),T2(n),T2(n.next),n=e=o),n=n.next}while(n!==e);return jd(n)}function S4e(e,t,i,n,r,o){let s=e;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&O4e(s,a)){let l=KF(s,a);return s=jd(s,s.next),l=jd(l,l.next),M2(s,t,i,n,r,o,0),void M2(l,t,i,n,r,o,0)}a=a.next}s=s.next}while(s!==e)}function z4e(e,t){return e.x-t.x}function T4e(e,t){let i=function E4e(e,t){let r,i=t,n=-1/0,o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let d=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=o&&d>n&&(n=d,r=i.x<i.next.x?i:i.next,d===o))return r}i=i.next}while(i!==t);if(!r)return null;let u,a=r,l=r.x,c=r.y,h=1/0;i=r;do{o>=i.x&&i.x>=l&&o!==i.x&&pf(s<c?o:n,s,l,c,s<c?n:o,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(o-i.x),z2(i,e)&&(u<h||u===h&&(i.x>r.x||i.x===r.x&&D4e(r,i)))&&(r=i,h=u)),i=i.next}while(i!==a);return r}(e,t);if(!i)return t;let n=KF(i,e);return jd(n,n.next),jd(i,i.next)}function D4e(e,t){return Kn(e.prev,e,t.prev)<0&&Kn(t.next,e,e.next)<0}function Ux(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function I4e(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function pf(e,t,i,n,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function O4e(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function k4e(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ZF(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(z2(e,t)&&z2(t,e)&&function N4e(e,t){let i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Kn(e.prev,e,t.prev)||Kn(e,t.prev,t))||r8(e,t)&&Kn(e.prev,e,e.next)>0&&Kn(t.prev,t,t.next)>0)}function Kn(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function r8(e,t){return e.x===t.x&&e.y===t.y}function ZF(e,t,i,n){let r=s8(Kn(e,t,i)),o=s8(Kn(e,t,n)),s=s8(Kn(i,n,e)),a=s8(Kn(i,n,t));return!!(r!==o&&s!==a||0===r&&o8(e,i,t)||0===o&&o8(e,n,t)||0===s&&o8(i,e,n)||0===a&&o8(i,t,n))}function o8(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function s8(e){return e>0?1:e<0?-1:0}function z2(e,t){return Kn(e.prev,e,e.next)<0?Kn(e,t,e.next)>=0&&Kn(e,e.prev,t)>=0:Kn(e,t,e.prev)<0||Kn(e,e.next,t)<0}function KF(e,t){let i=new jx(e.i,e.x,e.y),n=new jx(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function JF(e,t,i,n){let r=new jx(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function T2(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jx(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var eB=class{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return eB.area(e)<0}static triangulateShape(e,t){let i=[],n=[],r=[];tB(e),iB(i,e);let o=e.length;t.forEach(tB);for(let a=0;a<t.length;a++)n.push(o),o+=t[a].length,iB(i,t[a]);let s=function(e,t,i=2){let a,l,c,h,u,d,p,n=t&&t.length,r=n?t[0]*i:e.length,o=QF(e,0,r,i,!0),s=[];if(!o||o.next===o.prev)return s;if(n&&(o=function M4e(e,t,i,n){let o,s,a,l,c,r=[];for(o=0,s=t.length;o<s;o++)a=t[o]*n,l=o<s-1?t[o+1]*n:e.length,c=QF(e,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(I4e(c));for(r.sort(z4e),o=0;o<r.length;o++)i=T4e(r[o],i);return i}(e,t,o,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let f=i;f<r;f+=i)u=e[f],d=e[f+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?32767/p:0}return M2(o,s,i,a,l,p,0),s}(i,n);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function tB(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function iB(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var nB=class extends Hx{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new nB(e.radius,e.detail)}},ff=class extends gt{constructor(e=1,t=32,i=16,n=0,r=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let a=Math.min(o+s,Math.PI),l=0,c=[],h=new T,u=new T,d=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let v=[],y=g/i,_=0;0==g&&0==o?_=.5/t:g==i&&a==Math.PI&&(_=-.5/t);for(let b=0;b<=t;b++){let x=b/t;h.x=-e*Math.cos(n+x*r)*Math.sin(o+y*s),h.y=e*Math.cos(o+y*s),h.z=e*Math.sin(n+x*r)*Math.sin(o+y*s),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(x+_,1-y),v.push(l++)}c.push(v)}for(let g=0;g<i;g++)for(let v=0;v<t;v++){let _=c[g][v],b=c[g+1][v],x=c[g+1][v+1];(0!==g||o>0)&&d.push(c[g][v+1],_,x),(g!==i-1||a<Math.PI)&&d.push(_,b,x)}this.setIndex(d),this.setAttribute("position",new Ke(p,3)),this.setAttribute("normal",new Ke(f,3)),this.setAttribute("uv",new Ke(m,2))}static fromJSON(e){return new ff(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},rB=class extends gt{constructor(e=1,t=.4,i=12,n=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let o=[],s=[],a=[],l=[],c=new T,h=new T,u=new T;for(let d=0;d<=i;d++)for(let p=0;p<=n;p++){let f=p/n*r,m=d/i*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(f),h.y=(e+t*Math.cos(m))*Math.sin(f),h.z=t*Math.sin(m),s.push(h.x,h.y,h.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(p/n),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=n;p++){let m=(n+1)*(d-1)+p-1,g=(n+1)*(d-1)+p,v=(n+1)*d+p;o.push((n+1)*d+p-1,m,v),o.push(m,g,v)}this.setIndex(o),this.setAttribute("position",new Ke(s,3)),this.setAttribute("normal",new Ke(a,3)),this.setAttribute("uv",new Ke(l,2))}static fromJSON(e){return new rB(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},oB=class extends gt{constructor(e=1,t=.4,i=64,n=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},i=Math.floor(i),n=Math.floor(n);let s=[],a=[],l=[],c=[],h=new T,u=new T,d=new T,p=new T,f=new T,m=new T,g=new T;for(let y=0;y<=i;++y){let _=y/i*r*Math.PI*2;v(_,r,o,e,d),v(_+.01,r,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let b=0;b<=n;++b){let x=b/n*Math.PI*2,w=-t*Math.cos(x),S=t*Math.sin(x);h.x=d.x+(w*g.x+S*f.x),h.y=d.y+(w*g.y+S*f.y),h.z=d.z+(w*g.z+S*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/i),c.push(b/n)}}for(let y=1;y<=i;y++)for(let _=1;_<=n;_++){let x=(n+1)*y+(_-1),w=(n+1)*y+_,S=(n+1)*(y-1)+_;s.push((n+1)*(y-1)+(_-1),x,S),s.push(x,w,S)}function v(y,_,b,x,w){let S=Math.cos(y),C=Math.sin(y),M=b/_*y,z=Math.cos(M);w.x=x*(2+z)*.5*S,w.y=x*(2+z)*C*.5,w.z=x*Math.sin(M)*.5}this.setIndex(s),this.setAttribute("position",new Ke(a,3)),this.setAttribute("normal",new Ke(l,3)),this.setAttribute("uv",new Ke(c,2))}static fromJSON(e){return new oB(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function cu(e,t,i){return sB(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function a8(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function sB(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function R4e(e){let i=e.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(function t(r,o){return e[r]-e[o]}),n}function aB(e,t,i){let n=e.length,r=new e.constructor(n);for(let o=0,s=0;s!==n;++o){let a=i[o]*t;for(let l=0;l!==t;++l)r[s++]=e[a+l]}return r}function lB(e,t,i,n){let r=1,o=e[0];for(;void 0!==o&&void 0===o[n];)o=e[r++];if(void 0===o)return;let s=o[n];if(void 0!==s)if(Array.isArray(s))do{s=o[n],void 0!==s&&(t.push(o.time),i.push.apply(i,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[n],void 0!==s&&(t.push(o.time),s.toArray(i,i.length)),o=e[r++]}while(void 0!==o);else do{s=o[n],void 0!==s&&(t.push(o.time),i.push(s)),o=e[r++]}while(void 0!==o)}var l8=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(e>=r)break e;{let s=t[1];e<s&&(i=2,r=s);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===a)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0}}for(;i<o;){let s=i+o>>>1;e<t[s]?o=s:i=s+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},F4e=class extends l8{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Up,endingEnd:Up}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,o=e+1,s=n[r],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case jp:r=e,s=2*t-i;break;case 2402:r=n.length-2,s=t+n[r]-n[r+1];break;default:r=e,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case jp:o=e,a=2*i-t;break;case 2402:o=1,a=i+n[1]-n[0];break;default:o=e-1,a=t}let l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,i,n){let r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==s;++b)r[b]=g*o[c+b]+v*o[l+b]+y*o[a+b]+_*o[h+b];return r}},cB=class extends l8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(i-t)/(n-t),h=1-c;for(let u=0;u!==s;++u)r[u]=o[l+u]*h+o[a+u]*c;return r}},B4e=class extends l8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},Gl=class{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=a8(t,this.TimeBufferType),this.values=a8(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let i,t=e.constructor;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:a8(e.times,Array),values:a8(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new B4e(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new cB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new F4e(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);let s=this.getValueSize();this.times=cu(i,r,o),this.values=cu(this.values,r*s,o*s)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){let a=i[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==n&&sB(n))for(let s=0,a=n.length;s!==a;++s){let l=n[s];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,l),e=!1;break}}return e}optimize(){let e=cu(this.times),t=cu(this.values),i=this.getValueSize(),n=2302===this.getInterpolation(),r=e.length-1,o=1;for(let s=1;s<r;++s){let a=!1,l=e[s];if(l!==e[s+1]&&(1!==s||l!==e[0]))if(n)a=!0;else{let h=s*i,u=h-i,d=h+i;for(let p=0;p!==i;++p){let f=t[h+p];if(f!==t[u+p]||f!==t[d+p]){a=!0;break}}}if(a){if(s!==o){e[o]=e[s];let h=s*i,u=o*i;for(let d=0;d!==i;++d)t[u+d]=t[h+d]}++o}}if(r>0){e[o]=e[r];for(let s=r*i,a=o*i,l=0;l!==i;++l)t[a+l]=t[s+l];++o}return o!==e.length?(this.times=cu(e,0,o),this.values=cu(t,0,o*i)):(this.times=e,this.values=t),this}clone(){let e=cu(this.times,0),t=cu(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};Gl.prototype.TimeBufferType=Float32Array,Gl.prototype.ValueBufferType=Float32Array,Gl.prototype.DefaultInterpolation=2301;var mf=class extends Gl{};mf.prototype.ValueTypeName="bool",mf.prototype.ValueBufferType=Array,mf.prototype.DefaultInterpolation=2300,mf.prototype.InterpolantFactoryMethodLinear=void 0,mf.prototype.InterpolantFactoryMethodSmooth=void 0;var hB=class extends Gl{};hB.prototype.ValueTypeName="color";var c8=class extends Gl{};c8.prototype.ValueTypeName="number";var V4e=class extends l8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(i-t)/(n-t),l=e*s;for(let c=l+s;l!==c;l+=4)qt.slerpFlat(r,0,o,l-s,o,l,a);return r}},E2=class extends Gl{InterpolantFactoryMethodLinear(e){return new V4e(this.times,this.values,this.getValueSize(),e)}};E2.prototype.ValueTypeName="quaternion",E2.prototype.DefaultInterpolation=2301,E2.prototype.InterpolantFactoryMethodSmooth=void 0;var gf=class extends Gl{};gf.prototype.ValueTypeName="string",gf.prototype.ValueBufferType=Array,gf.prototype.DefaultInterpolation=2300,gf.prototype.InterpolantFactoryMethodLinear=void 0,gf.prototype.InterpolantFactoryMethodSmooth=void 0;var h8=class extends Gl{};h8.prototype.ValueTypeName="vector";var Yx=class{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ba(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,s=i.length;o!==s;++o)t.push(U4e(i[o]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(Gl.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,o=[];for(let s=0;s<r;s++){let a=[],l=[];a.push((s+r-1)%r,s,(s+1)%r),l.push(0,1,0);let c=R4e(a);a=aB(a,1,c),l=aB(l,1,c),!n&&0===a[0]&&(a.push(r),l.push(l[0])),o.push(new c8(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){let l=e[s],c=l.name.match(r);if(c&&c.length>1){let h=c[1],u=n[h];u||(n[h]=u=[]),u.push(l)}}let o=[];for(let s in n)o.push(this.CreateFromMorphTargetSequence(s,n[s],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,h,u,d,p){if(0!==u.length){let f=[],m=[];lB(u,f,m,d),0!==f.length&&p.push(new c(h,f,m))}},n=[],r=e.name||"default",o=e.fps||30,s=e.blendMode,a=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let h=l[c].keys;if(h&&0!==h.length)if(h[0].morphTargets){let d,u={};for(d=0;d<h.length;d++)if(h[d].morphTargets)for(let p=0;p<h[d].morphTargets.length;p++)u[h[d].morphTargets[p]]=-1;for(let p in u){let f=[],m=[];for(let g=0;g!==h[d].morphTargets.length;++g){let v=h[d];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new c8(".morphTargetInfluence["+p+"]",f,m))}a=u.length*o}else{let u=".bones["+t[c].name+"]";i(h8,u+".position",h,"pos",n),i(E2,u+".quaternion",h,"rot",n),i(h8,u+".scale",h,"scl",n)}}return 0===n.length?null:new this(r,a,n,s)}resetDuration(){let t=0;for(let i=0,n=this.tracks.length;i!==n;++i){let r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function U4e(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function H4e(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return c8;case"vector":case"vector2":case"vector3":case"vector4":return h8;case"color":return hB;case"quaternion":return E2;case"bool":case"boolean":return mf;case"string":return gf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let i=[],n=[];lB(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var u8={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},uB=class{constructor(e,t,i){let a,n=this,r=!1,o=0,s=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){s++,!1===r&&void 0!==n.onStart&&n.onStart(c,o,s),r=!0},this.itemEnd=function(c){o++,void 0!==n.onProgress&&n.onProgress(c,o,s),o===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(c){void 0!==n.onError&&n.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,h){return l.push(c,h),this},this.removeHandler=function(c){let h=l.indexOf(c);return-1!==h&&l.splice(h,2),this},this.getHandler=function(c){for(let h=0,u=l.length;h<u;h+=2){let d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},j4e=new uB,D2=class{constructor(e){this.manager=void 0!==e?e:j4e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},ah={},Y4e=class extends Error{constructor(e,t){super(e),this.response=t}},Gx=class extends D2{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=u8.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==ah[e])return void ah[e].push({onLoad:t,onProgress:i,onError:n});ah[e]=[],ah[e].push({onLoad:t,onProgress:i,onError:n});let o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then(l=>{if(200===l.status||0===l.status){if(0===l.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===l.body||void 0===l.body.getReader)return l;let c=ah[e],h=l.body.getReader(),u=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=u?parseInt(u):0,p=0!==d,f=0,m=new ReadableStream({start(g){!function v(){h.read().then(({done:y,value:_})=>{if(y)g.close();else{f+=_.byteLength;let b=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let x=0,w=c.length;x<w;x++){let S=c[x];S.onProgress&&S.onProgress(b)}g.enqueue(_),v()}})}()}});return new Response(m)}throw new Y4e(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>(new DOMParser).parseFromString(c,s));case"json":return l.json();default:if(void 0===s)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(s),h=c&&c[1]?c[1].toLowerCase():void 0,u=new TextDecoder(h);return l.arrayBuffer().then(d=>u.decode(d))}}}).then(l=>{u8.add(e,l);let c=ah[e];delete ah[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=ah[e];if(void 0===c)throw this.manager.itemError(e),l;delete ah[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},G4e=class extends D2{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,o=u8.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;let s=h2("img");function a(){c(),u8.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(h){c(),n&&n(h),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}},W4e=class extends D2{constructor(e){super(e)}load(e,t,i,n){let r=new Zn,o=new G4e(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(s){r.image=s,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r}},A2=class extends en{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ct(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},q4e=class extends A2{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(en.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ct(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},Wx=new De,dB=new T,pB=new T,qx=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $(512,512),this.map=null,this.mapPass=null,this.matrix=new De,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Cx,this._frameExtents=new $(1,1),this._viewportCount=1,this._viewports=[new Ut(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;dB.setFromMatrixPosition(e.matrixWorld),t.position.copy(dB),pB.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(pB),t.updateMatrixWorld(),Wx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wx),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Wx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},X4e=class extends qx{constructor(){super(new Yo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*l2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},$4e=class extends A2{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(en.DEFAULT_UP),this.updateMatrix(),this.target=new en,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new X4e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},fB=new De,P2=new T,Xx=new T,Q4e=class extends qx{constructor(){super(new Yo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new $(4,2),this._viewportCount=6,this._viewports=[new Ut(2,1,1,1),new Ut(0,1,1,1),new Ut(3,1,1,1),new Ut(1,1,1,1),new Ut(3,0,1,1),new Ut(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),P2.setFromMatrixPosition(e.matrixWorld),i.position.copy(P2),Xx.copy(i.position),Xx.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Xx),i.updateMatrixWorld(),n.makeTranslation(-P2.x,-P2.y,-P2.z),fB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fB)}},Z4e=class extends A2{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Q4e}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},K4e=class extends qx{constructor(){super(new Sx(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},J4e=class extends A2{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(en.DEFAULT_UP),this.updateMatrix(),this.target=new en,this.shadow=new K4e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},mB=class extends gt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},gB=class extends D2{constructor(e){super(e)}load(e,t,i,n){let r=this,o=new Gx(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(s){try{t(r.parse(JSON.parse(s)))}catch(a){n?n(a):console.error(a),r.manager.itemError(e)}},i,n)}parse(e){let t={},i={};function n(u,d){if(void 0!==t[d])return t[d];let p=u.interleavedBuffers[d],f=function r(u,d){if(void 0!==i[d])return i[d];let f=new Uint32Array(u.arrayBuffers[d]).buffer;return i[d]=f,f}(u,p.buffer),m=Tv(p.type,f),g=new n4e(m,p.stride);return g.uuid=p.uuid,t[d]=g,g}let o=e.isInstancedBufferGeometry?new mB:new gt,s=e.data.index;if(void 0!==s){let u=Tv(s.type,s.array);o.setIndex(new It(u,1))}let a=e.data.attributes;for(let u in a){let p,d=a[u];if(d.isInterleavedBufferAttribute){let f=n(e.data,d.data);p=new Px(f,d.itemSize,d.offset,d.normalized)}else{let f=Tv(d.type,d.array);p=new(d.isInstancedBufferAttribute?b2:It)(f,d.itemSize,d.normalized)}void 0!==d.name&&(p.name=d.name),void 0!==d.usage&&p.setUsage(d.usage),void 0!==d.updateRange&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),o.setAttribute(u,p)}let l=e.data.morphAttributes;if(l)for(let u in l){let d=l[u],p=[];for(let f=0,m=d.length;f<m;f++){let v,g=d[f];if(g.isInterleavedBufferAttribute){let y=n(e.data,g.data);v=new Px(y,g.itemSize,g.offset,g.normalized)}else{let y=Tv(g.type,g.array);v=new It(y,g.itemSize,g.normalized)}void 0!==g.name&&(v.name=g.name),p.push(v)}o.morphAttributes[u]=p}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let u=0,d=c.length;u!==d;++u){let p=c[u];o.addGroup(p.start,p.count,p.materialIndex)}let h=e.data.boundingSphere;if(void 0!==h){let u=new T;void 0!==h.center&&u.fromArray(h.center),o.boundingSphere=new Ps(u,h.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}};function vB(){return(typeof performance>"u"?Date:performance).now()}var t3e=class{constructor(e,t,i){let n,r,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,o=this.cumulativeWeight;if(0===o){for(let s=0;s!==n;++s)i[r+s]=i[s];o=t}else o+=t,this._mixBufferRegion(i,r,0,t/o,n);this.cumulativeWeight=o}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1&&this._mixBufferRegion(i,n,t*this._origIndex,1-r,t),o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(i[a]!==i[a+t]){s.setValue(i,n);break}}saveOriginalState(){let t=this.buffer,i=this.valueSize,n=i*this._origIndex;this.binding.getValue(t,n);for(let r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,n){qt.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let o=this._workIndex*r;qt.multiplyQuaternionsFlat(e,o,e,t,e,i),qt.slerpFlat(e,t,e,t,e,o,n)}_lerp(e,t,i,n,r){let o=1-n;for(let s=0;s!==r;++s){let a=t+s;e[a]=e[a]*o+e[i+s]*n}}_lerpAdditive(e,t,i,n,r){for(let o=0;o!==r;++o){let s=t+o;e[s]=e[s]+e[i+o]*n}}},$x="\\[\\]\\.:\\/",i3e=new RegExp("["+$x+"]","g"),Qx="[^"+$x+"]",n3e="[^"+$x.replace("\\.","")+"]",r3e=/((?:WC+[\/:])*)/.source.replace("WC",Qx),o3e=/(WCOD+)?/.source.replace("WCOD",n3e),s3e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Qx),a3e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Qx),l3e=new RegExp("^"+r3e+o3e+s3e+a3e+"$"),c3e=["material","materials","bones","map"],vn=class{constructor(e,t,i){this.path=t,this.parsedPath=i||vn.parseTrackName(t),this.node=vn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new vn.Composite(e,t,i):new vn(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(i3e,"")}static parseTrackName(e){let t=l3e.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let r=i.nodeName.substring(n+1);-1!==c3e.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(r){for(let o=0;o<r.length;o++){let s=r[o];if(s.name===t||s.uuid===t)return s;let a=i(s.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=vn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==l){if(void 0===e[l])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[l]}}let o=e[n];if(void 0===o)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};vn.Composite=class{constructor(e,t,i){let n=i||vn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},vn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vn.prototype.GetterByBindingType=[vn.prototype._getValue_direct,vn.prototype._getValue_array,vn.prototype._getValue_arrayElement,vn.prototype._getValue_toArray],vn.prototype.SetterByBindingTypeAndVersioning=[[vn.prototype._setValue_direct,vn.prototype._setValue_direct_setNeedsUpdate,vn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_array,vn.prototype._setValue_array_setNeedsUpdate,vn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_arrayElement,vn.prototype._setValue_arrayElement_setNeedsUpdate,vn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_fromArray,vn.prototype._setValue_fromArray_setNeedsUpdate,vn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var d3e=new Float32Array(1),p3e=class extends wo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,s=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(let h=0;h!==r;++h){let u=n[h],d=u.name,p=c[d];if(void 0!==p)++p.referenceCount,o[h]=p;else{if(p=o[h],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}p=new t3e(vn.create(i,d,t&&t._propertyBindings[h].binding.parsedPath),u.ValueTypeName,u.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,a,d),o[h]=p}s[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{let s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,o=n[t];void 0===o&&(o={},n[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,s=o[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new cB(new Float32Array(2),new Float32Array(2),1,d3e),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,o="string"==typeof e?Yx.findByName(n,e):e,s=null!==o?o.uuid:e,a=this._actionsByClip[s],l=null;if(void 0===i&&(i=null!==o?o.blendMode:2500),void 0!==a){let h=a.actionByRoot[r];if(void 0!==h&&h.blendMode===i)return h;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;let c=new class{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,o=r.length,s=new Array(o),a={endingStart:Up,endingEnd:Up};for(let l=0;l!==o;++l){let c=r[l].createInterpolant(null);s[l]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let n=this._clip.duration,r=e._clip.duration,s=n/r;e.warp(1,r/n,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,o=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);let a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);let r=this._startTime;if(null!==r){let a=(e-r)*i;a<0||0===i?t=0:(this._startTime=null,t=i*a)}t*=this._updateTimeScale(e);let o=this._updateTime(t),s=this._updateWeight(e);if(s>0){let a=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(let c=0,h=a.length;c!==h;++c)a[c].evaluate(o),l[c].accumulateAdditive(s);else for(let c=0,h=a.length;c!==h;++c)a[c].evaluate(o),l[c].accumulate(n,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,o=i===qb;if(0===e)return-1===r?n:o&&1==(1&r)?t-n:n;if(i===RR){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),n>=t||n<0){let s=Math.floor(n/t);n-=t*s,r+=Math.abs(s);let a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=n;if(o&&1==(1&r))return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=jp,n.endingEnd=jp):(n.endingStart=e?this.zeroSlopeAtStart?jp:Up:2402,n.endingEnd=t?this.zeroSlopeAtEnd?jp:Up:2402)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);let s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=i,this}}(this,o,t,i);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r="string"==typeof e?Yx.findByName(i,e):e,s=this._actionsByClip[r?r.uuid:e];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){let e=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)e[i].stop();return this}update(e){let t=this._actions,i=this._nActiveActions,n=this.time+=e*=this.timeScale,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,o);let s=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)s[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let o=r.knownActions;for(let s=0,a=o.length;s!==a;++s){let l=o[s];this._deactivateAction(l);let c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,t[c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let o in i){let a=i[o].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}let r=this._bindingsByRootAndName[t];if(void 0!==r)for(let o in r){let s=r[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Te=class{constructor(e){this.value=e}clone(){return new Te(void 0===this.value.clone?this.value:this.value.clone())}},yB=class{constructor(e,t,i=0,n=1/0){this.ray=new Xp(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new dx,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Zx(e,this,i,t),i.sort(_B),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)Zx(e[n],this,i,t);return i.sort(_B),i}};function _B(e,t){return e.distance-t.distance}function Zx(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){let r=e.children;for(let o=0,s=r.length;o<s;o++)Zx(r[o],t,i,!0)}}var bB=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Tr(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},xB=new $,wB=class{constructor(e=new $(1/0,1/0),t=new $(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=xB.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xB.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},CB=new T,d8=new T,Ca=class{constructor(e=new T,t=new T){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){CB.subVectors(e,this.start),d8.subVectors(this.end,this.start);let i=d8.dot(d8),n=d8.dot(CB)/i;return t&&(n=Tr(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},SB=new T,f3e=class extends en{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new gt,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){let l=o/a*Math.PI*2,c=s/a*Math.PI*2;n.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Ke(n,3));let r=new au({fog:!1,toneMapped:!1});this.cone=new w2(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),SB.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(SB),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},m3e=class extends Dr{constructor(e,t,i){super(new ff(t,4,2),new Rd({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},MB=new T,p8=new T,zB=new T,g3e=class extends en{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new gt;n.setAttribute("position",new Ke([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new au({fog:!1,toneMapped:!1});this.lightPlane=new Zv(n,r),this.add(this.lightPlane),n=new gt,n.setAttribute("position",new Ke([0,0,0,0,0,1],3)),this.targetLine=new Zv(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),MB.setFromMatrixPosition(this.light.matrixWorld),p8.setFromMatrixPosition(this.light.target.matrixWorld),zB.subVectors(p8,MB),this.lightPlane.lookAt(p8),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(p8),this.targetLine.scale.z=zB.length()}},f8=new T,ir=new Fd,m8=class extends w2{constructor(e){let t=new gt,i=new au({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],o={};function s(p,f){a(p),a(f)}function a(p){n.push(0,0,0),r.push(0,0,0),void 0===o[p]&&(o[p]=[]),o[p].push(n.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new Ke(n,3)),t.setAttribute("color",new Ke(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();let l=new Ct(16755200),c=new Ct(16711680),h=new Ct(43775),u=new Ct(16777215),d=new Ct(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,i,n,r){let o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,i.r,i.g,i.b),o.setXYZ(33,i.r,i.g,i.b),o.setXYZ(34,i.r,i.g,i.b),o.setXYZ(35,i.r,i.g,i.b),o.setXYZ(36,i.r,i.g,i.b),o.setXYZ(37,i.r,i.g,i.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;ir.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pr("c",t,e,ir,0,0,-1),pr("t",t,e,ir,0,0,1),pr("n1",t,e,ir,-1,-1,-1),pr("n2",t,e,ir,1,-1,-1),pr("n3",t,e,ir,-1,1,-1),pr("n4",t,e,ir,1,1,-1),pr("f1",t,e,ir,-1,-1,1),pr("f2",t,e,ir,1,-1,1),pr("f3",t,e,ir,-1,1,1),pr("f4",t,e,ir,1,1,1),pr("u1",t,e,ir,.7,1.1,-1),pr("u2",t,e,ir,-.7,1.1,-1),pr("u3",t,e,ir,0,2,-1),pr("cf1",t,e,ir,-1,0,1),pr("cf2",t,e,ir,1,0,1),pr("cf3",t,e,ir,0,-1,1),pr("cf4",t,e,ir,0,1,1),pr("cn1",t,e,ir,-1,0,-1),pr("cn2",t,e,ir,1,0,-1),pr("cn3",t,e,ir,0,-1,-1),pr("cn4",t,e,ir,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function pr(e,t,i,n,r,o,s){f8.set(r,o,s).unproject(n);let a=t[e];if(void 0!==a){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],f8.x,f8.y,f8.z)}}var g8=class extends w2{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new gt;r.setIndex(new It(i,1)),r.setAttribute("position",new Ke([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new au({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},v3e=class extends w2{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new gt;n.setAttribute("position",new Ke(t,3)),n.setAttribute("color",new Ke([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new au({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){let n=new Ct,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},lh=function y3e(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):c<-14?(n[l]=1024>>-c-14,n[256|l]=1024>>-c-14|32768,r[l]=-c-1,r[256|l]=-c-1):c<=15?(n[l]=c+15<<10,n[256|l]=c+15<<10|32768,r[l]=13,r[256|l]=13):c<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}let o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(8388608&c);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,o[l]=c|h}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:o,exponentTable:s,offsetTable:a}}(),x3e=Object.freeze({__proto__:null,fromHalfFloat:function b3e(e){let t=e>>10;return lh.uint32View[0]=lh.mantissaTable[lh.offsetTable[t]+(1023&e)]+lh.exponentTable[t],lh.floatView[0]},toHalfFloat:function _3e(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Tr(e,-65504,65504),lh.floatView[0]=e;let t=lh.uint32View[0],i=t>>23&511;return lh.baseTable[i]+((8388607&t)>>lh.shiftTable[i])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Bp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Bp);var Kx=Symbol("target"),TB=Symbol("unsubscribe");function Jx(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Wl=Array.isArray;function ew(e){return"symbol"==typeof e}var C3e={after:(e,t)=>Wl(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(e,t)=>Wl(e)?(e=[...e],t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+="."),ew(t)?e+t.toString():e+t):e,initial:e=>{if(Wl(e))return e.slice(0,-1);if(""===e)return e;let t=e.lastIndexOf(".");return-1===t?"":e.slice(0,t)},last:e=>{if(Wl(e))return e[e.length-1]||"";if(""===e)return e;let t=e.lastIndexOf(".");return-1===t?e:e.slice(t+1)},walk:(e,t)=>{if(Wl(e))for(let i of e)t(i);else if(""!==e){let i=0,n=e.indexOf(".");if(-1===n)t(e);else for(;i<e.length;)-1===n&&(n=e.length),t(e.slice(i,n)),i=n+1,n=e.indexOf(".",i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Sa=C3e;function EB(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&ew(i)||t.ignoreUnderscores&&"_"===i.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}function tw(e){return"[object Object]"===toString.call(e)}function v8(){return!0}function vf(e,t){return e.length!==t.length||e.some((i,n)=>t[n]!==i)}var DB=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),T3e=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),AB={push:v8,pop:v8,shift:v8,unshift:v8,copyWithin:vf,reverse:vf,sort:vf,splice:vf,flat:vf,fill:vf},E3e=new Set([...DB,...T3e,...Object.keys(AB)]);function y8(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var PB=["keys","values","entries"],IB=new Set(["has","toString"]),OB={add:y8,clear:y8,delete:y8,forEach:y8},D3e=new Set([...IB,...Object.keys(OB),...PB]);function _8(e,t){if(e.size!==t.size)return!0;let i;for(let[n,r]of e)if(i=t.get(n),i!==r||void 0===i&&!t.has(n))return!0;return!1}var A3e=new Set([...IB,"get"]),kB={set:_8,clear:_8,delete:_8,forEach:_8},P3e=new Set([...A3e,...Object.keys(kB),...PB]),hu=class{constructor(e,t,i,n){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return DB.has(e)}_shallowClone(e){let t=e;if(tw(e))t={...e};else if(Wl(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,n]of e.entries())t.set(i,this._shallowClone(n))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,n){return e?(Wl(n)?this._onIsChanged=AB[t]:n instanceof Set?this._onIsChanged=OB[t]:n instanceof Map&&(this._onIsChanged=kB[t]),n):i}update(e,t,i){let n=Sa.after(e,this._path);if("length"!==t){let r=this.clone;Sa.walk(n,o=>{r&&r[o]&&(this._clonedCache.has(r[o])||(r[o]=this._shallowClone(r[o])),r=r[o])}),this._hasOnValidate&&this._changes.push({path:n,property:t,previous:i}),r&&r[t]&&(r[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;-1!==i;i--)t=this._changes[i],Sa.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}},NB=class extends hu{static isHandledMethod(e){return E3e.has(e)}},I3e=class extends hu{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},LB=class extends hu{static isHandledMethod(e){return D3e.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},RB=class extends hu{static isHandledMethod(e){return P3e.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},O3e=class extends hu{constructor(e,t,i,n){super(void 0,t,i,n),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},k3e=class extends hu{constructor(e,t,i,n){super(void 0,t,i,n),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},yf=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return tw(e)||Wl(e)||Jx(e)}static isHandledMethod(e,t){return tw(e)?hu.isHandledMethod(t):Wl(e)?NB.isHandledMethod(t):e instanceof Set?LB.isHandledMethod(t):e instanceof Map?RB.isHandledMethod(t):Jx(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let n=hu;Wl(e)?n=NB:e instanceof Date?n=I3e:e instanceof Set?n=LB:e instanceof Map?n=RB:e instanceof WeakSet?n=O3e:e instanceof WeakMap&&(n=k3e),this._stack.push(new n(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:n}=e,r=yf.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},N3e={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},iw=(e,t,i={})=>{i={...N3e,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:o,ignoreDetached:s,details:a}=i,l=new class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),n=i[t];return void 0===n&&(n=Reflect.getOwnPropertyDescriptor(e,t),i[t]=n),n}getProxy(e,t,i,n){if(this.isUnsubscribed)return e;let r=e[n],o=r||e;this._pathCache.set(o,t);let s=this._proxyCache.get(o);return void 0===s&&(s=void 0===r?new Proxy(e,i):e,this._proxyCache.set(o,s)),s}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Sa.get(t,this.getPath(e)))}defineProperty(e,t,i){return!!Reflect.defineProperty(e,t,i)&&(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0)}setProperty(e,t,i,n,r){if(!this._equals(r,i)||!(t in e)){let o=this._getOwnPropertyDescriptor(e,t);return void 0!==o&&"set"in o?Reflect.set(e,t,i,n):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(e);n&&(delete n[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let n=this._getOwnPropertyDescriptor(t,i);return void 0!==e&&void 0!==n&&Object.is(e.value,n.value)&&(e.writable||!1)===(n.writable||!1)&&(e.enumerable||!1)===(n.enumerable||!1)&&(e.configurable||!1)===(n.configurable||!1)&&e.get===n.get&&e.set===n.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return void 0!==i&&!0!==i.configurable&&!0!==i.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}(r),c="function"==typeof i.onValidate,h=new yf(c),u=(y,_,b,x,w)=>!c||h.isCloning||!0===i.onValidate(Sa.concat(l.getPath(y),_),b,x,w),d=(y,_,b,x)=>{!EB(l,i,_)&&(!s||!l.isDetached(y,e))&&p(l.getPath(y),_,b,x)},p=(y,_,b,x,w)=>{h.isCloning?h.update(y,_,x):t(Sa.concat(y,_),b,x,w)},f=y=>y&&(y[n]||y),m=(y,_,b,x)=>function w3e(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(y)||"constructor"===b||o&&!yf.isHandledMethod(_,b)||EB(l,i,b)||l.isGetInvariant(_,b)||s&&l.isDetached(_,e)?y:(void 0===x&&(x=l.getPath(_)),l.getProxy(y,Sa.concat(x,b),g,n)),g={get(y,_,b){if(ew(_)){if(_===n||_===Kx)return y;if(_===TB&&!l.isUnsubscribed&&0===l.getPath(y).length)return l.unsubscribe(),y}let x=Jx(y)?Reflect.get(y,_):Reflect.get(y,_,b);return m(x,y,_)},set(y,_,b,x){b=f(b);let w=y[n]||y,S=w[_];if(r(S,b)&&_ in y)return!0;let C=u(y,_,b,S);return C&&l.setProperty(w,_,b,x,S)?(d(y,_,y[_],S),!0):!C},defineProperty(y,_,b){if(!l.isSameDescriptor(b,y,_)){let x=y[_];u(y,_,b.value,x)&&l.defineProperty(y,_,b,x)&&d(y,_,b.value,x)}return!0},deleteProperty(y,_){if(!Reflect.has(y,_))return!0;let b=Reflect.get(y,_),x=u(y,_,void 0,b);return x&&l.deleteProperty(y,_,b)?(d(y,_,void 0,b),!0):!x},apply(y,_,b){let x=_[n]||_;if(l.isUnsubscribed)return Reflect.apply(y,x,b);if((!1===a||!0!==a&&!a.includes(y.name))&&yf.isHandledType(x)){let w=Sa.initial(l.getPath(y)),S=yf.isHandledMethod(x,y.name);h.start(x,w,b);let C=Reflect.apply(y,h.preferredThisArg(y,_,x),S?b.map(E=>f(E)):b),M=h.isChanged(x,r),z=h.stop();if(yf.isHandledType(C)&&S&&(_ instanceof Map&&"get"===y.name&&(w=Sa.concat(w,b[0])),C=l.getProxy(C,w,g)),M){let E={name:y.name,args:b,result:C},D=h.isCloning?Sa.initial(w):w,P=h.isCloning?Sa.last(w):"";u(Sa.get(e,D),P,x,z,E)?p(D,P,x,z,E):h.undo(x)}return(_ instanceof Map||_ instanceof Set)&&function S3e(e){return"object"==typeof e&&"function"==typeof e.next}(C)?function M3e(e,t,i,n,r){let o=e.next;if("entries"===t.name)e.next=function(){let s=o.call(this);return!1===s.done&&(s.value[0]=r(s.value[0],t,s.value[0],n),s.value[1]=r(s.value[1],t,s.value[0],n)),s};else if("values"===t.name){let s=i[Kx].keys();e.next=function(){let a=o.call(this);return!1===a.done&&(a.value=r(a.value,t,s.next().value,n)),a}}else e.next=function(){let s=o.call(this);return!1===s.done&&(s.value=r(s.value,t,s.value,n)),s};return e}(C,y,_,w,m):C}return Reflect.apply(y,_,b)}},v=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};iw.target=e=>e&&e[Kx]||e,iw.unsubscribe=e=>e[TB]||e;var e,FB=iw,BB="object"==typeof global&&global&&global.Object===Object&&global,R3e="object"==typeof self&&self&&self.Object===Object&&self,al=BB||R3e||Function("return this")(),Ma=al.Symbol,VB=Object.prototype,V3e=VB.hasOwnProperty,H3e=VB.toString,O2=Ma?Ma.toStringTag:void 0,G3e=Object.prototype.toString,HB=Ma?Ma.toStringTag:void 0,Yd=function Q3e(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":HB&&HB in Object(e)?function U3e(e){var t=V3e.call(e,O2),i=e[O2];try{e[O2]=void 0;var n=!0}catch{}var r=H3e.call(e);return n&&(t?e[O2]=i:delete e[O2]),r}(e):function W3e(e){return G3e.call(e)}(e)},ch=function Z3e(e){return null!=e&&"object"==typeof e},b8=function J3e(e){return"symbol"==typeof e||ch(e)&&"[object Symbol]"==Yd(e)},UB=function ege(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r},ql=Array.isArray,jB=Ma?Ma.prototype:void 0,YB=jB?jB.toString:void 0,nge=function GB(e){if("string"==typeof e)return e;if(ql(e))return UB(e,GB)+"";if(b8(e))return YB?YB.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t},rge=/\s/,age=/^\s+/,cge=function lge(e){return e&&e.slice(0,function oge(e){for(var t=e.length;t--&&rge.test(e.charAt(t)););return t}(e)+1).replace(age,"")},ll=function hge(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},uge=/^[-+]0x[0-9a-f]+$/i,dge=/^0b[01]+$/i,pge=/^0o[0-7]+$/i,fge=parseInt,qB=function mge(e){if("number"==typeof e)return e;if(b8(e))return NaN;if(ll(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ll(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=cge(e);var i=dge.test(e);return i||pge.test(e)?fge(e.slice(2),i?2:8):uge.test(e)?NaN:+e},XB=function wge(e){if(!ll(e))return!1;var t=Yd(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Cge=al["__core-js_shared__"],$B=(e=/[^.]+$/.exec(Cge&&Cge.keys&&Cge.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"",Tge=Function.prototype.toString,Gd=function Ege(e){if(null!=e){try{return Tge.call(e)}catch{}try{return e+""}catch{}}return""},Age=/^\[object .+?Constructor\]$/,Nge=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rge=function Lge(e){return!(!ll(e)||function Sge(e){return!!$B&&$B in e}(e))&&(XB(e)?Nge:Age).test(Gd(e))},Wd=function Vge(e,t){var i=function Fge(e,t){return e?.[t]}(e,t);return Rge(i)?i:void 0},rw=Wd(al,"WeakMap"),QB=Object.create,Uge=function(){function e(){}return function(t){if(!ll(t))return{};if(QB)return QB(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),jge=Uge,Gge=function Yge(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)},Xge=800,$ge=16,Qge=Date.now,eve=function Jge(e){return function(){return e}},tve=function(){try{var e=Wd(Object,"defineProperty");return e({},"",{}),e}catch{}}(),x8=tve,ive=x8?function(e,t){return x8(e,"toString",{configurable:!0,enumerable:!1,value:eve(t),writable:!0})}:function gge(e){return e},ove=function Zge(e){var t=0,i=0;return function(){var n=Qge(),r=$ge-(n-i);if(i=n,r>0){if(++t>=Xge)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(ive),cve=/^(?:0|[1-9]\d*)$/,ow=function hve(e,t){var i=typeof e;return!!(t=t??9007199254740991)&&("number"==i||"symbol"!=i&&cve.test(e))&&e>-1&&e%1==0&&e<t},ZB=function uve(e,t,i){"__proto__"==t&&x8?x8(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i},sw=function dve(e,t){return e===t||e!=e&&t!=t},fve=Object.prototype.hasOwnProperty,aw=function mve(e,t,i){var n=e[t];(!fve.call(e,t)||!sw(n,i)||void 0===i&&!(t in e))&&ZB(e,t,i)},k2=function gve(e,t,i,n){var r=!i;i||(i={});for(var o=-1,s=t.length;++o<s;){var a=t[o],l=n?n(i[a],e[a],a,i,e):void 0;void 0===l&&(l=e[a]),r?ZB(i,a,l):aw(i,a,l)}return i},KB=Math.max,lw=function bve(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},JB=function xve(e){return null!=e&&lw(e.length)&&!XB(e)},wve=Object.prototype,cw=function Cve(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||wve)},eV=function Tve(e){return ch(e)&&"[object Arguments]"==Yd(e)},tV=Object.prototype,Eve=tV.hasOwnProperty,Dve=tV.propertyIsEnumerable,Ave=eV(function(){return arguments}())?eV:function(e){return ch(e)&&Eve.call(e,"callee")&&!Dve.call(e,"callee")},hw=Ave,iV="object"==typeof exports&&exports&&!exports.nodeType&&exports,nV=iV&&"object"==typeof module&&module&&!module.nodeType&&module,rV=nV&&nV.exports===iV?al.Buffer:void 0,w8=(rV?rV.isBuffer:void 0)||function Pve(){return!1},Fn={};Fn["[object Float32Array]"]=Fn["[object Float64Array]"]=Fn["[object Int8Array]"]=Fn["[object Int16Array]"]=Fn["[object Int32Array]"]=Fn["[object Uint8Array]"]=Fn["[object Uint8ClampedArray]"]=Fn["[object Uint16Array]"]=Fn["[object Uint32Array]"]=!0,Fn["[object Arguments]"]=Fn["[object Array]"]=Fn["[object ArrayBuffer]"]=Fn["[object Boolean]"]=Fn["[object DataView]"]=Fn["[object Date]"]=Fn["[object Error]"]=Fn["[object Function]"]=Fn["[object Map]"]=Fn["[object Number]"]=Fn["[object Object]"]=Fn["[object RegExp]"]=Fn["[object Set]"]=Fn["[object String]"]=Fn["[object WeakMap]"]=!1;var uw=function l8e(e){return function(t){return e(t)}},oV="object"==typeof exports&&exports&&!exports.nodeType&&exports,N2=oV&&"object"==typeof module&&module&&!module.nodeType&&module,dw=N2&&N2.exports===oV&&BB.process,_f=function(){try{return N2&&N2.require&&N2.require("util").types||dw&&dw.binding&&dw.binding("util")}catch{}}(),sV=_f&&_f.isTypedArray,aV=sV?uw(sV):function s8e(e){return ch(e)&&lw(e.length)&&!!Fn[Yd(e)]},p8e=Object.prototype.hasOwnProperty,lV=function f8e(e,t){var i=ql(e),n=!i&&hw(e),r=!i&&!n&&w8(e),o=!i&&!n&&!r&&aV(e),s=i||n||r||o,a=s?function Sve(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=a.length;for(var c in e)(t||p8e.call(e,c))&&(!s||!("length"==c||r&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ow(c,l)))&&a.push(c);return a},cV=function m8e(e,t){return function(i){return e(t(i))}},v8e=cV(Object.keys,Object),_8e=Object.prototype.hasOwnProperty,pw=function w8e(e){return JB(e)?lV(e):function b8e(e){if(!cw(e))return v8e(e);var t=[];for(var i in Object(e))_8e.call(e,i)&&"constructor"!=i&&t.push(i);return t}(e)},z8e=Object.prototype.hasOwnProperty,E8e=function T8e(e){if(!ll(e))return function C8e(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=cw(e),i=[];for(var n in e)"constructor"==n&&(t||!z8e.call(e,n))||i.push(n);return i},qd=function D8e(e){return JB(e)?lV(e,!0):E8e(e)},A8e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,P8e=/^\w*$/,L2=Wd(Object,"create"),H8e=Object.prototype.hasOwnProperty,G8e=Object.prototype.hasOwnProperty;function bf(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}bf.prototype.clear=function N8e(){this.__data__=L2?L2(null):{},this.size=0},bf.prototype.delete=function R8e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},bf.prototype.get=function U8e(e){var t=this.__data__;if(L2){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return H8e.call(t,e)?t[e]:void 0},bf.prototype.has=function W8e(e){var t=this.__data__;return L2?void 0!==t[e]:G8e.call(t,e)},bf.prototype.set=function $8e(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=L2&&void 0===t?"__lodash_hash_undefined__":t,this};var hV=bf,C8=function J8e(e,t){for(var i=e.length;i--;)if(sw(e[i][0],t))return i;return-1},t6e=Array.prototype.splice;function xf(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}xf.prototype.clear=function Z8e(){this.__data__=[],this.size=0},xf.prototype.delete=function i6e(e){var t=this.__data__,i=C8(t,e);return!(i<0||(i==t.length-1?t.pop():t6e.call(t,i,1),--this.size,0))},xf.prototype.get=function r6e(e){var t=this.__data__,i=C8(t,e);return i<0?void 0:t[i][1]},xf.prototype.has=function s6e(e){return C8(this.__data__,e)>-1},xf.prototype.set=function l6e(e,t){var i=this.__data__,n=C8(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var S8=xf,R2=Wd(al,"Map"),M8=function m6e(e,t){var i=e.__data__;return function p6e(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map};function wf(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}wf.prototype.clear=function u6e(){this.size=0,this.__data__={hash:new hV,map:new(R2||S8),string:new hV}},wf.prototype.delete=function g6e(e){var t=M8(this,e).delete(e);return this.size-=t?1:0,t},wf.prototype.get=function y6e(e){return M8(this,e).get(e)},wf.prototype.has=function b6e(e){return M8(this,e).has(e)},wf.prototype.set=function w6e(e,t){var i=M8(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var z8=wf,S6e="Expected a function";function fw(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(S6e);var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],o=i.cache;if(o.has(r))return o.get(r);var s=e.apply(this,n);return i.cache=o.set(r,s)||o,s};return i.cache=new(fw.Cache||z8),i}fw.Cache=z8;var M6e=fw,D6e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,A6e=/\\(\\)?/g,P6e=function T6e(e){var t=M6e(e,function(n){return 500===i.size&&i.clear(),n}),i=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(D6e,function(i,n,r,o){t.push(r?o.replace(A6e,"$1"):n||i)}),t}),I6e=P6e,k6e=function O6e(e){return null==e?"":nge(e)},Cf=function N6e(e,t){return ql(e)?e:function I8e(e,t){if(ql(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!b8(e))||P8e.test(e)||!A8e.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:I6e(k6e(e))},T8=function R6e(e){if("string"==typeof e||b8(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t},uV=function F6e(e,t){for(var i=0,n=(t=Cf(t,e)).length;null!=e&&i<n;)e=e[T8(t[i++])];return i&&i==n?e:void 0},mw=function B6e(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e},dV=Ma?Ma.isConcatSpreadable:void 0,H6e=function V6e(e){return ql(e)||hw(e)||!!(dV&&e&&e[dV])},U6e=function pV(e,t,i,n,r){var o=-1,s=e.length;for(i||(i=H6e),r||(r=[]);++o<s;){var a=e[o];t>0&&i(a)?t>1?pV(a,t-1,i,n,r):mw(r,a):n||(r[r.length]=a)}return r},Y6e=function j6e(e){return null!=e&&e.length?U6e(e,1):[]},fV=function G6e(e){return ove(function vve(e,t,i){return t=KB(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=KB(n.length-t,0),s=Array(o);++r<o;)s[r]=n[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=n[r];return a[t]=i(s),Gge(e,this,a)}}(e,void 0,Y6e),e+"")},gw=cV(Object.getPrototypeOf,Object),mV=Function.prototype.toString,Q6e=Object.prototype.hasOwnProperty,Z6e=mV.call(Object);function Sf(e){var t=this.__data__=new S8(e);this.size=t.size}Sf.prototype.clear=function iye(){this.__data__=new S8,this.size=0},Sf.prototype.delete=function rye(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Sf.prototype.get=function sye(e){return this.__data__.get(e)},Sf.prototype.has=function lye(e){return this.__data__.has(e)},Sf.prototype.set=function uye(e,t){var i=this.__data__;if(i instanceof S8){var n=i.__data__;if(!R2||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new z8(n)}return i.set(e,t),this.size=i.size,this};var E8=Sf,gV="object"==typeof exports&&exports&&!exports.nodeType&&exports,vV=gV&&"object"==typeof module&&module&&!module.nodeType&&module,yV=vV&&vV.exports===gV?al.Buffer:void 0,_V=yV?yV.allocUnsafe:void 0,bV=function wye(){return[]},Sye=Object.prototype.propertyIsEnumerable,xV=Object.getOwnPropertySymbols,Mye=xV?function(e){return null==e?[]:(e=Object(e),function bye(e,t){for(var i=-1,n=null==e?0:e.length,r=0,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[r++]=s)}return o}(xV(e),function(t){return Sye.call(e,t)}))}:bV,vw=Mye,Dye=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)mw(t,vw(e)),e=gw(e);return t}:bV,wV=Dye,CV=function Iye(e,t,i){var n=t(e);return ql(e)?n:mw(n,i(e))},yw=function Oye(e){return CV(e,pw,vw)},SV=function kye(e){return CV(e,qd,wV)},_w=Wd(al,"DataView"),bw=Wd(al,"Promise"),xw=Wd(al,"Set"),MV="[object Map]",zV="[object Promise]",TV="[object Set]",EV="[object WeakMap]",DV="[object DataView]",Bye=Gd(_w),Vye=Gd(R2),Hye=Gd(bw),Uye=Gd(xw),jye=Gd(rw),Xd=Yd;(_w&&Xd(new _w(new ArrayBuffer(1)))!=DV||R2&&Xd(new R2)!=MV||bw&&Xd(bw.resolve())!=zV||xw&&Xd(new xw)!=TV||rw&&Xd(new rw)!=EV)&&(Xd=function(e){var t=Yd(e),i="[object Object]"==t?e.constructor:void 0,n=i?Gd(i):"";if(n)switch(n){case Bye:return DV;case Vye:return MV;case Hye:return zV;case Uye:return TV;case jye:return EV}return t});var F2=Xd,Gye=Object.prototype.hasOwnProperty,D8=al.Uint8Array,ww=function $ye(e){var t=new e.constructor(e.byteLength);return new D8(t).set(new D8(e)),t},Kye=/\w*$/,AV=Ma?Ma.prototype:void 0,PV=AV?AV.valueOf:void 0,M5e=function S5e(e,t,i){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return ww(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return function Qye(e,t){var i=t?ww(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function n5e(e,t){var i=t?ww(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,i);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return function Jye(e){var t=new e.constructor(e.source,Kye.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return function t5e(e){return PV?Object(PV.call(e)):{}}(e)}},IV=_f&&_f.isMap,I5e=IV?uw(IV):function D5e(e){return ch(e)&&"[object Map]"==F2(e)},OV=_f&&_f.isSet,R5e=OV?uw(OV):function k5e(e){return ch(e)&&"[object Set]"==F2(e)},kV="[object Arguments]",NV="[object Function]",LV="[object Object]",An={};An[kV]=An["[object Array]"]=An["[object ArrayBuffer]"]=An["[object DataView]"]=An["[object Boolean]"]=An["[object Date]"]=An["[object Float32Array]"]=An["[object Float64Array]"]=An["[object Int8Array]"]=An["[object Int16Array]"]=An["[object Int32Array]"]=An["[object Map]"]=An["[object Number]"]=An[LV]=An["[object RegExp]"]=An["[object Set]"]=An["[object String]"]=An["[object Symbol]"]=An["[object Uint8Array]"]=An["[object Uint8ClampedArray]"]=An["[object Uint16Array]"]=An["[object Uint32Array]"]=!0,An["[object Error]"]=An[NV]=An["[object WeakMap]"]=!1;var RV=function A8(e,t,i,n,r,o){var s,a=1&t,l=2&t,c=4&t;if(i&&(s=r?i(e,n,r,o):i(e)),void 0!==s)return s;if(!ll(e))return e;var h=ql(e);if(h){if(s=function Wye(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Gye.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!a)return function Wge(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}(e,s)}else{var u=F2(e),d=u==NV||"[object GeneratorFunction]"==u;if(w8(e))return function yye(e,t){if(t)return e.slice();var i=e.length,n=_V?_V(i):new e.constructor(i);return e.copy(n),n}(e,a);if(u==LV||u==kV||d&&!r){if(s=l||d?{}:function z5e(e){return"function"!=typeof e.constructor||cw(e)?{}:jge(gw(e))}(e),!a)return l?function Aye(e,t){return k2(e,wV(e),t)}(e,function mye(e,t){return e&&k2(t,qd(t),e)}(s,e)):function zye(e,t){return k2(e,vw(e),t)}(e,function pye(e,t){return e&&k2(t,pw(t),e)}(s,e))}else{if(!An[u])return r?e:{};s=M5e(e,u,a)}}o||(o=new E8);var p=o.get(e);if(p)return p;o.set(e,s),R5e(e)?e.forEach(function(g){s.add(A8(g,t,i,g,e,o))}):I5e(e)&&e.forEach(function(g,v){s.set(v,A8(g,t,i,v,e,o))});var m=h?void 0:(c?l?SV:yw:l?qd:pw)(e);return function sve(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););}(m||e,function(g,v){m&&(g=e[v=g]),aw(s,v,A8(g,t,i,v,e,o))}),s},P8=function d7e(e){return RV(e,5)};function I8(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new z8;++t<i;)this.add(e[t])}I8.prototype.add=I8.prototype.push=function f7e(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},I8.prototype.has=function g7e(e){return this.__data__.has(e)};var y7e=I8,b7e=function _7e(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1},w7e=function x7e(e,t){return e.has(t)},FV=function M7e(e,t,i,n,r,o){var s=1&i,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e),h=o.get(t);if(c&&h)return c==t&&h==e;var u=-1,d=!0,p=2&i?new y7e:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var f=e[u],m=t[u];if(n)var g=s?n(m,f,u,t,e,o):n(f,m,u,e,t,o);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!b7e(t,function(v,y){if(!w7e(p,y)&&(f===v||r(f,v,i,n,o)))return p.push(y)})){d=!1;break}}else if(f!==m&&!r(f,m,i,n,o)){d=!1;break}}return o.delete(e),o.delete(t),d},T7e=function z7e(e){var t=-1,i=Array(e.size);return e.forEach(function(n,r){i[++t]=[r,n]}),i},D7e=function E7e(e){var t=-1,i=Array(e.size);return e.forEach(function(n){i[++t]=n}),i},BV=Ma?Ma.prototype:void 0,Cw=BV?BV.valueOf:void 0,q7e=Object.prototype.hasOwnProperty,VV="[object Arguments]",HV="[object Array]",O8="[object Object]",UV=Object.prototype.hasOwnProperty,J7e=function K7e(e,t,i,n,r,o){var s=ql(e),a=ql(t),l=s?HV:F2(e),c=a?HV:F2(t),h=(l=l==VV?O8:l)==O8,u=(c=c==VV?O8:c)==O8,d=l==c;if(d&&w8(e)){if(!w8(t))return!1;s=!0,h=!1}if(d&&!h)return o||(o=new E8),s||aV(e)?FV(e,t,i,n,r,o):function j7e(e,t,i,n,r,o,s){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new D8(e),new D8(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return sw(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=T7e;case"[object Set]":if(a||(a=D7e),e.size!=t.size&&!(1&n))return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var h=FV(a(e),a(t),n,r,o,s);return s.delete(e),h;case"[object Symbol]":if(Cw)return Cw.call(e)==Cw.call(t)}return!1}(e,t,l,i,n,r,o);if(!(1&i)){var p=h&&UV.call(e,"__wrapped__"),f=u&&UV.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return o||(o=new E8),r(m,g,i,n,o)}}return!!d&&(o||(o=new E8),function X7e(e,t,i,n,r,o){var s=1&i,a=yw(e),l=a.length;if(l!=yw(t).length&&!s)return!1;for(var u=l;u--;){var d=a[u];if(!(s?d in t:q7e.call(t,d)))return!1}var p=o.get(e),f=o.get(t);if(p&&f)return p==t&&f==e;var m=!0;o.set(e,t),o.set(t,e);for(var g=s;++u<l;){var v=e[d=a[u]],y=t[d];if(n)var _=s?n(y,v,d,t,e,o):n(v,y,d,e,t,o);if(!(void 0===_?v===y||r(v,y,i,n,o):_)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var b=e.constructor,x=t.constructor;b!=x&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x)&&(m=!1)}return o.delete(e),o.delete(t),m}(e,t,i,n,r,o))},e_e=function jV(e,t,i,n,r){return e===t||(null==e||null==t||!ch(e)&&!ch(t)?e!=e&&t!=t:J7e(e,t,i,n,jV,r))},i_e=function t_e(e,t){return null!=e&&t in Object(e)},s_e=function o_e(e,t){return null!=e&&function n_e(e,t,i){for(var n=-1,r=(t=Cf(t,e)).length,o=!1;++n<r;){var s=T8(t[n]);if(!(o=null!=e&&i(e,s)))break;e=e[s]}return o||++n!=r?o:!!(r=null==e?0:e.length)&&lw(r)&&ow(s,r)&&(ql(e)||hw(e))}(e,t,i_e)},Sw=function(){return al.Date.now()},c_e=Math.max,h_e=Math.min,Mw=function u_e(e,t,i){var n,r,o,s,a,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(w){var S=n,C=r;return n=r=void 0,c=w,s=e.apply(C,S)}function g(w){var S=w-l;return void 0===l||S>=t||S<0||u&&w-c>=o}function v(){var w=Sw();if(g(w))return y(w);a=setTimeout(v,function m(w){var M=t-(w-l);return u?h_e(M,o-(w-c)):M}(w))}function y(w){return a=void 0,d&&n?p(w):(n=r=void 0,s)}function x(){var w=Sw(),S=g(w);if(n=arguments,r=this,l=w,S){if(void 0===a)return function f(w){return c=w,a=setTimeout(v,t),h?p(w):s}(l);if(u)return clearTimeout(a),a=setTimeout(v,t),p(l)}return void 0===a&&(a=setTimeout(v,t)),s}return t=qB(t)||0,ll(i)&&(h=!!i.leading,o=(u="maxWait"in i)?c_e(qB(i.maxWait)||0,t):o,d="trailing"in i?!!i.trailing:d),x.cancel=function _(){void 0!==a&&clearTimeout(a),c=0,n=l=r=a=void 0},x.flush=function b(){return void 0===a?s:y(Sw())},x},m_e=function f_e(e,t){return t.length<2?e:uV(e,function eye(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var o=Array(r);++n<r;)o[n]=e[n+t];return o}(t,0,-1))},YV=function g_e(e,t){return e_e(e,t)},y_e=function v_e(e,t){return t=Cf(t,e),null==(e=m_e(e,t))||delete e[T8(function d_e(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}(t))]},b_e=function __e(e){return function K6e(e){if(!ch(e)||"[object Object]"!=Yd(e))return!1;var t=gw(e);if(null===t)return!0;var i=Q6e.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&mV.call(i)==Z6e}(e)?void 0:e},S_e=fV(function(e,t){var i={};if(null==e)return i;var n=!1;t=UB(t,function(o){return o=Cf(o,e),n||(n=o.length>1),o}),k2(e,SV(e),i),n&&(i=RV(i,7,b_e));for(var r=t.length;r--;)y_e(i,t[r]);return i}),zw=S_e,z_e=function M_e(e,t,i,n){if(!ll(e))return e;for(var r=-1,o=(t=Cf(t,e)).length,s=o-1,a=e;null!=a&&++r<o;){var l=T8(t[r]),c=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=s){var h=a[l];void 0===(c=n?n(h,l,a):void 0)&&(c=ll(h)?h:ow(t[r+1])?[]:{})}aw(a,l,c),a=a[l]}return e},A_e=function D_e(e,t){return function T_e(e,t,i){for(var n=-1,r=t.length,o={};++n<r;){var s=t[n],a=uV(e,s);i(a,s)&&z_e(o,Cf(s,e),a)}return o}(e,t,function(i,n){return s_e(e,n)})},P_e=fV(function(e,t){return null==e?{}:A_e(e,t)}),hh=P_e;function GV(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function Xl(e,t){return Object.setPrototypeOf(e,t),e}!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/")&&(()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");e?window.localStorage.setItem("desktop-app-version",e):window.localStorage.getItem("desktop-app-version")})();var k8=!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),Tw=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||k8&&"ontouchend"in document),Y_e=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,ia=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),WV=(()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)})(),qV=Number((()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]})());function XV(e){return Array.isArray(e)?e:[e]}function $V(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function N8(e){return k8?e.metaKey:e.ctrlKey}var Ot=[],L8={},B2={},R8={};function QV(e){Ot.includes(e)||Ot.push(e)}function Mf(e){delete L8[e.pointerId];for(let t=0;t<Ot.length;t++)if(Ot[t].pointerId===e.pointerId){Ot.splice(t,1);break}}function F8(e){if("touch"!==e.pointerType)return;let t=L8[e.pointerId];void 0===t&&(t={x:0,y:0},L8[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function Ew(e){return L8[(e.pointerId===Ot[0].pointerId?Ot[1]:Ot[0]).pointerId]}function ZV(e){B2[e.key]=!0,R8[e.key]=void 0===R8[e.key]?1:R8[e.key]+1}function KV(e){if(k8&&B2.Meta)for(let t in B2)B2[t]=!1;else B2[e.key]=!1;R8={}}var JV,B8,$_e=new Promise(e=>{JV=e});function Q_e(){if(B8)return B8;function t(){return(t=(0,Dn.Z)(function*(){let n=mn.e(642).then(mn.bind(mn,642)),[r,o]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/navmesh-wasm@1.0.81/build/navmesh.wasm").then(l=>l.arrayBuffer())]),s=r.default,a=yield s({wasmBinary:o});JV(a)})).apply(this,arguments)}return B8=function e(){return t.apply(this,arguments)}(),B8}var eH,V8,Z_e=new Promise(e=>{eH=e});function K_e(){if(V8)return V8;function t(){return(t=(0,Dn.Z)(function*(){let i=yield mn.e(615).then(mn.bind(mn,615));yield i.init(),eH(i)})).apply(this,arguments)}return V8=function e(){return t.apply(this,arguments)}(),V8}var $t=class{modifyById(e,t){let i=this;if(void 0===i[e])throw new Error("not expected");{let n={...i,[e]:t};return Object.setPrototypeOf(n,$t.prototype),n}}add(e,t){return this.runOp({type:1,id:e,data:t})?.data??this}runOp(e){let t=this;if(1===e.type){let n,i=t[e.id];n=void 0===i?{type:2,id:e.id}:{type:1,id:e.id,data:i};let{id:r,data:o}=e,s={...t,[r]:o};return Object.setPrototypeOf(s,$t.prototype),{data:s,actual:e,reverse:n}}if(2===e.type){let{id:i}=e,n=t[i];if(void 0===n)return null;{let r={...t};return Object.setPrototypeOf(r,$t.prototype),delete r[i],{data:r,actual:e,reverse:{type:1,id:i,data:n}}}}return null}};function Dw(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let i of t){let n=e[i];n&&"object"==typeof n&&Dw(n)}return Object.freeze(e)}var tH=class extends Error{};function Aw(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function uu(e,t,i){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let o=e;e=t,t=o}let n=[],r=1/(i+1);for(let o=0;o<i;o++){let s=e+(t-e)*(o+.75+.5*Math.random())*r;n.push(s)}return n}function Pw(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function iH(e,t){for(let i of e)!0!==t(i.id,i.data)&&iH(i.children,t)}function nH(e,t){if(!0!==t(e.id,e.data))for(let i of e.children)nH(i,t)}var H8,So=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,So.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Dw(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(!t)return e;e=t}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){return this.get(e)?.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return null===e?this:this.get(e)?.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let i=this.get(e);i&&nH(i,t)}}traverse(e){iH(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this.parent(e),n=this.childrenArray(i),r=n.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let o=n[r];return n=[...n],n[r]={...o,data:t},this.modifyArrayBy(i,n)}}modifyArrayBy(e,t){let i=e,n=t;for(;null!==i;){let o=n,s=i;if(i=this.parent(i),void 0===i)throw new Error;n=this.childrenArray(i);let a=n.findIndex(l=>l.id===s);if(a<0)throw new Error;n=[...n],n[a]={...n[a],children:o}}Object.setPrototypeOf(n,So.prototype);let r=n;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(void 0!==this.get(e))return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:n,data:r,children:o}=e;if(null!==t&&void 0===this.get(t)||this.checkDuplicatedIdRec(e))return null;{let s=t,a=this.childrenArray(s),l={fi:i,id:n,data:r,children:o};return a=[...a,l],a.sort((c,h)=>c.fi-h.fi),e.localIndex=a.indexOf(l),{data:this.modifyArrayBy(s,a),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let i=this.parent(t);if(void 0===i)return null;let n=this.childrenArray(i),r=n.findIndex(s=>s.id===t);e.localIndex=r,n=[...n];let o=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:e,reverse:{type:7,...o,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:n}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t){let u=t;for(;null!==u;){if(void 0===u)throw new Error;if(u===n)throw new tH("cyclic tree");u=this.parent(u)}}let r=this.parent(n);if(void 0===r)return null;let o=r,s=this.childrenArray(r),a=s.findIndex(u=>u.id===n);s=[...s];let l=s.splice(a,1)[0],c=this.modifyArrayBy(r,s);r=t,s=c.childrenArray(r);let h=l.fi;return l={...l,fi:i},s=[...s,l],s.sort((u,d)=>u.fi-d.fi),e.localIndex=s.indexOf(l),c=c.modifyArrayBy(r,s),{data:c,actual:e,reverse:{type:9,parent:o,fi:h,id:n}}}previous(e,t){if(null===t){let n=this.childrenArray(e);return 0===n.length?null:n[n.length-1].id}let i=null;for(let n of this.childrenArray(e)){if(n.id===t)return i;i=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)+1;if(n<i.length)return i[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)-1;return n>=0?this.traverseSortPrevious(i[n].id):t}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);void 0!==n&&t.push({...i,...n})}t.sort((i,n)=>function J_e(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}(i.sortKey,n.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],n=this.get(t),r=n;if(void 0!==n){for(;t;)i.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return{...r,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let n=this.childrenArray(e);if(null===t){if(0===n.length)return uu(0,i,i);{let r=n[0].fi;return uu(r-i,r,i)}}{let r=this.get(t);if(void 0===r||this.parent(t)!==e)throw new Error("illegal args");let o=n.find(s=>s.fi>r.fi);if(void 0===o){let s=n[n.length-1].fi;return uu(s,s+i,i)}return uu(r.fi,o.fi,i)}}};(e=>{e.runOp=function t(i,n){if(0!==n.type)return null;if(Array.isArray(i)){let r=n.props,o={},s=[...i],a=!1;if(r)for(let l of Object.keys(r)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");o[l]=s[c],s[c]=r[l],a=!0}return a?{data:s,actual:n,reverse:{type:0,props:o}}:null}{let r=n.props,o={},s={...i},a=!1;if(r)for(let l of Object.keys(r)){o[l]=s[l];let c=r[l];void 0===c?delete s[l]:s[l]=c,a=!0}return a?{data:s,actual:n,reverse:{type:0,props:o}}:null}}})(H8||(H8={}));var xt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,xt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Dw(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this,n=i.findIndex(o=>o.id===e);if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,xt.prototype);let t=e;return function e9e(){return typeof process<"u"}()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:n}=e,r=this,o={fi:t,id:i,data:n};return r=[...r,o],r.sort((s,a)=>s.fi-a.fi),e.localIndex=r.indexOf(o),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,n=i.findIndex(o=>o.id===t);if(-1===n)return null;e.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...r}}}moveOp(e){let{fi:t,id:i}=e,n=this;n=[...n];let r=n.findIndex(a=>a.id===i);if(-1===r)return null;let o=n[r].fi,s={...n[r],fi:t};return n[r]=s,n.sort((a,l)=>a.fi-l.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:o,id:i}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(null===e){if(0===i.length)return uu(0,t,t);{let n=i[0].fi;return uu(n-t,n,t)}}{let n=this.get(e);if(void 0===n)throw new Error("illegal args");let r=i.find(o=>o.fi>n.fi);if(void 0===r){let o=i[i.length-1].fi;return uu(o,o+t,t)}return uu(n.fi,r.fi,t)}}};function zf(e){return e&&"object"==typeof e&&e instanceof Ar}var du,Y8,oo,kw,Ar=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,n=0,r={};for(;n<e.path.length;){if(t.push(i),i=void 0===i?void 0:i[e.path[n]],void 0!==i&&!zf(i))return null;n+=1}i=i?Aw(i):new Ar;for(let[a,l]of Object.entries(e.props))r[a]=i[a],void 0===l?delete i[a]:i[a]=l;for(;n>0;){if(0===Object.keys(i).length){let a=t[n-1];a&&(i=Aw(a),delete i[e.path[n-1]])}else{let a=t[n-1];if(a){let l=Aw(a);l[e.path[n-1]]=i,i=l}else{let l=new Ar;l[e.path[n-1]]=i,i=l}}n-=1}return{data:Object.setPrototypeOf(i,Ar.prototype),actual:e,reverse:{...e,props:r}}}};function Iw(e,t){if(void 0===t)return;let i=!1,n=e.map(r=>{let o=r.id,s=V2(r.data,t[o]);if(i=i||void 0!==s,void 0===s&&(s=r.data),r.children){let a=Iw(r.children,t);return void 0!==a?i=!0:a=r.children,{...r,id:o,data:s,children:a}}return{...r,id:o,data:s}});return i?n:void 0}function V2(e,t){if(!zf(t))return t;if(e instanceof So){let i=Iw(e,t);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}if(e instanceof xt)return function t9e(e,t){if(void 0===t)return;let i=!1,n=e.map(r=>{let o=r.id,s=V2(r.data,t[o]);return i=i||void 0!==s,void 0===s&&(s=r.data),{...r,id:o,data:s}});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}(e,t);if(Array.isArray(e)){let i=!1,n=e.map((r,o)=>{let s=V2(r,t[o]);return i=i||void 0!==s,void 0===s&&(s=r),s});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if(e instanceof Ar)return Ow(e,t);if(e&&"object"==typeof e){let i={},n=!1;for(let[r,o]of Object.entries(e)){let s=V2(o,t[r]);n=n||void 0!==s,void 0===s&&(s=o),i[r]=s}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}function Ow(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!zf(t))return t;if(!zf(e))return du.apply(e,t);let i=new Set;for(let r of Object.keys(e))i.add(r);for(let r of Object.keys(t))i.add(r);let n=new Ar;for(let r of i){let o=Ow(void 0===e?void 0:e[r],void 0===t?void 0:t[r]);n[r]=o}return n}function i9e(e,t){let i={cur:[],result:[],len:0};return[e=H2(e,t,i)??e,i.result]}function U8(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function j8(e){e&&(e.len-=1)}function rH(e,t,i){let n=!1,r=e.map(o=>{let s=o.id,a=t[s];if(void 0!==a&&"string"==typeof a&&(n=!0,s=a,null!==i))throw new Error("not supported");let l=H2(o.data,t,U8(i,s));j8(i),n=n||void 0!==l,void 0===l&&(l=o.data);let c=rH(o.children,t,i);return void 0!==c?n=!0:c=o.children,{...o,id:s,data:l,children:c}});if(n)return r}function H2(e,t,i){if(e instanceof So){let n=rH(e,t,i);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof xt)return function r9e(e,t,i){let n=!1,r=e.map(o=>{let s=o.id,a=t[s];if(void 0!==a&&"string"==typeof a&&(n=!0,s=a,null!==i))throw new Error("not supported");let l=H2(o.data,t,U8(i,s));return j8(i),n=n||void 0!==l,void 0===l&&(l=o.data),{...o,id:s,data:l}});if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}(e,t,i);if(Array.isArray(e)){let n=!1,r=e.map((o,s)=>{let a=H2(o,t,U8(i,s));return j8(i),n=n||void 0!==a,void 0===a&&(a=o),a});return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}if(e&&"object"==typeof e&&!Pw(e)){let n={},r=!1;for(let[o,s]of Object.entries(e))if("name"!==o){let a=t[o];if("string"==typeof a){if(null!==i)throw new Error("not supported");r=!0,o=a}let l=H2(s,t,U8(i,o));j8(i),r=r||void 0!==l,void 0===l&&(l=s),n[o]=l}else n[o]=s;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if("string"==typeof e){let n=t[e];return void 0!==n&&function n9e(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(i),n}}(e=>{e.apply=function t(r,o){return V2(r,o)??r},e.merge=function i(r,o){return Ow(r,o)},e.filterOp=function n(r,o){let s=0,a=o.path,l=r;for(;s<a.length&&void 0!==l;){if(l=Mo.zoomOnce(l,a[s]),void 0===l)return o;if(!zf(l))return;s+=1}if(void 0===l)return o;if(zf(l)){if(0===o.type){let c={...o.props};for(let h of Object.keys(l))delete c[h];return{...o,props:c}}if(1===o.type||4===o.type||7===o.type){let c=Iw([o],l);return c?(console.log(c),c):o}return o}}})(du||(du={})),(e=>{e.replaceProps=function t(i,n){let r=Mo.zoom(n,i.path);if("object"==typeof r){let o={};for(let s of Object.keys(i.props))o[s]=r[s];return{...i,props:o}}return{...i,props:{}}}})(Y8||(Y8={})),(e=>{function n(l,c){let h=c.path;for(var u=[];;){let d;if(l instanceof Ar&&0===c.type&&(d=l.runOp({...c,path:h.slice(u.length)}),null===d&&(d=void 0)),void 0===d&&u.length===h.length&&(d=l instanceof So||l instanceof xt||l instanceof $t?l.runOp(c):H8.runOp(l,c)),void 0!==d){if(null!==d){let m=d.data;for(let g=u.length-1;g>=0;g--){let v=h[g],y=u[g];if(y instanceof So){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof xt){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof $t){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof Ar){let _={...y,[v]:m};m=Object.setPrototypeOf(_,Ar.prototype)}else{if("object"!=typeof y)return null;if(Array.isArray(y)){if("string"==typeof v&&(v=parseInt(v),isNaN(v)))throw new Error("Invalid path");let _=m;m=[...y],m[v]=_}else m={...y,[v]:m}}}return{data:m,actual:{...d.actual,path:h},reverse:{...d.reverse,path:h}}}return null}let f,p=h[u.length];if(l instanceof So){if("number"==typeof p)throw new Error("");f=l.get(p)?.data}else if(l instanceof xt){if("number"==typeof p)throw new Error("");f=l.get(p)?.data}else null!==l&&(f=l[p]);if(void 0===f)return null;u.push(l),l=f}}function r(l,c){for(let h=0;h<l.length&&h<c.length;h++)if(l[h]!==c[h])return!0;return!1}function o(l,c){if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==c[h])return!1;return!0}e.drop=function t(l,c){return{...l,path:l.path.slice(c)}},e.applySimple=function i(l,c){return n(l,c)?.data??l},e.apply=n,e.pathDisjoint=r,e.pathEq=o,e.commutative=function s(l,c){return r(l.path,c.path)},e.subsumed=function a(l,c){return!(0!==l.type||0!==c.type||!o(l.path,c.path))&&Object.keys(l.props).every(h=>void 0!==c.props[h])}})(oo||(oo={})),(e=>{function l(c,h){var u=c;let d=[],p=[];for(let f of h)try{if(3===f.type||5===f.type&&"variables"===f.path[f.path.length-1]){let m,g,v;if(3===f.type?(m=Mo.zoom(u,[...f.path,f.id]),v=oo.apply(u,{...f,type:2})):(m=Mo.zoom(u,[...f.path,f.id,"value"]),v=oo.apply(u,f)),null!==v){u=v.data;let[y,_]=i9e(u,{[f.id]:m});u=y;for(let b=0;b<_.length;b++){let x=_[b],w=x.pop();if("number"==typeof w){let S=[w];for(let M=b+1;M<_.length;M++){let z=_[M],E=z[z.length-1];if("number"!=typeof E||!Mo.equal(x,z.slice(0,z.length-1)))break;S.push(E),_.splice(M,1)}let C=Mo.zoom(u,x);g=C.map((M,z)=>S.includes(z)?f.id:M),m=C,w=x.pop()}else{if("alphaOverride"===w||"alpha"===w){m/=100;let S=m,C=Mo.zoom(u,x.slice(0,x.length-2)),M=C.layers.map(z=>z.id===x[x.length-1]?{...z,data:{...z.data,[w]:S}}:z);Object.setPrototypeOf(M,Object.getPrototypeOf(C.layers)),C.layers=M}g=f.id}d.push({type:0,path:x,props:{[w]:m}}),p.push({type:0,path:x,props:{[w]:g}})}p.push(v.reverse),d.push(v.actual)}}else{let m=oo.apply(u,f);null!==m&&(d.push(m.actual),u=m.data,p.push(m.reverse))}}catch(m){if(m instanceof tH)return null;throw m}return{data:u,actual:d,reverse:p.reverse()}}e.empty=function t(){return[]},e.removePrefix=function i(c,h){let u=[];for(let d of c){let[p,...f]=d.path;p===h&&u.push({...d,path:f})}return u},e.addPrefix=function n(c,h){return c.map(u=>({...u,path:[h,...u.path]}))},e.concat=function r(c,h){return[...c,...h]},e.compress=function o(c,h){return[...c.filter(u=>!h.some(d=>oo.subsumed(u,d))),...h]},e.commutative=function s(c,h){return c.every(u=>h.every(d=>oo.commutative(u,d)))},e.applyAll=function a(c,h){for(let u of h){let d=l(c,u);null!==d&&(c=d.data)}return c},e.apply=l})(kw||(kw={}));var oH=Symbol(),o9e=Symbol(),G8=Symbol(),U2=class{reportOp(e,t,i=[]){let n=this;if(null===t)return;n._current=t.data;let r=i;for(;!(n instanceof aH);){let o=n._path,s=n._current;if(""!==o&&r.splice(0,0,o),n=n._parent,null===n)return;n.update(o,s)}n.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[G8];i&&i(),delete this._children[e]}}}},s9e=class extends U2{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,H8.runOp(this._current,e),e.path)}},a9e=class extends U2{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,$t.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},sH={get(e,t){if(t===G8)return()=>{e._parent=null};if(t===oH)return e._current;if(t===o9e)return e;let{_current:i,_children:n}=e;if("push"===t&&Array.isArray(i))throw new Error("not supported to expand array");let r=void 0===n?void 0:n[t];if(void 0!==r)return r;let o=i[t],s=W8(e,t,o);return s!==o?(void 0===n&&(n={},e._children=n),n[t]=s,s):o},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,n=Reflect.getOwnPropertyDescriptor(i,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[t]}}},l9e={...sH,set(e,t,i){let n={type:0,props:{[t]:Pr(i)??i}};return e.deleteChildren(t),e.runOp(n),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},c9e={...sH,set(e,t,i){return void 0===i?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)},Nw=class extends U2{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[G8]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,o=W8(this,e,r);return o!==r?(void 0===i&&(i={},this._children=i),i[e]=o,o):r}add(e,t,i,n,r){this.runOp({type:7,parent:e,fi:t,id:i,data:n,children:r})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let o=i[r];this.add(e,n[r],o.id,o.data,o.children)}}insertBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let o=i[r];this.add(e,n[r],o.id,o.data,o.children)}}moveAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++)this.move(e,n[r],i[r])}moveBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++)this.move(e,n[r],i[r])}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Lw=class extends U2{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[G8]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id,r=this._current[i].fi;e(this.data(this._current[i].id),n,r)}}find(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id;if(e(this.data(n),n))return this.get(n)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,o=W8(this,e,r);return o!==r?(void 0===i&&(i={},this._children=i),i[e]=o,o):r}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++)this.move(i[n],t[n])}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++)this.move(i[n],t[n])}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Rw(e,t,i){if(e.length>0){let n=e[e.length-1];if(0===n.type&&0===t.type&&Mo.equal(n.path,i))return void Object.assign(n.props,t.props)}e.push({...t,path:i})}var Mo,aH=class extends U2{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,i,n){Rw(this.ts,t,e),Rw(this.actual,i,e),Rw(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function W8(e,t,i){return i instanceof So?new Nw(e,t,i):i instanceof xt?new Lw(e,t,i):i instanceof $t?new Proxy(new a9e(e,t,i),c9e):null!==i&&"object"==typeof i?Pw(i)?i:new Proxy(new s9e(e,t,i),l9e):i}function lH(e){let t=new aH(e);return[W8(t,"",e),t]}function j2(e,t){let[i,n]=lH(e);return t(i),n.result()}function Pr(e){return e instanceof Nw||e instanceof Lw?e._current:null!==e&&"object"==typeof e?e[oH]:e}function yn(e,t){let i=[];if(!(t.length<=e.length))return null;for(var n=0;n<t.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e=>{function n(o,s){return(o instanceof So||o instanceof Nw)&&"string"==typeof s||(o instanceof xt||o instanceof Lw)&&"string"==typeof s?o.data(s):"number"==typeof s&&Array.isArray(o)||"string"==typeof s&&"object"==typeof o&&null!==o?o[s]:void 0}function r(o,s,a=0){for(;a<s.length&&void 0!==o;)o=n(o,s[a]),a+=1;return o}e.equal=function t(o,s){if(s.length!==o.length)return!1;for(var a=0;a<o.length;){if(o[a]!==s[a])return!1;a+=1}return!0},e.removeOverridden=function i(o,s,a){let l=r(a,o);if(void 0!==l&&"object"==typeof l&&null!==l){let c={...s};return Object.keys(l).forEach(h=>{delete c[h]}),c}return s},e.zoomOnce=n,e.zoom=r})(Mo||(Mo={}));var Fw,cH=class{},hH=class extends cH{constructor(e){super(),this.id=e}},uH=class extends cH{constructor(e){super(),this.data=e}};try{Fw=new TextDecoder}catch{}var ot,pu,Bi,fu,na,uh,tn,ae=0,dH=[],Bw=dH,Vw=0,Is={},za=0,$l=0,ds=[],pH={useRecords:!1,mapsAsObjects:!0},fH=class{},mH=new fH;mH.name="MessagePack 0xC1";var Tf=!1,q8=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(ot)return TH(()=>(Gw(),this?this.unpack(e,t):q8.prototype.unpack.call(pH,e,t)));pu=t>-1?t:e.length,ae=0,Vw=0,$l=0,fu=null,Bw=dH,na=null,ot=e;try{tn=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw ot=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof q8){if(Is=this,this.structures)return Bi=this.structures,X8();(!Bi||Bi.length>0)&&(Bi=[])}else Is=pH,(!Bi||Bi.length>0)&&(Bi=[]);return X8()}unpackMultiple(e,t){let i,n=0;try{Tf=!0;let r=e.length,o=this?this.unpack(e,r):Q8.unpack(e,r);if(!t){for(i=[o];ae<r;)n=ae,i.push(X8());return i}for(t(o);ae<r;)if(n=ae,!1===t(X8()))return}catch(r){throw r.lastPosition=n,r.values=i,r}finally{Tf=!1,Gw()}}_mergeStructures(e,t){for(let i=0,n=(e=e||[]).length;i<n;i++){let r=e[i];r&&(r.isShared=!0,i>=32&&(r.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let n=e[i],r=t[i];r&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[i]=n),e[i]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function X8(){try{if(!Is.trusted&&!Tf){let t=Bi.sharedLength||0;t<Bi.length&&(Bi.length=t)}let e=nr();if(ae==pu)Bi.restoreStructures&&gH(),Bi=null,ot=null,uh&&(uh=null);else{if(ae>pu){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}if(!Tf)throw new Error("Data read, but end of buffer not reached")}return e}catch(e){throw Bi.restoreStructures&&gH(),Gw(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function gH(){for(let e in Bi.restoreStructures)Bi[e]=Bi.restoreStructures[e];Bi.restoreStructures=null}function nr(){let e=ot[ae++];if(e<160){if(e<128){if(e<64)return e;{let t=Bi[63&e]||Is.getStructures&&yH()[63&e];return t?(t.read||(t.read=Hw(t,63&e)),t.read()):e}}if(e<144){if(e-=128,Is.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[CH()]=nr();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(nr(),nr());return t}}{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=nr();return t}}if(e<192){let t=e-160;if($l>=ae)return fu.slice(ae-za,(ae+=t)-za);if(0==$l&&pu<140){let i=t<16?jw(t):xH(t);if(null!=i)return i}return Uw(t)}{let t;switch(e){case 192:return null;case 193:return na?(t=nr(),t>0?na[1].slice(na.position1,na.position1+=t):na[0].slice(na.position0,na.position0-=t)):mH;case 194:return!1;case 195:return!0;case 196:return Yw(ot[ae++]);case 197:return t=tn.getUint16(ae),ae+=2,Yw(t);case 198:return t=tn.getUint32(ae),ae+=4,Yw(t);case 199:return $d(ot[ae++]);case 200:return t=tn.getUint16(ae),ae+=2,$d(t);case 201:return t=tn.getUint32(ae),ae+=4,$d(t);case 202:if(t=tn.getFloat32(ae),Is.useFloat32>2){let i=Ww[(127&ot[ae])<<1|ot[ae+1]>>7];return ae+=4,(i*t+(t>0?.5:-.5)>>0)/i}return ae+=4,t;case 203:return t=tn.getFloat64(ae),ae+=8,t;case 204:return ot[ae++];case 205:return t=tn.getUint16(ae),ae+=2,t;case 206:return t=tn.getUint32(ae),ae+=4,t;case 207:return Is.int64AsNumber?(t=4294967296*tn.getUint32(ae),t+=tn.getUint32(ae+4)):t=tn.getBigUint64(ae),ae+=8,t;case 208:return tn.getInt8(ae++);case 209:return t=tn.getInt16(ae),ae+=2,t;case 210:return t=tn.getInt32(ae),ae+=4,t;case 211:return Is.int64AsNumber?(t=4294967296*tn.getInt32(ae),t+=tn.getUint32(ae+4)):t=tn.getBigInt64(ae),ae+=8,t;case 212:if(t=ot[ae++],114==t)return SH(63&ot[ae++]);{let i=ds[t];if(i)return i.read?(ae++,i.read(nr())):i.noBuffer?(ae++,i()):i(ot.subarray(ae,++ae));throw new Error("Unknown extension "+t)}case 213:return t=ot[ae],114==t?(ae++,SH(63&ot[ae++],ot[ae++])):$d(2);case 214:return $d(4);case 215:return $d(8);case 216:return $d(16);case 217:return t=ot[ae++],$l>=ae?fu.slice(ae-za,(ae+=t)-za):d9e(t);case 218:return t=tn.getUint16(ae),$l>=(ae+=2)?fu.slice(ae-za,(ae+=t)-za):p9e(t);case 219:return t=tn.getUint32(ae),$l>=(ae+=4)?fu.slice(ae-za,(ae+=t)-za):f9e(t);case 220:return t=tn.getUint16(ae),ae+=2,_H(t);case 221:return t=tn.getUint32(ae),ae+=4,_H(t);case 222:return t=tn.getUint16(ae),ae+=2,bH(t);case 223:return t=tn.getUint32(ae),ae+=4,bH(t);default:if(e>=224)return e-256;if(void 0===e){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var u9e=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Hw(e,t){function i(){if(i.count++>2){let r=e.read=new Function("r","return function(){return {"+e.map(o=>u9e.test(o)?o+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}}")(nr);return 0===e.highByte&&(e.read=vH(t,e.read)),r()}let n={};for(let r=0,o=e.length;r<o;r++)n[e[r]]=nr();return n}return i.count=0,0===e.highByte?vH(t,i):i}var vH=(e,t)=>function(){let i=ot[ae++];if(0===i)return t();let n=e<32?-(e+(i<<5)):e+(i<<5),r=Bi[n]||yH()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=Hw(r,e)),r.read()};function yH(){let e=TH(()=>(ot=null,Is.getStructures()));return Bi=Is._mergeStructures(e,Bi)}var Uw=$8,d9e=$8,p9e=$8,f9e=$8;function $8(e){let t;if(e<16&&(t=jw(e)))return t;if(e>64&&Fw)return Fw.decode(ot.subarray(ae,ae+=e));let i=ae+e,n=[];for(t="";ae<i;){let r=ot[ae++];if(128&r)if(192==(224&r)){let o=63&ot[ae++];n.push((31&r)<<6|o)}else if(224==(240&r)){let o=63&ot[ae++],s=63&ot[ae++];n.push((31&r)<<12|o<<6|s)}else if(240==(248&r)){let l=(7&r)<<18|(63&ot[ae++])<<12|(63&ot[ae++])<<6|63&ot[ae++];l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l)}else n.push(r);else n.push(r);n.length>=4096&&(t+=so.apply(String,n),n.length=0)}return n.length>0&&(t+=so.apply(String,n)),t}function _H(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=nr();return t}function bH(e){if(Is.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[CH()]=nr();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(nr(),nr());return t}}var so=String.fromCharCode;function xH(e){let t=ae,i=new Array(e);for(let n=0;n<e;n++){let r=ot[ae++];if((128&r)>0)return void(ae=t);i[n]=r}return so.apply(String,i)}function jw(e){if(e<4){if(e<2){if(0===e)return"";{let t=ot[ae++];return(128&t)>1?void(ae-=1):so(t)}}{let t=ot[ae++],i=ot[ae++];if((128&t)>0||(128&i)>0)return void(ae-=2);if(e<3)return so(t,i);let n=ot[ae++];return(128&n)>0?void(ae-=3):so(t,i,n)}}{let t=ot[ae++],i=ot[ae++],n=ot[ae++],r=ot[ae++];if((128&t)>0||(128&i)>0||(128&n)>0||(128&r)>0)return void(ae-=4);if(e<6){if(4===e)return so(t,i,n,r);{let o=ot[ae++];return(128&o)>0?void(ae-=5):so(t,i,n,r,o)}}if(e<8){let o=ot[ae++],s=ot[ae++];if((128&o)>0||(128&s)>0)return void(ae-=6);if(e<7)return so(t,i,n,r,o,s);let a=ot[ae++];return(128&a)>0?void(ae-=7):so(t,i,n,r,o,s,a)}{let o=ot[ae++],s=ot[ae++],a=ot[ae++],l=ot[ae++];if((128&o)>0||(128&s)>0||(128&a)>0||(128&l)>0)return void(ae-=8);if(e<10){if(8===e)return so(t,i,n,r,o,s,a,l);{let c=ot[ae++];return(128&c)>0?void(ae-=9):so(t,i,n,r,o,s,a,l,c)}}if(e<12){let c=ot[ae++],h=ot[ae++];if((128&c)>0||(128&h)>0)return void(ae-=10);if(e<11)return so(t,i,n,r,o,s,a,l,c,h);let u=ot[ae++];return(128&u)>0?void(ae-=11):so(t,i,n,r,o,s,a,l,c,h,u)}{let c=ot[ae++],h=ot[ae++],u=ot[ae++],d=ot[ae++];if((128&c)>0||(128&h)>0||(128&u)>0||(128&d)>0)return void(ae-=12);if(e<14){if(12===e)return so(t,i,n,r,o,s,a,l,c,h,u,d);{let p=ot[ae++];return(128&p)>0?void(ae-=13):so(t,i,n,r,o,s,a,l,c,h,u,d,p)}}{let p=ot[ae++],f=ot[ae++];if((128&p)>0||(128&f)>0)return void(ae-=14);if(e<15)return so(t,i,n,r,o,s,a,l,c,h,u,d,p,f);let m=ot[ae++];return(128&m)>0?void(ae-=15):so(t,i,n,r,o,s,a,l,c,h,u,d,p,f,m)}}}}}function Yw(e){return Is.copyBuffers?Uint8Array.prototype.slice.call(ot,ae,ae+=e):ot.subarray(ae,ae+=e)}function $d(e){let t=ot[ae++];if(ds[t])return ds[t](ot.subarray(ae,ae+=e));throw new Error("Unknown extension type "+t)}var wH=new Array(4096);function CH(){let e=ot[ae++];if(!(e>=160&&e<192))return ae--,nr();if(e-=160,$l>=ae)return fu.slice(ae-za,(ae+=e)-za);if(!(0==$l&&pu<180))return Uw(e);let o,t=4095&(e<<5^(e>1?tn.getUint16(ae):e>0?ot[ae]:0)),i=wH[t],n=ae,r=ae+e-3,s=0;if(i&&i.bytes==e){for(;n<r;){if(o=tn.getUint32(n),o!=i[s++]){n=1879048192;break}n+=4}for(r+=3;n<r;)if(o=ot[n++],o!=i[s++]){n=1879048192;break}if(n===r)return ae=n,i.string;r-=3,n=ae}for(i=[],wH[t]=i,i.bytes=e;n<r;)o=tn.getUint32(n),i.push(o),n+=4;for(r+=3;n<r;)o=ot[n++],i.push(o);let a=e<16?jw(e):xH(e);return i.string=null!=a?a:Uw(e)}var SH=(e,t)=>{var i=nr();let n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let r=Bi[e];return r&&r.isShared&&((Bi.restoreStructures||(Bi.restoreStructures=[]))[e]=r),Bi[e]=i,i.read=Hw(i,n),i.read()},MH="object"==typeof self?self:global;ds[0]=()=>{},ds[0].noBuffer=!0,ds[101]=()=>{let e=nr();return(MH[e[0]]||Error)(e[1])},ds[105]=e=>{let t=tn.getUint32(ae-4);uh||(uh=new Map);let n,i=ot[ae];n=i>=144&&i<160||220==i||221==i?[]:{};let r={target:n};uh.set(t,r);let o=nr();return r.used?Object.assign(n,o):(r.target=o,o)},ds[112]=e=>{let t=tn.getUint32(ae-4),i=uh.get(t);return i.used=!0,i.target},ds[115]=()=>new Set(nr());var zH=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");function TH(e){let t=pu,i=ae,n=Vw,r=za,o=$l,s=fu,a=Bw,l=uh,c=na,h=new Uint8Array(ot.slice(0,pu)),u=Bi,d=Bi.slice(0,Bi.length),p=Is,f=Tf,m=e();return pu=t,ae=i,Vw=n,za=r,$l=o,fu=s,Bw=a,uh=l,na=c,ot=h,Tf=f,(Bi=u).splice(0,Bi.length,...d),Is=p,tn=new DataView(ot.buffer,ot.byteOffset,ot.byteLength),m}function Gw(){ot=null,uh=null,Bi=null}ds[116]=e=>{let t=e[0],i=zH[t];if(!i)throw new Error("Could not find typed array for code "+t);return new MH[i](Uint8Array.prototype.slice.call(e,1).buffer)},ds[120]=()=>{let e=nr();return new RegExp(e[0],e[1])},ds[98]=e=>{let i=ae;ae+=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]-4,(na=[nr(),nr()]).position0=0,na.position1=0;let n=ae;ae=i;try{return nr()}finally{ae=n}},ds[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var Ww=new Array(147);for(let e=0;e<256;e++)Ww[e]=+("1e"+Math.floor(45.15-.30103*e));var Z8,Q8=new q8({useRecords:!1}),v9e=new Float32Array(1);new Uint8Array(v9e.buffer,0,4);try{Z8=new TextEncoder}catch{}var K8,qw,Se,fr,Ql,J8=typeof Buffer<"u",Xw=J8?Buffer.allocUnsafeSlow:Uint8Array,EH=J8?Buffer:Uint8Array,DH=J8?4294967296:2144337920,me=0,Zl=null,y9e=/[\u0080-\uFFFF]/,Y2=Symbol("record-id"),AH=class extends q8{constructor(e){super(e),this.offset=0;let i,n,r,o,s,a=0,l=EH.prototype.utf8Write?function(S,C,M){return Se.utf8Write(S,C,M)}:!(!Z8||!Z8.encodeInto)&&function(S,C){return Z8.encodeInto(S,Se.subarray(C)).written},c=this;e||(e={});let h=e&&e.sequential,u=e.structures||e.saveStructures,d=e.maxSharedStructures;if(null==d&&(d=u?32:0),d>8160)throw new Error("Maximum maxSharedStructure is 8160");let p=e.maxOwnStructures;null==p&&(p=u?32:64),h&&!e.saveStructures&&(this.structures=[]);let f=d>32||p+d>64,m=d+64,g=d+p+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],y=0,_=0;this.pack=this.encode=function(S,C){if(Se||(Se=new Xw(8192),fr=new DataView(Se.buffer,0,8192),me=0),(Ql=Se.length-10)-me<2048?(Se=new Xw(Se.length),fr=new DataView(Se.buffer,0,Se.length),Ql=Se.length-10,me=0):me=me+7&2147483640,i=me,s=c.structuredClone?new Map:null,c.bundleStrings?(Zl=["",""],Se[me++]=214,Se[me++]=98,Zl.position=me-i,me+=4):Zl=null,n=c.structures,n){n.uninitialized&&(n=c._mergeStructures(c.getStructures()));let M=n.sharedLength||0;if(M>d)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let z=0;z<M;z++){let E=n[z];if(!E)continue;let D,P=n.transitions;for(let I=0,B=E.length;I<B;I++){let V=E[I];D=P[V],D||(D=P[V]=Object.create(null)),P=D}P[Y2]=z+64}a=M}h||(n.nextId=M+64)}r&&(r=!1),o=n||[];try{if(b(S),Zl){fr.setUint32(Zl.position+i,me-Zl.position-i);let M=Zl;Zl=null,b(M[0]),b(M[1])}if(c.offset=me,s&&s.idsToInsert){(me+=6*s.idsToInsert.length)>Ql&&w(me),c.offset=me;let M=function b9e(e,t){let i,n=6*t.length,r=e.length-n;for(t.sort((o,s)=>o.offset>s.offset?1:-1);i=t.pop();){let o=i.offset,s=i.id;e.copyWithin(o+n,o,r),n-=6;let a=o+n;e[a++]=214,e[a++]=105,e[a++]=s>>24,e[a++]=s>>16&255,e[a++]=s>>8&255,e[a++]=255&s,r=o}return e}(Se.subarray(i,me),s.idsToInsert);return s=null,M}return C&x9e?(Se.start=i,Se.end=me,Se):Se.subarray(i,me)}finally{if(n){if(_<10&&_++,y>1e4)n.transitions=null,_=0,y=0,v.length>0&&(v=[]);else if(v.length>0&&!h){for(let M=0,z=v.length;M<z;M++)v[M][Y2]=0;v=[]}if(r&&c.saveStructures){let M=n.sharedLength||d;n.length>M&&(n=n.slice(0,M));let z=Se.subarray(i,me);return!1===c.saveStructures(n,a)?(c._mergeStructures(c.getStructures()),c.pack(S)):(a=M,z)}}C&w9e&&(me=i)}};let b=S=>{me>Ql&&(Se=w(me));var M,C=typeof S;if("string"===C){let E,z=S.length;if(Zl&&z>=8&&z<4096){let P=y9e.test(S);return Zl[P?0:1]+=S,Se[me++]=193,void b(P?-z:z)}E=z<32?1:z<256?2:z<65536?3:5;let D=3*z;if(me+D>Ql&&(Se=w(me+D)),z<64||!l){let P,I,B,V=me+E;for(P=0;P<z;P++)I=S.charCodeAt(P),I<128?Se[V++]=I:I<2048?(Se[V++]=I>>6|192,Se[V++]=63&I|128):55296==(64512&I)&&56320==(64512&(B=S.charCodeAt(P+1)))?(I=65536+((1023&I)<<10)+(1023&B),P++,Se[V++]=I>>18|240,Se[V++]=I>>12&63|128,Se[V++]=I>>6&63|128,Se[V++]=63&I|128):(Se[V++]=I>>12|224,Se[V++]=I>>6&63|128,Se[V++]=63&I|128);M=V-me-E}else M=l(S,me+E,D);M<32?Se[me++]=160|M:M<256?(E<2&&Se.copyWithin(me+2,me+1,me+1+M),Se[me++]=217,Se[me++]=M):M<65536?(E<3&&Se.copyWithin(me+3,me+2,me+2+M),Se[me++]=218,Se[me++]=M>>8,Se[me++]=255&M):(E<5&&Se.copyWithin(me+5,me+3,me+3+M),Se[me++]=219,fr.setUint32(me,M),me+=4),me+=M}else if("number"===C)if(S>>>0===S)S<64?Se[me++]=S:S<256?(Se[me++]=204,Se[me++]=S):S<65536?(Se[me++]=205,Se[me++]=S>>8,Se[me++]=255&S):(Se[me++]=206,fr.setUint32(me,S),me+=4);else if(S>>0===S)S>=-32?Se[me++]=256+S:S>=-128?(Se[me++]=208,Se[me++]=S+256):S>=-32768?(Se[me++]=209,fr.setInt16(me,S),me+=2):(Se[me++]=210,fr.setInt32(me,S),me+=4);else{let z;if((z=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){let E;if(Se[me++]=202,fr.setFloat32(me,S),z<4||(E=S*Ww[(127&Se[me])<<1|Se[me+1]>>7])>>0===E)return void(me+=4);me--}Se[me++]=203,fr.setFloat64(me,S),me+=8}else if("object"===C)if(S){if(s){let E=s.get(S);if(E){if(!E.id){let D=s.idsToInsert||(s.idsToInsert=[]);E.id=D.push(E)}return Se[me++]=214,Se[me++]=112,fr.setUint32(me,E.id),void(me+=4)}s.set(S,{offset:me-i})}let z=S.constructor;if(z===Object)x(S,!0);else if(z===Array){(M=S.length)<16?Se[me++]=144|M:M<65536?(Se[me++]=220,Se[me++]=M>>8,Se[me++]=255&M):(Se[me++]=221,fr.setUint32(me,M),me+=4);for(let E=0;E<M;E++)b(S[E])}else if(z===Map){(M=S.size)<16?Se[me++]=128|M:M<65536?(Se[me++]=222,Se[me++]=M>>8,Se[me++]=255&M):(Se[me++]=223,fr.setUint32(me,M),me+=4);for(let[E,D]of S)b(E),b(D)}else{for(let E=0,D=K8.length;E<D;E++)if(S instanceof qw[E]){let I=K8[E];if(I.write)return I.type&&(Se[me++]=212,Se[me++]=I.type,Se[me++]=0),void b(I.write.call(this,S));let N,B=Se,V=fr,R=me;Se=null;try{N=I.pack.call(this,S,W=>(Se=B,B=null,(me+=W)>Ql&&w(me),{target:Se,targetView:fr,position:me-W}),b)}finally{B&&(fr=V,me=R,Ql=(Se=B).length-10)}return void(N&&(N.length+me>Ql&&w(N.length+me),me=_9e(N,Se,me,I.type)))}x(S,!S.hasOwnProperty)}}else Se[me++]=192;else if("boolean"===C)Se[me++]=S?195:194;else if("bigint"===C){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))Se[me++]=211,fr.setBigInt64(me,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)Se[me++]=207,fr.setBigUint64(me,S);else{if(!this.largeBigIntToFloat)throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Se[me++]=203,fr.setFloat64(me,Number(S))}me+=8}else if("undefined"===C)this.encodeUndefinedAsNil?Se[me++]=192:(Se[me++]=212,Se[me++]=0,Se[me++]=0);else{if("function"!==C)throw new Error("Unknown type: "+C);b(this.writeFunction&&this.writeFunction())}},x=!1===this.useRecords?this.variableMapSize?S=>{let z,C=Object.keys(S),M=C.length;M<16?Se[me++]=128|M:M<65536?(Se[me++]=222,Se[me++]=M>>8,Se[me++]=255&M):(Se[me++]=223,fr.setUint32(me,M),me+=4);for(let E=0;E<M;E++)b(z=C[E]),b(S[z])}:(S,C)=>{Se[me++]=222;let M=me-i;me+=2;let z=0;for(let E in S)(C||S.hasOwnProperty(E))&&(b(E),b(S[E]),z++);Se[M+++i]=z>>8,Se[M+i]=255&z}:S=>{let M,C=Object.keys(S),z=o.transitions||(o.transitions=Object.create(null)),E=0;for(let P=0,I=C.length;P<I;P++){let B=C[P];M=z[B],M||(M=z[B]=Object.create(null),E++),z=M}let D=z[Y2];if(D)D>=96&&f?(Se[me++]=96+(31&(D-=96)),Se[me++]=D>>5):Se[me++]=D;else{D=o.nextId,D||(D=64),D<m&&this.shouldShareStructure&&!this.shouldShareStructure(C)?(D=o.nextOwnId,D<g||(D=m),o.nextOwnId=D+1):(D>=g&&(D=m),o.nextId=D+1);let P=C.highByte=D>=96&&f?D-96>>5:-1;z[Y2]=D,o[D-64]=C,D<m?(C.isShared=!0,o.sharedLength=D-63,r=!0,P>=0?(Se[me++]=96+(31&D),Se[me++]=P):Se[me++]=D):(P>=0?(Se[me++]=213,Se[me++]=114,Se[me++]=96+(31&D),Se[me++]=P):(Se[me++]=212,Se[me++]=114,Se[me++]=D),E&&(y+=_*E),v.length>=p&&(v.shift()[Y2]=0),v.push(z),b(C))}for(let P=0,I=C.length;P<I;P++)b(S[C[P]])},w=S=>{let C;if(S>16777216){if(S-i>DH)throw new Error("Packed buffer would be larger than maximum buffer size");C=Math.min(DH,4096*Math.round(Math.max((S-i)*(S>67108864?1.25:2),4194304)/4096))}else C=1+(Math.max(S-i<<2,Se.length-1)>>12)<<12;let M=new Xw(C);return fr=new DataView(M.buffer,0,C),Se.copy?Se.copy(M,0,i,S):M.set(Se.slice(i,S)),me-=i,i=0,Ql=M.length-10,Se=M}}useBuffer(e){Se=e,fr=new DataView(Se.buffer,Se.byteOffset,Se.byteLength),me=0}};function PH(e,t,i,n){let r=e.byteLength;if(r+1<256){var{target:o,position:s}=i(4+r);o[s++]=199,o[s++]=r+1}else if(r+1<65536){var{target:o,position:s}=i(5+r);o[s++]=200,o[s++]=r+1>>8,o[s++]=r+1&255}else{var{target:o,position:s,targetView:a}=i(7+r);o[s++]=201,a.setUint32(s,r+1),s+=4}o[s++]=116,o[s++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s)}function IH(e,t){let i=e.byteLength;var n,r;if(i<256){var{target:n,position:r}=t(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=t(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=255&i}else{var{target:n,position:r,targetView:o}=t(i+5);n[r++]=198,o.setUint32(r,i),r+=4}n.set(e,r)}function _9e(e,t,i,n){let r=e.length;switch(r){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:r<256?(t[i++]=199,t[i++]=r):r<65536?(t[i++]=200,t[i++]=r>>8,t[i++]=255&r):(t[i++]=201,t[i++]=r>>24,t[i++]=r>>16&255,t[i++]=r>>8&255,t[i++]=255&r)}return t[i++]=n,t.set(e,i),i+r}function Ef(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");qw.unshift(e.Class),K8.unshift(e)}!function m9e(e){ds[e.type]=e.unpack?e.unpack:e}(e)}qw=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,fH],K8=[{pack(e,t,i){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:r,targetView:o,position:s}=t(6);r[s++]=214,r[s++]=255,o.setUint32(s,n)}else if(n>0&&n<17179869184){let{target:r,targetView:o,position:s}=t(10);r[s++]=215,r[s++]=255,o.setUint32(s,4e6*e.getMilliseconds()+(n/1e3/4294967296>>0)),o.setUint32(s+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:r,position:s}=t(3);r[s++]=212,r[s++]=255,r[s++]=255}else{let{target:r,targetView:o,position:s}=t(15);r[s++]=199,r[s++]=12,r[s++]=255,o.setUint32(s,1e6*e.getMilliseconds()),o.setBigInt64(s+4,BigInt(Math.floor(n)))}}},{pack(e,t,i){let n=Array.from(e),{target:r,position:o}=t(this.structuredClone?3:0);this.structuredClone&&(r[o++]=212,r[o++]=115,r[o++]=0),i(n)}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?PH(e,16,t):IH(J8?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==EH&&this.structuredClone?PH(e,zH.indexOf(i.name),t):IH(e,t)}},{pack(e,t){let{target:i,position:n}=t(1);i[n]=193}}],new AH({useRecords:!1});var Qw,NH,x9e=512,w9e=1024,kH=new AH({structuredClone:!0});function $w(e){if(Pw(e))return e;if(Array.isArray(e))return e.map($w);if("object"==typeof e&&null!==e){let t={};for(let i of Object.keys(e).sort())t[i]=$w(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}Ef({Class:$t.prototype.constructor,type:1,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,$t.prototype),e)}),Ef({Class:xt.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,xt.prototype),e)}),Ef({Class:So.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,So.prototype),e)}),Ef({Class:hH.prototype.constructor,type:4,write:e=>e.id,read:e=>new hH(e)}),Ef({Class:uH.prototype.constructor,type:5,write:e=>e.data,read:e=>new uH(e)}),Ef({Class:Ar.prototype.constructor,type:6,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Ar.prototype),e)}),(e=>{function t(r){return kH.pack(r)}e.serialize=t,e.deserialize=function i(r){return kH.unpack(r)},e.checksum=function n(r){return function C9e(e){var t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e[i],t&=t;return t}(t($w(r))).toString()}})(Qw||(Qw={})),(e=>{e.toEventUIType=function t(n){return"Conditional"===n.type?"Distance"===n.condition.type?"Distance":"StateChange":n.type},e.fromEventUIType=function i(n){return"Distance"===n||"StateChange"===n?"Conditional":n}})(NH||(NH={}));var LH,e6,Zw,RH,FH,Kw,Jw,BH,VH,HH,UH,jH,eC,tC,Os={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]};(e=>{e.is=function t(n){return"MouseDown"===n.type||"MouseUp"===n.type||"MousePress"===n.type||"KeyDown"===n.type||"KeyUp"===n.type||"KeyPress"===n.type},e.defaultData=function i(n){return"MouseDown"===n||"MouseUp"===n||"MousePress"===n?{type:n,mode:"Object",disabled:!1,runMode:"Once",actions:new xt}:{type:n,disabled:!1,key:void 0,runMode:"Once",actions:new xt}}})(LH||(LH={})),(e=>{e.propertyDefaultData=function t(i){return{type:"Property",value:[i??null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}})(e6||(e6={})),(e=>{e.comparisonDefaultData=function t(r){return{type:"Comparison",operator:"==",lOperand:e6.propertyDefaultData(r),rOperand:{...e6.valueDefaultData}}},e.distanceDefaultData=function i(r){return{type:"Distance",toObject:r??null,fromObject:r??null,distance:200}},e.stateDefaultData=function n(r,o){return{type:"State",object:r??null,state:o??null}}})(Zw||(Zw={})),(e=>{e.is=function t(n){return"Conditional"===n.type},e.defaultData=function i(n){return{type:"Conditional",disabled:!1,inActions:new xt,outActions:new xt,condition:Zw.distanceDefaultData(n)}}})(RH||(RH={})),(e=>{e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new xt,drop:new xt}}})(FH||(FH={})),(e=>{e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new xt}})(Kw||(Kw={})),(e=>{e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(Jw||(Jw={})),(e=>{e.is=function t(n){return"MouseHover"===n.type},e.defaultData=function i(){return{type:"MouseHover",disabled:!1,actions:new xt}}})(BH||(BH={})),(e=>{e.is=function t(n){return"Scroll"===n.type},e.defaultData=function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new xt}}})(VH||(VH={})),(e=>{e.is=function t(n){return"Start"===n.type},e.defaultData=function i(){return{type:"Start",disabled:!1,actions:new xt}}})(HH||(HH={})),(e=>{e.is=function t(n){return"Collision"===n.type},e.defaultData=function i(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new xt}}})(UH||(UH={})),(e=>{e.is=function t(n){return"Trigger"===n.type},e.defaultData=function i(n,r){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new xt,triggerZone:"box",position:r.toArray(),rotation:[0,0,0],size:n.toArray(),radius:n.length()/2,helperVisible:!0}}})(jH||(jH={})),(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},e.is=function t(s){return"Resize"===s.type},e.sizeToDevice=function i(s){return"string"==typeof s?s:"custom"},e.deviceToSize=function n(s){return"string"==typeof s?[...e.defaultSizes[s]]:[...s]},e.defaultData=function r(){let s={size:"mobile",operator:"<",actions:new xt},a={size:"tablet",operator:"<",actions:new xt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new xt},c=new xt;return c.push({id:et.generateUUID(),fi:0,data:s},{id:et.generateUUID(),fi:1,data:a},{id:et.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}},e.defaultBreakpointData=function o(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new xt}}})(eC||(eC={})),(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},e.is=function t(n){return"VariableChange"===n.type},e.defaultData=function i(){return{disabled:!1,type:"VariableChange",actions:new xt,variableId:"",objectId:null,property:"Position X"}}})(tC||(tC={}));var dh,Qd,t6,Af,Go,on,iC,YH,GH,mu,Zd,Pf,gu,nC,Df="personal camera",G2="a218fcc3-276b-49b9-b485-49037fd14f5f",ra=5526619;function WH(e){return"string"==typeof e&&36===e.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}(e=>{function a(f,m){return Math.pow(m[0]-f[0],2)+Math.pow(m[1]-f[1],2)}function l(f,m){return Math.sqrt(a(f,m))}function u(f,m,g){let v=e.sub(m,f),y=e.sub(g,f),_=e.dot(v,y)/e.dot(v,v),b=e.scalarMultiply(v,_);return e.add(f,b)}e.isEqual=function t(f,m){return f[0]===m[0]&&f[1]===m[1]},e.lerp=function i(f,m,g){return[f[0]+(m[0]-f[0])*g,f[1]+(m[1]-f[1])*g]},e.add=function n(f,m){return[f[0]+m[0],f[1]+m[1]]},e.sub=function r(f,m){return[f[0]-m[0],f[1]-m[1]]},e.multiply=function o(f,m){return[f[0]*m[0],f[1]*m[1]]},e.divide=function s(f,m){return[f[0]/m[0],f[1]/m[1]]},e.distanceSquared=a,e.distance=l,e.dot=function c(f,m){return f[0]*m[0]+f[1]*m[1]},e.scalarMultiply=function h(f,m){return[f[0]*m,f[1]*m]},e.projectionOnto=u,e.projectionOntoDistance=function d(f,m,g){return l(f,u(f,m,g))},e.center=function p(f,m){return[.5*(f[0]+m[0]),.5*(f[1]+m[1])]}})(dh||(dh={})),(e=>{e.isEqual=function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]},e.add=function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]},e.sub=function n(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]},e.div=function r(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]},e.mul=function o(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]},e.dist=function s(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])},e.lerp=function a(l,c,h){return[l[0]+(c[0]-l[0])*h,l[1]+(c[1]-l[1])*h,l[2]+(c[2]-l[2])*h]}})(Qd||(Qd={})),(e=>{e.isEqual=function t(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]},e.lerp=function i(n,r,o){return[n[0]+(r[0]-n[0])*o,n[1]+(r[1]-n[1])*o,n[2]+(r[2]-n[2])*o,n[3]+(r[3]-n[3])*o]}})(t6||(t6={})),(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.isEqual=function t(r,o){for(let s=0;s<16;s++)if(r[s]!==o[s])return!1;return!0},e.simplify=function i(r){return r??e.identity},e.applyMatrix4=function n(r,o){let s=o.slice(0);for(var a=0,l=o.length;a<l;a+=3){let c=r[3]*o[a]+r[7]*o[a+1]+r[11]*o[a+2]+r[15];s[a]=(r[0]*o[a]+r[4]*o[a+1]+r[8]*o[a+2]+r[12])/c,s[a+1]=(r[1]*o[a]+r[5]*o[a+1]+r[9]*o[a+2]+r[13])/c,s[a+2]=(r[2]*o[a]+r[6]*o[a+1]+r[10]*o[a+2]+r[14])/c}return s}})(Af||(Af={})),(e=>{e.isRGB=function t(c){return"object"==typeof c&&"number"==typeof c.r&&"number"==typeof c.g&&"number"==typeof c.b},e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0},e.toRgb255a1=function i(c){return{r:Math.round(255*c.r),g:Math.round(255*c.g),b:Math.round(255*c.b),a:1}},e.clone=function n(c){return{r:c.r,g:c.g,b:c.b}},e.fromHex=function r(c){return{r:((c=Math.floor(c))>>16&255)/255,g:(c>>8&255)/255,b:(255&c)/255}},e.toHex=function o(c){return 65536*Math.round(255*c.r)+256*Math.round(255*c.g)+Math.round(255*c.b)},e.equals=function s(c,h){return c.r===h.r&&c.g===h.g&&c.b===h.b},e.equalsFixed=function a(c,h){return c.r.toFixed(2)===h.r.toFixed(2)&&c.g.toFixed(2)===h.g.toFixed(2)&&c.b.toFixed(2)===h.b.toFixed(2)},e.lerp=function l(c,h,u){return{r:c.r+(h.r-c.r)*u,g:c.g+(h.g-c.g)*u,b:c.b+(h.b-c.b)*u}}})(Go||(Go={})),(e=>{e.white={...Go.white,a:1},e.transparent={...Go.white,a:0},e.from0to1=function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}},e.fromHexAndA=function i(l,c){return{...Go.fromHex(l),a:c}},e.toRgb255a1=function n(l){return{r:Math.round(255*l.r),g:Math.round(255*l.g),b:Math.round(255*l.b),a:l.a}},e.equals=function r(l,c){return Go.equals(l,c)&&l.a===c.a},e.equalsFixed=function o(l,c){return Go.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)},e.lerp=function s(l,c,h){return{r:l.r+(c.r-l.r)*h,g:l.g+(c.g-l.g)*h,b:l.b+(c.b-l.b)*h,a:l.a+(c.a-l.a)*h}},e.toStyle=function a({r:l,g:c,b:h,a:u}=e.white){return`rgba(${255*l}, ${255*c}, ${255*h}, ${u})`}})(on||(on={})),(e=>{e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(iC||(iC={})),(e=>{e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(YH||(YH={})),(e=>{e.defaultData={control1:[.5,0],control2:[.5,1]}})(GH||(GH={})),(e=>{e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]})(mu||(mu={})),(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function t(i){return e.all.includes(i)}})(Zd||(Zd={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function t(i){return"PerspectiveCamera"===i.type?i.perspective?.zoom??1:i.orthographic?.zoom??1}})(Pf||(Pf={})),(e=>{e.defaultData=function t(n,r=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(n[0],n[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[n[0]+n[0]*r,0,0]},grid:{count:[2,2,2],size:n.map(o=>o*(1+r)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function i(n,r){let o={...n};if(qH.forEach(s=>{Object.assign(o,{[s]:r[s]??n[s]})}),o.radial={...n.radial},r.radial){let s=n.radial,a=r.radial;XH.forEach(l=>{Object.assign(o.radial,{[l]:a[l]??s[l]})})}if(o.linear={...n.linear},r.linear){let s=n.linear,a=r.linear;$H.forEach(l=>{Object.assign(o.linear,{[l]:a[l]??s[l]})})}if(o.grid={...n.grid},r.grid){let s=n.grid,a=r.grid;QH.forEach(l=>{Object.assign(o.grid,{[l]:a[l]??s[l]})})}if(o.toObject={...n.toObject},r.toObject){let s=n.toObject,a=r.toObject;ZH.forEach(l=>{Object.assign(o.toObject,{[l]:a[l]??s[l]})})}if(o.randomnessObject={...n.randomnessObject},r.randomnessObject){let s=n.randomnessObject,a=r.randomnessObject;KH.forEach(l=>{Object.assign(o.randomnessObject,{[l]:a[l]??s[l]})})}return o}})(gu||(gu={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function i(n,r){let o=[];void 0!==n.count&&o.push({type:0,path:r,props:{count:n.count}});for(let s of t){let a=n[s];a&&Object.keys(a).length>0&&o.push({type:0,path:[...r,s],props:a})}return o}})(nC||(nC={}));var rC,oC,n6,If,sC,aC,lC,JH,r6,eU,tU,qH=["count"],XH=["radius","start","end","position","scale","rotation"],$H=["position","scale","rotation"],QH=["count","size"],ZH=["count","position","scale","rotation"],KH=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function t(i){return e.all.includes(i)}})(rC||(rC={})),(e=>{e.defaultData=function t(n){return function i(n){if("PointLight"===n)return{type:n,color:on.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===n)return{type:n,color:on.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===n)return{type:n,color:on.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(n)}})(oC||(oC={})),(e=>{e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeLoopDelayStart:"end",emitTimeDuration:1,...e.defaultCollisionData}})(n6||(n6={})),(e=>{e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(If||(If={})),(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function t(i,n){return i.castShadow===n.castShadow&&i.receiveShadow===n.receiveShadow}})(sC||(sC={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function t(i,n){return i.flatShading===n.flatShading&&i.side===n.side&&i.wireframe===n.wireframe}})(aC||(aC={})),(e=>{e.defaultData={...aC.defaultData,...sC.defaultData}})(lC||(lC={})),(e=>{e.getMaterialData=function t(i,n){let r=[];if("material"in i){let o="string"==typeof i.material?n.materials[i.material]??n.lib.materials[i.material]?.asset:i.material;o&&r.push(o)}else if("materials"in i)for(let o of i.materials){let s="string"==typeof o?n.materials[o]??n.lib.materials[o]?.asset:o;s&&r.push(s)}return r}})(JH||(JH={})),(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})(r6||(r6={})),(e=>{e.is=function t(i){return"texture"===i||"video"===i||"color"===i||"depth"===i||"normal"===i||"gradient"===i||"noise"===i||"fresnel"===i||"rainbow"===i||"toon"===i||"outline"===i||"particle"===i||"transmission"===i||"matcap"===i||"displace"===i||"pattern"===i||"light"===i}})(eU||(eU={})),(e=>{e.is=function t(i){return"phong"===i||"toon"===i||"lambert"===i||"physical"===i}})(tU||(tU={}));var ao,Wo,o6,s6,iU=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],z9e=["wrapping","image","video","name","minFilter"];(e=>{e.patch=function t(o,s){let{texture:a,...l}=s;if(Object.assign(o,l),a){let c=o.texture;c&&Object.assign(c,a)}},e.defaultData=function i(o,s){return"light"===o&&s?function n(o){let s={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(o){case"phong":return{...s,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...s,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...s,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...s,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(s):function r(o){let s={alpha:1,mode:0,isMask:!1,visible:!0};switch(o){case"texture":return{...s,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008},crop:!1};case"video":return{...s,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:r6.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008},crop:!1};case"color":return{...s,type:"color",color:Go.fromHex(ra)};case"depth":return{...s,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...s,type:"normal",cnormal:[1,1,1]};case"gradient":return{...s,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...s,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Go.fromHex(6710886),a:1},colorB:{...Go.fromHex(6710886),a:1},colorC:{...Go.fromHex(16777215),a:1},colorD:{...Go.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...s,type:"fresnel",color:on.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...s,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...s,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:on.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...s,type:"outline",outlineColor:on.fromHexAndA(0,1),contourColor:on.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...s,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008}};case"transmission":return{...s,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...s,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Go.fromHex(0),a:1},colorB:{...Go.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(o)}})(ao||(ao={})),(e=>{function s(h,u="layer1",d="layer2"){let p=new xt;return p.push({fi:0,data:ao.defaultData("light",h),id:u}),p.push({fi:1,data:ao.defaultData("color"),id:d}),{layers:p}}e.isMergable=function t(h){return!h.layers.some(u=>"texture"===u.data.type&&0!==u.data.projection||"depth"===u.data.type&&!u.data.isWorldSpace||"noise"===u.data.type||"displace"===u.data.type)},e.getHash=function i(h){let u="";return h.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{u+=`${p}${f}`,Array.isArray(f)?f.forEach(m=>u+=`${m}`):"object"==typeof f?Object.values(f).forEach(m=>{u+="number"==typeof m?`${m.toFixed(4)}`:`${m}`}):u+=`${f}`})}),u},e.defaultEmptyData=function n(){return{layers:new xt}},e.defaultData=function r(h="layer1",u="layer2"){return s("phong",h,u)},e.withName=function o(h,u){return{...h,name:u}},e.defaultTwoLayerData=s,e.defaultUIObjectMaterial=function a(h){let u=ao.defaultData("texture");h&&Object.assign(u.texture,{image:h});let d=new xt;return d.push({fi:0,data:u,id:"layer1"}),d.push({fi:1,data:{...ao.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...ao.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}},e.defaultTwoLayerTextureData=function l(h,u="phong",d="layer1",p="layer2"){let f=ao.defaultData("texture");Object.assign(f.texture,{image:h});let m=new xt;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:ao.defaultData("light",u),id:p}),{layers:m}},e.defaultTwoLayerVideoTextureData=function c(h,u="phong",d="layer1",p="layer2"){let f=ao.defaultData("video");Object.assign(f.texture,{video:h});let m=new xt;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:ao.defaultData("light",u),id:p}),{layers:m}}})(Wo||(Wo={})),(e=>{e.defaultData=function t(){return{points:new xt,roundness:0,shapeHoles:[],isClosed:!1}}})(o6||(o6={})),(e=>{e.defaultData=function t(){return{points:new xt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(s6||(s6={}));var cC,nU={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(e=>{e.merge=function t(i,n){let r={...i};return oU.forEach(o=>{Object.assign(r,{[o]:n[o]??i[o]})}),r}})(cC||(cC={}));var a6,hC,Of,rU={shape:nU,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},oU=["depth","offset","angle","twist","startScale","endScale"];(e=>{e.is2DParametricMesh=function t(n){return"PolygonGeometry"===n||"RectangleGeometry"===n||"StarGeometry"===n||"TriangleGeometry"===n||"EllipseGeometry"===n||"UIGeometry"===n},e.isParametricMesh=function i(n){return"PolygonGeometry"===n||"PolygonGeometry"===n||"RectangleGeometry"===n||"StarGeometry"===n||"TriangleGeometry"===n||"EllipseGeometry"===n||"PathGeometry"===n||"VectorGeometry"===n||"ConeGeometry"===n||"CubeGeometry"===n||"CylinderGeometry"===n||"DodecahedronGeometry"===n||"HelixGeometry"===n||"IcosahedronGeometry"===n||"LatheGeometry"===n||"PyramidGeometry"===n||"SphereGeometry"===n||"PlaneGeometry"===n||"BackdropGeometry"===n||"TorusGeometry"===n||"TorusKnotGeometry"===n||"BooleanGeometry"===n||"TextGeometry"===n}})(a6||(a6={})),(e=>{e.merge=function t(i,n){let r={...i};return Object.assign(r,n),"PathGeometry"===r.type&&"extrusion"in n&&n.extrusion&&(r.extrusion={...i.extrusion},Object.assign(r.extrusion,cC.merge(r.extrusion,n.extrusion))),r}})(hC||(hC={})),(e=>{e.defaultData=function t(i){if("RectangleGeometry"===i)return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===i)return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===i)return{type:i,width:1,height:1,depth:1,path:s6.defaultData(),extrusion:rU};if("VectorGeometry"===i)return{width:1,height:1,type:i,subdivisions:12,shape:o6.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===i)return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===i)return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===i)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(Of||(Of={}));var uC,l6,dC,pC,fC,kf,mC,gC,vC,aU,Nf,zo,yC,lU,cU,hU,Lf,W2,_C,c6,vu,Rf,bC,Kd,h6,yu,xC,wC,Jd,q2,e1,X2,oa,CC,uU,dU,t1,Ta,u6,d6,sU=["width","height","depth"];function pU(e){e.layers.forEach(t=>{if("depth"===t.type&&void 0!==t.colorA){let i=t.colorA,n=t.colorB,r=[[i.r,i.g,i.b,i.a],[n.r,n.g,n.b,n.a]],o=[0,1];for(let a=2;a<10;a++)r.push(r[1]),o.push(1);let s={...hh(Pr(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:r,steps:o,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,s)}else if("depth"===t.type&&1===t.gradientType&&(t.near<0||t.far<0)){let i={...Pr(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function _u(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function bu(e,t){e.scene.objects.traverse((i,n)=>{"materials"in n?n.materials.forEach((r,o)=>{void 0===r&&(n.materials[o]=Wo.defaultData(),r=n.materials[o]),"string"!=typeof r&&t(r)}):"material"in n?"string"!=typeof n.material&&(void 0===n.material&&(n.material=Wo.defaultData()),t(n.material)):"Mesh"===n.type&&(void 0===n.material&&(n.material=Wo.defaultData()),t(n.material)),"overrides"in n&&Object.values(n.overrides).forEach(r=>{r.material&&"string"!=typeof r.material&&Object.getPrototypeOf(r.material)!==Ar.prototype&&t(r.material)})})}function fU(e){void 0===e.layers&&Object.assign(e,Wo.defaultTwoLayerData("lambert"))}function SC(e){!e.layers||e.layers.forEach(t=>{if("depth"===t.type&&10===t.colors.length){let i=[...t.colors];i.push(t.colors[9]);let n=[...t.steps];n.push(t.steps[9]);let r={...Pr(t),colors:i,steps:n};Object.assign(t,r)}})}function mU(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(n=>{"string"!=typeof n&&SC(n)}):"material"in i&&"string"!=typeof i.material&&SC(i.material)}),Object.values(e.shared.materials).forEach(t=>SC(t))}function gU(e){e.layers&&e.layers.forEach(t=>{"depth"===t.type&&void 0!==t.num&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function vU(e){e.layers&&e.layers.forEach(t=>{(function M9e(e){return"displace"!==e.type})(t)&&void 0===t.isMask&&(t.isMask=!1),("texture"===t.type||"video"===t.type)&&void 0===t.blending&&(t.blending=0),("noise"===t.type||"displace"===t.type&&"noise"===t.displacementType)&&(void 0===t.voronoiStyle&&(t.voronoiStyle=0),void 0===t.highCut&&(t.highCut=1),void 0===t.lowCut&&(t.lowCut=0),void 0===t.smoothness&&(t.smoothness=.3),void 0===t.seed&&(t.seed=0),void 0===t.quality&&(t.quality=1))})}function yU(e){let t=e.layers.find(i=>"light"===i.type)?.data;if("basic"===t?.category){let i=ao.defaultData("light","phong"),n=t;Object.assign(n,i),n.visible=!1}}function _U(e){_u(e,yU),bu(e,yU)}function bU(e){e.layers.forEach(t=>{"light"===t.type&&"toon"!==t.category&&void 0===t.occlusion&&(t.occlusion=!0)})}function xU(e){e.layers&&e.layers.forEach(t=>{"light"===t.type&&void 0===t.bumpMapIntensity&&(t.bumpMapIntensity=5)})}function wU(e){e.layers&&e.layers.forEach(t=>{"light"===t.type&&void 0===t.alphaOverride&&(t.alphaOverride=1)})}(e=>{e.defaultData={enabled:!1,useBackgroundColor:!1,color:Go.white,near:.1,far:2e3}})(uC||(uC={})),(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(l6||(l6={})),(e=>{e.defaultData={softShadowQuality:"low"}})(dC||(dC={})),(e=>{e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(pC||(pC={})),(e=>{e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(fC||(fC={})),(e=>{e.defaultData={usePhysics:!1,gravity:-10}})(kf||(kf={})),(e=>{e.defaultData={playCamera:Df,gameControlObject:null}})(mC||(mC={})),(e=>{e.defaultData={backgroundColor:on.fromHexAndA(2960946,1),postprocessing:l6.defaultData,fog:uC.defaultData,globalPhysics:kf.defaultData,ambient:pC.defaultData,ao:fC.defaultData,shadow:dC.defaultData,publish:mC.defaultData}})(gC||(gC={})),(e=>{e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(vC||(vC={})),(e=>{e.isComponentRelated=function t(n){return"Component"===n||"Instance"===n},e.isEmptyOrComponent=function i(n){return"Empty"===n||"Instance"===n}})(aU||(aU={})),(e=>{e.identity={...iC.identity,hiddenMatrix:Af.identity},e.fromObject=function t(r){return{position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix}},e.merge=function i(r,o){return{position:o?.position||r.position,rotation:o?.rotation||r.rotation,scale:o?.scale||r.scale,hiddenMatrix:o?.hiddenMatrix||r.hiddenMatrix}},e.diff=function n(r,o){return GV({position:Qd.isEqual(r.position,o.position)?void 0:o.position,rotation:Qd.isEqual(r.rotation,o.rotation)?void 0:o.rotation,scale:Qd.isEqual(r.scale,o.scale)?null:o.scale,hiddenMatrix:Af.isEqual(r.hiddenMatrix,o.hiddenMatrix)?void 0:o.hiddenMatrix})}})(Nf||(Nf={})),(e=>{e.defaultData={states:new xt,events:new xt,visible:!0,raycastLock:!1,physics:If.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...Nf.identity,cloner:null}})(zo||(zo={})),(e=>{e.defaultData={type:"Empty",...zo.defaultData}})(yC||(yC={})),(e=>{e.defaultData={type:"ParticleCollider",...vC.defaultData,...zo.defaultData}})(lU||(lU={})),(e=>{e.defaultData={type:"Component",...zo.defaultData}})(cU||(cU={})),(e=>{e.defaultData={type:"Particle",...zo.defaultData,...n6.defaultData}})(hU||(hU={})),(e=>{e.defaultData={type:"Mesh",...zo.defaultData,...lC.defaultData}})(Lf||(Lf={})),(e=>{e.defaultData={...zo.defaultData,...Nf.identity,position:[0,0,Pf.DefaultTargetOffset],...Pf.defaultData}})(W2||(W2={})),(e=>{e.defaultData=function t(i){return{...zo.defaultData,...oC.defaultData(i)}},e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(_C||(_C={})),(e=>{function t(n,r,o=0){for(;o<r.length;){let s=n?n[r[o]]:void 0;if(r.length===o+1)return s;if(!s)return;n=s.descendants,o+=1}}e.resolveWithDes=t,e.resolve=function i(n,r,o=0){let s=t(n,r,o);if(s){let a=Object.keys(s);if(1===a.length&&"descendants"===a[0])return}return s}})(c6||(c6={})),(e=>{function t(n,r){return{...zo.defaultData,...r,component:n,overrides:new Ar,physics:void 0,events:void 0,type:"Instance"}}e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function i(n){let r=Nf.fromObject(n.data);return t(n.id,r)}})(vu||(vu={})),(e=>{e.defaultData={type:"Page",...zo.defaultData,physics:{...If.defaultData,fusedBody:!1},...gC.defaultData,camera:W2.defaultData},e.isUIPage=function t(i){return void 0!==i.uiScene}})(Rf||(Rf={})),(e=>{e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Af.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:If.defaultData,states:new xt,events:new xt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Pf.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...zo.defaultData,...Lf.defaultData,geometry:Of.defaultData("RectangleGeometry"),material:Wo.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...zo.defaultData,...Lf.defaultData,geometry:Of.defaultData("BooleanGeometry"),material:Wo.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...zo.defaultData,...Lf.defaultData,geometry:Of.defaultData("TextGeometry"),material:Wo.defaultTwoLayerData("phong","layer1","layer2")}})(bC||(bC={})),(e=>{e.newEmpty=function t(o,s){let a={name:s};return"Mesh"===o.type?(a.geometry={},"material"in o&&(a.material={layers:new Ar}),"materials"in o&&(a.materials=o.materials.map(l=>({layers:new Ar})))):Zd.is(o.type)&&(a.perspective={},a.orthographic={}),a},e.toOps=function n(o,s){let a,l=[],c={orthographic:0,perspective:0,geometry:0};function h(u,d){for(let[p,f]of Object.entries(d.layers)){let{texture:m,...g}=f;if(void 0!==m&&Object.keys(m).length>0){let v={path:[...u,"layers",p,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...u,"layers",p],props:g,type:0};l.push(v)}}}for(let[u,d]of Object.entries(s))if("name"!==u)if("cloner"===u)l.push(...nC.toOps(d,["cloner"]));else if("pathSnapping"===u)l.push({path:[u],props:{slide:d.slide,offset:d.offset},type:0});else if("material"===u)h(["material"],d);else if("materials"===u)for(let[p,f]of Object.entries(d))h(["materials",p],f);else 0===c[u]?("geometry"===u&&void 0!==d.extrusion&&(l.push({path:[u,"extrusion"],props:d.extrusion,type:0}),d={...d},delete d.extrusion),Object.keys(d).length>0&&l.push({path:[u],props:d,type:0})):(void 0===a&&(a={path:[],props:{},type:0},l.push(a)),a.props[u]=d);return l},e.patch=function r(o,s){if(void 0===s)return o;let a={...o};if(Object.assign(a,Nf.merge(a,s)),Object.assign(a,{pathSnapping:Object.assign({},a.pathSnapping,{slide:s.pathSnapping?.slide??a.pathSnapping?.slide??0,offset:s.pathSnapping?.offset??a.pathSnapping?.offset??0})}),Zd.is(o.type)){a.orthographic={...a.orthographic},a.perspective={...a.perspective};let l=s;void 0!==l.orthographic?.zoom&&(a.orthographic.zoom=l.orthographic.zoom),void 0!==l.perspective?.zoom&&(a.perspective.zoom=l.perspective.zoom),void 0!==l.isUpVectorFlipped&&(a.isUpVectorFlipped=l.isUpVectorFlipped),void 0!==l.targetOffset&&(a.targetOffset=l.targetOffset)}else if("Mesh"===o.type)"geometry"in s&&Object.assign(a,{geometry:hC.merge(a.geometry,s.geometry)}),(s.material||s.materials)&&(a=function i(o,s){if(void 0===s)return o;let a={...o};return"material"in a&&"material"in s&&s.material&&(a.material=j2(a.material,l=>{if("string"!=typeof l)for(let[c,h]of Object.entries(s.material.layers)){let u=l.layers.data(c);u&&ao.patch(u,h)}}).data),a.materials&&s.materials&&(a.materials=j2(a.materials,l=>{for(let c=0;c<a.materials.length;c++){let h=s.materials[c];if("string"!=typeof h)for(let[u,d]of Object.entries(h.layers)){let p=l[c]?.layers?.data(u);p&&ao.patch(p,d)}}}).data),a}(a,s)),a.cloner&&"cloner"in s&&Object.assign(a,{cloner:gu.merge(a.cloner,s.cloner)});else if("Empty"===o.type)a.cloner&&"cloner"in s&&Object.assign(a,{cloner:gu.merge(a.cloner,s.cloner)});else if(rC.is(o.type)){let l=s;void 0!==l.intensity&&(a.intensity=l.intensity),void 0!==l.color&&(a.color="string"==typeof l.color?l.color:Go.clone(l.color))}return a}})(Kd||(Kd={})),(e=>{e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(h6||(h6={})),(e=>{e.defaultData={orbitControls:h6.defaultData,playPage:G2,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let n=0,r=0;return i<5?r=-30:i<10&&(r=30),0===i||10===i||5===i?n=30:(4===i||11===i||9===i)&&(n=-30),[120,[n,r],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1}})(yu||(yu={})),(e=>{e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(xC||(xC={})),(e=>{e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(wC||(wC={})),(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...xC.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:wC.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(Jd||(Jd={})),(e=>{e.physicsEnabled=function t(n){return void 0!==n.find(r=>"Page"===r.data.type&&r.data.globalPhysics.usePhysics)},e.traverseModuleInstances=function i(n,r,o){n.scene.objects.traverseFrom(r,(s,a)=>{if("Instance"===a.type){let l=p6.getComponentData(n,a.component)?.data;l&&o(s,a,l.events)}else o(s,a,a.events)})}})(q2||(q2={})),(e=>{function t(r=!0){let o=[],s=bC.defaultMeshObject;r&&(o.push({fi:-1,data:_C.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),o.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:s,children:[]}));let a=new So;return a.push({fi:1,id:G2,data:{...Rf.defaultData,name:"Scene 1"},children:o}),a}function i(r){return{...e.defaultData,objects:Xl(r,So.prototype)}}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultData={objects:t(),publish:yu.defaultData,styles:Jd.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new So,publish:yu.defaultData,styles:Jd.defaultData()}},e.emptyDataWithPage=function(r=!0){return{objects:t(r),publish:yu.defaultData,styles:Jd.defaultData()}},e.emptyData=function(){return{objects:new So,publish:{...yu.defaultData},styles:Jd.defaultData()}},e.withObjs=i,e.withObj=function n(r,o){return i([{id:r,data:o,children:[],fi:0}])}})(e1||(e1={})),(e=>{e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(X2||(X2={})),(e=>{function t(s){return void 0!==s.textValue}function n(s){return"boolean"==typeof s}e.isTextValue=t,e.isNumber=function i(s){return"number"==typeof s},e.isBoolean=n,e.typeOfVariable=function r(s){return t(s)?"string":n(s)?"boolean":"number"},e.getDisplayedValue=function o(s){return e.isTextValue(s)?Array.isArray(s.textValue)?s.textValue.map(a=>a.toString().padStart(s.padding??2,"0")).join(s.deliminator??":")+(void 0!==s.suffix?" "+s.suffix:""):s.textValue.toString():e.isBoolean(s)?s?"True":"False":e.isNumber(s)?parseFloat(s.toFixed(3)).toString():s.toString()}})(oa||(oa={})),(e=>{e.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(CC||(CC={})),(e=>{e.all=[...CC.all,"components"]})(uU||(uU={})),(e=>{e.defaultData=function t(){return{images:new $t,videos:new $t,colors:new $t,audios:new $t,particles:new $t,fonts:new $t,materials:new $t,components:new $t,variables:new $t}}})(dU||(dU={})),(e=>{e.defaultData=function t(){return{images:new $t,videos:new $t,colors:new $t,audios:new $t,particles:new $t,fonts:new $t,materials:new $t,components:new $t,variables:new $t}}})(t1||(t1={})),(e=>{e.defaultColors=function t(){return Xl({"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}},$t.prototype)},e.defaultImages=function i(){return Xl({},$t.prototype)},e.emptyData=function n(){return{catelogs:new $t,materials:new $t,images:new $t,videos:new $t,colors:new $t,audios:new $t,particles:new $t,fonts:new $t,variables:new xt,lib:t1.defaultData()}},e.defaultVariables=function r(s){switch(s){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let a=[0,0,0];return{name:"Time",value:{textValue:a,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:a,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",s)}},e.getFormattedTimerTime=function o(s,a){if("HH:mm:ss"===a.format){let l=Math.floor(s/3600),c=Math.floor((s-3600*l)/60);return{textValue:[l,c,Math.round(s-3600*l-60*c)]}}if("mm:ss"===a.format){let l=Math.floor(s/60);return{textValue:[l,Math.round(s-60*l)]}}return"number"===a.format?Math.round(s):Math.round(1e3*s)/1e3}})(Ta||(Ta={})),(e=>{e.list=["idle","move","jump","run"]})(u6||(u6={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new xt,move:new xt,jump:new xt,run:new xt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:on.fromHexAndA(3728051,1)}}})(d6||(d6={}));var Ff=180/Math.PI;function CU(e){e.rotation=e.rotation.slice(0,3).map(t=>t*Ff)}function SU(e){CU(e),"Page"===e.type&&CU(e.camera),e.states?.forEach(i=>{null==i.rotation||(i.rotation=i.rotation.slice(0,3).map(n=>n*Ff))});let t=e.geometry;t&&"SphereGeometry"===t.type&&(t.thetaLength=(t.thetaLength??180)*Ff),t&&"TorusGeometry"===t.type&&(t.arc=t.arc*Ff),t&&"PathGeometry"===t.type&&(t.extrusion.angle*=Ff,t.extrusion.twist*=Ff),"Mesh"===e.type&&"TextGeometry"===e.geometry.type&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Pr(e.events))&&e.events?.forEach(i=>{("MouseDown"===i.type||"MouseUp"===i.type||"MousePress"===i.type||"KeyDown"===i.type||"KeyUp"===i.type||"KeyPress"===i.type||"Collision"===i.type||"Trigger"===i.type)&&(i.runMode=i.toggle?"Toggle":"Repeat")})}var p6,MC,TU,f6,zC,m6,n1,$2,Bf,g6,TC,Q2,EC,DC,EU,v6,AC,r1,PC,ph=112;function MU(e,t){t(e.data);for(let i of e.children)MU(i,t)}function fbe(e){let t=e.schema??104;t!==ph&&t<105&&(MU(e.asset,SU),e.schema=105)}function zU(e){let t=e.schema??0;if(t!==ph){console.warn("updating from ",t,"to ",ph),function cbe(e,t){if(t<1&&(bu(e,pU),_u(e,pU),e.schema=1),t<2&&(function T9e(e){Object.assign(e.scene.publish,{orbitControls:{...h6.defaultData,...Pr(e.scene.publish.orbitControls)}})}(e),e.schema=2),t<3&&(function D9e(e){function t(i){if(i.layers)for(let n of Object.values(i.layers))if(n)for(let[r,o]of Object.entries(n))if((iU.includes(r)||"boolean"==typeof o)&&delete n[r],"texture"===r)for(let[s,a]of Object.entries(o))(z9e.includes(s)||"boolean"==typeof a)&&delete o[s]}e.scene.objects.traverse((i,n)=>{n.states.forEach(r=>{let o=r;o.material?t(o.material):o.materials&&o.materials.forEach(s=>{t(s)})})})}(e),e.schema=3),t<4&&(function A9e(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function P9e(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function I9e(e){e.scene.objects.traverse((t,i)=>{let n=i.cloner;n&&(n.radial.scale=n.radial.scale.map(r=>r+1),n.linear.scale=n.linear.scale.map(r=>r+1))})}(e),e.schema=6),t<7&&(function O9e(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&("DodecahedronGeometry"===n.type||"IcosahedronGeometry"===n.type)&&(n.detail=Math.round(n.detail))})}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(mU(e),e.schema=9),t<10&&(function R9e(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&("BooleanGeometry"===i.geometry.type||"SubdivGeometry"===i.geometry.type)&&(i.geometry.phongAngle=35)})}(e),e.schema=10),t<11&&(function F9e(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{("DirectionalLight"===i.type||"SpotLight"===i.type)&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(mU(e),e.schema=12),t<13&&(function B9e(e){e.shared.audios=Xl({},$t.prototype)}(e),e.schema=13),t<14&&(function H9e(e){let t=e.shared.materials;Object.entries(t).forEach(([i,n])=>{n.layers||Object.assign(t,{[i]:{name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]}})})}(e),e.schema=14),t<15&&(function U9e(e){Object.entries(Pr(e.shared.images)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Pr(e.shared.audios)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}(e),e.schema=15),t<16&&(function j9e(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(bu(e,gU),_u(e,gU),e.schema=17),t<18&&(bu(e,fU),_u(e,fU),e.schema=18),t<19&&(function E9e(e){Object.assign(e.scene.publish.settings,{video:{...yu.defaultData.settings.video,...Pr(e.scene.publish.settings.video)}})}(e),e.schema=19),t<20&&(function Y9e(e){e.shared.fonts=Xl({},$t.prototype)}(e),function W9e(e){let t=[];e.scene.objects.traverse((i,n)=>{let r=n;if("TextFrame"===r.type){let o=Wo.defaultTwoLayerData("phong"),s="string"==typeof r.color?e.shared.colors[r.color]:r.color;o.layers[1].data.color={r:s.r,g:s.g,b:s.b},o.layers[1].data.alpha=r.alpha;let a=function G9e(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}(r.font);void 0===e.shared.fonts[a]&&(e.shared.fonts[a]={name:a});let l={name:r.name,...zo.defaultData,...Lf.defaultData,flatShading:!1,wireframe:!1,geometry:{...Of.defaultData("TextGeometry"),width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:o,states:Pr(r.states),events:Pr(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},c=Pr(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}(e),e.schema=20),t<21&&(function q9e(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,n)=>{n.events.forEach(r=>{if(t[Number(r.type)])if(Object.assign(r,{type:t[Number(r.type)]}),"Audio"===r.type&&"audioEvent"in r&&(Object.assign(r,{playAudio:r.audioEvent}),delete r.audioEvent),"GameControl"===r.type)Object.assign(r,{gameActions:{idle:new xt,move:new xt,jump:new xt}});else{let o=new xt;Object.assign(r,{actions:o}),("MouseDown"===r.type||"MouseUp"===r.type||"KeyDown"===r.type||"KeyUp"===r.type)&&"url"in r&&o.push({fi:0,id:et.generateUUID(),data:{type:"Link",url:r.url,delay:0}}),"targets"in r&&(r.targets.forEach((s,a,l)=>{let h={easing:s.easing,duration:s.duration};6===s.easing?Object.assign(h,hh(s,"mass","stiffness","damping","velocity")):5===s.easing&&Object.assign(h,{control1:{...s.control1},control2:{...s.control2}});let d={state:s.state,repeat:s.repeat?-1:0,delay:s.delay,delayDirection:s.delayDirection,direction:s.cycle&&s.rewind?"pingpong-rewind":s.cycle?"pingpong":"normal",...h},p={allowSlerp:!0,type:"Transition",object:s.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new xt({fi:0,id:et.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:et.generateUUID(),data:d})};o.push({fi:l,id:a,data:p})}),delete r.targets)}})})}(e),function X9e(e){e.scene.objects.traverse((t,i)=>{function n(r,o){let s=new xt,a=[];if(i.events.forEach((l,c,h)=>{if("Audio"===l.type&&l.trigger===o){let u;a.push(c),"play"===l.interaction?u={...hh(l,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in l?l.after:void 0,toggle:"after"in l?l.toggle:void 0,type:"Audio"}:("pause"===l.interaction||"stop"===l.interaction)&&(u={...hh(l,"interaction","delay","object","playAudio"),type:"Audio"}),u&&s.push({fi:h,id:c,data:u})}}),a.forEach(l=>i.events.delete(l)),s.length){let l=i.events.find(c=>c.type===r)?.data;l?"actions"in l&&l.actions.insertBefore(null,s):i.events.insertBefore(null,[{id:et.generateUUID(),data:{type:r,actions:s}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")})}(e),e.schema=21),t<22&&(_U(e),e.schema=22),t<23&&(function $9e(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&"SubdivGeometry"===i.geometry.type&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}(e),e.schema=23),t<24&&(function Q9e(e){e.scene.objects.traverse((t,i)=>{("Empty"===i.type||"Mesh"===i.type)&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function V9e(e){e.shared.videos=Xl({},$t.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function k9e(e){e.scene.objects.traverse((t,i)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let r=Pr(e.scene.objects.data(n));r&&"Mesh"===r.type&&"BooleanGeometry"===r.geometry.type&&"Mesh"===i.type&&(i.visible=!0!==Pr(i).booleanExclude)}})}(e),e.schema=26),t<27&&(function N9e(e){e.scene.objects.traverse((t,i)=>{if("Mesh"===i.type){let n=i;"NonParametricGeometry"===i.geometry.type?void 0!==n.material&&delete n.material:void 0!==n.materials&&delete n.materials}})}(e),e.schema=27),t<28&&(_U(e),e.schema=28),t<29&&(function L9e(e){function t(n){Object.setPrototypeOf(n,Ar.prototype),n.texture&&Object.setPrototypeOf(n.texture,Ar.prototype)}function i(n){Object.setPrototypeOf(n,Ar.prototype);for(let r in n)t(n[r])}e.scene.objects.traverse((n,r)=>{r.states.forEach(o=>{let s=o;if(s.material){let a=Pr(s.material).layers;i(a),s.material.layers=a}if(s.materials)for(let a=0;a<s.materials.length;a++){let l=s.materials[a],c=Pr(l).layers;i(c),l.layers=c}})})}(e),e.schema=29),t<30&&(function Z9e(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&"NonParametricGeometry"===i.geometry.type&&!("material"in i)&&!("materials"in i)&&(i.material=Wo.defaultTwoLayerData("phong"))})}(e),e.schema=30),t<31&&(function K9e(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{("OrthographicCamera"===i.type||"PerspectiveCamera"===i.type)&&(void 0===i.orthographic.autoZoom&&(i.orthographic.autoZoom=!1),void 0===i.orthographic.autoZoomFrustumSize&&(i.orthographic.autoZoomFrustumSize=790))})}(e),e.schema=31),t<33&&(function J9e(e){e.scene.objects.traverse((t,i)=>{void 0===i.pathSnapping&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===i.pathSnapping.offset&&(i.pathSnapping.offset=0)})}(e),e.schema=33),t<34&&(function ebe(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function tbe(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function ibe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.resetYPosition=Math.abs(n.resetYPosition-i.position[1]))})})}(e),e.schema=36),t<37&&(function nbe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,n)=>{n.collision=(!t||null!==n.physics)&&"visibility"})}(e),e.schema=37),t<38&&(bu(e,vU),_u(e,vU),e.schema=38),t<39&&(function rbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.navmesh=d6.defaultDataThirdPerson.navmesh)})})}(e),e.schema=39),t<40&&(function obe(e){e.scene.styles||(e.scene.styles=Jd.defaultData())}(e),e.schema=40),t<41&&(function sbe(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),bu(e,bU),_u(e,bU)}(e),e.schema=41),t<42&&(function abe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&Object.assign(n.gameActions,{run:new xt})})})}(e),e.schema=42),t<43&&(function lbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.keyAssignments=[...n.keyAssignments,["run","\u21e7"],["none","Ctrl"]])})})}(e),e.schema=43),t<99){bu(e,xU),_u(e,xU),null===e.scene.publish.playCamera&&(e.scene.publish.playCamera=Df);let i=Pr(e.scene.objects),n=e.scene.objects;e.scene.publish.playPage=G2,n.insertBefore(null,null,[{id:G2,data:{...Rf.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:hh(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:hh(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...kf.defaultData,...hh(e.scene.environment,"usePhysics","gravity")},camera:Pr(e.scene.ownerCamera)??Rf.defaultData.camera,name:"Scene"},children:[]}]);for(let s of i)s.id!==e1.TRASH_CAN_ID&&n.move(G2,s.fi,s.id);let r=0,o=0;e.shared.penumbraSize&&e.scene.objects.traverse((s,a)=>{"DirectionalLight"===a.type?(a.penumbraSize=e.shared.penumbraSize[Math.min(r,2)],r+=1):"SpotLight"===a.type&&(a.penumbraSize=e.shared.penumbraSize[3+Math.min(o,1)],o+=1),null==a.physics&&"Instance"!==a.type&&(a.physics={},Object.assign(a.physics,If.defaultData)),null!=a.physics&&(a.physics.enabled=a.collision??"visibility",delete a.collision)}),e.schema=99}}(e,t),t<100&&(void 0===e.scene.publish.joystickSizeAndXYOffset&&(e.scene.publish.joystickSizeAndXYOffset=yu.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(bu(e,wU),_u(e,wU),e.schema=101),t<102&&(function hbe(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&"PathGeometry"===n.type&&(n.extrusion.capType="flat",n.extrusion.bevel=50,n.extrusion.bevelSides=6,"Custom"===n.extrusion.shape.type&&(n.extrusion.shape.shapeQuality="low"))})}(e),e.schema=102),t<104&&(e.shared.catelogs=new $t,e.shared.lib=t1.defaultData(),e.schema=104),t<105&&(function dbe(e){e.shared.variables=Xl({},$t.prototype)}(e),e.scene.objects.traverse((i,n)=>{SU(n)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))fbe(i);t<106&&(function pbe(e){let t=Pr(e.shared.variables);e.shared.variables=Xl(Object.entries(t??{}).map(([i,n],r)=>({fi:r,id:i,data:n})),xt.prototype)}(e),e.schema=106),t<107&&(e.shared.lib.variables=t1.defaultData().variables,e.schema=107),t<109&&(function mbe(e){e.shared.particles=Xl({},$t.prototype),e.shared.lib&&(e.shared.lib.particles=t1.defaultData().particles)}(e),e.schema=109),t<110&&(function gbe(e){e.scene.objects.traverse((t,i)=>{"Particle"===i.type&&"number"==typeof i.renderMaterial.size&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,n)=>{!function ube(e){Array.isArray(Pr(e.events))&&e.events?.forEach(t=>{"disabled"in t||(t.disabled=!1),("MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type)&&(t.mode=t.mode||"Object")})}(n)}),e.schema=111),t<112&&(function vbe(e){e.scene.objects.traverse((t,i)=>{"Page"===i.type&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}(e),e.schema=112)}}function o1(e,t=!1){let i=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),o={},s={},a=e[0].morphTargetsRelative,l=new gt,c=0;for(let h=0;h<e.length;++h){let u=e[h],d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in u.attributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[p]&&(o[p]=[]),o[p].push(u.attributes[p]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in u.morphAttributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[p]&&(s[p]=[]),s[p].push(u.morphAttributes[p])}if(t){let p;if(i)p=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;p=u.attributes.position.count}l.addGroup(c,p,h),c+=p}}if(i){let h=0,u=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)u.push(p.getX(f)+h);h+=e[d].attributes.position.count}l.setIndex(u)}for(let h in o){let u=DU(o[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,u)}for(let h in s){let u=s[h][0].length;if(0===u)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let d=0;d<u;++d){let p=[];for(let m=0;m<s[h].length;++m)p.push(s[h][m][d]);let f=DU(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(f)}}return l}function DU(e){let t,i,n,r=0;for(let a=0;a<e.length;++a){let l=e[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=l.normalized),n!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=l.array.length}let o=new t(r),s=0;for(let a=0;a<e.length;++a)o.set(e[a].array,s),s+=e[a].array.length;return new It(o,i,n)}(e=>{e.defaultData={schema:ph,scene:e1.defaultData,frames:(new $t).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",X2.defaultData),shared:{...Ta.emptyData(),colors:Ta.defaultColors()}},e.emptyDataForImports=function(){let r=e1.emptyDataWithPage();return{schema:ph,scene:r,frames:(new $t).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",X2.defaultData),shared:{...Ta.emptyData(),colors:Ta.defaultColors(),images:Ta.defaultImages()}}},e.emptyData=function(){return{schema:ph,scene:e1.emptyDataWithPage(),frames:(new $t).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",X2.defaultData),shared:Ta.emptyData()}},e.clipboard2dData=function(){return{schema:ph,scene:e1.emptyData(),frames:new $t,shared:Ta.emptyData()}},e.collabHelper={...kw,updateSchema:r=>(r.schema??0)<ph?j2(r,zU):(r.schema??0)-ph},e.updateSchemaDirectly=function t(r){let o=e.collabHelper.updateSchema(r);return"number"==typeof o?0===o?r:null:o.data},e.withoutLib=function i(r){return{...r,shared:{...r.shared,lib:t1.defaultData()}}},e.getComponentData=function n(r,o){let s=r.scene.objects.get(o);if(s&&"Component"===s.data.type)return s;{let a=r.shared.lib.components[o];if(a)return a.asset}}})(p6||(p6={})),(e=>{e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(MC||(MC={})),(e=>{e.is=function t(i){return!0}})(TU||(TU={})),(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},e.merge=function t(n,r){return{position:r?.position??n.position,rotation:r?.rotation??n.rotation,scale:r?.scale??n.scale,shear:r?.shear??n.shear}},e.diff=function i(n,r){return GV({position:dh.isEqual(n.position,r.position)?void 0:r.position,rotation:n.rotation===r.rotation?void 0:r.rotation,scale:dh.isEqual(n.scale,r.scale)?void 0:r.scale,shear:n.shear&&r.shear&&dh.isEqual(n.shear,r.shear)?void 0:r.shear})}})(f6||(f6={})),(e=>{e.defaultData={horizontalConstraint:0,verticalConstraint:0}})(zC||(zC={})),(e=>{e.defaultData={opacity:1,fill:{color:on.fromHexAndA(ra,1),enabled:!0},stroke:{color:on.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:on.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:on.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(m6||(m6={})),(e=>{e.newEmpty=function t(s,a){return{name:a}},e.patch=function r(s,a){if(void 0===a)return s;let l={...s};return Object.assign(l,f6.merge(l,a)),l=function i(s,a){if(void 0===a)return s;let l={...s},c=["width","height","cornerRadius"];for(let h of c)h in l&&h in a&&void 0!==a[h]&&Object.assign(l,{[h]:a[h]});return l}(l,a),l=function n(s,a){if(void 0===a)return s;let l={...s};return"fill"in l&&"fill"in a&&void 0!==a.fill&&Object.assign(l,{fill:{...l.fill,...a.fill}}),"stroke"in l&&"stroke"in a&&void 0!==a.stroke&&Object.assign(l,{stroke:{...l.stroke,...a.stroke}}),"layerBlur"in l&&"layerBlur"in a&&void 0!==a.layerBlur&&Object.assign(l,{layerBlur:{...l.layerBlur,...a.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in a&&void 0!==a.backgroundBlur&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...a.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in a&&void 0!==a.dropShadow&&Object.assign(l,{dropShadow:{...l.dropShadow,...a.dropShadow}}),"innerShadow"in l&&"innerShadow"in a&&void 0!==a.innerShadow&&Object.assign(l,{innerShadow:{...l.innerShadow,...a.innerShadow}}),l}(l,a),l},e.toOps=function o(s,a){let l,c=[];for(let[h,u]of Object.entries(a))"name"!==h&&(void 0===l&&(l={path:[],props:{},type:0},c.push(l)),l.props[h]=u);return c}})(n1||(n1={})),(e=>{e.defaultData={...f6.defaultData,...zC.defaultData,states:new xt,events:new xt,visible:!0,raycastLock:!1}})($2||($2={})),(e=>{e.defaultData={...$2.defaultData,...m6.defaultData}})(Bf||(Bf={})),(e=>{e.defaultData={cornerRadius:[0,0,0,0]}})(g6||(g6={})),(e=>{e.defaultData={...Bf.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"}})(TC||(TC={})),(e=>{e.defaultData={...Bf.defaultData,...g6.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"}})(Q2||(Q2={})),(e=>{e.defaultData={...Bf.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}})(EC||(EC={})),(e=>{e.defaultData={...Bf.defaultData,type:"path2d",path:"",name:"Path"}})(DC||(DC={})),(e=>{e.is=function t(i){return"ellipse2d"===i.type||"rectangle2d"===i.type||"text2d"===i.type||"vector2d"===i.type||"path2d"===i.type}})(EU||(EU={})),(e=>{e.defaultData={...$2.defaultData,name:"Group",type:"group2d"}})(v6||(v6={})),(e=>{e.defaultData=()=>({...$2.defaultData,...g6.defaultData,...m6.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:on.fromHexAndA(4737101,1),enabled:!0},stroke:{color:on.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(AC||(AC={})),(e=>{e.defaultData=function t(o){switch(o){case"rectangle2d":case"vector2d":return{...Q2.defaultData};case"ellipse2d":return{...TC.defaultData};case"text2d":return{...EC.defaultData};case"path2d":return{...DC.defaultData};case"frame2d":return{...AC.defaultData()};case"group2d":return{...v6.defaultData}}},e.getPivot=function i(o){return"width"in o&&"height"in o?["number"==typeof o.width?.5*o.width:0,"number"==typeof o.height?.5*o.height:0]:[0,0]},e.isResizeable=function n(o){return"rectangle2d"===o.type||"ellipse2d"===o.type||"text2d"===o.type||"frame2d"===o.type},e.hasCorners=function r(o){return"rectangle2d"===o.type||"frame2d"===o.type}})(r1||(r1={})),(e=>{e.defaultData={name:"UI",type:"scene2d",objects:new So},e.emptyData=function(){return{type:"scene2d",objects:new So}}})(PC||(PC={}));var ybe=Math.pow(2,-24),y6=class{constructor(){}};function Kl(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function AU(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let r=e[n+3]-e[n];r>i&&(i=r,t=n)}return t}function PU(e,t){t.set(e)}function IU(e,t,i){let n,r;for(let o=0;o<3;o++){let s=o+3;n=e[o],r=t[o],i[o]=n<r?n:r,n=e[s],r=t[s],i[s]=n>r?n:r}}function _6(e,t,i){for(let n=0;n<3;n++){let r=t[e+2*n],o=t[e+2*n+1],s=r-o,a=r+o;s<i[n]&&(i[n]=s),a>i[n+3]&&(i[n+3]=a)}}function Z2(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}function IC(e,t,i,n,r=null){let o=1/0,s=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*t,_=6*(t+i);y<_;y+=6){let b=e[y+0],x=e[y+1],w=b-x,S=b+x;w<o&&(o=w),S>l&&(l=S),v&&b<u&&(u=b),v&&b>f&&(f=b);let C=e[y+2],M=e[y+3],z=C-M,E=C+M;z<s&&(s=z),E>c&&(c=E),v&&C<d&&(d=C),v&&C>m&&(m=C);let D=e[y+4],P=e[y+5],I=D-P,B=D+P;I<a&&(a=I),B>h&&(h=B),v&&D<p&&(p=D),v&&D>g&&(g=D)}n[0]=o,n[1]=s,n[2]=a,n[3]=l,n[4]=c,n[5]=h,v&&(r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var fh=32,Cbe=(e,t)=>e.candidate-t.candidate,xu=new Array(fh).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),b6=new Float32Array(6);var Jl=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){let s=e[r][t];i=s<i?s:i,n=s>n?s:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){let a=e.dot(t[r]);i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};Jl.prototype.setFromBox=function(){let e=new T;return function(t,i){let n=i.min,r=i.max,o=1/0,s=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=n.x*a+r.x*(1-a),e.y=n.y*l+r.y*(1-l),e.z=n.z*c+r.z*(1-c);let h=t.dot(e);o=Math.min(h,o),s=Math.max(h,s)}this.min=o,this.max=s}}(),new Jl;var Dbe=function(){let e=new T,t=new T,i=new T;return function(n,r,o){let a=e,c=t;i.subVectors(n.start,r.start),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);let m,g,h=i.dot(c),u=c.dot(a),d=c.dot(c),p=i.dot(a),f=a.dot(a)*d-u*u;m=0!==f?(h*u-p*d)/f:0,g=(h+m*u)/d,o.x=m,o.y=g}}(),OC=function(){let e=new $,t=new T,i=new T;return function(n,r,o,s){Dbe(n,r,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return n.at(a,o),void r.at(l,s);if(a>=0&&a<=1)return r.at(l<0?0:1,s),void n.closestPointToPoint(s,!0,o);if(l>=0&&l<=1)return n.at(a<0?0:1,o),void r.closestPointToPoint(o,!0,s);{let c,h;c=a<0?n.start:n.end,h=l<0?r.start:r.end;let u=t,d=i;return n.closestPointToPoint(h,!0,t),r.closestPointToPoint(c,!0,i),u.distanceToSquared(h)<=d.distanceToSquared(c)?(o.copy(u),void s.copy(h)):(o.copy(c),void s.copy(d))}}}(),Abe=function(){let e=new T,t=new T,i=new ta,n=new Ca;return function(r,o){let{radius:s,center:a}=r,{a:l,b:c,c:h}=o;if(n.start=l,n.end=c,n.closestPointToPoint(a,!0,e).distanceTo(a)<=s||(n.start=l,n.end=h,n.closestPointToPoint(a,!0,e).distanceTo(a)<=s)||(n.start=c,n.end=h,n.closestPointToPoint(a,!0,e).distanceTo(a)<=s))return!0;let u=o.getPlane(i);if(Math.abs(u.distanceToPoint(a))<=s){let d=u.projectPoint(a,t);if(o.containsPoint(d))return!0}return!1}}(),Pbe=1e-15;function Vf(e){return Math.abs(e)<Pbe}var mh=class extends Co{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new T),this.satBounds=new Array(4).fill().map(()=>new Jl),this.points=[this.a,this.b,this.c],this.sphere=new Ps,this.plane=new ta,this.needsUpdate=!0}intersectsSphere(e){return Abe(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,s=r[0],a=o[0];this.getNormal(s),a.setFromPoints(s,n);let l=r[1],c=o[1];l.subVectors(e,t),c.setFromPoints(l,n);let h=r[2],u=o[2];h.subVectors(t,i),u.setFromPoints(h,n);let d=r[3],p=o[3];d.subVectors(i,e),p.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}};mh.prototype.closestPointToSegment=function(){let e=new T,t=new T,i=new Ca;return function(n,r=null,o=null){let c,{start:s,end:a}=n,l=this.points,h=1/0;for(let u=0;u<3;u++){let d=(u+1)%3;i.start.copy(l[u]),i.end.copy(l[d]),OC(i,n,e,t),c=e.distanceToSquared(t),c<h&&(h=c,r&&r.copy(e),o&&o.copy(t))}return this.closestPointToPoint(s,e),c=s.distanceToSquared(e),c<h&&(h=c,r&&r.copy(e),o&&o.copy(s)),this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<h&&(h=c,r&&r.copy(e),o&&o.copy(a)),Math.sqrt(h)}}(),mh.prototype.intersectsTriangle=function(){let e=new mh,t=new Array(3),i=new Array(3),n=new Jl,r=new Jl,o=new T,s=new T,a=new T,l=new T,c=new Ca,h=new Ca,u=new Ca;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let x=0;x<4;x++){let w=v[x];if(n.setFromPoints(y[x],i),w.isSeparated(n))return!1}let _=d.satBounds,b=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let x=0;x<4;x++){let w=_[x];if(n.setFromPoints(b[x],t),w.isSeparated(n))return!1}for(let x=0;x<4;x++){let w=y[x];for(let S=0;S<4;S++)if(o.crossVectors(w,b[S]),n.setFromPoints(o,t),r.setFromPoints(o,i),n.isSeparated(r))return!1}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let v=this.points,y=!1,_=0;for(let P=0;P<3;P++){let I=v[P],B=v[(P+1)%3];c.start.copy(I),c.end.copy(B),c.delta(s);let V=y?h.start:h.end,R=Vf(g.distanceToPoint(I));if(Vf(g.normal.dot(s))&&R){h.copy(c),_=2;break}if((g.intersectLine(c,V)||R)&&!Vf(V.distanceTo(B))){if(_++,y)break;y=!0}}if(1===_&&d.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==_)return!1;let b=d.points,x=!1,w=0;for(let P=0;P<3;P++){let I=b[P],B=b[(P+1)%3];c.start.copy(I),c.end.copy(B),c.delta(a);let V=x?u.start:u.end,R=Vf(m.distanceToPoint(I));if(Vf(m.normal.dot(a))&&R){u.copy(c),w=2;break}if((m.intersectLine(c,V)||R)&&!Vf(V.distanceTo(B))){if(w++,x)break;x=!0}}if(1===w&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==w)return!1;if(h.delta(s),u.delta(a),s.dot(a)<0){let P=u.start;u.start=u.end,u.end=P}let S=h.start.dot(s),C=h.end.dot(s),M=u.start.dot(s),z=u.end.dot(s);return(S===z||M===C||C<M!=S<z)&&(p&&(l.subVectors(h.start,u.start),l.dot(s)>0?p.start.copy(h.start):p.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(s)<0?p.end.copy(h.end):p.end.copy(u.end)),!0)}}}(),mh.prototype.distanceToPoint=function(){let e=new T;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),mh.prototype.distanceToTriangle=function(){let e=new T,t=new T,i=["a","b","c"],n=new Ca,r=new Ca;return function(o,s=null,a=null){let l=s||a?n:null;if(this.intersectsTriangle(o,l))return(s||a)&&(s&&l.getCenter(s),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let u,d=i[h],p=o[d];this.closestPointToPoint(p,e),u=p.distanceToSquared(e),u<c&&(c=u,s&&s.copy(e),a&&a.copy(p));let f=this[d];o.closestPointToPoint(f,e),u=f.distanceToSquared(e),u<c&&(c=u,s&&s.copy(f),a&&a.copy(e))}for(let h=0;h<3;h++){n.set(this[i[h]],this[i[(h+1)%3]]);for(let p=0;p<3;p++){r.set(o[i[p]],o[i[(p+1)%3]]),OC(n,r,e,t);let g=e.distanceToSquared(t);g<c&&(c=g,s&&s.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();var ec=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new T,this.max=new T,this.matrix=new De,this.invMatrix=new De,this.points=new Array(8).fill().map(()=>new T),this.satAxes=new Array(3).fill().map(()=>new T),this.satBounds=new Array(3).fill().map(()=>new Jl),this.alignedSatBounds=new Array(3).fill().map(()=>new Jl),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};ec.prototype.update=function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let d=n[1*l|2*c|4*h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=h?i.z:t.z,d.applyMatrix4(e)}let r=this.satBounds,o=this.satAxes,s=n[0];for(let l=0;l<3;l++){let c=o[l],h=r[l];c.subVectors(s,n[1<<l]),h.setFromPoints(c,n)}let a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},ec.prototype.intersectsBox=function(){let e=new Jl;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,r=this.satBounds,o=this.satAxes,s=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,s[0].isSeparated(e)||(e.min=i.y,e.max=n.y,s[1].isSeparated(e))||(e.min=i.z,e.max=n.z,s[2].isSeparated(e)))return!1;for(let a=0;a<3;a++){let c=r[a];if(e.setFromBox(o[a],t),c.isSeparated(e))return!1}return!0}}(),ec.prototype.intersectsTriangle=function(){let e=new mh,t=new Array(3),i=new Jl,n=new Jl,r=new T;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let s=this.satBounds,a=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let u=0;u<3;u++){let d=s[u];if(i.setFromPoints(a[u],t),d.isSeparated(i))return!1}let l=o.satBounds,c=o.satAxes,h=this.points;for(let u=0;u<3;u++){let d=l[u];if(i.setFromPoints(c[u],h),d.isSeparated(i))return!1}for(let u=0;u<3;u++){let d=a[u];for(let p=0;p<4;p++)if(r.crossVectors(d,c[p]),i.setFromPoints(r,t),n.setFromPoints(r,h),i.isSeparated(n))return!1}return!0}}(),ec.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},ec.prototype.distanceToPoint=function(){let e=new T;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),ec.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Ca),i=new Array(12).fill().map(()=>new Ca),n=new T,r=new T;return function(o,s=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(a||l)&&(o.getCenter(r),this.closestPointToPoint(r,n),o.closestPointToPoint(n,r),a&&a.copy(n),l&&l.copy(r)),0;let c=s*s,h=o.min,u=o.max,d=this.points,p=1/0;for(let m=0;m<8;m++){let g=d[m];r.copy(g).clamp(h,u);let v=g.distanceToSquared(r);if(v<p&&(p=v,a&&a.copy(g),l&&l.copy(r),v<c))return Math.sqrt(v)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,_=(m+2)%3;t[f].set(d[g<<y|v<<_],d[1<<m|g<<y|v<<_]);let C=e[m],M=e[y],z=e[_],E=i[f],D=E.start,P=E.end;D[C]=h[C],D[M]=g?h[M]:u[M],D[z]=v?h[z]:u[M],P[C]=u[C],P[M]=g?h[M]:u[M],P[z]=v?h[z]:u[M],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){r.x=m?u.x:h.x,r.y=g?u.y:h.y,r.z=v?u.z:h.z,this.closestPointToPoint(r,n);let y=r.distanceToSquared(n);if(y<p&&(p=y,a&&a.copy(n),l&&l.copy(r),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=t[m];for(let v=0;v<12;v++){OC(g,i[v],n,r);let _=n.distanceToSquared(r);if(_<p&&(p=_,a&&a.copy(n),l&&l.copy(r),_<c))return Math.sqrt(_)}}return Math.sqrt(p)}}();var Hf=new T,Uf=new T,jf=new T,x6=new $,w6=new $,C6=new $,OU=new T,kU=new T,NU=new T,S6=new T;function LU(e,t,i,n,r){let o=3*n,s=e.index.getX(o),a=e.index.getX(o+1),l=e.index.getX(o+2),{position:c,normal:h,uv:u,uv1:d}=e.attributes,p=function Obe(e,t,i,n,r,o,s,a,l){Hf.fromBufferAttribute(t,o),Uf.fromBufferAttribute(t,s),jf.fromBufferAttribute(t,a);let c=function Ibe(e,t,i,n,r,o){let s;return s=o===io?e.intersectTriangle(n,i,t,!0,r):e.intersectTriangle(t,i,n,o!==As,r),null===s?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,Hf,Uf,jf,S6,l);if(c){n&&(x6.fromBufferAttribute(n,o),w6.fromBufferAttribute(n,s),C6.fromBufferAttribute(n,a),c.uv=Co.getInterpolation(S6,Hf,Uf,jf,x6,w6,C6,new $)),r&&(x6.fromBufferAttribute(r,o),w6.fromBufferAttribute(r,s),C6.fromBufferAttribute(r,a),c.uv1=Co.getInterpolation(S6,Hf,Uf,jf,x6,w6,C6,new $)),i&&(OU.fromBufferAttribute(i,o),kU.fromBufferAttribute(i,s),NU.fromBufferAttribute(i,a),c.normal=Co.getInterpolation(S6,Hf,Uf,jf,OU,kU,NU,new T),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let h={a:o,b:s,c:a,normal:new T,materialIndex:0};Co.getNormal(Hf,Uf,jf,h.normal),c.face=h,c.faceIndex=o}return c}(i,c,h,u,d,s,a,l,t);return p?(p.faceIndex=n,r&&r.push(p),p):null}function tc(e,t,i,n){let r=e.a,o=e.b,s=e.c,a=t,l=t+1,c=t+2;i&&(a=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),r.x=n.getX(a),r.y=n.getY(a),r.z=n.getZ(a),o.x=n.getX(l),o.y=n.getY(l),o.z=n.getZ(l),s.x=n.getX(c),s.y=n.getY(c),s.z=n.getZ(c)}function RU(e,t,i,n,r,o,s){let a=i.index,l=i.attributes.position;for(let c=e,h=t+e;c<h;c++)if(tc(s,3*c,a,l),s.needsUpdate=!0,n(s,c,r,o))return!0;return!1}var FU=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function wu(e,t){return 65535===t[e+15]}function Yf(e,t){return t[e+6]}function K2(e,t){return t[e+14]}function J2(e){return e+8}function e4(e,t){return t[e+6]}var Gf=new dr,M6=new T,Rbe=["x","y","z"];function kC(e,t,i,n,r){let o=2*e,s=Wf,a=Cu,l=Su;if(wu(o,a))!function kbe(e,t,i,n,r,o){for(let s=n,a=n+r;s<a;s++)LU(e,t,i,s,o)}(t,i,n,Yf(e,l),K2(o,a),r);else{let c=J2(e);z6(c,s,n,M6)&&kC(c,t,i,n,r);let h=e4(e,l);z6(h,s,n,M6)&&kC(h,t,i,n,r)}}function NC(e,t,i,n){let r=2*e,o=Wf,s=Cu,a=Su;if(wu(r,s))return function Nbe(e,t,i,n,r){let o=1/0,s=null;for(let a=n,l=n+r;a<l;a++){let c=LU(e,t,i,a);c&&c.distance<o&&(s=c,o=c.distance)}return s}(t,i,n,Yf(e,a),K2(r,s));{let u,d,l=function Lbe(e,t){return t[e+7]}(e,a),c=Rbe[l],h=n.direction[c]>=0;h?(u=J2(e),d=e4(e,a)):(u=e4(e,a),d=J2(e));let p=z6(u,o,n,M6)?NC(u,t,i,n):null;if(p){let m=p.point[c];if(h?m<=o[d+l]:m>=o[d+l+3])return p}let f=z6(d,o,n,M6)?NC(d,t,i,n):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var Fbe=function(){let e,t,i=[],n=new FU(()=>new dr);return function(...o){e=n.getPrimitive(),t=n.getPrimitive(),i.push(e,t);let s=r(...o);n.releasePrimitive(e),n.releasePrimitive(t),i.pop(),i.pop();let a=i.length;return a>0&&(t=i[a-1],e=i[a-2]),s};function r(o,s,a,l,c=null,h=0,u=0){function d(y){let _=2*y,b=Cu,x=Su;for(;!wu(_,b);)_=2*(y=J2(y));return Yf(y,x)}function p(y){let _=2*y,b=Cu,x=Su;for(;!wu(_,b);)_=2*(y=e4(y,x));return Yf(y,x)+K2(_,b)}let f=2*o,m=Wf,g=Cu,v=Su;if(wu(f,g)){let y=Yf(o,v),_=K2(f,g);return Kl(o,m,e),l(y,_,!1,u,h+o,e)}{let w,S,C,M,y=J2(o),_=e4(o,v),b=y,x=_;if(c&&(C=e,M=t,Kl(b,m,C),Kl(x,m,M),w=c(C),S=c(M),S<w)){b=_,x=y;let V=w;w=S,S=V,C=M}C||(C=e,Kl(b,m,C));let D,E=a(C,wu(2*b,g),w,u+1,h+b);if(2===E){let V=d(b);D=l(V,p(b)-V,!0,u+1,h+b,C)}else D=E&&r(b,s,a,l,c,h,u+1);if(D)return!0;M=t,Kl(x,m,M);let B,I=a(M,wu(2*x,g),S,u+1,h+x);if(2===I){let V=d(x);B=l(V,p(x)-V,!0,u+1,h+x,M)}else B=I&&r(x,s,a,l,c,h,u+1);return!!B}}}(),Bbe=function(){let e=new mh,t=new mh,i=new De,n=new ec,r=new ec;return function o(s,a,l,c,h=null){let u=2*s,d=Wf,p=Cu,f=Su;if(null===h&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),h=n),!wu(u,p)){let m=s+8,g=f[s+6];return Kl(m,d,Gf),!!(h.intersectsBox(Gf)&&o(m,a,l,c,h)||(Kl(g,d,Gf),h.intersectsBox(Gf)&&o(g,a,l,c,h)))}{let g=a.index,v=a.attributes.position,y=l.index,_=l.attributes.position,b=Yf(s,f),x=K2(u,p);if(i.copy(c).invert(),l.boundsTree)return Kl(s,d,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:w=>r.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(c),w.b.applyMatrix4(c),w.c.applyMatrix4(c),w.needsUpdate=!0;for(let S=3*b,C=3*(x+b);S<C;S+=3)if(tc(t,S,g,v),t.needsUpdate=!0,w.intersectsTriangle(t))return!0;return!1}});for(let w=3*b,S=x+3*b;w<S;w+=3){tc(e,w,g,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let C=0,M=y.count;C<M;C+=3)if(tc(t,C,y,_),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function z6(e,t,i,n){return Kl(e,t,Gf),i.intersectBox(Gf,n)}var T6,Wf,Cu,Su,LC=[];function t4(e){T6&&LC.push(T6),T6=e,Wf=new Float32Array(e),Cu=new Uint16Array(e),Su=new Uint32Array(e)}function E6(){T6=null,Wf=null,Cu=null,Su=null,LC.length&&t4(LC.pop())}var RC=Symbol("skip tree generation"),FC=new dr,BC=new dr,qf=new De,s1=new ec,n4=new ec,r4=new T,D6=new T,Vbe=new T,Hbe=new T,Ube=new T,BU=new dr,ic=new FU(()=>new mh),o4=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),o4.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};let o,n=e._roots,r=e.geometry.getIndex();return o=t.cloneBuffers?{roots:n.map(s=>s.slice()),index:r.array.slice()}:{roots:n,index:r.array},o}static deserialize(e,t,i={}){if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),o4.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=e,o=new o4(t,{...i,[RC]:!0});if(o._roots=r,i.setIndex){let s=t.getIndex();if(null===s){let a=new It(e.index,1,!1);t.setIndex(a)}else s.array!==n&&(s.array.set(n),s.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[RC]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[RC]||(this._roots=function Ebe(e,t){let n,r,o,i=function Tbe(e,t){function i(v){d&&d(v/p)}function n(v,y,_,b=null,x=0){if(!f&&x>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),_<=h||x>=l)return i(y+_),v.offset=y,v.count=_,v;let w=function Sbe(e,t,i,n,r,o){let s=-1,a=0;if(0===o)s=AU(t),-1!==s&&(a=(t[s]+t[s+3])/2);else if(1===o)s=AU(e),-1!==s&&(a=function Mbe(e,t,i,n){let r=0;for(let o=t,s=t+i;o<s;o++)r+=e[6*o+2*n];return r/i}(i,n,r,s));else if(2===o){let l=Z2(e),c=1.25*r,h=6*n,u=6*(n+r);for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/fh;if(r<fh/4){let m=[...xu];m.length=r;let g=0;for(let y=h;y<u;y+=6,g++){let _=m[g];_.candidate=i[y+2*d],_.count=0;let{bounds:b,leftCacheBounds:x,rightCacheBounds:w}=_;for(let S=0;S<3;S++)w[S]=1/0,w[S+3]=-1/0,x[S]=1/0,x[S+3]=-1/0,b[S]=1/0,b[S+3]=-1/0;_6(y,i,b)}m.sort(Cbe);let v=r;for(let y=0;y<v;y++){let _=m[y];for(;y+1<v&&m[y+1].candidate===_.candidate;)m.splice(y+1,1),v--}for(let y=h;y<u;y+=6){let _=i[y+2*d];for(let b=0;b<v;b++){let x=m[b];_>=x.candidate?_6(y,i,x.rightCacheBounds):(_6(y,i,x.leftCacheBounds),x.count++)}}for(let y=0;y<v;y++){let _=m[y],b=_.count,x=r-_.count,S=_.rightCacheBounds,C=0;0!==b&&(C=Z2(_.leftCacheBounds)/l);let M=0;0!==x&&(M=Z2(S)/l);let z=1+1.25*(C*b+M*x);z<c&&(s=d,c=z,a=_.candidate)}}else{for(let v=0;v<fh;v++){let y=xu[v];y.count=0,y.candidate=p+f+v*f;let _=y.bounds;for(let b=0;b<3;b++)_[b]=1/0,_[b+3]=-1/0}for(let v=h;v<u;v+=6){let y=~~((i[v+2*d]-p)/f);y>=fh&&(y=fh-1);let _=xu[y];_.count++,_6(v,i,_.bounds)}let m=xu[fh-1];PU(m.bounds,m.rightCacheBounds);for(let v=fh-2;v>=0;v--){let y=xu[v];IU(y.bounds,xu[v+1].rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<fh-1;v++){let y=xu[v],_=y.count,b=y.bounds,x=xu[v+1].rightCacheBounds;0!==_&&(0===g?PU(b,b6):IU(b,b6,b6)),g+=_;let w=0,S=0;0!==g&&(w=Z2(b6)/l);let C=r-g;0!==C&&(S=Z2(x)/l);let M=1+1.25*(w*g+S*C);M<c&&(s=d,c=M,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:s,pos:a}}(v.boundingData,b,s,y,_,u);if(-1===w.axis)return i(y+_),v.offset=y,v.count=_,v;let S=function wbe(e,t,i,n,r){let o=i,s=i+n-1,a=r.pos,l=2*r.axis;for(;;){for(;o<=s&&t[6*o+l]<a;)o++;for(;o<=s&&t[6*s+l]>=a;)s--;if(!(o<s))return o;for(let c=0;c<3;c++){let h=e[3*o+c];e[3*o+c]=e[3*s+c],e[3*s+c]=h;let u=t[6*o+2*c+0];t[6*o+2*c+0]=t[6*s+2*c+0],t[6*s+2*c+0]=u;let d=t[6*o+2*c+1];t[6*o+2*c+1]=t[6*s+2*c+1],t[6*s+2*c+1]=d}o++,s--}}(a,s,y,_,w);if(S===y||S===y+_)i(y+_),v.offset=y,v.count=_;else{v.splitAxis=w.axis;let C=new y6,M=y,z=S-y;v.left=C,C.boundingData=new Float32Array(6),IC(s,M,z,C.boundingData,o),n(C,M,z,o,x+1);let E=new y6,D=S,P=_-z;v.right=E,E.boundingData=new Float32Array(6),IC(s,D,P,E.boundingData,o),n(E,D,P,o,x+1)}return v}!function _be(e,t){if(!e.index){let r,i=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;r=i>65535?new Uint32Array(new n(4*i)):new Uint16Array(new n(2*i)),e.setIndex(new It(r,1));for(let o=0;o<i;o++)r[o]=o}}(e,t);let r=new Float32Array(6),o=new Float32Array(6),s=function zbe(e,t){let i=e.attributes.position,n=e.index.array,r=n.length/3,o=new Float32Array(6*r),s=i.normalized,a=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let h=["getX","getY","getZ"];for(let u=0;u<r;u++){let f,m,g,d=3*u,p=6*u;s?(f=n[d+0],m=n[d+1],g=n[d+2]):(f=n[d+0]*c+l,m=n[d+1]*c+l,g=n[d+2]*c+l);for(let v=0;v<3;v++){let y,_,b;s?(y=i[h[v]](f),_=i[h[v]](m),b=i[h[v]](g)):(y=a[f+v],_=a[m+v],b=a[g+v]);let x=y;_<x&&(x=_),b<x&&(x=b);let w=y;_>w&&(w=_),b>w&&(w=b);let S=(w-x)/2,C=2*v;o[p+C+0]=x+S,o[p+C+1]=S+(Math.abs(x)+S)*ybe,x<t[v]&&(t[v]=x),w>t[v+3]&&(t[v+3]=w)}}return o}(e,r),a=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=function bbe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let r of e.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort((r,o)=>r-o);for(let r=0;r<n.length-1;r++){let o=n[r];t.push({offset:o/3,count:(n[r+1]-o)/3})}return t}(e);if(1===g.length){let v=g[0],y=new y6;y.boundingData=r,function xbe(e,t,i,n){let r=1/0,o=1/0,s=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=6*t,u=6*(t+i);h<u;h+=6){let d=e[h+0];d<r&&(r=d),d>a&&(a=d);let p=e[h+2];p<o&&(o=p),p>l&&(l=p);let f=e[h+4];f<s&&(s=f),f>c&&(c=f)}n[0]=r,n[1]=o,n[2]=s,n[3]=a,n[4]=l,n[5]=c}(s,v.offset,v.count,o),n(y,v.offset,v.count,o),m.push(y)}else for(let v of g){let y=new y6;y.boundingData=new Float32Array(6),IC(s,v.offset,v.count,y.boundingData,o),n(y,v.offset,v.count,o),m.push(y)}return m}(e,t),s=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let u=i[h],p=new a(32*l(u));n=new Float32Array(p),r=new Uint32Array(p),o=new Uint16Array(p),c(0,u),s.push(p)}return s;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function c(h,u){let d=h/4,p=h/2,f=!!u.count,m=u.boundingData;for(let g=0;g<6;g++)n[d+g]=m[g];if(f){let v=u.count;return r[d+6]=u.offset,o[p+14]=v,o[p+15]=65535,h+32}{let _,v=u.right,y=u.splitAxis;if(_=c(h+32,u.left),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=_/4,_=c(_,v),r[d+7]=y,_}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new dr))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let r,o,s,a,t=this.geometry,i=t.index.array,n=t.attributes.position,l=0,c=this._roots;for(let u=0,d=c.length;u<d;u++)r=c[u],o=new Uint32Array(r),s=new Uint16Array(r),a=new Float32Array(r),h(0,l),l+=r.byteLength;function h(u,d,p=!1){let f=2*u;if(65535===s[f+15]){let m=o[u+6],v=1/0,y=1/0,_=1/0,b=-1/0,x=-1/0,w=-1/0;for(let S=3*m,C=3*(m+s[f+14]);S<C;S++){let M=i[S],z=n.getX(M),E=n.getY(M),D=n.getZ(M);z<v&&(v=z),z>b&&(b=z),E<y&&(y=E),E>x&&(x=E),D<_&&(_=D),D>w&&(w=D)}return(a[u+0]!==v||a[u+1]!==y||a[u+2]!==_||a[u+3]!==b||a[u+4]!==x||a[u+5]!==w)&&(a[u+0]=v,a[u+1]=y,a[u+2]=_,a[u+3]=b,a[u+4]=x,a[u+5]=w,!0)}{let m=u+8,g=o[u+6],y=g+d,_=p,b=!1,x=!1;e?_||(b=e.has(m+d),x=e.has(y),_=!b&&!x):(b=!0,x=!0);let S=_||x,C=!1;(_||b)&&(C=h(m,d,_));let M=!1;S&&(M=h(g,d,_));let z=C||M;if(z)for(let E=0;E<3;E++){let D=m+E,P=g+E,I=a[D],B=a[D+3],V=a[P],R=a[P+3];a[u+E]=I<V?I:V,a[u+E+3]=B>R?B:R}return z}}}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);!function o(s,a=0){let l=2*s,c=65535===r[l+15];if(c){let h=n[s+6],u=r[l+14];e(a,c,new Float32Array(i,4*s,6),h,u)}else{let h=s+8,u=n[s+6],d=n[s+7];e(a,c,new Float32Array(i,4*s,6),d)||(o(h,a+1),o(u,a+1))}}(0)}raycast(e,t=Ja){let i=this._roots,n=this.geometry,r=[],o=t.isMaterial,s=Array.isArray(t),a=n.groups,l=o?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=s?t[a[c].materialIndex].side:l,d=r.length;if(t4(i[c]),kC(0,n,u,e,r),E6(),s){let p=a[c].materialIndex;for(let f=d,m=r.length;f<m;f++)r[f].face.materialIndex=p}}return r}raycastFirst(e,t=Ja){let i=this._roots,n=this.geometry,r=t.isMaterial,o=Array.isArray(t),s=null,a=n.groups,l=r?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=o?t[a[c].materialIndex].side:l;t4(i[c]);let d=NC(0,n,u,e);E6(),null!=d&&(null==s||d.distance<s.distance)&&(s=d,o&&(d.face.materialIndex=a[c].materialIndex))}return s}intersectsGeometry(e,t){let i=this.geometry,n=!1;for(let r of this._roots)if(t4(r),n=Bbe(0,i,e,t),E6(),n)break;return n}shapecast(e,t,i){let n=this.geometry;if(e instanceof Function){if(t){let u=t;t=(d,p,f,m)=>{let g=3*p;return u(d,g,g+1,g+2,f,m)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=ic.getPrimitive(),{boundsTraverseOrder:o,intersectsBounds:s,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){let u=a;a=(d,p,f,m,g)=>!!u(d,p,f,m,g)||RU(d,p,n,l,f,m,r)}else a||(a=l?(u,d,p,f)=>RU(u,d,n,l,p,f,r):(u,d,p)=>p);let c=!1,h=0;for(let u of this._roots){if(t4(u),c=Fbe(0,n,s,a,o,h),E6(),c)break;h+=u.byteLength}return ic.releasePrimitive(r),c}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,o=this.geometry.index,s=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;qf.copy(t).invert();let c=ic.getPrimitive(),h=ic.getPrimitive();if(r){let d=function(p,f,m,g,v,y,_,b){for(let x=m,w=m+g;x<w;x++){tc(h,3*x,a,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let S=p,C=p+f;S<C;S++)if(tc(c,3*S,o,s),c.needsUpdate=!0,r(c,h,S,x,v,y,_,b))return!0}return!1};if(n){let p=n;n=function(f,m,g,v,y,_,b,x){return!!p(f,m,g,v,y,_,b,x)||d(f,m,g,v,y,_,b,x)}}else n=d}e.getBoundingBox(BC),BC.applyMatrix4(t);let u=this.shapecast({intersectsBounds:d=>BC.intersectsBox(d),intersectsRange:(d,p,f,m,g,v)=>(FC.copy(v),FC.applyMatrix4(qf),e.shapecast({intersectsBounds:y=>FC.intersectsBox(y),intersectsRange:(y,_,b,x,w)=>n(d,p,y,_,m,g,x,w)}))});return ic.releasePrimitive(c),ic.releasePrimitive(h),u}intersectsBox(e,t){return s1.set(e.min,e.max,t),s1.needsUpdate=!0,this.shapecast({intersectsBounds:i=>s1.intersectsBox(i),intersectsTriangle:i=>s1.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),s1.set(e.boundingBox.min,e.boundingBox.max,t),s1.needsUpdate=!0;let s=this.geometry,a=s.attributes.position,l=s.index,c=e.attributes.position,h=e.index,u=ic.getPrimitive(),d=ic.getPrimitive(),p=D6,f=Vbe,m=null,g=null;n&&(m=Hbe,g=Ube);let v=1/0,y=null,_=null;return qf.copy(t).invert(),n4.matrix.copy(qf),this.shapecast({boundsTraverseOrder:b=>s1.distanceToBox(b),intersectsBounds:(b,x,w)=>w<v&&w<o&&(x&&(n4.min.copy(b.min),n4.max.copy(b.max),n4.needsUpdate=!0),!0),intersectsRange:(b,x)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:w=>n4.distanceToBox(w),intersectsBounds:(w,S,C)=>C<v&&C<o,intersectsRange:(w,S)=>{for(let C=3*w,M=3*(w+S);C<M;C+=3){tc(d,C,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let z=3*b,E=3*(b+x);z<E;z+=3){tc(u,z,l,a),u.needsUpdate=!0;let D=u.distanceToTriangle(d,p,m);if(D<v&&(f.copy(p),g&&g.copy(m),v=D,y=z/3,_=C/3),D<r)return!0}}}});for(let S=0,C=h?h.count:c.count;S<C;S+=3){tc(d,S,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let M=3*b,z=3*(b+x);M<z;M+=3){tc(u,M,l,a),u.needsUpdate=!0;let E=u.distanceToTriangle(d,p,m);if(E<v&&(f.copy(p),g&&g.copy(m),v=E,y=M/3,_=S/3),E<r)return!0}}}}),ic.releasePrimitive(u),ic.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(qf),f.applyMatrix4(qf),n.distance=f.sub(n.point).length(),n.faceIndex=_),i)}closestPointToPoint(e,t={},i=0,n=1/0){let r=i*i,o=n*n,s=1/0,a=null;if(this.shapecast({boundsTraverseOrder:c=>(r4.copy(e).clamp(c.min,c.max),r4.distanceToSquared(e)),intersectsBounds:(c,h,u)=>u<s&&u<o,intersectsTriangle:(c,h)=>{c.closestPointToPoint(e,r4);let u=e.distanceToSquared(r4);return u<s&&(D6.copy(r4),s=u,a=h),u<r}}),s===1/0)return null;let l=Math.sqrt(s);return t.point?t.point.copy(D6):t.point=D6.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Kl(0,new Float32Array(t),BU),e.union(BU)}),e}},s4=Qc(Gde()),jbe=.5*(Math.sqrt(3)-1),a4=(3-Math.sqrt(3))/6,nc=1/6,l4=(Math.sqrt(5),Math.sqrt(5),e=>0|Math.floor(e)),VU=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),VC=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function HC(e=Math.random){let t=HU(e),i=new Float64Array(t).map(r=>VU[r%12*2]),n=new Float64Array(t).map(r=>VU[r%12*2+1]);return function(r,o){let v,y,s=0,a=0,l=0,c=(r+o)*jbe,h=l4(r+c),u=l4(o+c),d=(h+u)*a4,m=r-(h-d),g=o-(u-d);m>g?(v=1,y=0):(v=0,y=1);let _=m-v+a4,b=g-y+a4,x=m-1+2*a4,w=g-1+2*a4,S=255&h,C=255&u,M=.5-m*m-g*g;if(M>=0){let D=S+t[C];M*=M,s=M*M*(i[D]*m+n[D]*g)}let z=.5-_*_-b*b;if(z>=0){let D=S+v+t[C+y];z*=z,a=z*z*(i[D]*_+n[D]*b)}let E=.5-x*x-w*w;if(E>=0){let D=S+1+t[C+1];E*=E,l=E*E*(i[D]*x+n[D]*w)}return 70*(s+a+l)}}function HU(e){let t=new Uint8Array(512);for(let i=0;i<256;i++)t[i]=i;for(let i=0;i<255;i++){let n=i+~~(e()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var c4,cl=new Co,qbe=Qc(JL()),Xbe=new De,$be=new De,Qbe=new De;(e=>{e.is=function t(i){return i&&i.__isSPEObject}})(c4||(c4={}));var Ti,UC=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new De,this.copyPreviousMatrix=!0,this.hiddenMatrix=new De,this.matrixWorldRigid=new De,this.shearScale=new De,this.shearScaleInv=new De}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof en&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let n=this.parent;if(t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let r of this.children)r.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let n of this.children)c4.is(n)&&n.traverseObject(t,i+1)}traverseObject(t,i=0){if(!0!==t(this,i))for(let n of this.children)c4.is(n)&&n.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:n,v:r,q:o}=(0,qbe.SVD)(i),s=Xbe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),a=$be.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),l=Qbe.copy(a).transpose();this.shearScale.makeScale(o[0],o[1],o[2]).multiply(l).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,l).copyPosition(this.matrixWorld),this.hasNonUniformScale=!o.every(c=>Math.abs(o[0]-c)<.01)}attach(t,i){this.updateWorldMatrix(!0,!1);let n=(new De).copy(this.matrixWorld).invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),n.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof De?t.hiddenMatrix.premultiply(n):t.applyMatrix4(n),t.updateWorldMatrix(!1,!1),this.add(t),void 0!==i&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,n,r,o,s){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},Zbe=class extends(UC(en)){},qo=class extends Zbe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];i?.object!==t&&(i&&this.remove(i),i=new qo(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===this.object.dataPatched.cloner?.hideBase}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return(e=>"Mesh"===this.object.type)()}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},a1=new T,l1=new T,Xf=new De,UU=[new T(-1,1,1),new T(-1,-1,1),new T(1,-1,1),new T(1,1,1),new T(-1,1,-1),new T(-1,-1,-1),new T(1,-1,-1),new T(1,1,-1)],Jbe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],exe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],jU=(e,t,i)=>{e.updateEntityBoxSize(a1,l1),Xf.copy(t).multiply(e.matrixWorld),0===l1.x&&0===l1.y&&0===l1.z?i.push(new T(a1.x,a1.y,a1.z).applyMatrix4(Xf)):UU.forEach(n=>{i.push(n.clone().multiply(l1).add(a1).applyMatrix4(Xf))})},YU=class extends dr{constructor(){super(...arguments),this.matrix=new De,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=(new De).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let n=[];return!0===i?e.traverseEntity(r=>{if(r.visible||r.cloner&&r.data.visible){if(!("geometry"in r))return void n.push(new T);jU(r,t,n)}}):jU(e,t,n),this.setFromPoints(n)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(Xf.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(l1).multiplyScalar(.5),this.getCenter(a1),Xf.copy(this.matrix).setPosition(a1),this.vertices=UU.map(e=>e.clone().multiply(l1).applyMatrix4(Xf))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=Jbe.map(([e,t])=>new Ca(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new T))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=exe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Mu={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},txe=class extends qF{constructor(){super()}getPoints(e=12){let i,t=[],n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let o=0,s=this.curves;o<s.length;o++){let a=s[o],c=Math.ceil(e*(0===o?n[o]:n[o]-n[o-1])/r),h=a.getPoints(c);for(let u=0;u<h.length;u++){let d=h[u];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},jC=.001;function YC(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=jC}function GC(e,t){let i=new T(...e.position),n=new T(...e.controlNext.position),r=new T(...t.controlPrevious.position),o=new T(...t.position);return YC(i,n,o)&&YC(i,r,o)}function GU(e){let t=e.points.map(h=>new T(...h.data.position)),i=[e.points[0]],n=new T(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)YC(n,t[h],t[h+1])||(i.push(e.points[h]),n=t[h]);i.push(e.points[e.points.length-1]);let r=e.isClosed,o=i.length-(r?0:1),s=i.length,a=[];for(let h=0;h<s;h++){let u=i[h].data,d=new T(...u.position),p=new T(...u.controlPrevious.position),f=new T(...u.controlNext.position),m={position:d,baseRoundness:u.roundness,controlPrevious:p,controlNext:f};if(0===u.roundness||!e.isClosed&&(0===h||h===s-1)){a[h]={...m,removedLength:0};continue}let y=i[r&&0==h?s-1:h-1].data,_=i[r&&h==s-1?0:h+1].data,b=new T(...y.position),x=new T(..._.position),w=b.clone().sub(d).normalize(),S=x.clone().sub(d).normalize();Object.assign(m,{prevDir:w,nextDir:S});let C=GC(y,u),M=GC(u,_);if(C&&M){let z=w.clone().add(S).normalize(),E=z.clone().cross(w).length()/w.dot(z);a[h]={...m,tan:E,removedLength:u.roundness/E}}else a[h]={...m,removedLength:0}}for(let h=0;h<o;h++){let p=a[h],f=a[r&&h===s-1?0:h+1];if(0!==p.removedLength||0!==f.removedLength){let m=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,m/2),f.removedLength=Math.min(f.removedLength,m/2)}}let l=[];for(let h=0;h<o;h++){let d=r&&h===s-1?0:h+1,p=a[h],f=a[d],m=null;if(GC(i[h].data,i[d].data)){let g=p.position.clone(),v=f.position.clone();(0!==p.removedLength||0!==f.removedLength)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(v)>jC&&(m=new e8(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}else p.position.distanceTo(f.position)>jC&&(m=new e8(p.position,p.controlNext,f.controlPrevious,f.position));l[2*h+1]=m}for(let h=0;h<s;h++){let u=a[h];if(0===u.removedLength){l[2*h]=null;continue}let d=u.position,p=u.prevDir.clone().multiplyScalar(u.removedLength).add(d),f=u.nextDir.clone().multiplyScalar(u.removedLength).add(d),m=u.tan*u.removedLength,g=u.prevDir.clone().add(u.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,_=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),b=g.clone().multiplyScalar(-m).add(_),x=d.distanceTo(b)/d.distanceTo(v),w=u.prevDir.clone().multiplyScalar(x*d.distanceTo(p)).add(d),S=w.clone().lerp(b,2),C=p.clone().lerp(w,4/3),M=f.clone().lerp(S,4/3);l[2*h]=new e8(p,C,M,f)}let c=new txe;return l.forEach(h=>{h&&c.add(h)}),c}(e=>{e.is=function t(i){return i&&i.__isEntity}})(Ti||(Ti={}));var gh=e=>Ti.is(e),ixe={type:"completeState",isfromEntity:!0},nxe=["x","y","z"],WC=new T,rxe=(new T).set(0,1,0),qC=e=>class extends(UC(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new YU,this._recursiveBBox=new YU,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Ti.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Ti.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let t=this;for(;"Instance"!==t.data.type;){let i=t.parent;if(!Ti.is(i))return;t=i}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){"string"==typeof t&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,n=!1){if(0!==this.data.states.length||n){for(let r of this.data.states)Kd.toOps(this.data,r.data).forEach(o=>{let s=Y8.replaceProps(o,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,i)});if(null!==t){let r=this.data.states.data(t);r&&(this.dataPatched=Kd.patch(this.data,r),Kd.toOps(this.data,r).forEach(o=>{this.updateByPatchedOp(o,this.dataPatched,i)}))}n&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{gh(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(n=>{n.uuid===t&&(i=n)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,n=i.indexOf(this)+1;if(Ti.is(i[n]))return i[n];if(Ti.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Ti.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&null!==i;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,n=this;for(;n!==t;){if(null===n)return-1;n=n.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)gh(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Ti.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(!0!==t(this,i))for(let n of this.children)gh(n)&&n.isConcreteEntity&&n.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(!0!==t(this,i))for(let n of this.children)gh(n)&&n.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)gh(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>gh(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(n=>{n.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*et.RAD2DEG,this.rotation.y*et.RAD2DEG,this.rotation.z*et.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return zw(i,t)}getTransformValues(t,i,n){return i[t].map((r,o)=>n?.shared.getVariable(r,[this.uuid,t,nxe[o]])??r)}updateTransformState(t,i){let n=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),n=!0),t.rotation&&(WC.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(et.DEG2RAD),this.rotation.setFromVector3(WC),n=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),n=!0),void 0!==t.hiddenMatrix&&(n=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Af.identity)),n&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&this.updateWorldMatrix(!1,!0),n}onVariableUpdate(t=!1){t?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)}))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Ti.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Ti.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return zw(i,t)}updateByObjUpdateOp(t,i){void 0!==t&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,n,r){let o=this.data;this.data=i;let s=t,a=yn(t.path,["states","*"]);if(null!==a){if(0===t.type){let[l]=a;if(this?.stateSelection===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(h=>void 0===h)){let h=this.data;if(void 0!==h){let u=Mo.zoom(h,t.path.slice(2));if(u)for(let d in t.props)void 0===t.props[d]&&d in u&&(c[d]=u[d])}}s={...t,props:c,path:t.path.slice(2)}}}}else if(0===t.type){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==l){if(void 0!==t.props.name&&l.name){let{name:h,...u}=l;l=u}if(void 0!==t.props.material&&"material"in l){let{material:h,...u}=l;l=u}let c=Mo.removeOverridden(t.path,t.props,l);s={...t,props:c}}}if(this.updateByPatchedOpBase(s,Kd.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),yn(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&"descendants"===c[0];)l.push(c[1]),c.splice(0,2);if(void 0===l[l.length-1]){if(0===t.type)for(let h of Object.keys(t.props)){l[l.length-1]=h;let u=n.scene.findInstance([this.uuid,...l]);u&&(u.overrideData=t.props[h],u.updateState(du.apply(u.component.data,u.overrideData),n))}}else{let h=n.scene.findInstance([this.uuid,...l]);if(h){let u=Mo.zoom(h.component.data,c);if(0===(t={...t,path:c}).type){let d=t.props;if(u)for(let[p,f]of Object.entries(t.props))void 0===f&&(d===t.props&&(d={...t.props}),d[p]=u[p]);t={...t,props:d}}h.overrideData=c6.resolve(i.overrides,l),h.updateByOp(t,oo.applySimple(h.data,t),n,!1)}}}else if(this.instances.length>0){let l;if(0===t.path.length&&0===t.type){let c;for(let h of vu.rootOverrideProps)h in t.props&&(void 0===c&&(c={}),c[h]=t.props[h]);c&&(l={...t,props:c})}else for(let c of vu.rootOverrideProps)if(yn(t.path,[c])){l=t;break}void 0!==l&&this.instances.forEach(c=>{if(c.isInstanceRoot){let h=du.filterOp(c.overrideData,l);h&&c.updateByOp(h,oo.applySimple(c.data,h),n,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let h=du.filterOp(c.overrideData,t);if(h){let u;u=o===c.data&&t===h?i:oo.applySimple(c.data,h),c.updateByOp(h,u,n,!0)}}})}}updateByPatchedOpBase(t,i,n){if(this.dataPatched=i,0===t.path.length&&0===t.type)void 0!==t.props.type&&!Zd.is(t.props.type)&&Mu.changeEntityProptotype(this,i,n);else if(1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&"type"in t.props){Mu.changeEntityProptotype(this,i,n);for(let r of this.children)Ti.is(r)&&r.updateVisible(n.scene)}this.updateByPatchedOp(t,i,n)}updateByPatchedOp(t,i,n){if(0===t.path.length&&0===t.type&&this.updateState(t.props,n),null!==yn(t.path,["pathSnapping"])&&this.updatePathSnapping(i.pathSnapping),null!==yn(t.path,["cloner"])){let r=oo.drop(t,1);0===r.path.length&&0===r.type&&!0===r.props.disabled?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(i.cloner,n.scene):(this.setFromClonerState(i.cloner,n),this.expandCloner(n.scene)),this.updateVisible(n.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let i=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,n=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,r=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,o=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===i)return;let s=t.find(i);if(!s||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let a=s.data;if(a.geometry.path.points.length<=1)return;let l=GU(a.geometry.path),c=(n+r)%1;n+r===1&&0===c&&(c=1);let h=l.getPointAt(c);if(null===h)return;let u=this.parent?this.parent?.matrixWorld:new De;s.updateMatrixWorld();let d=(new De).multiplyMatrices(u.clone().invert(),s.matrixWorld);h.applyMatrix4(d);let p={position:h.toArray(),rotation:a.rotation};if("tangential"===o){let f=(new De).extractRotation(s.matrixWorld),m=l.getTangentAt(c).applyMatrix4(f).add(h),g=(new De).lookAt(h,m,rxe),v=WC.setFromEuler((new Ur).setFromRotationMatrix(g)).multiplyScalar(et.RAD2DEG);p={...p,rotation:v.toArray()}}this.updateTransformState(p),this.traverseEntity(f=>{f._cameraType&&f.dispatchEvent(ixe)})}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==this.dataPatched.cloner?.hideBase),!t)return;let i=!1;this.traverseEntity(n=>{if("Splat"===n.data.type)return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){void 0!==t.name&&(this.name=t.name),void 0!==t.raycastLock&&(this.raycastLock=t.raycastLock),void 0!==t.visible&&(this.updateVisible(i?.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&void 0!==t.cloner&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Mu.Cloner&&"toObject"===t.parameters.type)}setFromClonerState(t,i){this.disposed||(null===t||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new Mu.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},WU=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);i.thetaLength=et.clamp(i.thetaLength,0,360);let n=i.width/2,r=i.radiusTop??n,o=i.radiusBottom??n;return r===o?(r=n,o=n):r>o?(r=n,o=o*n/r):(r=r*n/o,o=n),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:r,radiusBottom:o})}}static build(e){let f,{width:t,depth:i,height:n,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l,radiusTop:c,radiusBottom:h,cornerRadius:u,cornerSegments:d,hollow:p}=e.parameters;return 0===l?(f=new gt,f.setAttribute("position",new Ke([],3))):f=u||p?new XU(c,h,n,r,o,s,a,l*Math.PI/180,u,u,d,p):new Bx(c,h,n,r,o,s,a,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function zu(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function qU(e){return new $(e.y,-e.x)}var XU=class extends gt{constructor(e,t,i,n,r,o,s,a,l,c,h,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI,o&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,_=new T,b=new T;d&&0==e&&(e=l),d&&0==t&&(t=c);let x=new $(e,y),w=new $(t,-y),S=null,C=null,M=null,z=null,E=x.clone().sub(w),D=0,P=0,I=0;u>0&&(D=Math.min(e,t)*(1-u),P=e-D,I=t-D);let B=x.clone();B.x-=D;let V=Math.PI-E.angle(),R=E.angle(),N=Math.tan(R/2),W=Math.tan(V/2),Q=N+W,Y=u?Q:N;if(l=Math.min(l,(e-P)/(u?Q:W),E.length()/Q),c=Math.min(c,(t-I)/Y,E.length()/Q),l>0){let te=l/N;S=x.clone().sub(new $(te,l)),u&&(M=S.clone(),M.x-=D-Q*l),x.sub(E.clone().setLength(te))}if(c>0){let te=c/W;C=w.clone().sub(new $(te,-c)),w.add(E.clone().setLength(te)),u&&(z=C.clone(),z.x-=D-Q*c,B.sub(E.clone().setLength(te)))}E=x.clone().sub(w);let J=E.length()<.5,q=[];for(let te=0;te<=n;te++){let pe=[],se=te/n,ze=se*a+s,_e=new $(Math.sin(ze),Math.cos(ze));if(z&&C?(ee(pe,se,_e,V,c,z,-1,!0),ee(pe,se,_e,R,c,C,-1,!1)):C?(Z(pe,_e,C.x,0,-1),ee(pe,se,_e,R,c,C,-1,!1)):o||Z(pe,_e,t,I,-1),zu(qU(E).normalize(),_e,_),!J)for(let Xe=0;Xe<=r;Xe++){let $e=Xe/r;zu(E.clone().multiplyScalar($e).add(w),_e,b),f.push(b.x,b.y,b.z),m.push(_.x,_.y,_.z),g.push(se,.5+b.y/i),pe.push(v++)}if(M&&S?(ee(pe,se,_e,V,l,S,1,!1),ee(pe,se,_e,R,l,M,1,!0)):S?(ee(pe,se,_e,V,l,S,1,!1),Z(pe,_e,S.x,0,1)):o||Z(pe,_e,e,P,1),u&&!J){zu(qU(E).multiplyScalar(-1).normalize(),_e,_);for(let $e=0;$e<=r;$e++){let Ze=$e/r;zu(E.clone().multiplyScalar(-Ze).add(B),_e,b),f.push(b.x,b.y,b.z),m.push(_.x,_.y,_.z),g.push(se,.5+b.y/i),pe.push(v++)}}u&&!o&&pe.push(pe[0]),q.push(pe)}for(let te=0;te<q.length-1;te++)for(let pe=0;pe<q[0].length-1;pe++){if(o&&u&&pe==r)continue;let ze=q[te+1][pe],_e=q[te+1][pe+1],ge=q[te][pe+1],Xe=f[3*_e+0],$e=f[3*_e+2];p.push(q[te][pe],ze,ge),(0!=Xe||0!=$e)&&p.push(ze,_e,ge)}function ee(te,pe,se,ze,_e,ge,Xe,$e){for(let Ze=0;Ze<h+1;Ze++){let rt=Ze/h,Ve=Xe<0?rt:1-rt;$e&&(Ve-=1),Ve*=ze;let Le=new $(Math.sin(Ve),Math.cos(Ve)*Xe);zu(Le.clone().multiplyScalar(_e).add(ge),se,b),f.push(b.x,b.y,b.z),zu(Le,se,_),m.push(_.x,_.y,_.z),g.push(pe,.5+b.y/i),te.push(v++)}}function Z(te,pe,se,ze,_e){let ge=new T,Xe=new $,$e=[se,ze];_e<0&&$e.reverse();for(let Ze of $e)Xe.set(Ze,y*_e),zu(Xe,pe,ge),f.push(ge.x,ge.y,ge.z),m.push(0,_e,0),g.push(.5,.5),te.push(v++)}function ce(te,pe,se){let ze=new $(Math.sin(se),Math.cos(se)),_e=new $(-Math.cos(se),Math.sin(se)),ge=new T,Xe=te<0?(rt,Ve,Le)=>p.push(rt,Ve,Le):(rt,Ve,Le)=>p.push(rt,Le,Ve);zu(new $((e+t+P+I)/4,0),ze,ge),f.push(ge.x,ge.y,ge.z),m.push(_e.x,0,_e.y),g.push(.5,.5);let Ze=v++;for(let rt of pe){let Ve=f.slice(3*rt,3*rt+3);f.push(...Ve),m.push(_e.x,0,_e.y);let Le=g.slice(2*rt,2*rt+2);g.push(...Le),v++}for(let rt=Ze+1;rt<v-1;rt++)Xe(Ze,rt,rt+1);Xe(Ze,v-1,Ze+1)}a<2*Math.PI&&(ce(-1,q[0],s),ce(1,q[q.length-1],s+a)),this.setIndex(p),this.setAttribute("position",new Ke(f,3)),this.setAttribute("normal",new Ke(m,3)),this.setAttribute("uv",new Ke(g,2))}},XC=Math.PI/2,axe=class extends gt{constructor(e=1,t=1,i=1,n=1,r=1,o=1,s=0,a=4){super(),this.type="BoxGeometry";let l=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o),a=Math.floor(a),s=Math.min(s,e/2,t/2,i/2);let c=[],h=[],u=[],d=[],p=0,f=0;function m(y,_,b,x,w,S,C,M,z,E,D){let P=(S-2*s)/z,I=(C-2*s)/E,B=S/2-s,V=C/2-s,R=M/2,N=z+1,W=E+1,Q=0,G=0,Y=new T;for(let J=0;J<W;J++){let q=J*I-V;for(let ee=0;ee<N;ee++)Y[y]=(ee*P-B)*x,Y[_]=q*w,Y[b]=R,h.push(Y.x,Y.y,Y.z),Y[y]=0,Y[_]=0,Y[b]=M>0?1:-1,u.push(Y.x,Y.y,Y.z),d.push(ee/z),d.push(1-J/E),Q+=1}for(let J=0;J<E;J++)for(let q=0;q<z;q++){let Z=p+q+N*(J+1),ce=p+(q+1)+N*(J+1),te=p+(q+1)+N*J;c.push(p+q+N*J,Z,te),c.push(Z,ce,te),G+=6}l.addGroup(f,G,D),f+=G,p+=Q}function g(y,_,b,x,w,S,C,M,z,E,D){let P=(C-2*s)/E,I=C/2-s,B=M/2-s,V=z/2,R=E+1,N=0,W=0,Q=new T,G=new T;for(let Y=0;Y<a+1;Y++){let J=Y/a*XC,q=Math.sin(J)*s,ee=(1-Math.cos(J))*s,Z=Math.sin(J),ce=Math.cos(J);Q[_]=(B+q)*w,Q[b]=(V-ee)*S,G[y]=0,G[_]=Z*Math.sign(Q[_]),G[b]=ce*Math.sign(Q[b]);for(let te=0;te<R;te++)Q[y]=(te*P-I)*x,h.push(Q.x,Q.y,Q.z),u.push(G.x,G.y,G.z),d.push(te/E),d.push(0),N+=1}for(let Y=0;Y<a;Y++)for(let J=0;J<E;J++){let ee=p+J+R*(Y+1),Z=p+(J+1)+R*(Y+1),ce=p+(J+1)+R*Y;c.push(p+J+R*Y,ee,ce),c.push(ee,Z,ce),W+=6}l.addGroup(f,W,D),f+=W,p+=N}function v(y,_,b){let x=new T,w=new T(e/2,t/2,i/2);w.subScalar(s);let S=[],C=y*_*b>0?(z,E,D)=>c.push(z,E,D):(z,E,D)=>c.push(z,D,E);for(let z=0;z<=a;z++){let E=[],D=XC*(1-z/a),P=Math.cos(D),I=Math.sin(D),B=0;for(let V=0;V<=z;V++){let R=Math.cos(B),N=Math.sin(B);x.x=P*R,x.y=I,x.z=P*N;let W=w.clone().addScaledVector(x,s);h.push(y*W.x,_*W.y,b*W.z),u.push(y*x.x,_*x.y,b*x.z),d.push(0,0),E.push(p++),B+=XC/z}S.push(E)}let M=S.length-1;for(let z=0;z<M;z++){let E=S[z],D=S[z+1],P=E.length-1;C(E[0],D[1],D[0]);for(let I=1;I<=P;I++)C(E[I-1],E[I],D[I]),C(E[I],D[I+1],D[I])}}m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,n,o,2),m("x","z","y",1,-1,e,i,-t,n,o,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),s>0&&(g("z","y","x",-1,-1,1,i,t,e,o,0),g("z","y","x",1,-1,-1,i,t,e,o,1),g("z","y","x",-1,1,-1,i,t,e,o,1),g("z","y","x",1,1,1,i,t,e,o,0),g("x","y","z",-1,-1,-1,e,t,i,n,0),g("x","y","z",1,-1,1,e,t,i,n,1),g("x","y","z",-1,1,1,e,t,i,n,0),g("x","y","z",1,1,-1,e,t,i,n,1),g("y","x","z",-1,-1,1,t,e,i,r,0),g("y","x","z",1,-1,-1,t,e,i,r,1),g("y","x","z",1,1,1,t,e,i,r,1),g("y","x","z",-1,1,-1,t,e,i,r,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new Ke(h,3)),this.setAttribute("normal",new Ke(u,3)),this.setAttribute("uv",new Ke(d,2))}},$C=class extends gt{constructor(e=[],t=[],i="",n=1,r=.2,o=4){super(),this.type="PolyhedronGeometryRound";let s=[],a=[],l=[];return function c(){0==(r=Math.min(.99999,r))&&(o=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new T,p=d.clone(),f=new Co,m=r*n,g=n-m,v=o+1,y=new T,_=(R,N)=>y.subVectors(R,N).normalize(),b=(R,N)=>Array(R).fill(void 0).map(N),x=b(e.length/3,(R,N)=>(new T).fromArray(e,3*N).setLength(n)),w=[],S=1e6;for(let R=0;R<x.length;R++){let Q,G,Y,N=x[R],W=[],J=1e10,q=-1;for(;-1!=(q=t.indexOf(R,q+1));){let te=q-q%3;Q=t[te+(q+1)%3],G=t[te+(q+2)%3],Y=N.distanceToSquared(x[Q]),J=Math.min(J,Y),W.push([Q,G,Y])}J+=1e-6;let ee=[],Z=0,ce=W.length;for(let te=0;te<ce;te++){[Q,G,Y]=W[Z];let pe=1==w[Q]?.includes(R);Y<=J&&ee.push(Q+ +pe*S),Z=W.findIndex(se=>se[0]==G)}w.push(ee)}let C=[];{let W,Q,R=0,N=0,G=3==u;for(let Y=0;Y<=o;Y++){W=Y*(Y+1)/2,Q=(Y+1)*(Y+2)/2;for(let J=0;J<o-Y;J++)[R,N]=[W+J+Y+2,Q+J+Y+3],C.push(W,Q,...G?[N,W]:[R,Q],N,R),[W,Q]=[R,N];C.push(W,Q,W+o+2)}}let M=d.clone(),z=d.clone(),E=d.clone(),D=d.clone(),P=d.clone(),I=[],B=b(x.length,()=>b(u,()=>d.clone()));for(let R=0;R<x.length;R++){d.copy(x[R]).normalize(),M.copy(d).multiplyScalar(g);let N=w[R];for(let ee=0;ee<N.length;ee++)f.setFromPointsAndIndices(x,R,N[ee]%S,N[(ee+1)%u]%S),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(M,B[R][ee]);let W=[],Q=[],G=[],Y=new T;0==o&&[...B[R]].reduce((ee,Z)=>ee.add(Z),Y).multiplyScalar(1/u);for(let ee=0;ee<u;ee++){let Z=[],te=B[R][(ee-1+u)%u],pe=B[R][ee];d.copy(te).sub(M),p.copy(pe).sub(M);let se=M.angleTo(d),ze=d.angleTo(p),_e=Math.cos(se)*m;0==o?z.copy(Y):z.copy(M).setLength(g+_e),Q.push(_e);let ge=[z,te,pe];for(let Xe=0;Xe<2;Xe++){let $e=ge[Xe],Ze=ge[Xe+1];D.subVectors($e,M),P.subVectors(Ze,M),E.crossVectors(D,P).normalize();for(let rt=0;rt<v;rt++){let Ve=[se,ze][Xe]*rt/v;d.copy(D).applyAxisAngle(E,Ve).add(M),W.push(d.clone()),Xe&&(_(d,M),Z.push([0==rt?$e:d.clone(),y.clone()]))}Xe&&(_(Ze,M),Z.push([Ze,y.clone()]))}G.push(Z)}I.push(G);let J=2*v,q=2;for(let ee=0;ee<u;ee++){let Z=J*ee,ce=J*((ee+1)%u),te=[W[Z]];for(let se=1;se<v;se++){D=W[Z+se],P=W[ce+se],te.push(D);for(let ze=1,_e=se-q+1;ze<=_e;ze++)d.lerpVectors(D,P,ze/(_e+1)),d.sub(M).setLength(Q[ee]).add(M),te.push(d.clone());te.push(P)}for(let se=0;se<v;se++)te.push(W[se+v+Z]);te.push(W[ce+v]);let pe=C.map(se=>te[se]);s.push(...pe.map(se=>[se.x,se.y,se.z]).flat()),l.push(...pe.map(se=>(_(se,M),[y.x,y.y,y.z])).flat())}}let V=[];for(let R=0;R<w.length;R++)for(let N=0;N<u;N++){let W=w[R][N];if(W<S){let Q=w[W].findIndex(J=>J%S==R),G=I[R][N],Y=I[W][Q];for(let J=0;J<v;J++){let ee=Y[v-J],Z=G[J+1];[G[J],ee,Z,Z,ee,Y[v-(J+1)]].forEach(te=>{s.push(te[0].x,te[0].y,te[0].z),l.push(te[1].x,te[1].y,te[1].z)})}V.push(G[0][0],Y[v][0],G[v][0],Y[0][0])}}for(;V.length;){let R,N,W,Q;[R,N]=V.splice(0,2);let G=[R];for(;R!=N;)G.push(N),W=V.indexOf(N),Q=W%2,N=V.splice(W-Q,2)[1-Q];y.subVectors(G[0],G[1]).cross(d.subVectors(G[0],G[2])).normalize();let Y=y.dot(G[0])<0;Y&&y.negate();for(let J=1;J<=G.length-2;J++)[G[J+ +Y],G[J+1-+Y],G[0]].forEach(q=>{s.push(q.x,q.y,q.z),l.push(y.x,y.y,y.z)})}}(),function h(){let u=new T;for(let w=0;w<s.length;w+=3){u.x=s[w+0],u.y=s[w+1],u.z=s[w+2];let S=b(u)/2/Math.PI+.5,C=x(u)/Math.PI+.5;a.push(S,1-C)}let d=new T,p=new T,f=new T,m=new T,g=new $,v=new $,y=new $,_=(w,S,C,M)=>{M<0&&1===w.x&&(a[S]=w.x-1),0===C.x&&0===C.z&&(a[S]=M/2/Math.PI+.5)};for(let w=0,S=0;w<s.length;w+=9,S+=6){d.set(s[w+0],s[w+1],s[w+2]),p.set(s[w+3],s[w+4],s[w+5]),f.set(s[w+6],s[w+7],s[w+8]),g.set(a[S+0],a[S+1]),v.set(a[S+2],a[S+3]),y.set(a[S+4],a[S+5]),m.copy(d).add(p).add(f).divideScalar(3);let C=b(m);_(g,S+0,d,C),_(v,S+2,p,C),_(y,S+4,f,C)}for(let w=0;w<a.length;w+=6){let S=a[w+0],C=a[w+2],M=a[w+4],z=Math.max(S,C,M),E=Math.min(S,C,M);z>.9&&E<.1&&(S<.2&&(a[w+0]+=1),C<.2&&(a[w+2]+=1),M<.2&&(a[w+4]+=1))}function b(w){return Math.atan2(w.z,-w.x)}function x(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}(),this.setAttribute("position",new Ke(s,3)),this.setAttribute("normal",new Ke(l,3)),void this.setAttribute("uv",new Ke(a,2))}static fromJSON(e){return new $C(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},$U=class extends $C{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,r=1/n,a="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,e,t,i),this.type=a}static fromJSON(e){return new $U(e.radius,e.corner,e.cornerSides)}},h4=1e-12,QC=class{constructor(e){this.position=new $,this.startPosition=new $,this.uuid=et.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new QC(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},ZC=class extends QC{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new ZC(this.parent).copy(this)}},$f=class extends QC{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new ZC(this),new ZC(this))}static create(e,t){let i=new $f(e,new $(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,n=this.controls.length;i<n;i++){let r=this.controls[i];this.position.distanceTo(r.position)<=t?r.position.copy(this.position):r.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new $f(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let e=this.curveBefore?.getTangentAt(1),t=this.curveAfter?.getTangentAt(0);return[e,t]}computeNormals(e=new $,t=new $){let[i,n]=this.computeTangents();return i&&n&&(QU(i,e),QU(n,t)),[e,t]}computeTangent(e=new $){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new $){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function QU(e,t=new $){let i=e.length();return t.set(-e.y/i,e.x/i)}var Qf=new $,A6=new $,cxe=new $,hxe=new $,uxe=new $,dxe=new $,ZU=new T,KU=new T;function pxe(e){let t=new $;t.addVectors(e.v0,Qf.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new $;return i.addVectors(e.v2,A6.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new ol(e.v0,t,i,e.v2)}function u4(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function fxe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function mxe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function JU(e,t,i){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((r*r+n*n-o*o)/(2*r*n))}function gxe(e,t,i){return tj(e,t)&&tj(t,i)&&JC(e.position,t.position,i.position)}function JC(e,t,i){return 0===Qf.copy(t).sub(e).cross(A6.copy(i).sub(e))}function vxe(e,t,i,n,r){let o=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=(e.y+t.y)/2,a=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(e.y-t.y)/o,c=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(t.x-e.x)/o;return n.set(a+l,s+c),r.set(a-l,s-c),[n,r]}function yxe(e,t,i){return e.distanceTo(i)<t.distanceTo(i)?t:e}function _xe(e,t,i,n,r,o){let u,s=t.x-e.x,a=t.y-e.y,l=i.x-e.x,c=i.y-e.y,h=Math.sqrt((s+l)*(s+l)+(a+c)*(a+c));return JU(t,e,i)>Math.PI&&(h*=-1),u=u4(c,a)?(a+c)*(n/h-.5)*8/3/(s-l):(s+l)*(n/h-.5)*8/3/(c-a),r.set(t.x-u*a,t.y+u*s),o.set(i.x+u*c,i.y-u*l),[r,o]}function ej(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function tj(e,t){return JC(e.position,e.controls[1].position,t.position)&&JC(e.position,t.controls[0].position,t.position)}function ij(e,t=12,i=!1){let n=[];for(let r=0,o=e.length;r<o;r++){let s=e[r],a=0;if(i&&void 0!==s.roundedCurveCorner){let l=.5*c1(s.roundedCurveCorner,t);r>0&&(n[r-1]+=l),a+=l}void 0!==s.curveAfter&&(a+=c1(s.curveAfter,t)),n.push(a)}return e.length>0&&i&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*c1(e[0].roundedCurveCorner,t)),n}function c1(e,t=12){return e&&e instanceof Kv?2*t:e&&(e instanceof sl||e instanceof WF)?1:e&&e instanceof Fx?t*e.points.length:t}var sn,Ir,eS=new $,Sxe=new $,Mxe=new $,zxe=new $,Txe=new $,Exe=new $,rr=class extends n8{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new ta(new T(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=et.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let n=new rr;return n.isClosed=e.isClosed,n.points=e.points.map(r=>$f.create(r.id,r.data)),"number"==typeof e.roundness&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map(r=>rr.createFromState(r)),void 0!==t&&void 0!==i&&n.applySize(t,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(n=>n.uuid===e);if(i<0){let n=t;for(let r=0,o=this.shapeHoles.length;r<o;r++){let s=this.shapeHoles[r],a=s.points.length,l=s.getPointIndexById(e);if(!(l<0))return l+n;n+=a}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],o=e-t;if(o<=r.points.length-1)return r.points[o];t+=r.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],o=r.points.indexOf(e);if(o>=0)return t+o;t+=r.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=eS.set(e,t);for(let n=0,r=this.points.length;n<r;n++){let o=this.points[n];o.position.multiply(i),o.controls[0].position.multiply(i),o.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e,t=0,i=et.generateUUID()){let n;n=e instanceof $?e:new $(e,t);let r=new $f(i,n);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];if(n.uuid===e)return n}for(let t=0,i=this.shapeHoles.length;t<i;t++){let n=this.shapeHoles[t].getPointByUuid(e);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let n=i?this.roundedCurveDivisions:this.curveDivisions;return function xxe(e,t,i=12,n=!0){let o,r=KU.set(0,0,0),s=0,a=[];for(let l=0;l<t.length;l++){let c=t[l],h=Qf,u=c1(c,i);a.push(u);for(let d=0;d<=u;d++)if(c instanceof ol||c instanceof lu||c instanceof sl){if(c.getPoint(d/u,h),r.set(h.x,h.y,0),void 0!==o&&mxe(o,r))continue;void 0===o&&(o=ZU),o.copy(r),e.setXYZ(s,r.x,r.y,r.z),s++}}n&&s>1&&!(e.getX(s-1)===e.getX(0)&&e.getY(s-1)===e.getY(0)&&e.getZ(s-1)===e.getZ(0))&&(e.setXYZ(s,e.getX(0),e.getY(0),e.getZ(0)),s++)}(e,i?this.roundedCurves:this.curves,t,this.autoClose),n.reduce((r,o)=>r+o,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=ij(this.points,e,!1),this.roundedCurveDivisions=ij(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return 2*function wxe(e,t,i,n=12,r=!0){let o=KU.set(0,0,0),s=0,a=[];for(let l=0;l<t.length;l++){if(!1===i[l])continue;let c,h=t[l],u=Qf,d=c1(h,n);a.push(d);for(let p=0;p<=d;p++)if(h instanceof ol||h instanceof lu||h instanceof sl){if(h.getPoint(p/d,u),o.set(u.x,u.y,0),c?.equals(o))continue;void 0===c?c=ZU:(e.setXYZ(s,c.x,c.y,c.z),s++,e.setXYZ(s,o.x,o.y,o.z),s++),c.copy(o)}}return r&&s>1&&!(e.getX(s-1)===e.getX(0)&&e.getY(s-1)===e.getY(0)&&e.getZ(s-1)===e.getZ(0))&&(e.setXYZ(s,e.getX(0),e.getY(0),e.getZ(0)),s++),a}(e,this.curves,t,i,this.autoClose).reduce((n,r)=>n+r,0)}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function Cxe(e,t,i=12,n=!0){let r,o=0;for(let s=0;s<t.length;s++){let a=t[s],l=c1(a,i),c=Qf;for(let h=0;h<=l;h++)if(a instanceof ol||a instanceof lu||a instanceof sl){if(a.getPoint(h/l,c),void 0!==r&&fxe(r,c,h4))continue;void 0===r&&(r=A6),r.copy(c),e.push(c.x,c.y),o++}}return u4(e[0],e[e.length-2],h4)&&u4(e[1],e[e.length-1],h4)&&(e.pop(),e.pop()),n&&o>1&&!(u4(e[o-1],e[1],h4)&&u4(e[o-2],e[0],h4))&&(e.push(e[0],e[1]),o++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*c1(this.points[0].roundedCurveCorner,this.subdivision));let o=e-r;o<0&&(o+=n.reduce((s,a)=>s+a,0));for(let s=0,a=n.length;s<a;s++){let l=n[s];if(o<i+l)return[s,(o-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let n=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],o=this.curveDivisions,s=o[e];if(ej(n,r)){let l=n.position.distanceTo(r.position);return n.position.distanceTo(eS.set(i.x,i.y))/l}let a=0;for(let l=0;l<e;l++)a+=o[l];return(t-a)/s}dispose(){}_applyCurveForPoint(e,t){ej(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let n=i.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];0===t?this.moveTo(n.position.x,n.position.y):this._applyCurveForPoint(n,this.points[t-1])}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed&&this._applyCurveForPoint(this.points[0],this.points[this.points.length-1]),this.points.length>2){let t=0;for(let i=0,n=this.points.length;i<n;i++){let r=this.points[i],o=this.points[i-1]??this.points[this.points.length-1],s=this.points[i+1]??this.points[0],a=r.roundness,l=o&&s&&gxe(o,r,s);if(!r.controlsMoved()&&a>0&&!l){let c=r.curveBefore,h=r.curveAfter;if(void 0===c||void 0===h)continue;let w,u=r.roundedCurveBefore,d=r.roundedCurveAfter,p=c.getLength(),f=h.getLength(),m=Math.min(a,.499*p),g=Math.min(a,.499*f),v=Math.min(m,g),y=1-v/p,_=v/f,b=c.getPointAt(y,eS),x=h.getPointAt(_,Sxe);if(this._subSplitCurve(c,u,y,b,void 0),this._subSplitCurve(h,d,_,void 0,x),this.useCubicForRoundedCorners){let S=JU(b,r.position,x)/2,C=Math.tan(S)*b.distanceTo(r.position),[M,z]=vxe(b,x,C,Mxe,zxe),E=yxe(M,z,r.position),[D,P]=_xe(E,b,x,C,Txe,Exe);w=new ol(b.clone(),D.clone(),P.clone(),x.clone())}else w=new lu(b.clone(),r.position.clone(),x.clone());r.roundedCurveCorner=w,this.roundedCurves.splice(i+t,0,w),t++}}}}_subSplitCurve(e,t,i,n,r){if(!(e instanceof sl)){let o=e,s=t,a=o.getUtoTmapping(i,0),l=function bxe(e,t,i,n,r=.5){let o=Qf.subVectors(t,e).multiplyScalar(r).add(e),s=A6.subVectors(i,t).multiplyScalar(r).add(t),a=cxe.subVectors(n,i).multiplyScalar(r).add(i),l=o,c=hxe.subVectors(s,o).multiplyScalar(r).add(o),h=uxe.subVectors(a,s).multiplyScalar(r).add(s),u=a,d=dxe.subVectors(h,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,n.x,n.y]}(o.v0,o.v1,o.v2,o.v3,a);return void 0!==n&&(s.v0.set(l[0],l[1]),s.v1.set(l[2],l[3]),s.v2.set(l[4],l[5]),s.v3.set(l[6],l[7])),void 0!==r&&(s.v0.set(l[6],l[7]),s.v1.set(l[8],l[9]),s.v2.set(l[10],l[11]),s.v3.set(l[12],l[13])),s}return void 0!==n&&t.v2.copy(n),void 0!==r&&t.v1.copy(r),t}clone(){let e=new rr(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let n=7*i,r=e.points[n+0],o=e.points[n+1],s=e.points[n+2],a=e.points[n+3],l=e.points[n+4],c=e.points[n+5],h=e.points[n+6],u=new $f(et.generateUUID(),new $(r,o));u.controls[0].position.set(s,a),u.controls[1].position.set(l,c),u.roundness=h,this.points.push(u)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map(i=>{let n=new rr;return n.fromJSON(i),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(r,o)=>{o instanceof ol&&o.v3.equals(r.position)&&r.controls[0].position.copy(o.v2)};return this.points=(r=>{let s,a,o=[];for(s=0,a=r.length;s<a;s++)r[s]instanceof lu&&(r[s]=pxe(r[s]));for(s=0,a=r.length;s<a;s++){let d,h=r[s],u=s>0?r[s-1]:null;h instanceof ol?(d=this.createPoint(h.v0),d.controls[1].position.copy(h.v1)):h instanceof sl&&(d=this.createPoint(h.v1)),void 0!==d&&(null!==u&&i(d,u),o.push(d))}let l=r[r.length-1],c=!1;return l instanceof ol?l.v3.equals(o[0].position)&&(o[0].controls[0].position.copy(l.v2),c=!0):l instanceof sl&&l.v2.equals(o[0].position)&&(c=!0),this.isClosed=c,o})(e.curves),e instanceof n8&&(this.shapeHoles=e.holes.map(r=>{let o=new rr;return o.fromShape(r),o})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.roundness&&(i.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},tS=2*Math.PI;function iS({x:e,y:t},i,n,r,o){return{x:e*i+r,y:t*n+o}}function Dxe(e,t){let i=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),r=Math.sin(e),o=Math.cos(e+t),s=Math.sin(e+t);return[{x:n-r*i,y:r+n*i},{x:o+s*i,y:s-o*i},{x:o,y:s}]}function nj(e,t,i,n){let r=e*n-t*i<0?-1:1,o=Math.min(1,Math.max(-1,e*i+t*n));return r*Math.acos(o)}function kt(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(sn||(sn={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(Ir||(Ir={}));var wt=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,n){kt(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,o=n.s-i.s;return r+o>0?r<o?i.t-t.t+r/(r+o)*(t.t-n.t):i.t-n.t+o/(r+o)*(n.t-t.t):0},e.edgeSign=function(t,i,n){kt(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,o=n.s-i.s;return r+o>0?(i.t-n.t)*r+(i.t-t.t)*o:0},e.transEval=function(t,i,n){kt(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,o=n.t-i.t;return r+o>0?r<o?i.s-t.s+r/(r+o)*(t.s-n.s):i.s-n.s+o/(r+o)*(n.s-t.s):0},e.transSign=function(t,i,n){kt(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,o=n.t-i.t;return r+o>0?(i.s-n.s)*r+(i.s-t.s)*o:0},e.vertCCW=function(t,i,n){return t.s*(i.t-n.t)+i.s*(n.t-t.t)+n.s*(t.t-i.t)>=0},e.interpolate=function(t,i,n,r){return(t=t<0?0:t)<=(n=n<0?0:n)?0===n?(i+r)/2:i+t/(t+n)*(r-i):r+n/(t+n)*(i-r)},e.intersect=function(t,i,n,r,o){var s,a,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(n,r)||(l=n,n=r,r=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.vertLeq(n,i)?e.vertLeq(i,r)?((s=e.edgeEval(t,n,i))+(a=e.edgeEval(n,i,r))<0&&(s=-s,a=-a),o.s=e.interpolate(s,n.s,a,i.s)):((s=e.edgeSign(t,n,i))+(a=-e.edgeSign(t,r,i))<0&&(s=-s,a=-a),o.s=e.interpolate(s,n.s,a,r.s)):o.s=(n.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(n,r)||(l=n,n=r,r=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.transLeq(n,i)?e.transLeq(i,r)?((s=e.transEval(t,n,i))+(a=e.transEval(n,i,r))<0&&(s=-s,a=-a),o.t=e.interpolate(s,n.t,a,i.t)):((s=e.transSign(t,n,i))+(a=-e.transSign(t,r,i))<0&&(s=-s,a=-a),o.t=e.interpolate(s,n.t,a,r.t)):o.t=(n.t+i.t)/2},e}(),d4=function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},P6=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Zf=function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},rj=function(){function e(){var t=new Zf,i=new d4,n=new P6(0),r=new P6(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,n.next=n,n.Sym=r,r.next=r,r.Sym=n,this.vHead=t,this.fHead=i,this.eHead=n,this.eHeadSym=r}return e.prototype.makeEdge_=function(t){var i=new P6(0),n=new P6(1);t.Sym.side<t.side&&(t=t.Sym);var r=t.Sym.next;return n.next=r,r.Sym.next=i,i.next=t,t.Sym.next=n,i.Sym=n,i.Onext=i,i.Lnext=n,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,n.Sym=i,n.Onext=n,n.Lnext=i,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,i},e.prototype.splice_=function(t,i){var n=t.Onext,r=i.Onext;n.Sym.Lnext=i,r.Sym.Lnext=t,t.Onext=r,i.Onext=n},e.prototype.makeVertex_=function(t,i,n){var r=t;kt(r,"Vertex can't be null!");var o=n.prev;r.prev=o,o.next=r,r.next=n,n.prev=r,r.anEdge=i;var s=i;do{s.Org=r,s=s.Onext}while(s!==i)},e.prototype.makeFace_=function(t,i,n){var r=t;kt(r,"Face can't be null");var o=n.prev;r.prev=o,o.next=r,r.next=n,n.prev=r,r.anEdge=i,r.trail=null,r.marked=!1,r.inside=n.inside;var s=i;do{s.Lface=r,s=s.Lnext}while(s!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,n=t.Sym.next;i.Sym.next=n,n.Sym.next=i},e.prototype.killVertex_=function(t,i){var n=t.anEdge,r=n;do{r.Org=i,r=r.Onext}while(r!==n);var o=t.prev,s=t.next;s.prev=o,o.next=s},e.prototype.killFace_=function(t,i){var n=t.anEdge,r=n;do{r.Lface=i,r=r.Lnext}while(r!==n);var o=t.prev,s=t.next;s.prev=o,o.next=s},e.prototype.makeEdge=function(){var t=new Zf,i=new Zf,n=new d4,r=this.makeEdge_(this.eHead);return this.makeVertex_(t,r,this.vHead),this.makeVertex_(i,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},e.prototype.splice=function(t,i){var n=!1,r=!1;if(t!==i){if(i.Org!==t.Org&&(r=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!r){var o=new Zf;this.makeVertex_(o,i,t.Org),t.Org.anEdge=t}if(!n){var s=new d4;this.makeFace_(s,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,n=!1;if(t.Lface!==t.Rface&&(n=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!n){var r=new d4;this.makeFace_(r,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),n=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var r=new Zf;return this.makeVertex_(r,n,i.Org),i.Lface=n.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var n=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,n),t.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=t.Rface,n.winding=t.winding,n.Sym.winding=t.Sym.winding,n.idx=t.idx,n.Sym.idx=t.Sym.idx,n},e.prototype.connect=function(t,i){var n=!1,r=this.makeEdge_(t),o=r.Sym;if(i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(r,t.Lnext),this.splice_(o,i),r.Org=t.Dst,o.Org=i.Org,r.Lface=o.Lface=t.Lface,t.Lface.anEdge=o,!n){var s=new d4;this.makeFace_(s,r,t.Lface)}return r},e.prototype.zapFace=function(t){var n,r,o,s,a,i=t.anEdge;r=i.Lnext;do{r=(n=r).Lnext,n.Lface=null,null===n.Rface&&(n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),(o=n.Sym).Onext===o?this.killVertex_(o.Org,null):(o.Org.anEdge=o.Onext,this.splice_(o,o.Oprev)),this.killEdge_(n))}while(n!=i);(a=t.next).prev=s=t.prev,s.next=a},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,n=0;do{n++,i=i.Lnext}while(i!==t.anEdge);return n},e.prototype.mergeConvexFaces=function(t){var i,n,r,o,s;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(s=(n=i.anEdge).Org;r=n.Lnext,(o=n.Sym)&&o.Lface&&o.Lface.inside&&this.countFaceVerts_(i)+this.countFaceVerts_(o.Lface)-2<=t&&wt.vertCCW(n.Lprev.Org,n.Org,o.Lnext.Lnext.Org)&&wt.vertCCW(o.Lprev.Org,o.Org,n.Lnext.Lnext.Org)&&(r=o.Lnext,this.delete(o),n=null,o=null),!n||n.Lnext.Org!==s;)n=r;return!0},e.prototype.check=function(){var r,o,s,a,l,c,t=this.fHead,i=this.vHead,n=this.eHead;for(o=t,o=t;(r=o.next)!==t;o=r){kt(r.prev===o),l=r.anEdge;do{kt(l.Sym!==l),kt(l.Sym.Sym===l),kt(l.Lnext.Onext.Sym===l),kt(l.Onext.Sym.Lnext===l),kt(l.Lface===r),l=l.Lnext}while(l!==r.anEdge)}for(kt(r.prev===o&&null===r.anEdge),a=i,a=i;(s=a.next)!==i;a=s){kt(s.prev===a),l=s.anEdge;do{kt(l.Sym!==l),kt(l.Sym.Sym===l),kt(l.Lnext.Onext.Sym===l),kt(l.Onext.Sym.Lnext===l),kt(l.Org===s),l=l.Onext}while(l!==s.anEdge)}for(kt(s.prev===a&&null===s.anEdge),c=n,c=n;(l=c.next)!==n;c=l)kt(l.Sym.next===c.Sym),kt(l.Sym!==l),kt(l.Sym.Sym===l),kt(null!==l.Org),kt(null!==l.Dst),kt(l.Lnext.Onext.Sym===l),kt(l.Onext.Sym.Lnext===l);kt(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&null===l.Org&&null===l.Dst&&null===l.Lface&&null===l.Rface)},e}(),oj=function e(){this.handle=null},sj=function e(){this.key=null,this.node=0},Ixe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var n=0;n<t+1;n++)this.nodes[n]=new oj,this.handles[n]=new sj;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var r,o,s,i=this.nodes,n=this.handles;for(r=i[t].handle;;){if((s=t<<1)<this.size&&this.leq(n[i[s+1].handle].key,n[i[s].handle].key)&&++s,kt(s<=this.max),o=i[s].handle,s>this.size||this.leq(n[r].key,n[o].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=o,n[o].node=t,t=s}},e.prototype.floatUp_=function(t){var r,o,s,i=this.nodes,n=this.handles;for(r=i[t].handle;;){if(o=i[s=t>>1].handle,0===s||this.leq(n[o].key,n[r].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=o,n[o].node=t,t=s}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,n;if(2*(i=++this.size)>this.max){var r,o;for(this.max*=2,o=this.nodes.length,this.nodes.length=this.max+1,r=o;r<this.nodes.length;r++)this.nodes[r]=new oj;for(o=this.handles.length,this.handles.length=this.max+1,r=o;r<this.handles.length;r++)this.handles[r]=new sj}return 0===this.freeList?n=i:this.freeList=this.handles[n=this.freeList].node,this.nodes[i].handle=n,this.handles[n].node=i,this.handles[n].key=t,this.initialized&&this.floatUp_(i),n},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,n=t[1].handle,r=i[n].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[n].key=null,i[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),r},e.prototype.delete=function(t){var r,i=this.nodes,n=this.handles;kt(t>=1&&t<=this.max&&null!==n[t].key),i[r=n[t].node].handle=i[this.size].handle,n[i[r].handle].node=r,--this.size,r<=this.size&&(r<=1||this.leq(n[i[r>>1].handle].key,n[i[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),n[t].key=null,n[t].node=this.freeList,this.freeList=t},e}(),nS=function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},aj=function e(){this.key=null,this.next=null,this.prev=null},Oxe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new aj,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do{i=i.next}while(null!==i.key&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,i));var n=new aj;return n.key=i,n.next=t.next,t.next.prev=n,n.prev=t,t.next=n,n},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),kxe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,n){var r=t.event,o=i.eUp,s=n.eUp;return o.Dst===r?s.Dst===r?wt.vertLeq(o.Org,s.Org)?wt.edgeSign(s.Dst,o.Org,s.Org)<=0:wt.edgeSign(o.Dst,s.Org,o.Org)>=0:wt.edgeSign(s.Dst,r,s.Org)<=0:s.Dst===r?wt.edgeSign(o.Dst,r,o.Org)>=0:wt.edgeEval(o.Dst,r,o.Org)>=wt.edgeEval(s.Dst,r,s.Org)},e.deleteRegion=function(t,i){i.fixUpperEdge&&kt(0===i.eUp.winding),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,n){kt(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=n,n.activeRegion=i},e.topLeftRegion=function(t,i){var r,n=i.eUp.Org;do{i=e.regionAbove(i)}while(i.eUp.Org===n);if(i.fixUpperEdge){if(null===(r=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;e.fixUpperEdge(t,i,r),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,n){var r=new nS;return r.eUp=n,r.nodeUp=t.dict.insertBefore(i.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r,r},e.isWindingInside=function(t,i){switch(t.windingRule){case sn.ODD:return 0!=(1&i);case sn.NONZERO:return 0!==i;case sn.POSITIVE:return i>0;case sn.NEGATIVE:return i<0;case sn.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,n){for(var r,o=null,s=i,a=i.eUp;s!==n;){if(s.fixUpperEdge=!1,(r=(o=e.regionBelow(s)).eUp).Org!=a.Org){if(!o.fixUpperEdge){e.finishRegion(t,s);break}r=t.mesh.connect(a.Lprev,r.Sym),e.fixUpperEdge(t,o,r)}a.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(a,r)),e.finishRegion(t,s),a=o.eUp,s=o}return a},e.addRightEdges=function(t,i,n,r,o,s){var a,l,c,h,u=!0;c=n;do{kt(wt.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext}while(c!==r);for(null===o&&(o=e.regionBelow(i).eUp.Rprev),l=i,h=o;(c=(a=e.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),a.windingNumber=l.windingNumber-c.winding,a.inside=e.isWindingInside(t,a.windingNumber),l.dirty=!0,!u&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),u=!1,l=a,h=c;l.dirty=!0,kt(l.windingNumber-c.winding===a.windingNumber),s&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,n){t.mesh.splice(i,n)},e.vertexWeights=function(t,i,n){var r=wt.vertL1dist(i,t),o=wt.vertL1dist(n,t),s=.5*o/(r+o),a=.5*r/(r+o);t.coords[0]+=s*i.coords[0]+a*n.coords[0],t.coords[1]+=s*i.coords[1]+a*n.coords[1],t.coords[2]+=s*i.coords[2]+a*n.coords[2]},e.getIntersectData=function(t,i,n,r,o,s){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,n,r),e.vertexWeights(i,o,s)},e.checkForRightSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,o=n.eUp;if(wt.vertLeq(r.Org,o.Org)){if(wt.edgeSign(o.Dst,r.Org,o.Org)>0)return!1;wt.vertEq(r.Org,o.Org)?r.Org!==o.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,o.Oprev,r)):(t.mesh.splitEdge(o.Sym),t.mesh.splice(r,o.Oprev),i.dirty=n.dirty=!0)}else{if(wt.edgeSign(r.Dst,o.Org,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(o.Oprev,r)}return!0},e.checkForLeftSplice=function(t,i){var s,n=e.regionBelow(i),r=i.eUp,o=n.eUp;if(kt(!wt.vertEq(r.Dst,o.Dst)),wt.vertLeq(r.Dst,o.Dst)){if(wt.edgeSign(r.Dst,o.Dst,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,s=t.mesh.splitEdge(r),t.mesh.splice(o.Sym,s),s.Lface.inside=i.inside}else{if(wt.edgeSign(o.Dst,r.Dst,o.Org)>0)return!1;i.dirty=n.dirty=!0,s=t.mesh.splitEdge(o),t.mesh.splice(r.Lnext,o.Sym),s.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var p,f,n=e.regionBelow(i),r=i.eUp,o=n.eUp,s=r.Org,a=o.Org,l=r.Dst,c=o.Dst,d=new Zf;if(kt(!wt.vertEq(c,l)),kt(wt.edgeSign(l,t.event,s)<=0),kt(wt.edgeSign(c,t.event,a)>=0),kt(s!==t.event&&a!==t.event),kt(!i.fixUpperEdge&&!n.fixUpperEdge),s===a||Math.min(s.t,l.t)>Math.max(a.t,c.t))return!1;if(wt.vertLeq(s,a)){if(wt.edgeSign(c,s,a)>0)return!1}else if(wt.edgeSign(l,a,s)<0)return!1;return e.debugEvent(t),wt.intersect(l,s,c,a,d),kt(Math.min(s.t,l.t)<=d.t),kt(d.t<=Math.max(a.t,c.t)),kt(Math.min(c.s,l.s)<=d.s),kt(d.s<=Math.max(a.s,s.s)),wt.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=wt.vertLeq(s,a)?s:a,wt.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),wt.vertEq(d,s)||wt.vertEq(d,a)?(e.checkForRightSplice(t,i),!1):!wt.vertEq(l,t.event)&&wt.edgeSign(l,t.event,d)>=0||!wt.vertEq(c,t.event)&&wt.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(r.Sym),t.mesh.splice(o.Sym,r),i=e.topLeftRegion(t,i),r=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),e.addRightEdges(t,i,r.Oprev,r,r,!0),!0):l===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(r.Lnext,o.Oprev),n=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,n.eUp=o.Oprev,o=e.finishLeftRegions(t,n,null),e.addRightEdges(t,i,o.Onext,r.Rprev,f,!0),!0):(wt.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),r.Org.s=t.event.s,r.Org.t=t.event.t),wt.edgeSign(c,t.event,d)<=0&&(i.dirty=n.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(r.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,r),r.Org.s=d.s,r.Org.t=d.t,r.Org.pqHandle=t.pq.insert(r.Org),e.getIntersectData(t,r.Org,s,l,a,c),e.regionAbove(i).dirty=i.dirty=n.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r,o,n=e.regionBelow(i);;){for(;n.dirty;)i=n,n=e.regionBelow(n);if(!i.dirty&&(n=i,null===(i=e.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,(r=i.eUp).Dst!==(o=n.eUp).Dst&&e.checkForLeftSplice(t,i)&&(n.fixUpperEdge?(e.deleteRegion(t,n),t.mesh.delete(o),o=(n=e.regionBelow(i)).eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(r),r=(i=e.regionAbove(n)).eUp)),r.Org!==o.Org)if(r.Dst===o.Dst||i.fixUpperEdge||n.fixUpperEdge||r.Dst!==t.event&&o.Dst!==t.event)e.checkForRightSplice(t,i);else if(e.checkForIntersect(t,i))return;r.Org===o.Org&&r.Dst===o.Dst&&(e.addWinding(o,r),e.deleteRegion(t,i),t.mesh.delete(r),i=e.regionAbove(n))}},e.connectRightVertex=function(t,i,n){var r,o=n.Onext,s=e.regionBelow(i),a=i.eUp,l=s.eUp,c=!1;a.Dst!==l.Dst&&e.checkForIntersect(t,i),wt.vertEq(a.Org,t.event)&&(t.mesh.splice(o.Oprev,a),i=e.topLeftRegion(t,i),o=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),s),c=!0),wt.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,s,null),c=!0),c?e.addRightEdges(t,i,n.Onext,o,o,!0):(r=wt.vertLeq(l.Org,a.Org)?l.Oprev:a,r=t.mesh.connect(n.Lprev,r),e.addRightEdges(t,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i))},e.connectLeftDegenerate=function(t,i,n){var r,o,s,a,l;return wt.vertEq((r=i.eUp).Org,n)?(kt(!1),void e.spliceMergeVertices(t,r,n.anEdge)):wt.vertEq(r.Dst,n)?(kt(!1),i=e.topRightRegion(i),o=a=(s=(l=e.regionBelow(i)).eUp.Sym).Onext,l.fixUpperEdge&&(kt(o!==s),e.deleteRegion(t,l),t.mesh.delete(s),s=o.Oprev),t.mesh.splice(n.anEdge,s),wt.edgeGoesLeft(o)||(o=null),void e.addRightEdges(t,i,s.Onext,a,o,!0)):(t.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(t.mesh.delete(r.Onext),i.fixUpperEdge=!1),t.mesh.splice(n.anEdge,r),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,i){var n,r,o,s,a,l,c=new nS;if(c.eUp=i.anEdge.Sym,n=t.dict.search(c).key,r=e.regionBelow(n)){if(a=r.eUp,0===wt.edgeSign((s=n.eUp).Dst,i,s.Org))return void e.connectLeftDegenerate(t,n,i);o=wt.vertLeq(a.Dst,s.Dst)?n:r,n.inside||o.fixUpperEdge?(l=o===n?t.mesh.connect(i.anEdge.Sym,s.Lnext):t.mesh.connect(a.Dnext,i.anEdge).Sym,o.fixUpperEdge?e.fixUpperEdge(t,o,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,i)):e.addRightEdges(t,n,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var n=i.anEdge;null===n.activeRegion;)if((n=n.Onext)===i.anEdge)return void e.connectLeftVertex(t,i);var r=e.topLeftRegion(t,n.activeRegion);kt(null!==r);var o=e.regionBelow(r),s=o.eUp,a=e.finishLeftRegions(t,o,null);a.Onext===s?e.connectRightVertex(t,r,a):e.addRightEdges(t,r,a.Onext,s,s,!0)},e.addSentinel=function(t,i,n,r){var o=new nS,s=t.mesh.makeEdge();s.Org.s=n,s.Org.t=r,s.Dst.s=i,s.Dst.t=r,t.event=s.Dst,o.eUp=s,o.windingNumber=0,o.inside=!1,o.fixUpperEdge=!1,o.sentinel=!0,o.dirty=!1,o.nodeUp=t.dict.insert(o)},e.initEdgeDict=function(t){t.dict=new Oxe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],r=t.bmin[0]-i,o=t.bmax[0]+i,a=t.bmax[1]+n;e.addSentinel(t,r,o,t.bmin[1]-n),e.addSentinel(t,r,o,a)},e.doneEdgeDict=function(t){for(var i,n=0;null!==(i=t.dict.min().key);)i.sentinel||(kt(i.fixUpperEdge),kt(1==++n)),kt(0===i.windingNumber),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,n,r,o=t.mesh.eHead;for(i=o.next;i!==o;i=n)n=i.next,r=i.Lnext,wt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,r,i),t.mesh.delete(i),r=(i=r).Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,n,r,o=0;for(n=(r=t.mesh.vHead).next;n!==r;n=n.next)o++;for(i=t.pq=new Ixe(o+=8,wt.vertLeq),n=(r=t.mesh.vHead).next;n!==r;n=n.next)n.pqHandle=i.insert(n);return n===r&&(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var n,r,o;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,kt((o=n.anEdge).Lnext!==o),o.Lnext.Lnext===o&&(e.addWinding(o.Onext,o),t.mesh.delete(o));return!0},e.computeInterior=function(t,i){var n,r;if(void 0===i&&(i=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&wt.vertEq(r,n);)r=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,r.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(i&&t.mesh.check(),!0)},e}(),Nxe=function(){function e(){this.mesh=new rj,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=sn.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,n,r,o,s,a,l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)c[g]=o=i.coords[g],f[g]=i,l[g]=o,p[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)(o=i.coords[v])<c[v]&&(c[v]=o,f[v]=i),o>l[v]&&(l[v]=o,p[v]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,h[0]=(n=f[y]).coords[0]-(r=p[y]).coords[0],h[1]=n.coords[1]-r.coords[1],h[2]=n.coords[2]-r.coords[2],i=m.next;i!==m;i=i.next)u[0]=i.coords[0]-r.coords[0],u[1]=i.coords[1]-r.coords[1],u[2]=i.coords[2]-r.coords[2],d[0]=h[1]*u[2]-h[2]*u[1],d[1]=h[2]*u[0]-h[0]*u[2],d[2]=h[0]*u[1]-h[1]*u[0],(s=d[0]*d[0]+d[1]*d[1]+d[2]*d[2])>a&&(a=s,t[0]=d[0],t[1]=d[1],t[2]=d[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},e.prototype.checkOrientation_=function(){for(var i,r,t=this.mesh.fHead,n=this.mesh.vHead,o=0,s=t.next;s!==t;s=s.next)if(!((r=s.anEdge).winding<=0))do{o+=(r.Org.s-r.Dst.s)*(r.Org.t+r.Dst.t),r=r.Lnext}while(r!==s.anEdge);if(o<0){for(i=n.next;i!==n;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var n,r,t=this.mesh.vHead,i=[0,0,0],o=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),o=!0),n=this.sUnit,r=this.tUnit;var s=this.longAxis_(i);n[s]=0,n[(s+1)%3]=1,n[(s+2)%3]=0,r[s]=0,r[(s+1)%3]=0,r[(s+2)%3]=i[s]>0?1:-1;for(var a=t.next;a!==t;a=a.next)a.s=this.dot_(a.coords,n),a.t=this.dot_(a.coords,r);o&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var n,r;if((n=i.anEdge).Lnext===n||n.Lnext.Lnext===n)throw"Mono region invalid";for(;wt.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;wt.vertLeq(n.Org,n.Dst);n=n.Lnext);for(r=n.Lprev;n.Lnext!==r;)if(wt.vertLeq(n.Dst,r.Org)){for(;r.Lnext!==n&&(wt.edgeGoesLeft(r.Lnext)||wt.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0);)r=t.connect(r.Lnext,r).Sym;r=r.Lprev}else{for(;r.Lnext!==n&&(wt.edgeGoesRight(n.Lprev)||wt.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)n=t.connect(n,n.Lprev).Sym;n=n.Lnext}if(r.Lnext===n)throw"Mono region invalid";for(;r.Lnext.Lnext!==n;)r=t.connect(r.Lnext,r).Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)if(i=n.next,n.inside&&!this.tessellateMonoRegion_(t,n))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)i=n.next,n.inside||t.zapFace(n)},e.prototype.setWindingNumber_=function(t,i,n){for(var r,o=t.eHead.next;o!==t.eHead;o=r)r=o.next,o.Rface.inside!==o.Lface.inside?o.winding=o.Lface.inside?i:-i:n?t.delete(o):o.winding=0},e.prototype.getNeighbourFace_=function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},e.prototype.outputPolymesh_=function(t,i,n,r){var o,l,s=0,a=0;n>3&&t.mergeConvexFaces(n);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,h.inside){o=h.anEdge,l=0;do{-1===(c=o.Org).n&&(c.n=a,a++),l++,o=o.Lnext}while(o!==h.anEdge);if(l>n)throw"Face vertex greater that support polygon";h.n=s,++s}for(this.elementCount=s,i===Ir.CONNECTED_POLYGONS&&(s*=2),this.elements=[],this.elements.length=s*n,this.vertexCount=a,this.vertices=[],this.vertices.length=a*r,this.vertexIndices=[],this.vertexIndices.length=a,c=t.vHead.next;c!==t.vHead;c=c.next)if(-1!==c.n){var u=c.n*r;this.vertices[u+0]=c.coords[0],this.vertices[u+1]=c.coords[1],r>2&&(this.vertices[u+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}var d=0;for(h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){o=h.anEdge,l=0;do{this.elements[d++]=(c=o.Org).n,l++,o=o.Lnext}while(o!==h.anEdge);for(var p=l;p<n;++p)this.elements[d++]=-1;if(i===Ir.CONNECTED_POLYGONS){o=h.anEdge;do{this.elements[d++]=this.getNeighbourFace_(o),o=o.Lnext}while(o!==h.anEdge);for(var f=l;f<n;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var n,r,o=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){r=n=a.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==r);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,h=0;for(o=0,a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){s=0,r=n=a.anEdge;do{this.vertices[l++]=n.Org.coords[0],this.vertices[l++]=n.Org.coords[1],i>2&&(this.vertices[l++]=n.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,s++,n=n.Lnext}while(n!==r);this.elements[h++]=o,this.elements[h++]=s,o+=s}},e.prototype.addContour=function(t,i){null===this.mesh&&(this.mesh=new rj),t<2&&(t=2),t>3&&(t=3);for(var n=null,r=0;r<i.length;r+=t)null===n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=i[r+0],n.Org.coords[1]=i[r+1],n.Org.coords[2]=t>2?i[r+2]:0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},e.prototype.tesselate=function(t,i,n,r,o,s){if(void 0===t&&(t=sn.ODD),void 0===i&&(i=Ir.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,o&&(this.normal[0]=o[0],this.normal[1]=o[1],this.normal[2]=o[2]),this.windingRule=t,r<2&&(r=2),r>3&&(r=3),!this.mesh)return!1;this.projectPolygon_(),kxe.computeInterior(this,s);var a=this.mesh;return i===Ir.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),i===Ir.BOUNDARY_CONTOURS?this.outputContours_(a,r):this.outputPolymesh_(a,i,n,r),!0},e}();function Tu(e){var t=e.windingRule,i=void 0===t?sn.ODD:t,n=e.elementType,r=void 0===n?Ir.POLYGONS:n,o=e.polySize,s=void 0===o?3:o,a=e.vertexSize,l=void 0===a?2:a,c=e.normal,h=void 0===c?[0,0,1]:c,u=e.contours,d=void 0===u?[]:u,p=e.strict,f=void 0===p||p,m=e.debug,g=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new Nxe;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,r,s,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}var rS=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`),this.buffer=new ArrayBuffer(e*rS.eSize);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*n,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${e}`);let n=new ArrayBuffer(e*rS.eSize),r=Float32Array.BYTES_PER_ELEMENT,o=0,s=new Float32Array(n,o*r,3*e);o+=3*e;let a=new Float32Array(n,o*r,3*e);o+=3*e;let l=new Float32Array(n,o*r,2*e);t?(s.set(this.positions.subarray(0,3*this.size)),a.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(s.set(this.positions),a.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=s,this.normals=a,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let n=this.capacity;for(;t>n;)n*=2;this.realloc(n)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},lj=rS;lj.eSize=8*Float32Array.BYTES_PER_ELEMENT;var Lxe=Qc(qde()),oS={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},cj={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},hj={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},sS=(e,t)=>([i,n])=>(n<i&&(n+=t),(e>=i?e:e+t)<=n),aS=class extends gt{constructor(e,t,i=0,n=12,r=3,o=sn.ODD,s=!1){super(),this.forPathBevel=s,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=n,this._bevelSegmentsInput=r;let u,d,p,a=this._shape.extractShapePointsToFlatArray([],n),l=this._shape.shapeHoles.map(M=>{let z=M.extractShapePointsToFlatArray([],n),E=[];for(let D=z.length-1;D>=1;D-=2)E.push(z[D-1],z[D-0]);return E}),c=[],h=[];for(let M=0;M<a.length;M+=2)h.push([a[M],a[M+1]]);c.push(h);for(let M=0;M<l.length;M++){let z=l[M],E=[];for(let D=0;D<z.length;D+=2)E.push([z[D],z[D+1]]);c.push(E)}u=e.isText?.1*(new wB).setFromPoints(e.points.map(M=>M.position)).getSize(new $).length():0===c[0].length?i:(0,Lxe.default)(c).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,u,t/2),this._bevelSegments=Math.floor(r));try{d=Tu({windingRule:o,elementType:Ir.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a]})}catch{d=oS}try{p=Tu({windingRule:sn.ODD,elementType:Ir.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=cj}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let M=0;M<p.elements.length;M++)d.elements.push(p.elements[M]+(M%2==0?d.vertexCount:0));for(let M=0;M<p.vertexIndices.length;M++)d.vertexIndices.push(p.vertexIndices[M]+d.vertexCount);for(let M=0;M<p.vertices.length;M++)d.vertices.push(p.vertices[M])}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let M=0,z=d.vertexCount;M<z;M++){let E=2*M,D=d.vertices[E+0],P=d.vertices[E+1];D<m&&(m=D),D>g&&(g=D),P<v&&(v=P),P>y&&(y=P)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new lj(this._computeBufferEstimatedSize(d));let _=[],b=[];for(let M=d.elementCount-1;M>=0;M--){let z=M>=f,E=2*M,D=d.elements[E+0],P=d.elements[E+1],I=D+P,B={start:D,count:P,normals:[],continuous:[],concave:[]},V=D,R=I-1,N=D+1,W=this._shape.roundedCurves.length;do{let q=V-D,ce=d.vertices[2*V+0],te=d.vertices[2*V+1],pe=d.vertices[2*N+0],se=d.vertices[2*N+1],ze=ce-d.vertices[2*R+0],_e=te-d.vertices[2*R+1],ge=Math.sqrt(ze*ze+_e*_e);ze/=ge,_e/=ge;let Xe=ce-pe,$e=te-se,Ze=Math.sqrt(Xe*Xe+$e*$e);Xe/=Ze,$e/=Ze,B.normals[2*q+0]=-$e,B.normals[2*q+1]=Xe,B.concave[q]=ze*$e-_e*Xe>0;let rt=d.vertexIndices[V];if(Array.isArray(rt))B.continuous[q]=!1;else{let[Ve,Le]=this._shape.getCurveIndexFromVertexId(rt-1,!0);if(Le>0&&Le<1)B.continuous[q]=!0;else{let vt=1===Le?Ve+1:Ve-1;vt=(vt+W)%W;let Ft=1===Le?0:1,j=this._shape.roundedCurves[Ve].getTangent(Le),F=this._shape.roundedCurves[vt].getTangent(Ft);B.continuous[q]=j.dot(F)>.95}}z&&(B.normals[2*q+0]*=-1,B.normals[2*q+1]*=-1),[R,V,N]=[V,N,N+1],N>=I&&(N-=P)}while(N!==D+1);let Q=[];Q.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(2*D,2*I),vertexCount:P,vertexIndices:new Array(P).fill(!0).map((q,ee)=>[ee,ee]),elements:[0,P],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(2*D,2*I)});let G=0;for(let q=1;q<=this._bevelSegments;q++){let ee=q/this._bevelSegments*Math.PI/2,Z=(1-Math.cos(ee))*this._bevel,ce=[],te=[],pe=[],se=[],ze=0;for(let ge=0;ge<P;ge++){let Xe=2*ge,$e=(ge-1+P)%P*2,Ze=d.vertices[2*B.start+Xe+0],rt=d.vertices[2*B.start+Xe+1],Ve=-B.normals[$e+0]*Z,Le=-B.normals[$e+1]*Z,vt=-B.normals[Xe+0]*Z,Ft=-B.normals[Xe+1]*Z;if(B.concave[ge]||!B.concave[ge]&&z){let j=Math.atan2(Le,Ve),F=Math.atan2(Ft,vt);F>j&&(F-=2*Math.PI);let ue=F-j;if(B.continuous[ge]||z){let Ie=j+ue/2,O=Math.cos(Ie)*Z,be=Math.sin(Ie)*Z;ce[2*ze+0]=Ze+O*(z?-1:1),ce[2*ze+1]=rt+be*(z?-1:1),se[ze]=ge,ze++}else{let Ie=Math.max(1,Math.floor(n/4*Math.abs(ue)/Math.PI));for(let O=0;O<=Ie;O++){let be=j+ue*(O/Ie),lt=Math.cos(be)*Z,We=Math.sin(be)*Z;ce[2*ze+0]=Ze+lt,ce[2*ze+1]=rt+We,se[ze]=ge,ze++}}}else ce[2*ze+0]=Ze+Ve,ce[2*ze+1]=rt+Le,se[ze]=ge,te[ge]=ze,ze++,ce[2*ze+0]=Ze,ce[2*ze+1]=rt,se[ze]=ge,ze++,ce[2*ze+0]=Ze+vt,ce[2*ze+1]=rt+Ft,se[ze]=ge,pe[ge]=ze,ze++}let _e=Tu({windingRule:sn.POSITIVE,elementType:Ir.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ce],edgeCreateCallback:ge=>{let Xe=ge.Org.idx,$e=se[Xe],Ze=se[(Xe+1)%se.length];ge.idx=[$e,Ze],ge.Sym.idx=[Ze,$e]},vertexIdCallback:ge=>{let Xe=ge.Lprev.idx;return[Xe?Xe[1]:0,ge.idx?ge.idx[0]:0]}});if(!_e)throw console.log("Error"),new Error(`error generating bevel geometry for ${q}'th loop`);if(!_e.vertexCount){let ge=(q-1)/this._bevelSegments*Math.PI/2;G=(1-Math.sin(ge))*this._bevel;break}for(let ge=0;ge<_e.vertexIndices.length;ge++){let[Xe,$e]=_e.vertexIndices[ge];if(Xe===$e)continue;let Ze=$e;$e<Xe&&(Ze+=P);for(let rt=Xe;rt<Ze;rt++){let Ve=rt%P,Le=(rt+1)%P;if(!B.continuous[Ve]||!B.continuous[Le]){_e.vertexIndices[ge]=[Xe,Ve],_e.vertexIndices.splice(ge+1,0,[Le,$e]),_e.vertices.splice(2*(ge+1),0,_e.vertices[2*ge],_e.vertices[2*ge+1]);break}}}Q.push({bevelI:q,angle:ee,size:Z,boundary:_e,reverseMap:se,insetPoints:ce})}let Y=(q,ee,Z)=>{let ce=0,te=q.boundary.vertexIndices.length;for(;ce<te&&Z(q.boundary.vertexIndices[ee]);)ee=(ee+1)%te,ce++;return ce},J=_.length;for(let q=1;q<Q.length;q++){let ee=Q[q-1],Z=Q[q],ce=ee.boundary.vertexIndices.length,te=Z.boundary.vertexIndices.length;if(!ce||!te)break;let pe=B.concave.length,se=0,ze=sS(se,P);for(;!ee.boundary.vertexIndices.filter(ze).length||!Z.boundary.vertexIndices.filter(ze).length;)se++,ze=sS(se,P);let _e=ee.boundary.vertexIndices.findIndex(ze),ge=Z.boundary.vertexIndices.findIndex(ze);do{_e=(_e+1)%ce}while(ze(ee.boundary.vertexIndices[_e]));do{ge=(ge+1)%te}while(ze(Z.boundary.vertexIndices[ge]));se=(se+1)%P;let vt,Ft,Xe=se,$e=0,Ve=this._buildBevelVert(B,ee,(_e-1+ce)%ce,void 0,$e),Le=this._buildBevelVert(B,Z,(ge-1+te)%te,void 0,$e),j=!1;do{$e=(se||pe)/pe,ze=sS(se,P);let F=Y(ee,_e,ze),ue=Y(Z,ge,ze),Ie=j;if(j=!1,F&&!ue){for(let O=0;O<F;O++)vt=this._buildBevelVert(B,ee,(_e+O)%ce,O/(F-1),$e),_.push(Ve.topN,vt.topP,Le.topN),!1===s&&_.push(vt.bottomP,Ve.bottomN,Le.bottomN),Ve=vt;j=!0}else if(!F&&ue)for(let O=0;O<ue;O++)Ft=this._buildBevelVert(B,Z,(ge+O)%te,O/(ue-1),$e),_.push(Le.topN,Ve.topP,Ft.topP),!1===s&&_.push(Ve.bottomP,Le.bottomN,Ft.bottomP),Le=Ft;else if(F&&ue)if(vt=this._buildBevelVert(B,ee,_e,0,$e),Ft=this._buildBevelVert(B,Z,ge,0,$e),Ie?(_.push(Ve.topN,Ft.topP,Le.topN),_.push(Ve.topN,vt.topP,Ft.topP),!1===s&&(_.push(Ft.bottomP,Ve.bottomN,Le.bottomN),_.push(Ft.bottomP,vt.bottomP,Ve.bottomN))):(_.push(Le.topN,Ve.topN,vt.topP),_.push(Le.topN,vt.topP,Ft.topP),!1===s&&(_.push(vt.bottomP,Ve.bottomN,Le.bottomN),_.push(vt.bottomP,Le.bottomN,Ft.bottomP))),Ve=vt,Le=Ft,F===ue)for(let O=1;O<F;O++)vt=this._buildBevelVert(B,ee,(_e+O)%ce,O/(F-1),$e),Ft=this._buildBevelVert(B,Z,(ge+O)%te,O/(ue-1),$e),_.push(Ve.topN,vt.topP,Le.topN),_.push(Le.topN,vt.topP,Ft.topP),!1===s&&(_.push(vt.bottomP,Ve.bottomN,Le.bottomN),_.push(vt.bottomP,Le.bottomN,Ft.bottomP)),Ve=vt,Le=Ft;else if(F>ue){let O=F/ue,be=0;for(let lt=1;lt<F;lt++)vt=this._buildBevelVert(B,ee,(_e+lt)%ce,lt/(F-1),$e),_.push(Ve.topN,vt.topP,Le.topN),!1===s&&_.push(vt.bottomP,Ve.bottomN,Le.bottomN),Ve=vt,lt>(be+1)*O&&(be++,Ft=this._buildBevelVert(B,Z,(ge+be)%te,be/(ue-1),$e),_.push(Le.topN,vt.topP,Ft.topP),!1===s&&_.push(vt.bottomP,Le.bottomN,Ft.bottomP),Le=Ft)}else{let O=ue/F,be=0;for(let lt=1;lt<ue;lt++)Ft=this._buildBevelVert(B,Z,(ge+lt)%te,lt/(ue-1),$e),_.push(Le.topN,vt.topP,Ft.topP),!1===s&&_.push(vt.bottomP,Le.bottomN,Ft.bottomP),Le=Ft,lt>(be+1)*O&&(be++,vt=this._buildBevelVert(B,ee,(_e+be)%ce,be/(F-1),$e),_.push(Ve.topN,vt.topP,Le.topN),!1===s&&_.push(vt.bottomP,Ve.bottomN,Le.bottomN),Ve=vt)}_e=(_e+F)%ce,ge=(ge+ue)%te,se=(se+1)%pe}while(se!==Xe)}if(!1===s&&this._depth>2*this._bevel&&this._buildWall(Q,B,_),z){let q=[];for(let ee=_.length-1;ee>=J+2;ee-=3)q.push(_[ee-0],_[ee-1],_[ee-2]);_.splice(J,_.length-J,...q)}if(z){let q=[];for(let ee=Q[Q.length-1].boundary.vertices.length-1;ee>=1;ee-=2)q.push(Q[Q.length-1].boundary.vertices[ee-1],Q[Q.length-1].boundary.vertices[ee-0]);b.push(q)}if(!z){let ee,q=Q[Q.length-1];try{ee=Tu({windingRule:Q.length>1?sn.POSITIVE:sn.ODD,elementType:Ir.POLYGONS,vertexSize:2,strict:!0,contours:[q.insetPoints,...b]})}catch{ee=hj}if(!ee)throw new Error("Error generating geometry for surface");0===l.length&&this._bevel<u&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let Z=0;Z<3*ee.elementCount;Z+=3){let ce=this._buildSurfaceVert(ee,ee.elements[Z+0],G),te=this._buildSurfaceVert(ee,ee.elements[Z+1],G),pe=this._buildSurfaceVert(ee,ee.elements[Z+2],G);_.push(ce.top,te.top,pe.top),!1===s&&_.push(pe.bottom,te.bottom,ce.bottom)}}this.vertexCache={}}this._buffer.shrink();let x=new It(Uint32Array.from(_),1),w=new It(this._buffer.positions,3),S=new It(this._buffer.normals,3),C=new It(this._buffer.uvs,2);w.needsUpdate=!0,S.needsUpdate=!0,C.needsUpdate=!0,x.needsUpdate=!0,this.setAttribute("position",w),this.setAttribute("normal",S),this.setAttribute("uv",C),this.setIndex(x)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,o=n.boundary.vertexCount;r<o;r++){let s=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%o);i.push(a.topP,s.topN,s.bottomN),i.push(a.topP,s.bottomN,a.bottomP)}}_buildSurfaceVert(e,t,i){let n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=e.vertices[2*t+0],o=e.vertices[2*t+1],s=(r-this._minX)/this._width,a=(o-this._minY)/this._height;this.forPathBevel&&(a=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,u={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=o,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=s,this._buffer.uvs[h+1]=a,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=o,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=s,this._buffer.uvs[h+3]=a),this.vertexCache[n]=u,u}_buildBevelVert(e,t,i,n=1,r){let o=`${t.bevelI}:${i}`;if(o in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[o].pathBevelUCoord))return this.vertexCache[o];let l,c,h,u,[s,a]=t.boundary.vertexIndices[i];s!==a?(c=s,l=a,u=!1,h=e.continuous[c]&&e.continuous[l]):(l=s,c=(l-1+e.count)%e.count,u=e.concave[l]&&t.bevelI>0,h=e.continuous[l]||u);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=2*i,m=2*l,g=2*c,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],_=(1-p)*this._bevel,b=(v-this._minX)/this._width,x=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(b=r),x=1);let w=e.normals[m+0],S=e.normals[m+1],C=e.normals[g+0],M=e.normals[g+1];if(u){w+=(C-w)*(1-n),S+=(M-S)*(1-n);let V=Math.sqrt(w*w+S*S);w/=V,S/=V}let z=this._buffer.get(this.forPathBevel?h?1:2:h?2:4),E=3*z,D=2*z,P={i,fi:l,topP:z+0,topN:z+0,bottomP:z+1,bottomN:z+1,pathBevelUCoord:r};return this._buffer.positions[E+0]=v,this._buffer.positions[E+1]=y,this._buffer.positions[E+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[E+0]=w*d,this._buffer.normals[E+1]=S*d,this._buffer.normals[E+2]=p,this._buffer.uvs[D+0]=b,this._buffer.uvs[D+1]=x,!1===this.forPathBevel&&(this._buffer.positions[E+3]=v,this._buffer.positions[E+4]=y,this._buffer.positions[E+5]=_,this._buffer.normals[E+3]=w*d,this._buffer.normals[E+4]=S*d,this._buffer.normals[E+5]=-p,this._buffer.uvs[D+2]=x,this._buffer.uvs[D+3]=b),h||(this.forPathBevel?(z+=1,E+=3,D+=2):(z+=2,E+=6,D+=4),P.topP=z+0,P.bottomP=z+1,this._buffer.positions[E+0]=v,this._buffer.positions[E+1]=y,this._buffer.positions[E+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[E+0]=C*d,this._buffer.normals[E+1]=M*d,this._buffer.normals[E+2]=p,this._buffer.uvs[D+0]=b,this._buffer.uvs[D+1]=x,!1===this.forPathBevel&&(this._buffer.positions[E+3]=v,this._buffer.positions[E+4]=y,this._buffer.positions[E+5]=_,this._buffer.normals[E+3]=C*d,this._buffer.normals[E+4]=M*d,this._buffer.normals[E+5]=-p,this._buffer.uvs[D+2]=x,this._buffer.uvs[D+3]=b)),this.vertexCache[o]=P,P}clone(){let e=new aS(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=P8(this.userData),e}},uj=class extends gt{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=sn.ODD,this.elementType=Ir.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:sn.ODD,elementType:Ir.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let o,l,c,n=this._shape.extractShapePointsToFlatArray([],this._curveSegments),r=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s=!0,a=!0;for(let d=0,p=n.length/2;d<p;d++){let f=2*d,m=n[f+0],g=n[f+1];if(void 0!==l&&m!==l&&(s=!1),void 0!==c&&g!==c&&(a=!1),l=m,c=g,!s&&!a)break}if(!s&&!a)try{o=Tu({contours:[n,...r],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{o=oS}let h=o?.vertexCount??1,u=o?.elementCount??1;if(this._positionAttribute=new It(new Float32Array(3*h),3),this._normalAttribute=new It(new Float32Array(3*h),3),this._uvAttribute=new It(new Float32Array(2*h),2),this._indexAttribute=new It(new Uint32Array(3*u),1),o){let d=1/0,p=-1/0,f=1/0,m=-1/0;for(let y=0,_=h;y<_;y++){let b=2*y,x=o.vertices[b+0],w=o.vertices[b+1];x<d&&(d=x),x>p&&(p=x),w<f&&(f=w),w>m&&(m=w)}let g=p-d,v=m-f;for(let y=0,_=h;y<_;y++){let b=2*y,x=o.vertices[b+0],w=o.vertices[b+1],S=(x-d)/g,C=(w-f)/v;this._positionAttribute.setXYZ(y,x,w,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,S,C)}for(let y=0,_=u;y<_;y++){let b=3*y,w=o.elements[b+1],S=o.elements[b+2];this._indexAttribute.setX(b+0,o.elements[b+0]),this._indexAttribute.setX(b+1,w),this._indexAttribute.setX(b+2,S)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(o?.elementCount??1))}clone(){let e=new uj(this._shape,this._curveSegments);return e.userData=P8(this.userData),e}},dj=class extends aS{constructor(e,t,i=0,n=12,r=3,o=sn.ODD){super(e,t,i,n,r,o),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,o=n.boundary.vertexCount;r<o;r++){let s=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%o);i.push(a.topP,s.topN,s.bottomN),i.push(a.topP,s.bottomN,a.bottomP)}}clone(){let e=new dj(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=P8(this.userData),e}},h1=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:sn.ODD},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),s=e.shape??t?.shape,a=s?.roundness??i.roundness;void 0!==s&&(s instanceof rr?(s.width!==n||s.height!==r)&&s.applySize(n,r):s=new rr(n,r).fromJSON(s),void 0!==e.parameters?.roundness&&e.parameters?.roundness>0&&s.update());let l=s??new rr(n,r);return{parameters:Object.assign(i,{width:n,height:r,depth:o,roundness:a}),shape:l}}static build(e){let a,{depth:t,extrudeBevelSize:i,extrudeBevelSegments:n,subdivisions:r,roundness:o,windingRule:s}=e.parameters;return e.shape.roundness=o,a=t<=0?new uj(e.shape,r,{windingRule:s}):new dj(e.shape,t,i,r,n,s),Object.assign(a,{userData:{...e,type:"VectorGeometry"}})}},pj=2*Math.PI,lS=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=et.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof rr?e.shape:new rr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let p,{width:t,height:i,spikes:n,angle:r,innerRadius:o,depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c=e.shape,d=function Rxe(e,t,i,n,r,o){if(n>=pj)return r>30||r%4==0?(function Bxe(e,t,i,n=0,r=0,o=0){let s=.5522847498,a=t*s,l=i*s;e.addPoint(I6(r-t,o,r-t,o-l,r-t,o+l)),e.addPoint(I6(r,o+i,r-a,o+i,r+a,o+i)),e.addPoint(I6(r+t,o,r+t,o+l,r+t,o-l)),e.addPoint(I6(r,o-i,r+a,o-i,r-a,o-i)),n>0&&gj(e,t,i,n)}(e,t,i,o),Math.round(r/4)):fj(e,n,r,t,i,o);let s={x:0,y:i},a=(n=Math.max(n,.001))+.5*Math.PI,l={x:Math.cos(a)*t,y:Math.sin(a)*i},c=function Pxe({px:e,py:t,cx:i,cy:n,rx:r,ry:o,largeArcFlag:s,sweepFlag:a}){let l=[];if(0===r||0===o)return[];let c=(e-i)/2,h=(t-n)/2;if(0===c&&0===h)return[];r=Math.abs(r),o=Math.abs(o);let u=Math.pow(c,2)/Math.pow(r,2)+Math.pow(h,2)/Math.pow(o,2);u>1&&(r*=Math.sqrt(u),o*=Math.sqrt(u));let d=function Axe(e,t,i,n,r,o,s,a,l,c){let h=Math.pow(r,2),u=Math.pow(o,2),d=Math.pow(s,2),p=Math.pow(a,2),f=h*u-h*p-u*d;f<0&&(f=0),f/=h*p+u*d,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/o*a,g=f*-o/r*s,v=m+(e+i)/2,y=g+(t+n)/2,_=(s-m)/r,b=(a-g)/o,x=(-s-m)/r,w=(-a-g)/o,S=nj(1,0,_,b),C=nj(_,b,x,w);return!c&&C>0&&(C-=tS),c&&C<0&&(C+=tS),{centerx:v,centery:y,ang1:S,ang2:C}}(e,t,i,n,r,o,c,h,s,a),{ang1:p,ang2:f}=d,{centerx:m,centery:g}=d,v=Math.abs(f)/(tS/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let _=0;_<y;_++)l.push(Dxe(p,f)),p+=f;return l.map(_=>{let{x:b,y:x}=iS(_[0],r,o,m,g),{x:w,y:S}=iS(_[1],r,o,m,g),{x:C,y:M}=iS(_[2],r,o,m,g);return{x1:b,y1:x,x2:w,y2:S,x:C,y:M}})}({px:s.x,py:s.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%c.length==0?function Fxe(e,t,i,n,r,o,s,a){let l=Math.round(r/n.length);e.addPoint(Kf(t,i));for(let c=0,h=n.length;c<h;c++){let u=n[c],d=e.points[c],p=Kf(u.x,u.y);d.controls[1].position.set(u.x1,u.y1),p.controls[0].position.set(u.x2,u.y2),e.addPoint(p)}return a>0?mj(e,o,s,a):e.addPoint(Kf(0,0)),l}(e,s.x,s.y,c,r,t,i,o):fj(e,n,r,t,i,o)}(c,.5*t,.5*i,r*Math.PI/180,n,o);return c.isClosed=!0,c.update(),0===r?(p=new gt,p.setAttribute("position",new Ke([],3))):p=h1.create({shape:c,parameters:{subdivisions:d,depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function fj(e,t,i,n,r,o){let s=-t/i;for(let a=0;a<=i;a++){let l=s*a,c=Math.sin(l)*n,h=Math.cos(l)*r;e.addPoint(Kf(c,h))}return t<pj?o>0?mj(e,n,r,o):e.addPoint(Kf(0,0)):(e.removePoint(e.points[e.points.length-1]),o>0&&gj(e,n,r,o)),1}function Kf(e,t){return new $f(et.generateUUID(),new $(e,t))}function I6(e,t,i,n,r,o){let s=Kf(e,t);return s.controls[0].position.set(i,n),s.controls[1].position.set(r,o),s}function mj(e,t,i,n){vj(e,t,i,n).forEach(r=>e.addPoint(r))}function gj(e,t,i,n){let r=vj(e,t,i,n),o=new rr;r.forEach(s=>o.addPoint(s)),o.isClosed=!0,e.shapeHoles.push(o)}function vj(e,t,i,n){let r=n*t/100,o=r*(Math.abs(i)/Math.abs(t)),s=new $(r/t,o/i),a=e.points.map(l=>{let c=l.clone();return c.uuid=et.generateUUID(),c}).reverse();return a.forEach(l=>{l.position.multiply(s);let c=l.controls[0].position.clone().multiply(s),h=l.controls[1].position.clone().multiply(s);l.controls[0].position.copy(h),l.controls[1].position.copy(c)}),a}var cS=new Jp([0,0,0],1),yj=class extends gt{constructor(e=!0,t=1,i=1,n=1,r=1,o=1,s=1,a=1,l=1,c=1,h=1,u=1){if(super(),0===o)return;let d=e&&1===o;d&&(u=0),h>100&&(h=100),0===h&&(u=0);let y,_,b,x,w,S,C,M,p=()=>new T,f=new T,m=p(),g=p(),v=p(),z=p(),E=p(),D=p(),P=p(),I=p(),B=p(),V=p(),R=p(),N=i-2*a+.001,W=N/o,Q=Math.ceil(s*o),G=Q+1,Y=N/Q,J=-N/2,q=c+1,ee=2*Math.PI/c,Z=Math.PI/2/u,te=Math.min((1-h/100)*a,a-.01),pe=a-te,se=0,_e=2*u+2,ge=q*_e/2,Xe=ge+q*G,$e=Math.max(0,q*(G+_e)),[Ze,rt,Ve]=[3,3,2].map(Be=>Array($e*Be).fill(0)),Le=[],vt=r-a;function Ft(Be,ct){let st=Math.PI/2;S=ct*Y,M=2*Math.PI*(S%W)/W+st,S+=J,C=Math.sin(M)*vt,w=Math.cos(M)*vt,e?Be.set(w,C,S):Be.set(w,S,C)}Ft(f,-1e-10),Ft(m,0),z.copy(f),Ft(f,1);let j=f.distanceTo(m),F=d?0:pe+te,ue=j*Q+2*F,Ie=te,O=ue-F;for(let Be=0;Be<=Q;Be++){Ft(g,Be),R.subVectors(g,z).normalize(),z.copy(g),B.copy(g).setComponent(+e+1,0).normalize(),V.crossVectors(R,B).normalize();let ct=0===Be,st=Be===Q,Lt=ct?3*Math.PI/2:Z,St=ct?Ie:O,Ii=ct?q:Xe,pn=ct?0:$e-q,Ei=R.clone().multiplyScalar(ct?-pe:pe).add(g),re=R.clone().multiplyScalar(ct?-1:1).normalize();for(let ye=0;ye<q;ye++){let ke=ye*ee;if(E.addVectors(f.copy(B).multiplyScalar(a*Math.cos(ke)),m.copy(V).multiplyScalar(a*Math.sin(ke))),D.copy(E).normalize(),ct||st){d||(se=pn+ye,[0,1,2].forEach(Ue=>{Ze[3*se+Ue]=Ei.getComponent(Ue),rt[3*se+Ue]=re.getComponent(Ue)}),Ve[2*se]=+st,Ve[2*se+1]=ye/c),m.copy(D).multiplyScalar(te),v.addVectors(g,m);for(let Ue=0;Ue<u;Ue++){let _t=Ue*Z+Lt;P.addVectors(f.copy(R).multiplyScalar(pe*Math.sin(_t)),m.copy(D).multiplyScalar(pe*Math.cos(_t))),I.copy(P).normalize(),m.addVectors(v,P),P.normalize(),se=Ii+Ue*q+ye,[0,1,2].forEach(Hn=>{Ze[3*se+Hn]=m.getComponent(Hn),rt[3*se+Hn]=I.getComponent(Hn)});let At=+ct+Math.sin(_t);Ve[2*se]=(St+pe*At)/ue,Ve[2*se+1]=ye/c}}m.addVectors(g,E),se=ge+Be*q+ye,[0,1,2].forEach(Ue=>{Ze[3*se+Ue]=m.getComponent(Ue),rt[3*se+Ue]=D.getComponent(Ue)}),Ve[2*se]=(F+Be*j)/ue,Ve[2*se+1]=ye/c}}let be=G+2*u+2,[We,Me]=[+d,be-1];for(let Be=We;Be<=Me-1;Be++){let ct=d&&Be===Me-1;for(let st=0;st<q-1;st++)y=Be*q+st,_=y+1,b=(ct?st:y)+q,x=(ct?st+1:_)+q,0===Be?Le.push(_,x,b):Be===be-2?Le.push(y,_,b):Le.push(y,_,b,_,x,b)}this.setIndex(Le),this.setAttribute("position",new Ke(Ze,3)),this.setAttribute("normal",new Ke(rt,3)),this.setAttribute("uv",new Ke(Ve,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let r,o,s,a,e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,n=Array.from(this.getIndex().array),l=6*(t-1)*e.radialSegments,c=t,h=c===t;for(let u=0;u<e.radialSegments;u++)r=c*i+u,o=r+1,s=(h?u:r)+i,a=(h?u+1:o)+i,n[l++]=r,n[l++]=o,n[l++]=s,n[l++]=o,n[l++]=a,n[l++]=s;return n.length=l,cS.array=n,cS.count=n.length,cS}},_j=class extends $C{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,s="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],s,e,t,i),this.type=s}static fromJSON(e){return new _j(e.radius,e.corner,e.cornerSides)}},rc=new De,hS=new en,O6=new T,k6=class extends wo{constructor(){super(),this.uuid=et.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new Vr).getNormalMatrix(e);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(let o=0,s=r.vertexNormals.length;o<s;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return rc.makeRotationX(e),this.applyMatrix4(rc),this}rotateY(e){return rc.makeRotationY(e),this.applyMatrix4(rc),this}rotateZ(e){return rc.makeRotationZ(e),this.applyMatrix4(rc),this}translate(e,t,i){return rc.makeTranslation(e,t,i),this.applyMatrix4(rc),this}scale(e,t,i){return rc.makeScale(e,t,i),this.applyMatrix4(rc),this}lookAt(e){return hS.lookAt(e),hS.updateMatrix(),this.applyMatrix4(hS.matrix),this}fromBufferGeometry(e){let t=this,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,o=n.normal,s=n.color,a=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let u=0;u<r.count;u++)t.vertices.push((new T).fromBufferAttribute(r,u)),void 0!==s&&t.colors.push((new Ct).fromBufferAttribute(s,u));function c(u,d,p,f){let m=void 0===s?[]:[t.colors[u].clone(),t.colors[d].clone(),t.colors[p].clone()],g=void 0===o?[]:[(new T).fromBufferAttribute(o,u),(new T).fromBufferAttribute(o,d),(new T).fromBufferAttribute(o,p)],v=new uS(u,d,p,g,m,f);t.faces.push(v),void 0!==a&&t.faceVertexUvs[0].push([(new $).fromBufferAttribute(a,u),(new $).fromBufferAttribute(a,d),(new $).fromBufferAttribute(a,p)]),void 0!==l&&t.faceVertexUvs[1].push([(new $).fromBufferAttribute(l,u),(new $).fromBufferAttribute(l,d),(new $).fromBufferAttribute(l,p)])}let h=e.groups;if(h.length>0)for(let u=0;u<h.length;u++){let d=h[u],p=d.start;for(let m=p,g=p+d.count;m<g;m+=3)void 0!==i?c(i.getX(m),i.getX(m+1),i.getX(m+2),d.materialIndex):c(m,m+1,m+2,d.materialIndex)}else if(void 0!==i)for(let u=0;u<i.count;u+=3)c(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<r.count;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(O6).negate(),this.translate(O6.x,O6.y,O6.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new De;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new T,t=new T;for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b];e.subVectors(this.vertices[r.c],s),t.subVectors(o,s),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)t[i]=new T;if(e){let i=new T,n=new T;for(let r=0,o=this.faces.length;r<o;r++){let s=this.faces[r],a=this.vertices[s.a],l=this.vertices[s.b];i.subVectors(this.vertices[s.c],l),n.subVectors(a,l),i.cross(n),t[s.a].add(i),t[s.b].add(i),t[s.c].add(i)}}else{this.computeFaceNormals();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)t[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],o=r.vertexNormals;3===o.length?(o[0].copy(t[r.a]),o[1].copy(t[r.b]),o[2].copy(t[r.c])):(o[0]=t[r.a].clone(),o[1]=t[r.b].clone(),o[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(let r=0,o=n.vertexNormals.length;r<o;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}let e=new k6;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let r=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(let s=0,a=this.faces.length;s<a;s++){let l=new T,c={a:new T,b:new T,c:new T};r.push(l),o.push(c)}}let n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,o=this.faces.length;r<o;r++){let s=this.faces[r],l=n.vertexNormals[r];n.faceNormals[r].copy(s.normal),l.a.copy(s.vertexNormals[0]),l.b.copy(s.vertexNormals[1]),l.c.copy(s.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new dr),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ps),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n,r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(n=(new Vr).getNormalMatrix(t));for(let u=0,d=s.length;u<d;u++){let p=s[u].clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(let u=0,d=l.length;u<d;u++){let f,m,p=l[u],g=p.vertexNormals,v=p.vertexColors,y=new uS(p.a+r,p.b+r,p.c+r);y.normal.copy(p.normal),void 0!==n&&y.normal.applyMatrix3(n).normalize();for(let _=0,b=g.length;_<b;_++)f=g[_].clone(),void 0!==n&&f.applyMatrix3(n).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let _=0,b=v.length;_<b;_++)m=v[_],y.vertexColors.push(m.clone());y.materialIndex=p.materialIndex+i,a.push(y)}for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,_=g.length;y<_;y++)v.push(g[y].clone());this.faceVertexUvs[u].push(v)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(e=4){let t={},i=[],n=[],r=Math.pow(10,e);for(let a=0,l=this.vertices.length;a<l;a++){let c=this.vertices[a],h=Math.round(c.x*r)+"_"+Math.round(c.y*r)+"_"+Math.round(c.z*r);void 0===t[h]?(t[h]=a,i.push(this.vertices[a]),n[a]=i.length-1):n[a]=n[t[h]]}let o=[];for(let a=0,l=this.faces.length;a<l;a++){let c=this.faces[a];c.a=n[c.a],c.b=n[c.b],c.c=n[c.c];let h=[c.a,c.b,c.c];for(let u=0;u<3;u++)if(h[u]===h[(u+1)%3]){o.push(a);break}}for(let a=o.length-1;a>=0;a--){let l=o[a];this.faces.splice(l,1);for(let c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(l,1)}let s=this.vertices.length-i.length;return this.vertices=i,s}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let n=e[t];this.vertices.push(new T(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort(function i(a,l){return a.materialIndex-l.materialIndex});let o,s,n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];n&&n.length===t&&(o=[]),r&&r.length===t&&(s=[]);for(let a=0;a<t;a++){let l=e[a]._id;o&&o.push(n[l]),s&&s.push(r[l])}o&&(this.faceVertexUvs[0]=o),s&&(this.faceVertexUvs[1]=s)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let p=this.parameters;for(let f in p)void 0!==p[f]&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],n=[],r={},o=[],s={},a=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],m=!0,g=!1,v=void 0!==this.faceVertexUvs[0][p],y=f.normal.length()>0,_=f.vertexNormals.length>0,b=1!==f.color.r||1!==f.color.g||1!==f.color.b,x=f.vertexColors.length>0,w=0;if(w=c(w,0,0),w=c(w,1,m),w=c(w,2,g),w=c(w,3,v),w=c(w,4,y),w=c(w,5,_),w=c(w,6,b),w=c(w,7,x),i.push(w),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let S=this.faceVertexUvs[0][p];i.push(d(S[0]),d(S[1]),d(S[2]))}if(y&&i.push(h(f.normal)),_){let S=f.vertexNormals;i.push(h(S[0]),h(S[1]),h(S[2]))}if(b&&i.push(u(f.color)),x){let S=f.vertexColors;i.push(u(S[0]),u(S[1]),u(S[2]))}}function c(p,f,m){return m?p|1<<f:p&~(1<<f)}function h(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return void 0!==r[f]||(r[f]=n.length/3,n.push(p.x,p.y,p.z)),r[f]}function u(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return void 0!==s[f]||(s[f]=o.length,o.push(p.getHex())),s[f]}function d(p){let f=p.x.toString()+p.y.toString();return void 0!==l[f]||(l[f]=a.length/2,a.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=n,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=i,e}clone(){return(new k6).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let u=0,d=t.length;u<d;u++)this.vertices.push(t[u].clone());let i=e.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let n=e.faces;for(let u=0,d=n.length;u<d;u++)this.faces.push(n[u].clone());for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,_=g.length;y<_;y++)v.push(g[y].clone());this.faceVertexUvs[u].push(v)}}let r=e.morphTargets;for(let u=0,d=r.length;u<d;u++){let p={};if(p.name=r[u].name,void 0!==r[u].vertices){p.vertices=[];for(let f=0,m=r[u].vertices.length;f<m;f++)p.vertices.push(r[u].vertices[f].clone())}if(void 0!==r[u].normals){p.normals=[];for(let f=0,m=r[u].normals.length;f<m;f++)p.normals.push(r[u].normals[f].clone())}this.morphTargets.push(p)}let o=e.morphNormals;for(let u=0,d=o.length;u<d;u++){let p={};if(void 0!==o[u].vertexNormals){p.vertexNormals=[];for(let f=0,m=o[u].vertexNormals.length;f<m;f++){let g=o[u].vertexNormals[f],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),p.vertexNormals.push(v)}}if(void 0!==o[u].faceNormals){p.faceNormals=[];for(let f=0,m=o[u].faceNormals.length;f<m;f++)p.faceNormals.push(o[u].faceNormals[f].clone())}this.morphNormals.push(p)}let s=e.skinWeights;for(let u=0,d=s.length;u<d;u++)this.skinWeights.push(s[u].clone());let a=e.skinIndices;for(let u=0,d=a.length;u<d;u++)this.skinIndices.push(a[u].clone());let l=e.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new jxe).fromGeometry(this),t=new gt,i=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",N6.call(new It(i,3),e.vertices)),e.normals.length>0){let n=new Float32Array(3*e.normals.length);t.setAttribute("normal",N6.call(new It(n,3),e.normals))}if(e.colors.length>0){let n=new Float32Array(3*e.colors.length);t.setAttribute("color",bj.call(new It(n,3),e.colors))}if(e.uvs.length>0){let n=new Float32Array(2*e.uvs.length);t.setAttribute("uv",xj.call(new It(n,2),e.uvs))}if(e.uvs2.length>0){let n=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",xj.call(new It(n,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let r=[],o=e.morphTargets[n];for(let s=0,a=o.length;s<a;s++){let l=o[s],c=new Ke(3*l.data.length,3);c.name=l.name,r.push(N6.call(c,l.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){let n=new Ke(4*e.skinIndices.length,4);t.setAttribute("skinIndex",wj.call(n,e.skinIndices))}if(e.skinWeights.length>0){let n=new Ke(4*e.skinWeights.length,4);t.setAttribute("skinWeight",wj.call(n,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new gt,i=e.geometry;if(e.isPoints||e.isLine){let n=new Ke(3*i.vertices.length,3),r=new Ke(3*i.colors.length,3);if(t.setAttribute("position",N6.call(n,i.vertices)),t.setAttribute("color",bj.call(r,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let o=new Ke(i.lineDistances.length,1);t.setAttribute("lineDistance",Yxe.call(o,i.lineDistances))}null!==i.boundingSphere&&(t.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};k6.prototype.isGeometry=!0;var jxe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let i,n,r,t=[],o=e.faces;for(n=0;n<o.length;n++){let s=o[n];s.materialIndex!==r&&(r=s.materialIndex,void 0!==i&&(i.count=3*n-i.start,t.push(i)),i={start:3*n,materialIndex:r})}void 0!==i&&(i.count=3*n-i.start,t.push(i)),this.groups=t}fromGeometry(e){let l,t=e.faces,i=e.vertices,n=e.faceVertexUvs,r=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=e.morphTargets,a=s.length;if(a>0){l=[];for(let g=0;g<a;g++)l[g]={name:s[g].name,data:[]};this.morphTargets.position=l}let u,c=e.morphNormals,h=c.length;if(h>0){u=[];for(let g=0;g<h;g++)u[g]={name:c[g].name,data:[]};this.morphTargets.normal=u}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,m=p.length===i.length;i.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let v=t[g];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{let b=v.normal;this.normals.push(b,b,b)}let _=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{let b=v.color;this.colors.push(b,b,b)}if(!0===r){let b=n[0][g];void 0!==b?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new $,new $,new $))}if(!0===o){let b=n[1][g];void 0!==b?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new $,new $,new $))}for(let b=0;b<a;b++){let x=s[b].vertices;l[b].data.push(x[v.a],x[v.b],x[v.c])}for(let b=0;b<h;b++){let x=c[b].vertexNormals[g];u[b].data.push(x.a,x.b,x.c)}f&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},uS=class{constructor(e,t,i,n,r,o=0){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new T,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new Ct,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function Yxe(e){return this.array.set(e),this}function bj(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new Ct),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this}function xj(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new $),t[i++]=o.x,t[i++]=o.y}return this}function N6(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new T),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this}function wj(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Ut),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this}var Gxe=["a","b","c"];function Wxe(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function dS(e,t,i){let n=Math.min(e,t),r=Math.max(e,t);return i.get(n+"_"+r)}function pS(e,t,i,n,r,o){let c,s=Math.min(e,t),a=Math.max(e,t),l=s+"_"+a;n.has(l)?c=n.get(l):(c={a:i[s],b:i[a],newEdge:null,faces:[]},n.set(l,c)),c.faces.push(r),o[e].edges.push(c),o[t].edges.push(c)}function L6(e,t,i,n,r){e.push(new uS(t,i,n,void 0,void 0,r))}function Jf(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function R6(e,t,i,n){e.push([t.clone(),i.clone(),n.clone()])}var Gr=new T,Cj=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof rr?e.shape:new rr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:n,cornerRadius:r,depth:o,extrudeBevelSize:s,extrudeBevelSegments:a}=e.parameters,l=e.shape,c=.5*t,h=.5*i,p=2*Math.PI/n;for(let m=0;m<n;m++){let g=p*m,v=0+Math.sin(g)*c,y=0+Math.cos(g)*h;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=r;l.roundness=r,l.update();let f=h1.create({shape:l,parameters:{roundness:r,depth:o,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}};function p4(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function fS(e,t,i,n,r,o){let s=t.clone().sub(e),a=i.clone().sub(e),l=s.angleTo(a);if(s.normalize(),a.normalize(),n===r){let c=s.add(a).normalize();o.copy(e).addScaledVector(c,n/Math.sin(l/2))}else{let c=s.angleTo(a);o.copy(e),o.addScaledVector(s,r/Math.sin(c)),o.addScaledVector(a,n/Math.sin(c))}}function Zxe(e,t,i){let n=e.clone().sub(t),r=i.clone().sub(t);return n.projectOnVector(r),n.add(t)}var Kxe=class extends gt{constructor(e=.5,t=1,i=4,n=1,r=!1,o=0,s=4){super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),s=Math.floor(s);let E,a=[],l=[],c=[],h=[],u=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),m=2*Math.PI/i,g=(i-2)*Math.PI/i,v=Math.PI-g,y=new T(0,-d,0),_=new T(0,d,0),b=new $(e,-d),x=new $(f,-d),w=new $(0,_.y).sub(x),S=new $(0,_.y).sub(b),C=new $(w.y,-w.x).normalize(),M=new $(S.y,-S.x).normalize(),z=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-w.angle())/2)-1e-8;o=Math.min(o,z);{let N=new T(C.x,C.y,0),W=new T(Math.cos(m)*N.x,N.y,Math.sin(m)*N.x);E=N.angleTo(W)}let D=o/Math.tan((Math.PI-w.angle())/2),P=o/Math.tan((Math.PI-E)/2),I=new T;if(!r){l.push(y.x,y.y,y.z),c.push(0,-1,0),h.push(0,0);let N=u++,W=[],Q=b.clone(),G=D/Math.cos(Math.PI/i);Q.x-=G;for(let Y=0;Y<i;Y++){let J=Y/i*Math.PI*2+p;p4(Q,new $(Math.sin(J),Math.cos(J)),I),l.push(I.x,I.y,I.z),c.push(0,-1,0),h.push(0,0),W.push(u++)}for(let Y=0;Y<W.length;Y++)a.push(W[Y],N,W[(Y+1)%W.length])}let B=[];{let N=new T,W=new T,Q=new T,G=new T,Y=new T,J=new T;for(let q=0;q<i;q++){let ee=q/i*Math.PI*2+p,Z=(q+.5)/i*Math.PI*2+p,ce=(q+1)/i*Math.PI*2+p,te=new $(Math.sin(ee),Math.cos(ee)),pe=new $(Math.sin(Z),Math.cos(Z)),se=new $(Math.sin(ce),Math.cos(ce));p4(b,te,W),p4(b,se,Q),p4(C,pe,N),fS(_,W,Q,P,P,G),l.push(G.x,G.y,G.z),fS(W,_,Q,P,D,Y),l.push(Y.x,Y.y,Y.z),fS(Q,W,_,D,P,J),l.push(J.x,J.y,J.z),c.push(N.x,N.y,N.z),c.push(N.x,N.y,N.z),c.push(N.x,N.y,N.z),h.push(0,0),h.push(0,0),h.push(0,0);let ze=u++,_e=u++,ge=u++;if(a.push(ze,_e,ge),o>0){{let Ze=W.clone().add(Q).multiplyScalar(.5),rt=_.clone().sub(Ze).normalize(),Ve=y.clone().sub(Ze).normalize().add(rt).normalize().multiplyScalar(-1);V(Ze,J.clone().sub(Y),Ve,w.angle())}let Xe,$e;{let Ze=new T;p4(M,se,Ze);let rt=J.clone().add(G).multiplyScalar(.5);rt=Zxe(rt,Q,_);let Ve=J.clone().sub(G);[Xe,$e]=V(rt,Ve,Ze,E,G.y)}{let Ze=Xe,rt=Ze.clone().setY(0).normalize(),Ve=new T(0,-1,0),Le=rt.clone().cross(Ve);R(Ze,rt,Ve,Le)}B.concat($e);{let Ze=w.angle(),rt=Math.PI-Ze,Ve=_.clone();Ve.y-=o/Math.sin(Ze-Math.PI/2);let Le=new T,vt=[];for(let j=0;j<s;j++){let F=[],ue=Math.PI/2-rt*j/s,Ie=Math.cos(ue),O=Math.sin(ue),be=Z;for(let lt=0;lt<=j;lt++){let We=Math.cos(be),Me=Math.sin(be);N.x=Ie*Me,N.y=O,N.z=Ie*We,Le.copy(Ve).addScaledVector(N,o),l.push(Le.x,Le.y,Le.z),c.push(N.x,N.y,N.z),h.push(0,0),F.push(u++),be+=2*Math.PI/j/i}vt.push(F)}$e.reverse(),vt.push($e);let Ft=vt.length-1;for(let j=0;j<Ft;j++){let F=vt[j],ue=vt[j+1],Ie=F.length-1;a.push(ue[1],F[0],ue[0]);for(let O=1;O<=Ie;O++)a.push(F[O],F[O-1],ue[O]),a.push(ue[O+1],F[O],ue[O])}}}}}function V(N,W,Q,G,Y){let J=-G/2,q=(Math.PI-G)/2,ee=W.clone().normalize().cross(Q);N.addScaledVector(Q,-o/Math.sin(q));let Z=new T,ce=new T,pe=u,se=[];for(let ze=0;ze<=s;ze++){let _e=J+ze/s*G;ce.set(0,0,0),ce.addScaledVector(ee,Math.sin(_e)),ce.addScaledVector(Q,Math.cos(_e));for(let ge=0;ge<=1;ge++){let Xe=ge/1-.5;if(Z.copy(N),Z.addScaledVector(W,Xe),Z.addScaledVector(ce,o),null!=Y){let $e=Math.max(0,Z.y-Y);Z.addScaledVector(W,-$e/W.y)}l.push(Z.x,Z.y,Z.z),c.push(ce.x,ce.y,ce.z),h.push(0,0),0===ge&&se.push(u),u++}}for(let ze=0;ze<s;ze++)for(let _e=0;_e<1;_e++){let ge=pe+_e+2*ze,Xe=ge+2,$e=Xe+1,Ze=ge+1;a.push(ge,Xe,Ze),a.push(Xe,$e,Ze)}return[N.clone().addScaledVector(W,.5),se]}function R(N,W,Q,G){let Y=Math.PI/2,J=S.angle()-Y,q=[],ee=new T,Z=new T;for(let te=0;te<=s;te++){let pe=[],se=te/s;for(let ze=0;ze<=te;ze++){let _e=((te?ze/te:0)-.5)*v,ge=Math.cos(_e),Xe=Math.sin(_e),Ze=(Y+Math.atan(Math.tan(J)*ge))*se,rt=Math.cos(Ze),Ve=Math.sin(Ze);ee.set(0,0,0),ee.addScaledVector(W,Ve*ge),ee.addScaledVector(Q,rt),ee.addScaledVector(G,Ve*Xe),Z.copy(N).addScaledVector(ee,o),l.push(Z.x,Z.y,Z.z),c.push(ee.x,ee.y,ee.z),h.push(0,0),pe.push(u++)}q.push(pe)}let ce=q.length-1;for(let te=0;te<ce;te++){let pe=q[te],se=q[te+1],ze=pe.length-1;a.push(pe[0],se[1],se[0]);for(let _e=1;_e<=ze;_e++)a.push(pe[_e-1],pe[_e],se[_e]),a.push(pe[_e],se[_e+1],se[_e])}}this.setIndex(a),this.setAttribute("position",new Ke(l,3)),this.setAttribute("normal",new Ke(c,3)),this.setAttribute("uv",new Ke(h,2))}},mS=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),n=Object.assign(t?.ui??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof rr?e.shape:new rr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:n}}static build(e){let t=e.shape,{width:i,height:n,cornerRadius:r,cornerType:o,depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c={x:.5*i,y:.5*n},h={x:-c.x,y:-c.y},u={x:c.x,y:c.y};function d(b,x,w){return x>i&&w>n?Math.min(b*i/x,b*n/w):x>i?b*i/x:w>n?b*n/w:b}let p=[];p[0]=0===r[0]?0:d(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:d(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:d(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:d(r[3],r[3]+r[0],r[3]+r[2]);let f=h.x,m=u.x,g=u.y,v=h.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let b=0,x=t.points.length;b<x;b++)t.points[b].roundness=p[b],b>0&&p[b]!==p[b-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=1!==o,t.update();let _=h1.create({shape:t,parameters:{depth:s,extrudeBevelSize:a,extrudeBevelSegments:l}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},iwe=class extends gt{constructor(e=1,t=1,i=1,n=90,r=10,o=24){super(),this.type="BackdropGeometry";let s=[],a=[],l=[],c=.001;0==r&&(o=1),o=Math.max(1,Math.floor(o)),r=Math.min(r,100),n=Math.min(180-c,n),n*=Math.PI/180;let h=[],u=Math.PI/2,d=(ce=0,te=0,pe=0)=>new T(ce,te,pe),p=d(),f=d(),[m,g,v]=[t/2,e/2,i/2],y=-g,_=+g,[b,x,w]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],S=(ce,te=!1)=>Math.sin(ce-Math.PI/(+te+1)),C=(ce,te=!1)=>Math.cos(ce-Math.PI/(+te+1));w.y=Math.sin(n)*t-m;let M=Math.cos(n)*t-v,z=b.z-c;n<=u?(w.z=Math.min(M,z),w.z==z&&(w.y-=(M-z)/Math.tan(u-n))):x.z=Math.min(x.z-M-v,b.z-c),p.subVectors(b,x),f.subVectors(w,x);let E=Math.min(p.length(),f.length())*r/100,D=E*Math.tan(n/2),P=E/Math.cos(n/2),I=p.clone().normalize().add(f.normalize()).setLength(P).add(x);p.set(0,S(n,!0),C(n,!0)),h.push([w,p.clone()]);let B=(Math.PI-n)/o;for(let ce=0;ce<=o;ce++){let te=u+n+ce*B;p.set(0,Math.sin(te)*D,Math.cos(te)*D),p.add(I),f.set(0,S(te),C(te)),h.push([p.clone(),f.clone()])}h.push([b,d(0,1,0)]);let V=Math.sin(B/2)*D*2,R=h.length-1,N=h[0][0].distanceTo(h[1][0]),Q=N+V*o+h[R-1][0].distanceTo(h[R][0]);h[0].push(1);for(let ce=0;ce<=o;ce++)h[ce+1].push(1-(N+ce*V)/Q);h[R].push(0);let q,ee,Z,[G,Y,J]=h[0];for(let ce=1;ce<h.length;ce++)[q,ee,Z]=h[ce],s.push(y,G.y,G.z,y,q.y,q.z,_,G.y,G.z,_,G.y,G.z,y,q.y,q.z,_,q.y,q.z),a.push(0,Y.y,Y.z,0,ee.y,ee.z,0,Y.y,Y.z,0,Y.y,Y.z,0,ee.y,ee.z,0,ee.y,ee.z),l.push(0,J,0,Z,1,J,1,J,0,Z,1,Z),[G,Y,J]=[q,ee,Z];this.setAttribute("position",new Ke(s,3)),this.setAttribute("normal",new Ke(a,3)),this.setAttribute("uv",new Ke(l,2))}},Sj=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof rr?e.shape:new rr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:o,angle:s,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,u=.5*t,d=.5*i,m=s*Math.PI/360/r,g=Math.PI/2*3*-1,v=u*n/100,y=d*n/100;if(3===r&&50===n){m=2*Math.PI/r;for(let b=0;b<r;b++){let x=m*b,w=0+Math.sin(x)*u,S=0+Math.cos(x)*d;h.addPoint(h.createPoint(w,S))}}else for(let b=0;b<r;b++){let x=0+Math.cos(g)*u,w=0+Math.sin(g)*d;h.addPoint(h.createPoint(x,w)),g+=m,x=0+Math.cos(g)*v,w=0+Math.sin(g)*y,h.addPoint(h.createPoint(x,w)),g+=m}h.isClosed=!0;for(let b=0,x=h.points.length;b<x;b++)h.points[b].roundness=o;h.roundness=o,h.update();let _=h1.create({shape:h,parameters:{roundness:o,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},ve=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+ve.version}static addUnaryOp(e){return ve.max_unop_len=Math.max(e.length,ve.max_unop_len),ve.unary_ops[e]=1,ve}static addBinaryOp(e,t,i){return ve.max_binop_len=Math.max(e.length,ve.max_binop_len),ve.binary_ops[e]=t,i?ve.right_associative.add(e):ve.right_associative.delete(e),ve}static addIdentifierChar(e){return ve.additional_identifier_chars.add(e),ve}static addLiteral(e,t){return ve.literals[e]=t,ve}static removeUnaryOp(e){return delete ve.unary_ops[e],e.length===ve.max_unop_len&&(ve.max_unop_len=ve.getMaxKeyLen(ve.unary_ops)),ve}static removeAllUnaryOps(){return ve.unary_ops={},ve.max_unop_len=0,ve}static removeIdentifierChar(e){return ve.additional_identifier_chars.delete(e),ve}static removeBinaryOp(e){return delete ve.binary_ops[e],e.length===ve.max_binop_len&&(ve.max_binop_len=ve.getMaxKeyLen(ve.binary_ops)),ve.right_associative.delete(e),ve}static removeAllBinaryOps(){return ve.binary_ops={},ve.max_binop_len=0,ve}static removeLiteral(e){return delete ve.literals[e],ve}static removeAllLiterals(){return ve.literals={},ve}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new ve(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return ve.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!ve.binary_ops[String.fromCharCode(e)]||ve.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return ve.isIdentifierStart(e)||ve.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(ve.hooks[e]){let i={context:this,node:t};return ve.hooks.run(e,i),i.node}return t}searchHook(e){if(ve.hooks[e]){let t={context:this};return ve.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===ve.SPACE_CODE||e===ve.TAB_CODE||e===ve.LF_CODE||e===ve.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions();return this.runHook("after-all",1===e.length?e[0]:{type:ve.COMPOUND,body:e})}gobbleExpressions(e){let i,n,t=[];for(;this.index<this.expr.length;)if(i=this.code,i===ve.SEMCOL_CODE||i===ve.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())t.push(n);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,ve.max_binop_len),t=e.length;for(;t>0;){if(ve.binary_ops.hasOwnProperty(e)&&(!ve.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!ve.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,n,r,o,s,a,l;if(o=this.gobbleToken(),!o||(t=this.gobbleBinaryOp(),!t))return o;for(r={value:t,prec:ve.binaryPrecedence(t),right_a:ve.right_associative.has(t)},s=this.gobbleToken(),s||this.throwError("Expected expression after "+t),n=[o,r,s];t=this.gobbleBinaryOp();){if(i=ve.binaryPrecedence(t),0===i){this.index-=t.length;break}r={value:t,prec:i,right_a:ve.right_associative.has(t)},l=t;let c=h=>r.right_a&&h.right_a?i>h.prec:i<=h.prec;for(;n.length>2&&c(n[n.length-2]);)s=n.pop(),t=n.pop().value,o=n.pop(),e={type:ve.BINARY_EXP,operator:t,left:o,right:s},n.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),n.push(r,e)}for(a=n.length-1,e=n[a];a>1;)e={type:ve.BINARY_EXP,operator:n[a-1].value,left:n[a-2],right:e},a-=2;return e}gobbleToken(){let e,t,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(e=this.code,ve.isDecimalDigit(e)||e===ve.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===ve.SQUOTE_CODE||e===ve.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===ve.OBRACK_CODE)n=this.gobbleArray();else{for(t=this.expr.substr(this.index,ve.max_unop_len),i=t.length;i>0;){if(ve.unary_ops.hasOwnProperty(t)&&(!ve.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!ve.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let r=this.gobbleToken();return r||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:ve.UNARY_EXP,operator:t,argument:r,prefix:!0})}t=t.substr(0,--i)}ve.isIdentifierStart(e)?(n=this.gobbleIdentifier(),ve.literals.hasOwnProperty(n.name)?n={type:ve.LITERAL,value:ve.literals[n.name],raw:n.name}:n.name===ve.this_str&&(n={type:ve.THIS_EXP})):e===ve.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===ve.PERIOD_CODE||t===ve.OBRACK_CODE||t===ve.OPAREN_CODE||t===ve.QUMARK_CODE;){let i;if(t===ve.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==ve.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===ve.OBRACK_CODE?(e={type:ve.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==ve.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===ve.OPAREN_CODE?e={type:ve.CALL_EXP,arguments:this.gobbleArguments(ve.CPAREN_CODE),callee:e}:(t===ve.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:ve.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let t,i,e="";for(;ve.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===ve.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);ve.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,"e"===t||"E"===t){for(e+=this.expr.charAt(this.index++),t=this.char,("+"===t||"-"===t)&&(e+=this.expr.charAt(this.index++));ve.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);ve.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,ve.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===ve.PERIOD_CODE||1===e.length&&e.charCodeAt(0)===ve.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:ve.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let r=this.expr.charAt(this.index++);if(r===i){n=!0;break}if("\\"===r)switch(r=this.expr.charAt(this.index++),r){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=r}else e+=r}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:ve.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(ve.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,ve.isIdentifierPart(e));)this.index++;return{type:ve.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){i=!0,this.index++,e===ve.CPAREN_CODE&&n&&n>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===ve.COMMA_CODE){if(this.index++,n++,n!==t.length)if(e===ve.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===ve.CBRACK_CODE)for(let o=t.length;o<n;o++)t.push(null)}else if(t.length!==n&&0!==n)this.throwError("Expected comma");else{let o=this.gobbleExpression();(!o||o.type===ve.COMPOUND)&&this.throwError("Expected comma"),t.push(o)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(ve.CPAREN_CODE);if(this.code===ve.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:ve.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:ve.ARRAY_EXP,elements:this.gobbleArguments(ve.CBRACK_CODE)}}},uwe=new class{add(e,t,i){if("string"!=typeof arguments[0])for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(n){this[n]=this[n]||[],t&&this[n][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}};Object.assign(ve,{hooks:uwe,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if("object"!=typeof t||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}}(ve),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),ve.max_unop_len=ve.getMaxKeyLen(ve.unary_ops),ve.max_binop_len=ve.getMaxKeyLen(ve.binary_ops);var e0=e=>new ve(e).parse();Object.getOwnPropertyNames(ve).forEach(e=>{void 0===e0[e]&&"prototype"!==e&&(e0[e]=ve[e])}),e0.Jsep=ve;var fwe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let o=i;for(;o.right.operator&&e.binary_ops[o.right.operator]<=.9;)o=o.right;t.node.test=o.right,o.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};e0.plugins.register(fwe);var mwe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],gwe=["0","1","2","3","4","5","6","7","8","9","."],vwe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function ywe(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}function Mj(e,t,i="number"){let r,o,n="";for(let s=0;s<e.length;s++){let a=e[s];if("id"in a){if(s>0&&"id"in e[s-1])return void console.error("Two variables in a row",e);let c=t.getVariable(a.id),h=oa.getDisplayedValue(c);"number"===i&&oa.isTextValue(c)&&Array.isArray(c.textValue)&&1===c.textValue.length?h=parseFloat(h).toString():"boolean"===i&&oa.isBoolean(c)?h=c?"true":"false":"boolean"===i&&oa.isTextValue(c)&&!Array.isArray(c.textValue)&&(h='"'+h+'"'),n+=h}else"string"!==i?"and"!==a.name?"or"!==a.name?"True"!==a.name?"False"!==a.name?"boolean"!==i||ywe(a.name)||gwe.includes(a.name)||mwe.includes(a.name)||vwe.includes(a.name.replace(/\($/g,""))?n+=a.name:n+='"'+a.name+'"':n+="false":n+="true":n+="||":n+="&&":('"'!==a.name&&"+"!==a.name&&(n+=a.name),"+"===a.name&&"\\"===n[n.length-1]&&(n=n.slice(0,-1)+a.name))}if("string"===i)return n;if(0===e.length){if("number"===i)return 0;if("boolean"===i)return!1}try{r=e0(n)}catch(s){return void console.error(n,s)}try{o=ki(r)}catch(s){console.error(n,r,s)}return o}function ki(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return Number(ki(e.left)===ki(e.right));case"!=":return Number(ki(e.left)!==ki(e.right));case">":return Number(ki(e.left)>ki(e.right));case">=":return Number(ki(e.left)>=ki(e.right));case"<":return Number(ki(e.left)<ki(e.right));case"<=":return Number(ki(e.left)<=ki(e.right));case"+":return ki(e.left)+ki(e.right);case"-":return ki(e.left)-ki(e.right);case"*":return ki(e.left)*ki(e.right);case"/":return ki(e.left)/ki(e.right);case"%":return ki(e.left)%ki(e.right);case"&&":return ki(e.left)&&ki(e.right);case"||":return ki(e.left)||ki(e.right);case"^":return Math.pow(ki(e.left),ki(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-ki(e.argument);case"!":return Number(!ki(e.argument));default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if("Identifier"===e.callee.type){if("random"===e.callee.name){let t=0,i=1;if(e.arguments.length>=1)try{t=ki(e.arguments[0])}catch(n){console.warn(n)}if(e.arguments.length>=2)try{i=ki(e.arguments[1])}catch(n){console.warn(n)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(ki))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}e0.addBinaryOp("^",11,!0);var _we=new De,bwe=new De,Cwe=class extends gt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth&&function lwe(e,t){let i=2*Math.PI;return(e%i+i)%i==(t%i+i)%i}(e.twist,0)&&e.startScale===e.endScale)}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?e.length:e.length-1,o=Math.floor(n*r),s=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),a=Math.min(Math.max(2,s-o+1),r+2),l=[],c=[];for(let R=0;R<a;R++){let N=this.inputs.path.isClosed?(R+o)%e.length:Math.min(R+o,e.length-1);l.push(e[N].clone()),c.push(t[N].clone())}let h=(R,N,W)=>{l[R]=l[R].clone().lerp(l[N],W),c[R]=function xwe(e,t,i){let n=[new T,new T,new T],r=[new T,new T,new T];return e.extractBasis(n[0],n[1],n[2]),t.extractBasis(r[0],r[1],r[2]),n.forEach((o,s)=>{let a=r[s],l=et.lerp(o.length(),a.length(),i);o.lerp(a,i).setLength(l)}),(new De).makeBasis(n[0],n[1],n[2])}(c[R],c[N],W)},u=0,d=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(d||0===n)&&(u=d,h(0,1,u));let p=0,f=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===i){let R=l.length-1;l[R].copy(l[0]),c[R].copy(c[0])}this._applyPathModifiers(c,u,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let S,{regions:_,infos:b,vertices:x}=this._computeShapePoints(y),w=0;"round"===v&&(S=new aS(this.inputs.shapeData,2*m,m,y,g,void 0,!0),w=S.getAttribute("position").count);let C=0,M=0;b.sort((R,N)=>R.start-N.start),b.forEach(R=>{R.verticesStart=C,R.verticesCount=R.continuous.reduce((N,W,Q)=>N+(0!==Q&&W?1:2),0),M+=R.verticesCount,C=M});let E,z=M*a,D=0;if(this._isOpenEnded()&&"flat"===v){try{E=Tu({windingRule:sn.ODD,elementType:Ir.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:_})}catch{E=hj}D=E.vertexCount}let P=z+2*D+2*w,I=z+2*D,B={positions:new Float32Array(3*P),normals:new Float32Array(3*P),uvs:new Float32Array(2*P)},V=[];if(b.forEach(R=>{this._extrudeRegion(R,x,c,l,B,V,this._isGeometryClosed()&&!this._isOpenEnded())}),E&&(this._closeEnd(E,z,V,B,c[0],l[0],!1),this._closeEnd(E,z+D,V,B,c[c.length-1],l[l.length-1],!0)),S){B.positions.set(S.getAttribute("position").array,3*I),B.normals.set(S.getAttribute("normal").array,3*I),B.uvs.set(S.getAttribute("uv").array,2*I);for(let Q=I;Q<I+w;Q++)B.uvs[2*Q+1]=1e-4;let R=V.length;V.push(...S.getIndex().array.map(Q=>Q+I)),I+=w,B.positions.set(S.getAttribute("position").array,3*I),B.normals.set(S.getAttribute("normal").array,3*I),B.uvs.set(S.getAttribute("uv").array,2*I);let N=V.length;V.push(...S.getIndex().array.map(Q=>Q+I)),this.setAttribute("position",new It(B.positions,3)),this.setAttribute("normal",new It(B.normals,3)),this.setAttribute("uv",new It(B.uvs,2)),this.setIndex(V);let W=_we;W.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(W,I,P),W.copy(c[0]).setPosition(l[0]).multiply(bwe.makeScale(1,1,-1)),this.applyMatrix4OnRange(W,I-w,I),this.reverseIndicesOnRange(R,N)}else this.setAttribute("position",new It(B.positions,3)),this.setAttribute("normal",new It(B.normals,3)),this.setAttribute("uv",new It(B.uvs,2)),this.setIndex(V)}_extractPathPoints(){let e=GU(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,n=this.inputs.path.isClosed,r=new T,o=new T,s=new T,a=new T,l=new T(0,1,0);for(let f=0;f<i;f++){let g,v,m=e[f];g=0===f?n?e[e.length-2]:m.clone().multiplyScalar(2).sub(e[1]):e[f-1],v=f===i-1?n?e[1]:m.clone().multiplyScalar(2).sub(e[f-1]):e[f+1];let y=m.clone().sub(g).normalize(),_=v.clone().sub(m).normalize(),b=y.clone().add(_).normalize();s.copy(b),0===f&&(b.equals(l)||b.clone().negate().equals(l))&&l.set(0,0,1);let x=l.clone().cross(b).normalize(),w=b.clone().cross(x).normalize();l.copy(w),a.copy(x),0===f&&(r.copy(w),o.copy(b));let S=(new De).makeBasis(x,w,b);t.push(S)}let c=n?o:s,h=n?r:new T(0,1,0),u=c.clone().cross(a).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return t;let p=h.clone().cross(u);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let m=(new De).makeRotationZ(d*f/t.length);t[f].multiply(m)}return t}_applyPathModifiers(e,t,i){let n=e.length,{angle:r,twist:o,startScale:s,endScale:a}=this.inputs.parameters.extrusion,l=new De,c=new De;return e.forEach((h,u)=>{let d=0===u?0:u===n-1?1:(u-t)/(n-(0===i?0:1)-(t+(1-i)));l.makeRotationZ(et.lerp(r,r+o,d)*et.DEG2RAD);let p=et.lerp(s,a,d);c.makeScale(p,p,p),h.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=sn.ODD){let o,s,i=this.inputs.shapeData,n=i.extractShapePointsToFlatArray([],e),r=i.shapeHoles.map(p=>{let f=p.extractShapePointsToFlatArray([],e),m=[];for(let g=f.length-1;g>=1;g-=2)m.push(f[g-1],f[g-0]);return m});try{o=Tu({windingRule:t,elementType:Ir.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n]})}catch{o=oS}try{s=Tu({windingRule:sn.ODD,elementType:Ir.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...r]})}catch{s=cj}if(!o)throw new Error("error generating geometry");let a=o.elementCount;if(s){o.elementCount+=s.elementCount;for(let p=0;p<s.elements.length;p++)o.elements.push(s.elements[p]+(p%2==0?o.vertexCount:0));for(let p=0;p<s.vertexIndices.length;p++)o.vertexIndices.push(s.vertexIndices[p]+o.vertexCount);for(let p=0;p<s.vertices.length;p++)o.vertices.push(s.vertices[p])}let l=1/0,c=-1/0,h=1/0,u=-1/0;for(let p=0,f=o.vertexCount;p<f;p++){let m=2*p,g=o.vertices[m+0],v=o.vertices[m+1];g<l&&(l=g),g>c&&(c=g),v<h&&(h=v),v>u&&(u=v)}let d=[];for(let p=o.elementCount-1;p>=0;p--){let f=p>=a,m=2*p,g=o.elements[m+0],v=o.elements[m+1],y=g+v,_={start:g,count:v,normals:[],isHole:f,continuous:[],verticesStart:0,verticesCount:0};d.push(_);let b=g,x=y-1,w=g+1,S=i.roundedCurves.length;do{let C=b-g,E=o.vertices[2*b+0],D=o.vertices[2*b+1],P=o.vertices[2*w+0],I=o.vertices[2*w+1],B=E-o.vertices[2*x+0],V=D-o.vertices[2*x+1],R=Math.sqrt(B*B+V*V);B/=R,V/=R;let N=E-P,W=D-I,Q=Math.sqrt(N*N+W*W);N/=Q,W/=Q,_.normals[2*C+0]=-W,_.normals[2*C+1]=N;let G=o.vertexIndices[b];if(Array.isArray(G))_.continuous[C]=!1;else{let[Y,J]=i.getCurveIndexFromVertexId(G-1,!0);if(J>0&&J<1)_.continuous[C]=!0;else{let q=1===J?Y+1:Y-1;q=(q+S)%S;let ee=1===J?0:1,Z=i.roundedCurves[Y].getTangent(J),ce=i.roundedCurves[q].getTangent(ee);_.continuous[C]=Z.dot(ce)>.95}}f&&(_.normals[2*C+0]*=-1,_.normals[2*C+1]*=-1),[x,b,w]=[b,w,w+1],w>=y&&(w-=v)}while(w!==g+1)}return{regions:[n,...r],infos:d,vertices:o.vertices}}_insertVertex(e,t,i,n,r){let o=2*t,s=3*t;e.positions[s+0]=i.x,e.positions[s+1]=i.y,e.positions[s+2]=i.z,e.normals[s+0]=n.x,e.normals[s+1]=n.y,e.normals[s+2]=n.z,e.uvs[o+0]=r.x,e.uvs[o+1]=r.y}_extrudeRegion(e,t,i,n,r,o,s){let a=new T,l=new T,c=new T,h=new T,u=new $;i.forEach((p,f)=>{let m=n[f],g=e.verticesStart*i.length+e.verticesCount*f;for(let v=0;v<e.count;v++){let y=2*(e.start+v);if(a.set(t[y+0],t[y+1],0),c.copy(a).applyMatrix4(p).add(m),e.continuous[v])h.set(e.normals[2*v+0],e.normals[2*v+1],0);else{let _=0===v?2*(e.start+e.count-1):y-2;l.set(t[_+0],t[_+1],0),h.copy(a).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(p).normalize(),u.set(0===v?1:v/e.count,f/(i.length-1)),this._insertVertex(r,g,c,h,u),g++,!e.continuous[v]||0===v){if(0===v)h.set(e.normals[2*v+0],e.normals[2*v+1],0),u.set(0,f/(i.length-1));else{let _=v===e.count-1?2*e.start:y+2;l.set(t[_+0],t[_+1],0),h.copy(l).sub(a),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(p).normalize(),this._insertVertex(r,g,c,h,u),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,m=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||0===v)&&g++;let y=v===e.count-1?0:g+1,_=f+g,b=f+y,x=m+y,w=m+g;e.isHole?o.push(_,x,b,_,w,x):o.push(_,b,x,_,x,w),g++}}}_closeEnd(e,t,i,n,r,o,s){let a=e.vertexCount,l=new T(0,0,s?-1:1).applyMatrix4(r),c=new T,h=new $;for(let d=0;d<a;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(r).add(o),this._insertVertex(n,t+d,c,l,h)}let u=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d;i.push(u[p+0]+t,u[p+(s?1:2)]+t,u[p+(s?2:1)]+t)}}applyMatrix4OnRange(e,t,i){let o,s,a,l,n=e.elements,r=(new Vr).getNormalMatrix(e).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let u=c.array,d=h.array,p=c.itemSize;for(let f=t*p,m=i*p;f<m;f+=p)o=u[f+0],s=u[f+1],a=u[f+2],l=1/(n[3]*o+n[7]*s+n[11]*a+n[15]),u[f+0]=(n[0]*o+n[4]*s+n[8]*a+n[12])*l,u[f+1]=(n[1]*o+n[5]*s+n[9]*a+n[13])*l,u[f+2]=(n[2]*o+n[6]*s+n[10]*a+n[14])*l,o=d[f+0],s=d[f+1],a=d[f+2],d[f+0]=r[0]*o+r[3]*s+r[6]*a,d[f+1]=r[1]*o+r[4]*s+r[7]*a,d[f+2]=r[2]*o+r[5]*s+r[8]*a;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let n=e;n<t;n+=3){let r=i.getX(n),o=i.getX(n+1),s=i.getX(n+2);i.setXYZ(n,s,o,r)}i.needsUpdate=!0}}};function zj(){let e=new gt;return e.setAttribute("position",new It(new Float32Array([]),3)),e.setIndex(new It(new Uint16Array([]),1)),e}var Ej,F6,Swe=zj().attributes,Tj=class extends gt{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,Swe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i?.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t?.requestRender()})}updateFont(e,t){var i=this;return(0,Dn.Z)(function*(){let n=t.getFont(e);n&&(i.font=n,yield n.loadingPromise)})()}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t?.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:i,height:n,depth:r,extrudeBevelSize:o,extrudeBevelSegments:s,text:a,textTransform:l}=e,c=oa.getDisplayedValue(a),u=function Twe(e,t,i){let n=[""],r="";for(let o of i)r+=o," "===o||"\n"===o?(n[n.length-1]+=r,r="","\n"===o&&n.push("")):t.getTextWidth(n[n.length-1]+r,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+r,e)>e.width&&(1===r.length?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}(e,t,2===l?c.toUpperCase():3===l?c.toLowerCase():c),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(u,e),m=.5*("number"==typeof i?i:1),g=.5*("number"==typeof n?n:1),v=d.map(b=>(new rr).fromShape(b,!0));this.vectorShapes=v;let y=v.map(b=>h1.create({shape:b,parameters:{depth:r,extrudeBevelSegments:s,extrudeBevelSize:o,windingRule:r<=0?sn.NONZERO:sn.ODD,subdivisions:this.isLowResolution&&r>0?1:12}})),_=y.length?o1(y):zj();_.translate(-m,g,0),this.dispose(),this.wrappedText=u,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(_.attributes).forEach(([b,x])=>{this.setAttribute(b,x)}),this.setIndex(_.index),this.computeBoundingSphere()}clone(){let e=Xl(new gt,Tj.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}setText(e){var t=this;return(0,Dn.Z)(function*(){t.font&&(yield t.font.loadingPromise),yield t.update({...t.userData.parameters,text:e})})()}get text(){return this.userData.parameters.text??""}},Dj=new Promise(e=>{Ej=e}),Aj=!1;function Ewe(){if(!Aj)return F6||(F6=function e(){return t.apply(this,arguments)}(),F6);function t(){return(t=(0,Dn.Z)(function*(){let n=mn.e(526).then(mn.bind(mn,526)),[r,o]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/modelling-wasm@1.0.81/build/process.wasm").then(l=>l.arrayBuffer())]),s=r.default,a=yield s({wasmBinary:o});Ej(a),Aj=!0})).apply(this,arguments)}}var Dwe=["font"];function f4(e,t,i,n){let r,o,s;"PathGeometry"===e.type?(o=JSON.parse(JSON.stringify(e)),s=[[],["extrusion"]]):(o={...e},s=[[]]);for(let c of s){let h=o;for(let u of c)h=h[u];for(r in h){let u=h[r];WH(u)&&!Dwe.includes(r)&&(h[r]=t.getVariable(u,[n.uuid,"geometry",...c,r]),WH(h[r])&&(h[r]=1))}}let l,a={parameters:o,type:o.type};if("PathGeometry"===o.type)a.path=o.path;else if("VectorGeometry"===o.type){let c=rr.createFromState(o.shape,o.width,o.height);a.shape=c}else if("NonParametricGeometry"===o.type)o.data.groups&&o.data.groups?.forEach(c=>c.materialIndex=Math.max(c.materialIndex??0,0)),a.geometry=(new gB).parse(o);else{if("SubdivGeometry"===o.type){let c=new ps(o,i);return c.data=e,c}if("TextGeometry"===o.type)return new Tj(o,t);if("UIGeometry"===o.type)return mS.create({parameters:{width:o.width,height:o.height,cornerRadius:o.cornerRadius,cornerType:o.cornerType}})}try{l=Bj(a)}catch(c){console.error(c)}if(!l){let c=rr.createFromState(o6.defaultData(),100,100);a.shape=c,l=Bj(a)}return l}var Awe=new De;function gS(e,t,i,n){let a,l,c,r=e.position.array,o=e.normal.array,s=Awe.makeScale(t,i,n).invert().elements;for(var h=0,u=r.length;h<u;h+=3)r[h]*=t,r[h+1]*=i,r[h+2]*=n,a=o[h],l=o[h+1],c=o[h+2],o[h]=s[0]*a+s[4]*l+s[8]*c,o[h+1]=s[1]*a+s[5]*l+s[9]*c,o[h+2]=s[2]*a+s[6]*l+s[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var Tt,B6=new dr,t0=new T;Dj.then(e=>{Tt=e});var Pj=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Ij=new Uint32Array([0,1,2,3]),Oj=new Uint8Array([4]),ps=class extends gt{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let n=Qd.div(t,this.data.scaleBaked);this.subdividedGeometry&&gS(this.subdividedGeometry.attributes,...n),this.originalGeometry&&gS(this.originalGeometry.attributes,...n),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(t0.fromArray(n));let o=t0.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=o/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=ps.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new rl(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0,Object.assign(this,this.subdividedGeometry??this.originalGeometry),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(ps.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new Ps,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.boundingSphere.center;B6.setFromBufferAttribute(e.attributes.position),B6.getCenter(i),e.boundingSphere.radius=i.distanceTo(B6.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),B6.getSize(t0);let n={width:t0.x,height:t0.y,depth:t0.z};return this.userData.parameters=n,n}static build(e,t,i,n){let r,o,s,a=e?.phongAngle??35;!1===i&&(a=-1),t&&(Tt.free_bvh(t),Tt.free_subdivision_surface(t));try{r=ps.allocate(e,n)}catch(l){console.error(l,e),r=ps.allocate({positionWASM:Pj,indexWASM:Ij,verticesPerFaceWASM:Oj},n)}if(Tt.set_destination_refinement_level(r,0),o=ps.buildLevel(r,!0,a),e.subdivisions>0)try{Tt.set_destination_refinement_level(r,e.subdivisions),s=ps.buildLevel(r,!1,a)}catch{try{Tt.set_destination_refinement_level(r,e.subdivisions-1),s=ps.buildLevel(r,!1,a)}catch{s=null}}else s=null;return{subdivPointer:r,originalGeometry:o,subdividedGeometry:s}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let r,o,s,a,l,c,n=void 0!==e.shape||void 0!==e.path?t.geometry:f4(e,i,!1);if(r="TorusGeometry"===e.type&&e.arc===2*Math.PI?n.getClosedTorusIndicesForBooleanOrSubdiv():n.getIndex(),({positions:o,triIndices:l}=V6(n.getAttribute("position"),r)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let h=e.radialSegments*e.heightSegments*3*2;c=[h,h+3*e.radialSegments]}return({indices:s,verticesPerFace:a}=Nj(o,l,n,c)),{positions:o,indices:s,verticesPerFace:a}}static allocate(e,t){let i,n,r,o=[],s=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,n=e.indexWASM,r=e.verticesPerFaceWASM):(i=Pj,n=Ij,r=Oj);let y,a=i.length,l=n.length,c=r.length,h=i.length+o.length+s.length,u=n.length+r.length,d=h*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,p=h*Float32Array.BYTES_PER_ELEMENT,m=(Uint32Array,Tt._malloc(d)),g=new Float32Array(Tt.HEAPF32.buffer,m,h),v=new Uint32Array(Tt.HEAPU32.buffer,m+p,u);g.set(i,0),g.set(o,i.length),g.set(s,i.length+o.length),v.set(n,0),v.set(r,n.length),e?.scaleBaked?.some(b=>1!==b)&&(y=(new De).makeScale(...e.scaleBaked)),t&&(y?y.premultiply(t):y=t);let _=y?Tt.alloc_subdivision_surface2(m,a,m+p,l,m+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c,y.elements):Tt.alloc_subdivision_surface(m,a,m+p,l,m+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c);return Tt._free(m),_}static buildLevel(e,t,i,n,r){let o=r?Tt.get_mesh_data2(e,t?Tt.Level.CONTROL:Tt.Level.REFINED,i,r.elements):Tt.get_mesh_data(e,t?Tt.Level.CONTROL:Tt.Level.REFINED,i),a=Tt.HEAPU32.subarray(o>>2,8+(o>>2)),l=a.subarray(4,8),c=0,h=Tt.HEAPU32[a[c]>>2],u=Tt.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=Tt.HEAPU32[a[c]>>2],p=Tt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=Tt.HEAPU32[a[c]>>2],m=Tt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let g=Tt.HEAPU32[a[c]>>2],v=Tt.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,void 0===n){let y=new gt;if(y.setIndex(new Jp(v,1)),y.setAttribute("position",new Ke(u,3)),y.setAttribute("normal",new Ke(p,3)),t){y.setAttribute("faceMap",new Jp(m,1));let _=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new It(_,4))}return Tt.free_mesh_data(o),y.userData.type="SubdivGeometry",y}n.getAttribute("position").copyArray(u),n.getAttribute("normal").copyArray(p),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,Tt.free_mesh_data(o)}static freeSubdivPointer(e){Tt.free_bvh(e),Tt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let n=Tt.get_wireframe_data_for_base_level(e),o=Tt.HEAPU32.subarray(n>>2,4+(n>>2)),s=o.subarray(2,4),a=0,l=Tt.HEAPU32[o[a]>>2],c=Tt.HEAPF32.subarray(l>>2,(l>>2)+s[a]);a++;let h=Tt.HEAPU32[o[a]>>2],u=Tt.HEAPU32.subarray(h>>2,(h>>2)+s[a]);if(void 0===t){let d=new gt;d.setAttribute("position",new Ke(c,3));let p=new Float32Array(c.length);for(let f=0,m=c.length;f<m;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new It(p,3)),d.setIndex(new Jp(u,1)),Tt.free_wireframe_data_for_base_level(n),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,Tt.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,i){let n=0===t;n||Tt.set_destination_refinement_level(e,t);let r=i?Tt.get_topological_data2(e,n?Tt.Level.CONTROL:Tt.Level.REFINED,i.elements):Tt.get_topological_data(e,n?Tt.Level.CONTROL:Tt.Level.REFINED),s=Tt.HEAPU32.subarray(r>>2,6+(r>>2)),a=s.subarray(3,6),l=0,c=Tt.HEAPU32[s[l]>>2],h=new Float32Array(Tt.HEAPF32.subarray(c>>2,(c>>2)+a[l]));l++;let u=Tt.HEAPU32[s[l]>>2],d=new Uint32Array(Tt.HEAPU32.subarray(u>>2,(u>>2)+a[l]));l++;let p=Tt.HEAPU32[s[l]>>2],f=new Uint8Array(Tt.HEAPU32.subarray(p>>2,(p>>2)+a[l]));return Tt.free_topological_data(r),{positions:h,indices:d,verticesPerFace:f}}},kj=["getX","getY","getZ"];function V6(e,t){let i={},n=t?t.count:e.count,r=0,o=[],s=[];for(let c=0;c<n;c++){let h=t?t.getX(c):c,u="";for(let d=0;d<3;d++)u+=~~(1e4*e[kj[d]](h))+",";if(u in i)o.push(i[u]);else{for(let d=0;d<3;d++)s.push(e[kj[d]](h));i[u]=r,o.push(r),r++}}let l=[];for(let c=0;c<o.length;c+=3)o[c]===o[c+1]||o[c]===o[c+2]||o[c+1]===o[c+2]||l.push(o[c],o[c+1],o[c+2]);return{positions:s,triIndices:l}}var H6=new T,vS=new T,yS=new T,_S=new T;function Nj(e,t,i,n){let r=[],o=[];if(void 0!==i.userData.shape&&0===i.userData.parameters.depth&&0===i.userData.shape.shapeHoles.length){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if("EllipseGeometry"===i.userData.type&&c<=24&&c%4==0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d==0)}let h=0;for(let d=0;d<l.length;d+=2)h+=(l[d]-l[(0===d?l.length:d)-2])*(l[d+1]+l[(0===d?l.length:d)-1]);e.length=0;let u=0;if(h<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),r.push(u++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),r.push(u++);return o.push(u),{indices:r,verticesPerFace:o}}let s=new Float32Array([i.userData.parameters.depth])[0],a=0;for(;a<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[3*t[a]+2]===s||0===e[3*t[a]+2])&&l++,(e[3*t[a+1]+2]===s||0===e[3*t[a+1]+2])&&l++,(e[3*t[a+2]+2]===s||0===e[3*t[a+2]+2])&&l++,3===l)break}if(t[a+1]===t[a+3]&&t[a+2]===t[a+5]||t[a+0]===t[a+3]&&t[a+2]===t[a+4]){H6.set(e[3*t[a]],e[3*t[a]+1],e[3*t[a]+2]),vS.set(e[3*t[a+1]],e[3*t[a+1]+1],e[3*t[a+1]+2]),yS.set(e[3*t[a+4]],e[3*t[a+4]+1],e[3*t[a+4]+2]),_S.set(e[3*t[a+5]],e[3*t[a+5]+1],e[3*t[a+5]+2]),vS.sub(H6).normalize(),yS.sub(H6).normalize(),_S.sub(H6).normalize();let l=vS.cross(yS).dot(_S);Math.abs(l)>.005||n&&n.some((c,h)=>h%2!=1&&a>=n[h]&&a<n[h+1])?(r.push(t[a],t[a+1],t[a+2]),o.push(3),a+=3):(r.push(t[a],t[a+1],t[a+4],t[a+5]),o.push(4),a+=6)}else r.push(t[a],t[a+1],t[a+2]),o.push(3),a+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],h=0;for(let u=0,d=0;u<e.length;u+=3,d++)0===e[u+2]&&(l.push(d),h++),e[u+2]===s&&c.push(d);if(0===i.userData.parameters.extrudeBevelSize){let u=c[0];c[0]=c[1],c[1]=u}l.reverse(),r.push(...l,...c),o.push(h,h)}return{indices:r,verticesPerFace:o}}var vh={};((e,t)=>{for(var i in t)bv(e,i,{get:t[i],enumerable:!0})})(vh,{calcBoolean:()=>Nwe,calcBooleanTopological:()=>kwe,freeMeshSet:()=>Bwe,getMeshSet:()=>Lwe,hasOpenEdges:()=>Rwe,transformMeshSet:()=>Fwe});var Lj,U6,pi,n0,Pwe=new Promise(e=>{Lj=e});function Iwe(){if(U6)return U6;function t(){return(t=(0,Dn.Z)(function*(){let n=mn.e(226).then(mn.bind(mn,226)),[r,o]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/boolean-wasm@1.0.81/build/boolean.wasm").then(l=>l.arrayBuffer())]),s=r.default,a=yield s({wasmBinary:o});Lj(a)})).apply(this,arguments)}return U6=function e(){return t.apply(this,arguments)}(),U6}function Rj(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?i:n,o=pi._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(pi.HEAPU32.buffer,o,t):new Float32Array(pi.HEAPF32.buffer,o,t)).set(e,0),o}function Fj(e){switch(e){case 0:return pi.OP.UNION;case 1:return pi.OP.INTERSECTION;case 2:return pi.OP.A_MINUS_B;case 3:return pi.OP.B_MINUS_A;case 4:return pi.OP.SYMMETRIC_DIFFERENCE;case 5:return pi.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function kwe(e,t){void 0===n0&&(n0=pi.init_csg());let i=Rj(e),n=pi.csg_calc_topological(n0,i,e.length,Fj(t));pi._free(i);let o=pi.HEAPU32.subarray(n>>2,6+(n>>2)),s=o.subarray(3,6),a=0,l=pi.HEAPU32[o[a]>>2],c=new Float32Array(pi.HEAPF32.subarray(l>>2,(l>>2)+s[a]));a++;let h=pi.HEAPU32[o[a]>>2],u=new Uint32Array(pi.HEAPU32.subarray(h>>2,(h>>2)+s[a]));a++;let d=pi.HEAPU32[o[a]>>2],p=new Uint8Array(pi.HEAPU32.subarray(d>>2,(d>>2)+s[a]));return pi.free_mesh_data(n),{positions:c,indices:u,verticesPerFace:p}}function Nwe(e,t,i,n){void 0===n0&&(n0=pi.init_csg());let r=Rj(e),o=pi.csg_calc(n0,r,e.length,n,Fj(t));pi._free(r);let a=pi.HEAPU32.subarray(o>>2,5+(o>>2)),l=a.subarray(2,5),c=0,h=pi.HEAPU32[a[c]>>2],u=pi.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=pi.HEAPU32[a[c]>>2],p=pi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new Ke(u,3)),i.setAttribute("normal",new Ke(p,3));let m=pi.HEAPF32.subarray(5+(o>>2),5+(o>>2)+6);return null===i.boundingSphere&&(i.boundingSphere=new Ps),i.boundingSphere.center.set(m[0],m[1],m[2]),i.boundingSphere.radius=(m[3]**2+m[4]**2+m[5]**2)**.5,i.userData.parameters={width:2*m[3],height:2*m[4],depth:2*m[5]},pi.free_mesh_data(o),f}function Lwe(e,t,i){if(void 0===pi)return-1;let n,r,o;if(t&&void 0!==e.userData.positions){let v=e.userData;o=v.verticesPerFace.length,n=v.positions,r=Array(v.verticesPerFace.reduce((y,_)=>y+_,0)+o);for(let y=0,_=0,b=0;y<v.verticesPerFace.length;y++){r[b++]=v.verticesPerFace[y];for(let x=0;x<v.verticesPerFace[y];x++)r[b++]=v.indices[_++]}}else({positions:n,faceIndices:r,nFaces:o}=function Owe(e,t,i){let n,r;r="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let a,{positions:o,triIndices:s}=V6(e.getAttribute("position"),r);if(t&&i){let{indices:l,verticesPerFace:c}=Nj(o,s,e);a=c.length,n=[];for(let h=0,u=0;h<a;h++){n.push(c[h]);for(let d=0;d<c[h];d++)n.push(l[u++])}}else{let l=s.length;n=Array(l+l/3),a=0;for(let c=0,h=0;h<n.length;)n[h++]=3,a++,n[h++]=s[c++],n[h++]=s[c++],n[h++]=s[c++]}return{positions:o,faceIndices:n,nFaces:a}}(e,t,i));let s=n.length,a=r.length,l=n.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,p=(Uint32Array,pi._malloc(h)),f=new Float32Array(pi.HEAPF32.buffer,p,l),m=new Uint32Array(pi.HEAPU32.buffer,p+u,c);f.set(n,0),m.set(r,0);let g=pi.get_csg_mesh(p,s,p+u,a,o);return pi._free(p),g}function Rwe(e){return pi.has_open_edges(e)}function Fwe(e,t){pi.transform_csg_mesh(e,t.elements)}function Bwe(e){pi.free_csg_mesh(e)}Pwe.then(e=>pi=e);var Vwe={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=et.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let d,{width:t,depth:i,height:n,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:h,cornerSegments:u}=e.parameters;return 0===l?(d=new gt,d.setAttribute("position",new Ke([],3))):d=c>0||h>0||l<360?new XU(0,t/2,n,r,o,s,a,l*Math.PI/180,c,h,u,0,!0):new Vx(t/2,n,r,o,s),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let c,{width:t,height:i,depth:n,widthSegments:r,heightSegments:o,depthSegments:s,cornerRadius:a,cornerSegments:l}=e.parameters;return c=0==a?new rl(t,i,n,r,o,s):new axe(t,i,n,r,o,s,a,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},CylinderGeometry:WU,DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:o,cornerSides:s}=e.parameters,a=0===r&&0!==o?new $U(.5*t,o,s):new $F(.5*t,r);return a.scale(1,i/t,n/t),Object.assign(a,{userData:{...e,type:"DodecahedronGeometry"}})}},EllipseGeometry:lS,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??n),o=Math.abs(i.depth??n),s=Math.abs(Math.min(n,o))/2;return{parameters:Object.assign(i,{width:n,height:r,depth:o,radius:s,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:n,radius:r,revolutions:o,segments:s,pathRadius:a,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:u}=e.parameters,d=new yj(!1,t,i,n,r,o,s,a,l,c,h,u);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:o,cornerSides:s}=e.parameters,a=0===r&&0!==o?new _j(.5*t,o,s):new nB(.5*t,r);return a.scale(1,i/t,n/t),Object.assign(a,{userData:{...e,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){(e.parameters?.points??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},t?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:n}=e.parameters,r=new n8;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let o=new XF(r.extractPoints(n).shape,i);return o.rotateZ(Math.PI),Object.assign(o,{userData:{...e,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let n,i=e.geometry??t?.geometry??(new gt).copy(new rl(100,100,100));void 0===t?(i.computeBoundingBox(),i.boundingBox.getSize(Gr),n={width:Gr.x,height:Gr.y,depth:Gr.z,subdivisions:0}):n=t.parameters;let r={...n,...e.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:n,subdivisions:r}=e.parameters,o=e.geometry??(new gt).copy(new rl(100,100,100)),s=o.userData.parameters;void 0===s?(o.computeBoundingBox(),o.boundingBox.getSize(Gr)):Gr.set(s.width,s.height,s.depth),(t!==Gr.x||i!==Gr.y||n!==Gr.z)&&o.scale(0===Gr.x?1:t/Gr.x,0===Gr.y?1:i/Gr.y,0===Gr.z?1:n/Gr.z);let a=o.originalGeometry;try{r>0?(void 0===a||s?.subdivisions!==r)&&(void 0===a&&(a=o),o=new class{constructor(e=1){this.subdivisions=e}modify(e){(e=e instanceof gt?(new k6).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let i,n,r,o,s,t=new T,a=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=void 0!==c&&c.length>0,u=[],d=new Map;!function qxe(e,t,i,n){let r,o,s;for(r=0,o=e.length;r<o;r++)i[r]={edges:[]};for(r=0,o=t.length;r<o;r++)s=t[r],pS(s.a,s.b,e,n,s,i),pS(s.b,s.c,e,n,s,i),pS(s.c,s.a,e,n,s,i)}(a,l,u,d);let f,m,g,v,y,_,b,p=[];for(let ce of Array.from(d.keys())){for(m=d.get(ce),g=new T,y=3/8,_=1/8,b=m.faces.length,2!=b&&(y=.5,_=0),g.addVectors(m.a,m.b).multiplyScalar(y),t.set(0,0,0),o=0;o<b;o++){for(v=m.faces[o],s=0;s<3&&(f=a[Wxe(v,Gxe[s])],f===m.a||f===m.b);s++);f&&t.add(f)}t.multiplyScalar(_),g.add(t),m.newEdge=p.length,p.push(g)}let x,w,S,C,M,z,E,D=[];for(n=0,r=a.length;n<r;n++){for(z=a[n],M=u[n].edges,i=M.length,3==i?x=3/16:i>3&&(x=3/(8*i)),w=1-i*Number(x),S=x,i<=2&&2==i&&(w=3/4,S=1/8),E=z.clone().multiplyScalar(w),t.set(0,0,0),o=0;o<i;o++)C=M[o],f=C.a!==z?C.a:C.b,t.add(f);t.multiplyScalar(Number(S)),E.add(t),D.push(E)}let B,V,R,Q,G,Y,J,P=D.concat(p),I=D.length,N=[],W=[],q=new $,ee=new $,Z=new $;for(n=0,r=l.length;n<r;n++)v=l[n],B=Number(dS(v.a,v.b,d).newEdge)+I,V=Number(dS(v.b,v.c,d).newEdge)+I,R=Number(dS(v.c,v.a,d).newEdge)+I,L6(N,B,V,R,v.materialIndex),L6(N,v.a,B,R,v.materialIndex),L6(N,v.b,V,B,v.materialIndex),L6(N,v.c,R,V,v.materialIndex),h&&(Q=c[n],G=Q[0],Y=Q[1],J=Q[2],q.set(Jf(G.x,Y.x),Jf(G.y,Y.y)),ee.set(Jf(Y.x,J.x),Jf(Y.y,J.y)),Z.set(Jf(G.x,J.x),Jf(G.y,J.y)),R6(W,q,ee,Z),R6(W,G,q,Z),R6(W,Y,ee,q),R6(W,J,Z,ee));e.vertices=P,e.faces=N,h&&(e.faceVertexUvs[0]=W)}}(r).modify(a).toBufferGeometry()):(void 0!==a&&(o=a),a=void 0,void 0===o.getAttribute("normal")&&o.computeVertexNormals())}catch{void 0!==a&&(o=a),a=void 0,void 0===o.getAttribute("normal")&&o.computeVertexNormals()}return void 0!==a&&Object.assign(o,{originalGeometry:a}),delete e.geometry,Object.assign(o,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new gB(i).load(e,n=>{let r=this.normalizeInputs({geometry:n});n.boundingBox.getSize(Gr);let o=100/Gr.x;Object.assign(r.parameters,{width:100,height:Gr.y*o,depth:Gr.z*o}),t(this.build(r))})}},PolygonGeometry:Cj,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,heightSegments:o,openEnded:s,cornerRadius:a,cornerSegments:l}=e.parameters,c=new Kxe(.5*t,i,r,o,s,a,l);return c.scale(1,1,n/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}},RectangleGeometry:mS,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=et.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let h,{width:t=100,height:i=t,depth:n=t,widthSegments:r=64,heightSegments:o=64,phiStart:s,phiLength:a,thetaStart:l,thetaLength:c}=e.parameters;return 0===c?(h=new gt,h.setAttribute("position",new Ke([],3))):h=new ff(.5*t,r,o,s,a,l,c*et.DEG2RAD),h.scale(1,i/t,n/t),Object.assign(h,{userData:{...e,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:n=8,heightSegments:r=8}=e.parameters,o=new Bd(t,i,n,r);return o.scale(1,1,1),Object.assign(o,{userData:{...e,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,angle:r,cornerRadius:o,cornerSegments:s}=e.parameters,a=new iwe(t,i,n,r,o,s);return Object.assign(a,{userData:{...e,type:"BackdropGeometry"}})}},StarGeometry:Sj,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,n=new Bd(t,i);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),o=Math.round(Math.abs(i.depth??.25*i.width));return{parameters:Object.assign(i,{width:n,height:r,depth:o})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,tubularSegments:o,arc:s,cornerRadius:a,cornerSegments:l}=e.parameters,c=function owe(e,t,i,n,r,o,s,a,l,c,h){[t,i]=[i,t],s=t/2;let u=et.clamp(r/360,0,1);if(0===u){let d=new gt;return d.setAttribute("position",new Ke([],3)),d}return 1===u&&(c=0),new yj(!0,e,t,i,n,u,o,s,a,l,c,h)}(t,i,n,.5*t,s,o,0,0,r,a,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??.125*i.width})}}static build(e){let{width:t,tube:i,tubularSegments:n,radialSegments:r,p:o,q:s}=e.parameters,a=.5*t;a!==i&&(a-=i);let l=new oB(a,i,n,r,o,s);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof rr?e.shape:new rr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:o,extrudeBevelSegments:s,isRect:a}=e.parameters,l=e.shape,c=.5*t,h=.5*i;a?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=n;l.roundness=n,l.update();let u=h1.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:o,extrudeBevelSegments:s}});return Object.assign(u,{userData:{...e,type:"TriangleGeometry"}})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),s=t?.shapeData??lS.create({parameters:nU}).userData.shape;return{path:e.path??s6.defaultData(),parameters:Object.assign(i,{width:n,height:r,depth:o,extrusion:{...rU,...i.extrusion}}),shapeData:s}}static build(e){if(e.path.points.length>=2){let t=new Cwe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}return Object.assign(new gt,{userData:{...e,type:"PathGeometry"}})}},VectorGeometry:h1},Bj=e=>Vwe[e.type].create(e);function r0(e){return null!==e&&"booleanOp"in e}var Vj=class extends(qC(Dr)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new De}updateVisible(e){super.updateVisible(e),this.visible=!r0(this.parent)&&this.visible,r0(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(vh.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),r0(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof Vj&&(e.freeBooleanPointer(),r0(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&r0(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),r0(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},j6=new dr;function bS(e,t=0,i=e.count,n,r){let o=1/0,s=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0;for(let u=t;u<i;u++){let d=e.getX(u),p=e.getY(u),f=e.getZ(u);d<o&&(o=d),p<s&&(s=p),f<a&&(a=f),d>l&&(l=d),p>c&&(c=p),f>h&&(h=f)}j6.min.set(o,s,a),j6.max.set(l,c,h),j6.getCenter(n),j6.getSize(r).multiplyScalar(.5)}var Hwe=new gt,Uwe=new Rd,fs=class extends Vj{constructor(e,t){super(Hwe,Uwe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?bS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Eu=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===Eu.uuidContext)throw new Error("plz startContext");this.uuid=Eu.uuidContext===Eu.globalContext?"_gid"+Eu.uuidContext.nodeContextUuid++:"_uid"+Eu.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){null===this.uuidContext||this.uuidContext===Eu.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return this.analyze(e,i=i??{}),this.flow(e,t,i)}flow(e,t,i){e.addFlow((i=i??{}).slot,i.cache,i.context);let n={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),n}build(e,t,i){t=t??this.getType(e,t);let n=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,n,r,o){return""}generate(e,t,i,n,r){return""}parse(e,t,i,n){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let n=e.getTypeLength(i);(n>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=n,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},To=Eu;To.globalContext={nodeContextUuid:0},To.uuidContext=Eu.globalContext;var Hj=class{constructor(e){this.name=(e=e??{}).name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},ks=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){this.keywords[e]={callback:t,cache:i=void 0===i||i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},an=class extends To{constructor(e,t){super(e),this.scope="",this.shared=void 0===(t=t??{}).shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,i,n){if(t=t??this.getType(e),this.getShared(e,t)){let r=this.getUnique(e,t);r&&void 0===this.uuid&&(this.uuid=et.generateUUID()),i=e.getUUID(i??this.getUUID(),!r);let o=e.getNodeData(i),s=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,i)):super.build(e,t,i);if(r)return o.name=o.name||super.build(e,t,i),o.name;if(!this.getLabel()&&(!this.getShared(e,s)||e.context.ignoreCache||1===o.deps))return super.build(e,t,i);i=this.getUUID(!1);let a=this.getTemp(e,i);if(a)return e.format(a,s,t);{a=super.generate(e,t,i,o.output,n);let l=this.generate(e,s,i);return e.addNodeCode(a+" = "+l+";"),e.format(a,s,t)}}return super.build(e,t,i)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,n,r){return this.getShared(e,t)||console.error("TempNode is not shared"),e.getTempVar(i=i??this.uuid,n??this.getType(e),r,this.getLabel()).name}},Ns=class extends an{constructor(e,t){(t=t??{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,n,r,o){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let s=e.getNodeData(i);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,i,n,r,o):e.isShader("vertex")?(s.vertex||(s.vertex=e.createVertexUniform(n,this,r,o,this.getLabel())),e.format(s.vertex.name,n,t)):(s.fragment||(s.fragment=e.createFragmentUniform(n,this,r,o,this.getLabel())),e.format(s.fragment.name,n,t))}},Eo=class extends Ns{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof $?e:new $(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,n,r,o){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},Ea=class extends Ns{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof T?e:new T(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,n,r,o){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},Do=class extends Ct{constructor(e,t,i,n){super(e,t,i),this.isColorA=!0,this.a=n}setRGBA(e,t,i,n){super.setRGB(e,t,i),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a="rgba"===r?parseFloat(n[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a="hsla"===r?parseFloat(n[4]):1,super.setStyle(e,t)}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},yh=class extends Ns{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Do?e:new Do(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,n,r,o){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},Ywe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Uj=/[a-z_0-9]+/gi,qe=class extends an{constructor(e,t,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(e,t,i,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,n,r){let o,s=0,a=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;o=Uj.exec(this.src);)l.push(o);for(let c=0;c<l.length;c++){let h=l[c],u=h[0],d=!this.isMethod||!this.getInputByName(u),p=u;if(this.keywords[u]||this.useKeywords&&d&&ks.containsKeyword(u)){let f=this.keywords[u];if(!f){let m=ks.getKeywordData(u);m.cache&&(f=e.keywords[u]),f=f||ks.getKeyword(u,e),m.cache&&(e.keywords[u]=f)}p=f.build(e)}u!==p&&"."!==a[h.index+s-1]&&(a=a.substring(0,h.index+s)+p+a.substring(h.index+u.length+s),s+=p.length-u.length),void 0===this.getIncludeByName(p)&&ks.contains(p)&&e.include(ks.get(p))}return"source"===t?a:this.isMethod?(this.isInterface||e.include(this,void 0,a),this.name):e.format("( "+a+" )",this.getType(e),t)}parse(e,t,i,n){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=n??{},this.isMethod){let r=Ywe.exec(this.src);if(this.inputs=[],r&&4==r.length){this.type=r[1],this.name=r[2];let o=r[3].match(Uj);if(o){let s=0;for(;s<o.length;){let l,a=o[s++];"in"===a||"out"===a||"inout"===a?l=o[s++]:(l=a,a="");let c=o[s++];this.inputs.push({name:c,type:l,qualifier:a})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},Gwe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,jj=class extends an{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||jj.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,n,r){this.src=e||"";let o,s,a="",l=Gwe.exec(e);this.useDefine=r??"#"===this.src.charAt(0),l&&l.length>1?(s=l[1],o=l[2],a=l[3]):(o=this.src,s="f"),this.name=o,this.type=s,this.value=a}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,n,r){return e.format(this.name,this.getType(e),t)}},ln=jj;ln.PI="PI",ln.PI2="PI2",ln.RECIPROCAL_PI="RECIPROCAL_PI",ln.RECIPROCAL_PI2="RECIPROCAL_PI2",ln.LOG2="LOG2",ln.EPSILON="EPSILON";var Wwe=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),qwe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Yj=class extends an{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,n,r){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=Wwe.exec(e);if(t){let n,i=t[2];for(;n=qwe.exec(i);)this.inputs.push({type:n[1],name:n[2]});this.name=t[1]}else this.name="";this.type=this.name}},xS=class extends an{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(n,this.getType(e),t)}};ks.addKeyword("uv",function(){return new xS}),ks.addKeyword("uv2",function(){return new xS(1)});var o0=class extends an{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??o0.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case el:return["Linear"];case Zt:return["sRGB"];default:return[]}}generate(e,t){let i=this.input.build(e,"v4"),n=this.getType(e),r=o0.Nodes[this.method],o=e.include(r);if(o===o0.LINEAR_TO_LINEAR)return e.format(i,n,t);if(2===r.inputs?.length){let s=this.factor.build(e,"f");return e.format(o+"( "+i+", "+s+" )",n,t)}return e.format(o+"( "+i+" )",n,t)}fromEncoding(e){let t=o0.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=o0.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},oc=o0;oc.Nodes={LinearToLinear:new qe(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new qe(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new qe(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},oc.LINEAR_TO_LINEAR="LinearToLinear",oc.SRGB_TO_LINEAR="sRGBToLinear",oc.LINEAR_TO_SRGB="LinearTosRGB";var Pn=class extends qe{constructor(e="",t,i,n,r){super(e,r,n,i,t),this.nodeType="Expression"}},_h=class extends Ns{constructor(e=new Zn,t,i,n){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new xS,this.bias=i,this.project=void 0!==n&&n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if("sampler2D"===t)return this.getTexture(e,t);let o,s,i=this.getTexture(e,t),n=this.uv.build(e,this.project?"v4":"v2"),r=this.bias?this.bias.build(e,"f"):void 0;void 0===r&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f")),o=this.project?"texture2DProj":r?"tex2DBias":"tex2D",s=r?o+"( "+i+", "+n+", "+r+" )":o+"( "+i+", "+n+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new oc(new Pn("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,l),e.removeContext(),e.format(s,l,t)}},it=class extends Ns{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,n,r,o){return e.format(this.value+(this.value%1?"":".0"),n,t)}},Gj=class extends an{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,n,r){n=this.getType(e);let o=this.value,s=o.build(e,t)+"( ",a=[];if(o.inputs){for(let l=0;l<o.inputs.length;l++){let c=o.inputs[l];a.push((this.inputs[l]||this.inputs[c.name]).build(e,e.getTypeByFormat(c.type)))}s+=a.join(", ")+" )"}return e.format(s,n,t)}},Wj=class extends an{constructor(e,t,i=Wj.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let n=this.a.build(e,i),r=this.b.build(e,i);return e.format("( "+n+" "+this.op+" "+r+" )",i,t)}},Ls=Wj;Ls.ADD="+",Ls.SUB="-",Ls.MUL="*",Ls.DIV="/";var cn=class extends an{constructor(e,t=cn.ABS,i,n){super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof i?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case cn.MIX:case cn.CLAMP:case cn.REFRACT:case cn.SMOOTHSTEP:case cn.FACEFORWARD:return 3;case cn.MIN:case cn.MAX:case cn.MOD:case cn.STEP:case cn.REFLECT:case cn.DISTANCE:case cn.DOT:case cn.CROSS:case cn.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>n?this.a.getType(e):i>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case cn.LENGTH:case cn.DISTANCE:case cn.DOT:return"f";case cn.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,n,r,o=this.a?e.getTypeLength(this.a.getType(e)):0,s=this.b?e.getTypeLength(this.b.getType(e)):0,a=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case cn.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case cn.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case cn.CROSS:i=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case cn.STEP:i=this.a.build(e,1===o?"f":l),n=this.b.build(e,l);break;case cn.MIN:case cn.MAX:case cn.MOD:i=this.a.build(e,l),n=this.b.build(e,1===s?"f":l);break;case cn.REFRACT:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,"f");break;case cn.MIX:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,1===a?"f":l);break;default:i=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(r=this.c.build(e,l))}let h=[];h.push(i),n&&h.push(n),r&&h.push(r);let u=this.getNumInputs(e);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},Qt=cn;Qt.RAD="radians",Qt.DEG="degrees",Qt.EXP="exp",Qt.EXP2="exp2",Qt.LOG="log",Qt.LOG2="log2",Qt.SQRT="sqrt",Qt.INV_SQRT="inversesqrt",Qt.FLOOR="floor",Qt.CEIL="ceil",Qt.NORMALIZE="normalize",Qt.FRACT="fract",Qt.SATURATE="saturate",Qt.SIN="sin",Qt.COS="cos",Qt.TAN="tan",Qt.ASIN="asin",Qt.ACOS="acos",Qt.ARCTAN="atan",Qt.ABS="abs",Qt.SIGN="sign",Qt.LENGTH="length",Qt.NEGATE="negate",Qt.INVERT="invert",Qt.MIN="min",Qt.MAX="max",Qt.MOD="mod",Qt.STEP="step",Qt.REFLECT="reflect",Qt.DISTANCE="distance",Qt.DOT="dot",Qt.CROSS="cross",Qt.POW="pow",Qt.MIX="mix",Qt.CLAMP="clamp",Qt.REFRACT="refract",Qt.SMOOTHSTEP="smoothstep",Qt.FACEFORWARD="faceforward";var m4=class extends an{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,n){let r=new Gj(m4.Nodes.bilinearCubeUV,[t,i,n]);this.colorSpaceTL=this.colorSpaceTL??new oc(new Pn("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new oc(new Pn("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new oc(new Pn("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new oc(new Pn("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(e)+".br");let o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new Pn(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Pn(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Pn(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Pn(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let s=new Pn("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return s.keywords.cubeUV_TL=this.colorSpaceTLExp,s.keywords.cubeUV_TR=this.colorSpaceTRExp,s.keywords.cubeUV_BL=this.colorSpaceBLExp,s.keywords.cubeUV_BR=this.colorSpaceBRExp,s.keywords.cubeUV=r,s}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=new Gj(m4.Nodes.roughnessToMip,[this.bias||e.context.roughness]),o=new Qt(r,m4.Nodes.m0,m4.Nodes.cubeUV_maxMipLevel,Qt.CLAMP),s=new Qt(o,Qt.FLOOR),a=new Qt(o,Qt.FRACT),l=this.bilinearCubeUV(e,this.value,i,s),c=this.bilinearCubeUV(e,this.value,i,new Ls(s,new it(1).setReadonly(!0),Ls.ADD)),h=new Qt(l,c,a,Qt.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},wS=m4;wS.Nodes=function(){let e=new Yj("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new ln("float cubeUV_maxMipLevel 8.0",!0),i=new ln("float cubeUV_minMipLevel 4.0",!0),n=new ln("float cubeUV_maxTileSize 256.0",!0),r=new ln("float cubeUV_minTileSize 16.0",!0),o=new qe("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;let s=new qe("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");s.useKeywords=!1;let a=new qe("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,o,s,t,i,n,r]);a.useKeywords=!1;let l=new ln("float r0 1.0",!0),c=new ln("float v0 0.339",!0),h=new ln("float m0 -2.0",!0),u=new ln("float r1 0.8",!0),d=new ln("float v1 0.276",!0),p=new ln("float m1 -1.0",!0),f=new ln("float r4 0.4",!0),m=new ln("float v4 0.046",!0),g=new ln("float m4 2.0",!0),v=new ln("float r5 0.305",!0),y=new ln("float v5 0.016",!0),_=new ln("float m5 3.0",!0),b=new ln("float r6 0.21",!0),x=new ln("float v6 0.0038",!0),w=new ln("float m6 4.0",!0);return{bilinearCubeUV:a,roughnessToMip:new qe("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,u,d,p,f,m,g,v,y,_,b,x,w]),m0:h,cubeUV_maxMipLevel:t}}();var s0=class extends an{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??s0.VIEW}getShared(){return this.scope===s0.WORLD}build(e,t,i,n){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,i,n):super.build(e,t,i)}generate(e,t,i,n,r){let o;switch(this.scope){case s0.VIEW:o=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case s0.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case s0.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal")}return e.format(o,this.getType(e),t)}},Rs=s0;Rs.LOCAL="local",Rs.WORLD="world",Rs.VIEW="view",Rs.NORMAL="normal",ks.addKeyword("viewNormal",function(){return new Rs(Rs.VIEW)}),ks.addKeyword("localNormal",function(){return new Rs(Rs.NORMAL)}),ks.addKeyword("worldNormal",function(){return new Rs(Rs.WORLD)});var bh=class extends an{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??bh.LOCAL}getType(){return this.scope===bh.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case bh.LOCAL:case bh.WORLD:return!1}return!0}generate(e,t,i,n,r){let o;switch(this.scope){case bh.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case bh.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case bh.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case bh.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(o,this.getType(),t)}},hl=bh;hl.LOCAL="local",hl.WORLD="world",hl.VIEW="view",hl.PROJECTION="projection",ks.addKeyword("position",function(){return new hl}),ks.addKeyword("worldPosition",function(){return new hl(hl.WORLD)}),ks.addKeyword("viewPosition",function(){return new hl(hl.VIEW)});var sc=class extends an{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??sc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===sc.SPHERE?"v2":this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case sc.VECTOR:{let r=new Rs(Rs.VIEW),o=e.context.roughness,s=r.build(e,"v3"),a=new hl(hl.VIEW).build(e,"v3"),l=o?o.build(e,"f"):void 0,c=`reflect( -normalize( ${a} ), ${s} )`;l&&(c=`normalize( mix( ${c}, ${s}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${h};`),n="reflectVec"):n=h;break}case sc.CUBE:{let r=new sc(sc.VECTOR).build(e,"v3"),o="vec3( -"+r+".x, "+r+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${o};`),n="reflectCubeVec"):n=o;break}case sc.SPHERE:{let r="normalize( ( viewMatrix * vec4( "+new sc(sc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${r};`),n="reflectSphereVec"):n=r;break}}return e.format(n,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},a0=sc;a0.CUBE="cube",a0.SPHERE="sphere",a0.VECTOR="vector";var Xwe=class extends an{constructor(e=new _h,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new wS(this.value,t??new a0(a0.VECTOR),i),this.irradianceNode=new wS(this.value,new Rs(Rs.WORLD),new it(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},$we=class extends Ns{constructor(e=new xx,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new a0,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){if("samplerCube"===t)return this.getTexture(e,t);let o,i=this.getTexture(e,t),n=this.uv?.build(e,"v3"),r=this.bias?this.bias.build(e,"f"):void 0;void 0===r&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f")),o=r?"texCubeBias( "+i+", "+n+", "+r+" )":"texCube( "+i+", "+n+" )";let s={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(s),this.colorSpace=this.colorSpace??new oc(new Pn("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,a),e.removeContext(),e.format(o,a,t)}},qj=["x","y","z","w"],iCe=["float","vec2","vec3","vec4"],nCe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},rCe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Xj=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let n=this.getIncludes(t,i);if(!n)return"";let r="";n=n.sort(e);for(let o=0;o<n.length;o++)n[o].src&&(r+=n[o].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let n=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+n+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+n+";"),this.addVertexFinalCode("vUv"+n+" = uv"+n+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+"\n"}clearNodeCode(e){let t=this.nodeCode[e=e??this.shader];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,i,n="varying",r="V",o=""){let s=this.getVars(n),a=s[e];return a||(a={name:i||"node"+r+s.length+(o?"_"+o:""),type:t},s.push(a),s[e]=a),a}getTempVar(e,t,i,n){return this.getVar(e,t,i,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){t=t??"";let i="";for(let n=0,r=e.length;n<r;++n){let o=e[n],a=o.name,l=o.size,c=this.getFormatByType(o.type);if(void 0===c)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+a+`[${l}];\n`:i+=t+" "+c+" "+a+";\n"}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof To?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,n,r,o){if(t.includes("[]")){let s=this.inputs.arrayUniforms,l=new Hj({type:t,size:i.size,name:n||"nodeUA"+s.list.length+(o?"_"+o:""),node:i,needsUpdate:r});return s.list.push(l),s[e].push(l),s[e][l.name]=l,this.uniforms[l.name]=l,l}{let s=this.inputs.uniforms,l=new Hj({type:t,name:n||"nodeU"+s.list.length+(o?"_"+o:""),node:i,needsUpdate:r});return s.list.push(l),s[e].push(l),s[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,n,r){return this.createUniform("vertex",e,t,i,n,r)}createFragmentUniform(e,t,i,n,r){return this.createUniform("fragment",e,t,i,n,r)}include(e,t,i){let n;if(e="string"==typeof e?ks.get(e):e,!1===this.context.include)return e.name;e instanceof qe?n=this.includes.functions:e instanceof ln?n=this.includes.consts:e instanceof Yj&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(e){let o=r[e.name];if(o||(o=r[e.name]={node:e,deps:[]},r.push(o),o.src=e.build(this,"source")),e instanceof qe&&t&&r[t.name]&&-1===r[t.name].deps.indexOf(e)&&(r[t.name].deps.push(e),e.includes?.length)){let s=0;do{this.include(e.includes[s++],t)}while(s<e.includes.length)}return i&&(o.src=i),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return iCe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i?.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(void 0!==i){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Td:case Ed:return new $we(i);case s2:return new Xwe(new _h(i));default:return new _h(i)}else{if(i.isVector2)return new Eo(i);if(i.isVector3)return new Ea(i);if(i.isVector4)return new yh(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return nCe[e]||e}getFormatByType(e){return rCe[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return qj[e]}getIndexByElement(e){return qj.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=el,t===el&&this.context.gamma&&(t=Zt),t}},or=class extends Ns{constructor(e=0,t,i,n){super("c"),this.nodeType="Color",this.value=e instanceof Do?e:new Do(e||0,t,i,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,n,r,o){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let s=e.getNodeData(i),a=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return a?this.generateReadonly(e,t,i,n,r,o):e.isShader("vertex")?(s.vertex||(s.vertex=e.createVertexUniform(n,this,r,o,this.getLabel())),e.format(s.vertex.name,n,t)):(s.fragment||(s.fragment=e.createFragmentUniform(n,this,r,o,this.getLabel())),e.format(s.fragment.name,n,t))}generateReadonly(e,t,i,n,r,o){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},_n=class extends Ns{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,n,r,o){return e.format(this.value.toString(),n,t)}},ms=class extends Ns{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,n){return e.format(this.value?"true":"false",n,t)}},u1=class extends Ns{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},CS=class extends Ns{},oCe=class extends CS{constructor(e){super("v3"),this.image=e,this._value=new T}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},SS=class extends CS{constructor(e,t,i=1008){super("t"),this.image=e,this.wrap=t,this.minFilter=i}get value(){return this.image.getTexture(this.wrap,this.minFilter)}},$j=class extends Ns{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Vr}generateReadonly(e,t,i,n,r,o){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},ac=class extends Ns{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new De}generateReadonly(e,t,i,n,r,o){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function Qj(e,t,i,n=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply((new Vr).makeRotation(n*et.DEG2RAD))}var sCe=class extends $j{constructor(e,t,i=0){super(new Vr),this.repeat=e,this.offset=t,this.rotation=i,Qj(this.value,e,t,i)}updateMatrix(){Qj(this.value,this.repeat,this.offset,this.rotation)}},d1=class extends Ns{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Ut?new Array(e).fill(t):new Array(e).fill(new Ut(0))}},Zj=class extends an{constructor(e,t,i,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=n}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Kj=class extends an{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Kj.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},MS=Kj;MS.Nodes={customColor:new qe("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var Jj=class extends an{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Jj.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},eY=Jj;eY.Nodes={customNormal:new qe("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var g4=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=n,this.axis=r,this.side=o,this.size=s,this.blending=a,this.mat=l,this.isMask=u,this.alpha=c,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let n,i=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:n=e.include(g4.Nodes.cylindrical);break;case 2:n=e.include(g4.Nodes.spherical);break;case 1:let a=new qe(`\n\t\tvec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${["zy","xz","xy"][this.axis.value]})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value]}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);n=e.include(a);break;case 4:n=e.include(g4.Nodes.triplanar);break;default:n=e.include(g4.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),4===this.projection.value){let o=`${i}_writeUvs`,s=o+"0",a=o+"1",l=o+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(s,"vec2"),e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),r.push(s),r.push(a),r.push(l),r.push(c)}else{let o=`${i}_writeUvs`;e.addFragmentVariable(o,"vec2"),r.push(o)}return e.format(n+"("+r.join(",")+")",this.getType(e),t)}},zS=g4;zS.Nodes={cylindrical:new qe("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new qe("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new qe("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new qe("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var v4=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=o,this.origin=s,this.direction=a,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new qe(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${i}_IS_VECTOR\n                   #ifdef ${i}_LINEAR\n                       #ifdef ${i}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${i}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${i}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[v4.Nodes.vectorLinearWorldSpaceDepth,v4.Nodes.vectorLinearObjectSpaceDepth,v4.Nodes.vectorSphericalObjectSpaceDepth,v4.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),0===this.gradientType.value&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(n),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.isMask.build(e,"b")),o.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(r+"("+o.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},tY=v4;tY.Nodes={vectorLinearWorldSpaceDepth:new qe("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new qe("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new qe("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new qe("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var aCe=class extends an{constructor(e,t,i,n,r,o,s,a){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=n,this.factor=r,this.isMask=a,this.alpha=o,this.mode=s,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new qe("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=e.include(i),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},iY=class extends an{constructor(e,t,i,n,r,o,s,a,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=n,this.offset=r,this.morph=o,this.angle=s,this.isMask=l,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(iY.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},nY=iY;nY.Nodes={gradient:new qe("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var rY=class extends an{constructor(e,t,i,n,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=r}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(rY.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),n.push(this.rotation.build(e,"f")),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},oY=rY;oY.Nodes={matcap:new qe("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var TS=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(TS||{}),Fs=function(){let e=new qe("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new qe("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new ln("float F3 0.3333333"),t.keywords.G3=new ln("float G3 0.1666667");let i=new qe("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),n=new qe("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),r=new qe("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),o=new qe("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[n,r]),s=new qe("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),a=new qe("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[s]),l=new qe("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[a]),c=new qe("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[l]);c.keywords.NUM_OCTAVES=new ln("int NUM_OCTAVES 5");let h=new qe("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),u=new qe("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[n,r,h]),d=new qe("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),p=new qe("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),f=new qe("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),m=new qe("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),g=new qe("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),v=new qe("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplex:t,simplexFractal:i,simplexAshima:o,fbm:c,perlin:u,voronoi:new qe('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[d,p,f,m,g,v])}}(),sY=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h,u,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=n,this.fB=r,this.distortion=o,this.colorA=s,this.colorB=a,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,n,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=Object.values(TS)[this.noiseType.value],a=new qe(`vec3 ${o}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==o?`\n\t\tfloat v = ${o}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${o}(st),\n\t\t\t\t\t   ${o}(st + vec3(1.0)),\n\t\t\t\t\t   ${o}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${o}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${o}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${o}(st * q));\n\t\tfloat f = ${o}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[Fs.simplex,Fs.simplexFractal,Fs.simplexAshima,Fs.fbm,Fs.perlin,Fs.voronoi]),l=e.include(a),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};sY.numOctaves=5;var aY=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h,u,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=o,this.contourFrequency=s,this.outlineSmoothing=a,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let n=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),o=this.compensation.build(e,"b"),s=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(n,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(o,"uniform bool"),e.addVertexParsVariable(s,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${i}_offset = vec2(0.0);\n                if (${o}) {\n                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${r} * (${n} / 2.0) * ${i}_clipPosition.w * 2.0 * ${s};\n                    ${i}_clipPosition.xy += ${i}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${i}_clipPosition;\n                }\n            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(aY.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},lY=aY;lY.Nodes=function(){let e=new qe("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new qe("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var xh=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h,u,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=n,this.offset=r,this.colorA=o,this.colorB=s,this.frequency=a,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave"}let n=`g${this.uuid.toString().replace(/-/g,"")}`,r=new qe("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),o=new qe("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),s="";if(4===this.projection.value)s=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`;else{let h=2===this.style.value?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u="";u=0===this.axis.value?"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);";let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:d=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${u}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}s=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${d}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${h};\n\t\t\t\t`}let a=new qe(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${s}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[o,r,xh.DrawFunctions.circle,xh.DrawFunctions.ring,xh.DrawFunctions.polygon,xh.DrawFunctions.cross,xh.DrawFunctions.diamond,xh.DrawFunctions.checkerboard,xh.DrawFunctions.line,xh.DrawFunctions.wave]),l=e.include(a),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},cY=xh;cY.DrawFunctions=function(){let e=new qe("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new qe("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new qe("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new qe("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new qe("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new qe("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new qe("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new qe("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new qe("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new qe("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var hY=class extends an{constructor(e,t,i,n,r,o,s,a){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=o,this.isMask=a,this.alpha=s,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(hY.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},uY=hY;uY.Nodes=function(){let e=new qe("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[Fs.simplex]);return{rainbow:new qe("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n             }",[e])}}();var dY=class extends an{constructor(e,t,i,n,r,o,s,a,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=o,this.noiseScale=s,this.shadowColor=a,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(dY.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pY=dY;pY.Nodes=function(){let e=new qe("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new qe("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),i=new qe("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),n=new qe("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new qe('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new qe('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[Fs.simplex,e,i,r])}}();var lCe={textureBicubic:new qe("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")},fY=class extends an{constructor(e,t,i,n,r,o,s,a){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=o,this.aspectRatio=s,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Et.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(fY.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mY=fY;mY.Nodes=function(){let e=new qe("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new qe("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),i=new qe("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new qe('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[lCe.textureBicubic,i,e]),r=new qe("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,t]);return{transmission:new qe("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var ES=(e=>(e.NOISE="noise",e.MAP="map",e))(ES||{}),gY=class extends an{constructor(e,t,i,n,r,o,s,a,l,c,h){super("v3"),this.displacementTypeIndex=new _n(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(ES)[this.displacementTypeIndex.value]&&(this.mat=new $j(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=n,this.smoothness=r,this.seed=o,this.highCut=s,this.lowCut=a,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(ES)[this.displacementTypeIndex.value]){case"map":i=e.include(gY.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break;case"noise":{let r=Object.values(TS)[this.noiseFunctionIndex.value],o=new qe("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),a=new qe(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==r?`\n\t\t\t\t\tfloat v = ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[Fs.simplex,Fs.simplexFractal,Fs.simplexAshima,Fs.fbm,Fs.perlin,Fs.voronoi]),l=new qe("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[a,o]);i=e.include(l),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vY=gY;vY.Nodes=function(){let e=new qe("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new qe("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new qe("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var Et={normalRenderTarget:new _h,normalRenderTargetDepth:new _h,transmissionRenderTarget:new _h,aspectRatio:new Eo,transmissionSize:new Eo(2048,2048),transmissionRenderTargetDepth:new _h,aoRenderTarget:new _h,aoEnabled:new ms,pixelRatioNode:new it(1),resolution:new Eo,penumbraSize:new u1(5,.5),frameIndex:new _n(0),transmissionLod:new _n(2)};for(let e of Object.values(Et))e.isRenderGlobal=!0;var AS,yY={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.0.81/build/ui.wasm"},DS=class extends To{constructor(){super("basic"),this.nodeType="Basic",this.color=new or(ra),this.shadingAlpha=new it(1),this.shadingBlend=new _n(0),this.previousModelViewMatrix=new ac,this.previouseProjectionMatrix=new ac}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({resolution:Et.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rf.merge([je.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new or(ra)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==n,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let s=["#include <normal_fragment_begin>",i.code];n&&s.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),o?s.push(o.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`):s.push(`vec3 finalColor = ${i.result};`);let a="1.0";this.mask&&(this.mask.analyze(e),a=`luminance(${this.mask.flow(e,"v3").result})`),s.push(n?`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${a} );`:"gl_FragColor = vec4("+i.result+", 1.0 );"),r&&s.push(`gl_FragColor.a *= ${r.result};`),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join("\n")}return t}},hCe=class extends To{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new or(ra),this.emissive=new or(0),this.emissiveIntensity=new it(1),this.previousModelViewMatrix=new ac,this.previouseProjectionMatrix=new ac,this.shadingAlpha=new it(1),this.shadingBlend=new _n(0),this.occlusion=new ms(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({resolution:Et.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rf.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),n.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Et.penumbraSize}),e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({aoMap:Et.aoRenderTarget}),e.mergeUniform({aoEnabled:Et.aoEnabled}),void 0===this.color&&(this.color=new or(ra)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),o=this.occlusion.flow(e,"b",{slot:"occlusion"}),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];u.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&u.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),u.push("vec3 ao = aoEnabled && "+o.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${d}, ${a.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u.push(c?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},l0={dHdxy:new qe("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new qe("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},uCe=class extends To{constructor(){super("phong"),this.nodeType="Phong",this.color=new or(ra),this.specular=new or(1118481),this.shininess=new it(30),this.previousModelViewMatrix=new ac,this.previouseProjectionMatrix=new ac,this.shadingAlpha=new it(1),this.shadingBlend=new _n(0),this.occlusion=new ms(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({resolution:Et.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rf.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Et.penumbraSize}),e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({aoMap:Et.aoRenderTarget}),e.mergeUniform({aoEnabled:Et.aoEnabled}),void 0===this.color&&(this.color=new or(ra)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){e.include(l0.dHdxy),e.include(l0.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";g=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${p.result}, uv0, ${m});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${p.result}, uv1, ${m});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${p.result}, uv2, ${m});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${m});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${f.result};\n\t\t\t\t\t${g}\n\t\t\t\t\t`)}u.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${d}, ${a.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u.push(c?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},dCe=class extends To{constructor(){super("standard"),this.nodeType="Standard",this.color=new or(ra),this.roughness=new it(.3),this.metalness=new it(0),this.reflectivity=new it(.5),this.previousModelViewMatrix=new ac,this.previouseProjectionMatrix=new ac,this.shadingAlpha=new it(1),this.shadingBlend=new _n(0),this.occlusion=new ms(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({resolution:Et.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rf.merge([je.fog,je.lights])),je.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Et.penumbraSize}),e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({aoMap:Et.aoRenderTarget}),e.mergeUniform({aoEnabled:Et.aoEnabled});let i={gamma:!0};void 0===this.color&&(this.color=new or(ra)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),o=this.roughness.flow(e,"f"),s=this.metalness.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(l0.dHdxy),e.include(l0.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";y=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${m.result}, uv0, ${v});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${m.result}, uv1, ${v});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${m.result}, uv2, ${v});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${g.result};\n\t\t\t\t\t${y}\n\t\t\t\t\t`)}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"\tfloat metalnessFactor = "+s.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),v="";v=4===this.roughnessMap.projection.value?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${o.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${m.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${o.result};\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${g.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${v}\n\t\t\t\t`)}else p.push(o.code,"\tfloat roughnessFactor = "+o.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${f} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${f}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),p.push(h?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&p.push(`gl_FragColor.a *= ${u.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join("\n")}return t}},pCe=class extends To{constructor(){super("toon"),this.nodeType="Toon",this.color=new or(ra),this.specular=new or(1118481),this.shininess=new it(30),this.previousModelViewMatrix=new ac,this.previouseProjectionMatrix=new ac,this.shadingAlpha=new it(1),this.shadingBlend=new _n(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({resolution:Et.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rf.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Et.penumbraSize}),e.mergeUniform({frameIndex:Et.frameIndex}),e.mergeUniform({aoMap:Et.aoRenderTarget}),e.mergeUniform({aoEnabled:Et.aoEnabled}),void 0===this.color&&(this.color=new or(ra)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),s=this.shadingBlend.flow(e,"i"),a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){e.include(l0.dHdxy),e.include(l0.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";m=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${d.result}, uv0, ${f});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${d.result}, uv1, ${f});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${d.result}, uv2, ${f});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${p.result};\n\t\t\t\t\t${m}\n\t\t\t\t\t`)}h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${u}, ${s.result} );\n\t\t\t\t}\n\t\t\t\t`),a&&h.push(a.code,`outgoingLight = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`),h.push(l?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},fCe=class{constructor(e=1e4){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){return this.cache.get(e)?.data}load(e){let t=Date.now(),i=this.cache.get(e);return void 0===i?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},mCe=class extends fCe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},vCe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){}},yCe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},_Y=class extends vCe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isCanvas=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===e.type,this.isCanvas="CANVAS"===e.nodeName,this.updateSrc(this.isCanvas?e:e.data)}updateSrc(e){var t=this;return(0,Dn.Z)(function*(){if(typeof document>"u")return;t.disposeTextures(),t.loaded=!1;let i=()=>{t.loaded=!0;for(let r of Object.values(t._cache))for(let o of Object.values(r))o&&(o.image=t.img,o.needsUpdate=!0);t.shared.requestRender()};if(t.isCanvas)t.img=e,t.loaded=!0;else if(t.isVideo){if(t.img=document.createElement("video"),t.img.preload="auto",t.img.playsInline=!0,t.img.currentTime=.01,"string"!=typeof e){var n=new FileReader;let r;n.readAsDataURL(new Blob([e],{type:"video/mp4"})),yield new Promise(o=>{n.onloadend=s=>{r=s.target?.result,o(null)}}),t.img.src=r}else t.img.src=e;t.img.onloadeddata=()=>{i()}}else t.img=new Image,t.img.src=function gCe(e){return"string"==typeof e?e:(AS||(AS=new mCe),AS.load(e))}(e),t.img.onload=i})()}getTexture(e,t=1008){let i=this._cache[e]?.[t];if(i)return i;{let n;return this.isCanvas&&(n=new l4e(this.img,void 0,e,e,void 0,t)),n=this.isVideo?new a4e(this.img,void 0,e,e):new Zn(this.img,void 0,e,e,void 0,t),this.loaded&&(n.needsUpdate=!0),void 0===this._cache[e]&&(this._cache[e]={}),this._cache[e][t]=n,n}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))i&&(i.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,n]of Object.entries(t))n?.dispose(),this._cache[e][i]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Du=class extends _Y{};var bCe={year:0,month:1,day:2,hour:3,minute:4,second:5},PS={};function bY(e,t,i,n,r,o,s){var a=new Date(0);return a.setUTCFullYear(e,t,i),a.setUTCHours(n,r,o,s),a}var xY=36e5,SCe=6e4,IS={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function wY(e,t,i){var n,r,o;if(!e||(n=IS.timezoneZ.exec(e)))return 0;if(n=IS.timezoneHH.exec(e))return CY(o=parseInt(n[1],10))?-o*xY:NaN;if(n=IS.timezoneHHMM.exec(e)){o=parseInt(n[1],10);var s=parseInt(n[2],10);return CY(o,s)?(r=Math.abs(o)*xY+s*SCe,o>0?-r:r):NaN}if(function TCe(e){if(SY[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),SY[e]=!0,!0}catch{return!1}}(e)){t=new Date(t||Date.now());var a=i?t:function MCe(e){return bY(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),l=OS(a,e),c=i?l:function zCe(e,t,i){var r=e.getTime()-t,o=OS(new Date(r),i);if(t===o)return t;r-=o-t;var s=OS(new Date(r),i);return o===s?o:Math.max(o,s)}(t,l,e);return-c}return NaN}function OS(e,t){var i=function _Ce(e,t){var i=function CCe(e){if(!PS[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z"));PS[e]="06/25/2014, 00:00:00"===t||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===t?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return PS[e]}(t);return i.formatToParts?function xCe(e,t){try{for(var i=e.formatToParts(t),n=[],r=0;r<i.length;r++){var o=bCe[i[r].type];o>=0&&(n[o]=parseInt(i[r].value,10))}return n}catch(s){if(s instanceof RangeError)return[NaN];throw s}}(i,e):function wCe(e,t){var i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}(i,e)}(e,t),n=bY(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=e.getTime(),o=r%1e3;return n-(r-(o>=0?o:1e3+o))}function CY(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}var SY={},ECe=Qc(Xde(),1),MY=Qc($de(),1),kS=36e5,zY=6e4,PCe=2,gs={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function TY(e,t,i){t=t||0,i=i||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var o=7*t+i+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+o),n}var RCe=[31,28,31,30,31,30,31,31,30,31,30,31],FCe=[31,29,31,30,31,30,31,31,30,31,30,31];function EY(e){return e%400==0||e%4==0&&e%100!=0}function DY(e,t,i){if(t<0||t>11)return!1;if(null!=i){if(i<1)return!1;var n=EY(e);if(n&&i>FCe[t]||!n&&i>RCe[t])return!1}return!0}function AY(e,t,i){return!(t<0||t>52||null!=i&&(i<0||i>6))}function NS(e,t,i){return!(null!=e&&(e<0||e>=25)||null!=t&&(t<0||t>=60)||null!=i&&(i<0||i>=60))}function vs(e,t){return t.color(e)}function PY(e=new Date,t){let i=t.format,n=e.getSeconds(),r=e;t&&null!==t.timeZone&&(r=function VCe(e,t,i){var n=function ICe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);var i=t||{},n=null==i.additionalDigits?PCe:(0,ECe.default)(i.additionalDigits);if(2!==n&&1!==n&&0!==n)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r=function OCe(e){var n,t={},i=gs.dateTimePattern.exec(e);if(i?(t.date=i[1],n=i[3]):(i=gs.datePattern.exec(e))?(t.date=i[1],n=i[2]):(t.date=null,n=e),n){var r=gs.timeZone.exec(n);r?(t.time=n.replace(r[1],""),t.timeZone=r[1].trim()):t.time=n}return t}(e),o=function kCe(e,t){var r,i=gs.YYY[t],n=gs.YYYYY[t];if(r=gs.YYYY.exec(e)||n.exec(e)){var o=r[1];return{year:parseInt(o,10),restDateString:e.slice(o.length)}}if(r=gs.YY.exec(e)||i.exec(e)){var s=r[1];return{year:100*parseInt(s,10),restDateString:e.slice(s.length)}}return{year:null}}(r.date,n),l=function NCe(e,t){if(null===t)return null;var i,n,r,o;if(0===e.length)return(n=new Date(0)).setUTCFullYear(t),n;if(i=gs.MM.exec(e))return n=new Date(0),DY(t,r=parseInt(i[1],10)-1)?(n.setUTCFullYear(t,r),n):new Date(NaN);if(i=gs.DDD.exec(e)){n=new Date(0);var s=parseInt(i[1],10);return function BCe(e,t){if(t<1)return!1;var i=EY(e);return!(i&&t>366||!i&&t>365)}(t,s)?(n.setUTCFullYear(t,0,s),n):new Date(NaN)}if(i=gs.MMDD.exec(e)){n=new Date(0),r=parseInt(i[1],10)-1;var a=parseInt(i[2],10);return DY(t,r,a)?(n.setUTCFullYear(t,r,a),n):new Date(NaN)}if(i=gs.Www.exec(e))return AY(0,o=parseInt(i[1],10)-1)?TY(t,o):new Date(NaN);if(i=gs.WwwD.exec(e)){o=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return AY(0,o,l)?TY(t,o,l):new Date(NaN)}return null}(o.restDateString,o.year);if(isNaN(l))return new Date(NaN);if(l){var u,c=l.getTime(),h=0;if(r.time&&(h=function LCe(e){var t,i,n;if(t=gs.HH.exec(e))return NS(i=parseFloat(t[1].replace(",",".")))?i%24*kS:NaN;if(t=gs.HHMM.exec(e))return NS(i=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")))?i%24*kS+n*zY:NaN;if(t=gs.HHMMSS.exec(e)){i=parseInt(t[1],10),n=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return NS(i,n,r)?i%24*kS+n*zY+1e3*r:NaN}return null}(r.time),isNaN(h)))return new Date(NaN);if(r.timeZone||i.timeZone){if(u=wY(r.timeZone||i.timeZone,new Date(c+h)),isNaN(u))return new Date(NaN)}else u=(0,MY.default)(new Date(c+h)),u=(0,MY.default)(new Date(c+h+u));return new Date(c+h+u)}return new Date(NaN)}(e,i),r=wY(t,n,!0),o=new Date(n.getTime()-r),s=new Date(0);return s.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),s.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),s}(new Date,t.timeZone));let a,o=r.getHours(),s=r.getMinutes();"12ampm"===t.format12h24h&&(a=o>=12?"PM":"AM");let c,h,l=o;switch("24"!==t.format12h24h&&(l=o%12,0===l&&(l=12)),i){case"HH:mm:ss":c=[l,s,n];break;case"HH:mm":c=[l,s];break;case"HH":c=[l],a=void 0;break;case"mm":c=[s],a=void 0;break;case"ss":c=[n],a=void 0;break;case"year":h=r.getFullYear();break;case"month":h=r.getMonth()+1;break;case"dayOfYear":h=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":h=r.getDate();break;case"secondOfDay":h=60*o*60+60*s+n;break;default:console.error("Unknown time format",i),h=0}return void 0!==c?{textValue:c,suffix:a}:h}function UCe(e){return{type:e.type}}function ul(e,t){let{alpha:i,mode:n,isMask:r}=e,o="string"==typeof i?(Number(t.getVariable(i))??100)/100:i;return{...UCe(e),alpha:o,mode:n,isMask:r}}var Y6=class extends Do{},eSe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},tSe={depth:["colors"]};function iSe(e,t,i){if("isMask"===t)return!0;let n=eSe[e.type],r=tSe[e.type];if(void 0!==r){let o=e.color;if(r.includes(t)){let s=o[t]?.value?.length;if(void 0!==s&&s!==i.length)return!0}}return void 0!==n&&n.includes(t)}function IY(e,t,i){let n=i.uniforms[`f${i.id}_texture`];if(!n)return!1;let o=e;if("image"in o){let a=t.image(o.image),l=n;l.image instanceof Du||l.image.deref(),l.image=a}if("video"in o){let a=t.video(o.video),l=n;l.image instanceof Du||l.image.deref(),l.image=a}if("wrapping"in o&&(n.wrap=o.wrapping),"minFilter"in o&&(n.minFilter=o.minFilter),"rotation"in o&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(o.rotation??0)*et.DEG2RAD,!1;if("repeat"in o||"offset"in o||"rotation"in o){let a=i.uniforms[`f${i.id}_mat`];"repeat"in o&&(a.repeat=o.repeat),"offset"in o&&(a.offset=o.offset),"rotation"in o&&(a.rotation=o.rotation??0),a.updateMatrix()}return!1}var p1=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable("number"==typeof e?100*e:e,i)??100)/100))??1,y4=class{constructor(e,t,i,n,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let o in n)this.uniforms[`f${this.id}_${o}`]=n[o];for(let o in i)kY(o,this,i,r)}get type(){return this.data.type}static create(e,t,i,n){if("light"===i.type)return lc.createLigherLayer(e,t,i,n);if("texture"===i.type||"video"===i.type){let r="texture"===i.type?n.canvas(i.texture.image)??n.image(i.texture.image):n.video(i.texture.video),o=new SS(r,i.texture.wrapping,i.texture.minFilter??1008),s=new oCe(r),a=new sCe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new it(i.crop?1:0),c=new _n(i.projection??0),h=new _n(["x","y","z"].indexOf(i.axis)??0),u=new _n(i.side??0),d=new Eo(i.size?new $(i.size[0],i.size[1]):new $(100,100)),p=new it(i.blending??0),f=new it(p1(i.alpha,n)),m=new _n(i.mode??0),g=new ms(i.isMask??!1),v=new zS(o,s,l,c,h,u,d,p,a,f,m,g),y=new Pn(v.calpha,"f");return new sr(e,t,i,{texture:o,textureSize:s,crop:l,projection:c,axis:h,side:u,size:d,blending:p,mat:a,alpha:f,mode:m,isMask:g},v,m,y,g,n)}if("matcap"===i.type){let r=n.image(i.texture.image),o=new SS(r,i.texture.wrapping,i.texture.minFilter??1008),s=new it(p1(i.alpha,n)),a=new _n(i.mode??0),l=new ms(i.isMask??!1),c=new it(i.texture.rotation??0),h=new oY(o,s,a,l,c),u=new Pn(h.calpha,"f");return new sr(e,t,i,{texture:o,alpha:s,mode:a,isMask:l,rotation:c},h,a,u,l,n)}if("displace"===i.type){if("noise"===i.displacementType){let r=new Ea(new T(...i.offset)),o=new it(i.scale??10),s=new it(i.intensity??8),a=new it(i.movement??1),l=new _n(i.noiseType??0),c=new _n(i.voronoiStyle??0),h=new it(i.smoothness??.5),u=new it(i.seed??0),d=new it(i.highCut??1),p=new it(i.lowCut??0),f=new _n(i.quality??1),m=new vY(s,a,r,c,h,u,d,p,f,o,l);return new OY(e,t,i,{offset:r,scale:o,intensity:s,movement:a,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:p,quality:f},m,n)}throw new Error}return function sSe(e,t,i,n){let r=function HCe(e,t){switch(e.type){case"fresnel":return function YCe(e,t){let{bias:i,scale:n,intensity:r,factor:o,color:s}=e;return{...ul(e,t),color:vs(s,t),bias:i,scale:n,intensity:r,factor:o}}(e,t);case"gradient":return function GCe(e,t){let{gradientType:i,smooth:n,colors:r,steps:o,angle:s,offset:a,morph:l}=e;return{...ul(e,t),gradientType:i,smooth:n,colors:r.map(c=>new Ut(c[0],c[1],c[2],c[3])),num:r.length,steps:o,offset:new $(...a),morph:new $(...l),angle:s}}(e,t);case"depth":return function WCe(e,t){let{gradientType:i,near:n,far:r,isVector:o,isWorldSpace:s,origin:a,direction:l,colors:c,steps:h,smooth:u}=e;return{...ul(e,t),gradientType:i,near:n,far:r,isVector:o,isWorldSpace:s,origin:new T(...a),direction:l?new T(...l):new T(1,0,0),colors:c.map(d=>void 0!==d?new Ut(d[0],d[1],d[2],d[3]):new Ut(0,0,0,0)),steps:h.slice(0,c.length),smooth:u}}(e,t);case"normal":return function qCe(e,t){let{cnormal:i}=e;return{...ul(e,t),cnormal:new T(i[0],i[1],i[2])}}(e,t);case"noise":return function XCe(e,t){return{...ul(e,t),scale:e.scale,move:e.move,fA:new $(...e.fA),fB:new $(...e.fB),size:new T(...e.size),distortion:new $(...e.distortion),colorA:vs(e.colorA,t),colorB:vs(e.colorB,t),colorC:vs(e.colorC,t),colorD:vs(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}(e,t);case"rainbow":return function $Ce(e,t){return{...ul(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new T(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new T(...e.offset)}}(e,t);case"toon":return function QCe(e,t){return{...ul(e,t),positioning:e.positioning,colors:e.colors.map(i=>new Ut(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new T(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:vs(e.shadowColor,t),offset:new T(...e.offset)}}(e,t);case"outline":return function ZCe(e,t){return{...ul(e,t),outlineColor:vs(e.outlineColor,t),contourColor:vs(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new T(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}(e,t);case"transmission":return function KCe(e,t){return{...ul(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}(e,t);case"color":return function jCe(e,t){return{...ul(e,t),color:vs(e.color,t)}}(e,t);case"pattern":return function JCe(e,t){return{...ul(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new $(...e.offset),colorA:vs(e.colorA,t),colorB:vs(e.colorB,t),frequency:new $(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new $(...e.vertical),horizontal:new $(...e.horizontal),sides:e.sides}}(e,t)}}(i,n);return function oSe(e,t,i,n,r){switch(e.type){case"color":{let o=new or(n.color??ra),s=Da(n),a=new MS(o,s.alpha),l=new Pn(a.calpha,"f");return new sr(t,i,e,{color:o,...s},a,s.mode,l,s.isMask,r)}case"fresnel":{let o=new or(n.color??16777215),s=new it(n.bias??.1),a=new it(n.scale??1),l=new it(n.intensity??2),c=new it(n.factor??1),h=Da(n),u=new aCe(o,s,a,l,c,h.alpha,h.mode,h.isMask),d=new Pn(u.calpha,"f");return new sr(t,i,e,{color:o,bias:s,scale:a,intensity:l,factor:c,...h},u,h.mode,d,h.isMask,r)}case"rainbow":{let o=new it(n.filmThickness??30),s=new it(n.movement??0),a=new Ea(n.wavelengths??new T(0,0,0)),l=new it(n.noiseStrength??0),c=new it(n.noiseScale??1),h=new Ea(n.offset??new T(0,0,0)),u=Da(n),d=new uY(o,s,a,l,c,h,u.alpha,u.isMask),p=new Pn(d.calpha,"f");return new sr(t,i,e,{filmThickness:o,movement:s,wavelengths:a,noiseStrength:l,noiseScale:c,offset:h,...u},d,u.mode,p,u.isMask,r)}case"transmission":{let o=new it(n.thickness??10),s=new it(n.ior??1.5),a=new it(n.roughness??.5),l=Et.transmissionSize,c=Et.transmissionRenderTarget,h=Et.transmissionRenderTargetDepth,u=window.innerWidth,d=window.innerHeight,p=u>=d?new Eo(d/u,1):new Eo(1,u/d),f=Da(n),m=new mY(o,s,a,l,c,h,p,f.alpha),g=new Pn(m.calpha,"f");return new sr(t,i,e,{thickness:o,ior:s,roughness:a,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{let s,a,o=new _n(n.positioning??0);n.colors?s=new d1(n.colors.length,n.colors):(s=new d1(10,new Ut(0,0,0,1)),s.value[1]=new Ut(1,1,1,1)),n.steps?a=new u1(n.steps.length,n.steps):(a=new u1(10,1),a.value[0]=0);let l=new Ea(n.source??new T(0,0,0)),c=new ms(n.isWorldSpace??!0),h=new it(n.noiseStrength??0),u=new it(n.noiseScale??1),d=new yh(n.shadowColor),p=new Ea(n.offset??new T(0,0,0)),f=Da(n),m=new pY(o,s,a,l,c,h,u,d,p,f.alpha),g=new Pn(m.calpha,"f");return new sr(t,i,e,{positioning:o,colors:s,steps:a,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:u,shadowColor:d,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{let o=new or(n.outlineColor??16777215),s=new or(n.contourColor??16777215),a=new it(n.outlineWidth??.1),l=new it(n.contourWidth??.1),c=new it(n.outlineThreshold??.1),h=new it(n.contourThreshold??.1),u=new it(n.outlineSmoothing??.1),d=new it(n.contourFrequency??.1),p=new Ea(n.contourDirection??new T(0,1,0)),f=new ms(n.positionalLines??!1),m=new ms(n.compensation??!0),g=Et.normalRenderTarget,v=Et.normalRenderTargetDepth,y=Et.pixelRatioNode,_=Et.resolution,b=Da(n),x=new lY(o,s,a,l,c,h,u,d,p,f,m,_,g,v,y,b.alpha),w=new Pn(x.calpha,"f");return new sr(t,i,e,{outlineColor:o,contourColor:s,outlineWidth:a,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:u,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...b},x,b.mode,w,b.isMask,r)}case"depth":{let p,f,o=new _n(n.gradientType??0),s=new ms(n.smooth??!1),a=new it(n.near??50),l=new it(n.far??200),c=new it(n.isVector??1),h=new it(n.isWorldSpace??0),u=new Ea(n.origin??new T),d=new Ea(n.direction??new T);n.colors?p=new d1(n.colors.length,n.colors):(p=new d1(2,new Ut(0,0,0,1)),p.value[1]=new Ut(1,1,1,1)),n.steps?f=new u1(n.steps.length,n.steps):(f=new u1(2,1),f.value[0]=0);let m=Da(n),g=new tY(o,s,a,l,c,h,u,d,p,f,m.alpha,m.isMask),v=new Pn(g.calpha,"f");return new sr(t,i,e,{gradientType:o,smooth:s,near:a,far:l,isVector:c,isWorldSpace:h,origin:u,direction:d,colors:p,steps:f,...m},g,m.mode,v,m.isMask,r)}case"noise":{let o=new it(n.scale??1),s=new Ea(n.size??new T(100,100,100)),a=new it(n.move??1),l=new Eo(n.fA??new $(1.7,9.2)),c=new Eo(n.fB??new $(8.3,2.8)),h=new Eo(n.distortion??new $(1,1)),u=new yh(n.colorA),d=new yh(n.colorB),p=new yh(n.colorC),f=new yh(n.colorD),m=new _n(n.noiseType??0),g=new _n(n.voronoiStyle??0),v=new it(n.highCut??1),y=new it(n.lowCut??0),_=new it(n.smoothness??.5),b=new it(n.seed??.5),x=new _n(n.quality??1),w=Da(n),S=new sY(o,s,a,l,c,h,u,d,p,f,w.alpha,m,w.isMask,g,v,y,_,b,x),C=new Pn(S.calpha,"f");return new sr(t,i,e,{scale:o,size:s,move:a,fA:l,fB:c,distortion:h,colorA:u,colorB:d,colorC:p,colorD:f,noiseType:m,...w,voronoiStyle:g,highCut:v,lowCut:y,smoothness:_,seed:b,quality:x},S,w.mode,C,w.isMask,r)}case"normal":{let o=new Ea(n.cnormal??new T(1,1,1)),s=Da(n),a=new eY(o,s.alpha),l=new Pn(a.calpha,"f");return new sr(t,i,e,{cnormal:o,...s},a,s.mode,l,s.isMask,r)}case"gradient":{let a,l,o=new _n(n.gradientType??0),s=new ms(n.smooth??!1);n.colors?a=new d1(n.colors.length,n.colors):(a=new d1(10,new Ut(0,0,0,1)),a.value[1]=new Ut(1,1,1,1)),n.steps?l=new u1(n.steps.length,n.steps):(l=new u1(10,1),l.value[0]=0);let c=new Eo(n.offset??new $(0,0)),h=new Eo(n.morph??new $(0,0)),u=new it(n.angle??0),d=Da(n),p=new nY(o,s,a,l,c,h,u,d.alpha,d.isMask),f=new Pn(p.calpha,"f");return new sr(t,i,e,{gradientType:o,smooth:s,colors:a,steps:l,offset:c,morph:h,angle:u,...d},p,d.mode,f,d.isMask,r)}case"pattern":{let o=new _n(n.style??0),s=new _n(n.projection??0),a=new _n(["x","y","z"].indexOf(n.axis)??0),l=new it(n.blending??0),c=new Eo(n.offset??new $(0,0)),h=new yh(n.colorA),u=new yh(n.colorB),d=new Eo(n.frequency??new $(10,10)),p=new it(n.size??.5),f=new it(n.variation??0),m=new it(n.smoothness??.5),g=new it(n.zigzag??0),v=new it(n.rotation??0),y=new Eo(n.vertical??new $(0,1)),_=new Eo(n.horizontal??new $(0,1)),b=new _n(n.sides??6),x=Da(n),w=new cY(o,s,a,l,c,h,u,d,p,f,m,g,v,y,_,b,x.alpha,x.isMask),S=new Pn(w.calpha,"f");return new sr(t,i,e,{style:o,projection:s,axis:a,blending:l,offset:c,colorA:h,colorB:u,frequency:d,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:_,sides:b,...x},w,x.mode,S,x.isMask,r)}default:{let o=new or(1,0,0,1),s=Da(n),a=new MS(o,s.alpha),l=new Pn(a.calpha,"f");return new sr(t,i,e,{color:o,...s},a,s.mode,l,s.isMask,r)}}}(i,e,t,r,n)}(e,t,i,n)}updateByOp(e,t,i){let n=e;if(void 0===n.path[0]){if(0===n.type)return"type"in n.props||"category"in n.props||"visible"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):function nSe(e,t,i,n){let r=!1;for(let[o,s]of Object.entries(e)){if("bumpMap"===o||"roughnessMap"===o){r=!0;continue}if(!o||void 0===s)continue;if(kY(o,i,n,t)){"visible"===o&&"light"===i.type&&(r=!0);continue}i.visible=n.visible;let a=i.uniforms[`f${i.id}_${o}`];if(a&&!(a instanceof CS))switch(r=r||iSe(i,o,s),a.constructor){case or:if("string"==typeof s){let l=t.getColor(s);l&&(a.value=l);break}{let l=s;a.value instanceof Y6?a.value=new Do(l.r,l.g,l.b,l.a):a.setRGBA(l);break}case yh:if("string"==typeof s){let l=t.getColor(s);l&&(a.value=l);break}{let l=s;a.value instanceof Y6?a.value=new Do(l.r,l.g,l.b,l.a):a.value.setRGBA(l.r,l.g,l.b,l.a);break}case Eo:{let l=s;a.value.setX(l[0]),a.value.setY(l[1]);break}case Ea:{let l=s;a.value.setX(l[0]),a.value.setY(l[1]),a.value.setZ(l[2]);break}case _h:IY(s,t,i);break;case d1:a.value=s.map(l=>new Ut(...l));break;default:a.value=s}}return r}(n.props,i.shared,this,t)}else if("texture"===n.path[0])return!("texture"in t)&&!("video"in t)||IY(n.props,i.shared,this);return!1}dispose(){if(function rSe(e){let t=e instanceof y4?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;e.image instanceof Du||e.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&void 0!==t&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},sr=class extends y4{constructor(e,t,i,n,r,o,s,a,l){super(e,t,i,n,l),this.params=n,this.color=r,this.mode=o,this.alpha=s,this.isMask=a}},OY=class extends y4{constructor(e,t,i,n,r,o){super(e,t,i,n,o),this.position=r}},lc=class extends y4{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.node=n}static createLigherLayer(e,t,i,n){let r,c,o=new it(p1(i.alpha,n)),s=new _n(i.mode),a=new it(i.bumpMapIntensity),l=new it(p1(i.alphaOverride,n));if(i.visible)if("lambert"===i.category){r=new hCe;let h=new or(n.color(i.emissive)??0),u=new ms(i.occlusion??!0);c={emissive:h,occlusion:u},r.emissive=h,r.occlusion=u}else if("toon"===i.category){r=new pCe;let h=new it(i.shininess??30),u=new or(n.color(i.specular)??1118481);c={shininess:h,specular:u},r.shininess=h,r.specular=u}else if("physical"===i.category){r=new dCe;let h=new it(i.roughness??.3),u=new it(i.metalness??0),d=new it(i.reflectivity??.5),p=new ms(i.occlusion??!0);c={roughness:h,metalness:u,reflectivity:d,occlusion:p},r.roughness=h,r.metalness=u,r.reflectivity=d,r.occlusion=p}else{r=new uCe;let h=new it(i.shininess??30),u=new or(void 0!==i.specular?n.color(i.specular)??1118481:1118481),d=new ms(i.occlusion??!0);c={shininess:h,specular:u,occlusion:d},r.shininess=h,r.specular=u,r.occlusion=d}else r=new DS,c={};return r.alpha=new it(1),r.shadingAlpha=o,r.shadingBlend=s,r.bumpMapIntensity=a,r.alphaOverride=l,c.alpha=r.shadingAlpha,c.mode=r.shadingBlend,c.bumpMapIntensity=r.bumpMapIntensity,c.alphaOverride=r.alphaOverride,new lc(e,t,i,r,c,n)}get category(){return this.node.category}};function Da(e){return{alpha:new it(e.alpha??1),mode:new _n(e.mode??0),isMask:new ms(e.isMask??!1)}}function kY(e,t,i,n){if("displace"===i.type&&("intensity"===e||"visible"===e)){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if("displace"!==i.type&&("alpha"===e||"visible"===e)){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=p1(i.alpha,n)*(i.visible?1:0),"outline"===i.type&&"visible"===e){let o=t.uniforms[`f${t.id}_compensation`];o&&(o.value=i.compensation&&i.visible)}return r}}function c0(e,t){let i=0,n=e.layers.find(r=>"light"===r.data.type);if(n){let r=n.data,o=Number(t.getVariable(r.alphaOverride));if(("string"==typeof r.alphaOverride?o/100:r.alphaOverride)<1)return!0}for(let r of e.layers){if("displace"!==r.data.type&&r.data.isMask)return!0;if("displace"!==r.data.type&&"alpha"in r.data&&"light"!==r.data.type&&"fresnel"!==r.data.type&&"texture"!==r.data.type&&"matcap"!==r.data.type&&"rainbow"!==r.data.type&&"outline"!==r.data.type&&"pattern"!==r.data.type){let o=r.data.visible?r.data.alpha:0;if("string"==typeof o&&(o=Math.max(0,Math.min(1,Number(t.getVariable(o)??100)/100))),1===o&&"depth"===r.data.type||"gradient"===r.data.type){for(let s of r.data.colors)if(s[3]<1){o=s[3];break}}else if(1===o&&"noise"===r.data.type){let s=t.color(r.data.colorA).a,a=t.color(r.data.colorB).a,l=t.color(r.data.colorC).a,c=t.color(r.data.colorD).a,h=Math.min(s,Math.min(a,Math.min(l,c)));h<1&&(o=h)}i+=(1-i)*o}}return i<1}var Au=class extends qi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},aSe=class extends Au{constructor(e,t,i,n){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},LS=class extends Au{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],To.startContext(this),this.reset0(e,t),To.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i){let n=i?6:(e?3:0)+t;if(0===n)return this;void 0===this.flavors&&(this.flavors=[]),n-=1;let r=this.flavors[n];return void 0===r&&(r=new aSe(e,t,i,this),this.flavors[n]=r,r.flatShading=e,r.side=t,r.updateAfterBuild()),r}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t,i=!1){(this.data!==e||i)&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??Wo.defaultTwoLayerData("phong").layers;try{this.layers=i.map(n=>y4.create(this.layerIdGen++,n.id,n.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=c0(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if("alphaOverride"===e[0])this.transparent=c0(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if("layer"===e[0]){let n=e[1],r=e[2];if(n&&r){let o=this.layers.find(s=>s.uuid===n);o?.hasValue(r)&&("alpha"===r?(this.transparent=c0(this.data,i.shared),o.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):o.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>"light"===i.data.type);t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&"string"==typeof i.data.alpha&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof lc),void 0===this.lightLayer&&(this.lightLayer=new lc(0,"",{...ao.defaultData("light","phong"),visible:!1},new DS,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(r=>r instanceof lc);if(!e)return;let t=e.data,i=t.bumpMap,n=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let o=this.layers[r];o instanceof sr&&o.color instanceof zS&&(o.uuid===i&&(e.node.bumpMap=o.color),o.uuid===n&&(e.node.roughnessMap=o.color))}}updateByOp(e,t,i){if(To.startContext(this),void 0!==t?this.data=t:t=this.data,this.transparent=c0(t,i.shared),"layers"===e.path[0]){let n=i.shared,r=e.path[1];if(void 0===r)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{0===e.type&&void 0!==e.props.occlusion&&i.scene.markNeedsUpdateRendererDirty();let o=this.layers.find(s=>s.uuid===r);if(o){let a,s=t.layers.data(r);0===e.type&&("alpha"in e.props||"alphaOverride"in e.props)&&(a="alpha"in e.props?{...e.props,alpha:p1(e.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:{...e.props,alphaOverride:p1(e.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),o.updateByOp({...e,...a?{props:a}:{},path:e.path.slice(2)},s,i)&&this.reset0(t,i)}}}else this.reset0(t,i);To.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof sr?t.color.mask=void 0:t instanceof lc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof sr&&t.isMask.value&&t.data.visible&&e>0){let n=this.layers[e-1];n instanceof lc?n.node.mask=new Ls(t.color,t.alpha,Ls.MUL):n instanceof sr&&(n.isMask.value||(n.color.mask=new Ls(t.color,t.alpha,Ls.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof sr),t=this.layers.findIndex(i=>i instanceof lc);if(-1!==e&&e<t){let i=this.layers[e].color;for(let n=e+1;n<t;++n){let r=this.layers[n];if(r instanceof sr){if(r.isMask.value)continue;i=new Zj(i,r.color,r.alpha,r.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Pn("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof lc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let n=this.layers[i];if(n instanceof sr){if(n.isMask.value)continue;e=new Zj(e,n.color,n.alpha,n.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof OY);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ls(t,e[i].position,Ls.ADD),t=new Ls(t,new it(.5).setReadonly(!0),Ls.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let i=(n,r,o)=>Math.min(Math.max(n,r),o);for(let n of this.layers)if("displace"===n.type){let r=i(n.uniforms[`f${n.id}_intensity`].value,e,t);n.uniforms[`f${n.id}_intensity`].value=r}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Xj;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof sr){let t=e.params.texture;if(t instanceof SS&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Au.prototype,{properties:{get:function(){return this.fragment.properties}}});var RS=class extends LS{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},NY=new Map;function lSe(e){if("string"==typeof e)return e;let t=NY.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},NY.set(e,t)),t.url}var LY,G6,FY,cSe=new Promise(e=>{LY=e}),RY=!1;function hSe(){if(!RY)return G6||(G6=function e(){return t.apply(this,arguments)}(),G6);function t(){return(t=(0,Dn.Z)(function*(){yield mn.e(725).then(mn.bind(mn,725)),LY(void 0!==window?window:global),RY=!0})).apply(this,arguments)}}function uSe(e){let t=!1;return e.scene.objects.traverse((i,n)=>{if(!1===n.visible||void 0===n.events||!1===Array.isArray(n.events))return!0;let r=[];n.events.forEach(o=>{"dragDropActions"in o.data?(r.push(...o.data.dragDropActions.drag),r.push(...o.data.dragDropActions.drop)):"inActions"in o.data?(r.push(...o.data.inActions),r.push(...o.data.outActions)):"gameActions"in o.data?(r.push(...o.data.gameActions.idle),r.push(...o.data.gameActions.move),r.push(...o.data.gameActions.jump),r.push(...o.data.gameActions.run)):"breakpoints"in o.data?o.data.breakpoints.forEach(s=>{r.push(...s.data.actions)}):"actions"in o.data&&r.push(...o.data.actions),t=t||r.some(s=>"Audio"===s.data.type)})}),t}cSe.then(e=>FY=e);var VY,W6,_4=class{constructor({src:e,volume:t,delay:i,loop:n}){let r;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},r="string"==typeof e?{src:e}:{src:lSe(e),format:"wav"},this.sound=new FY.Howl(r),this.sound.on("end",this.onEnd),this.src=e,void 0!==t&&(this.volume=t),void 0!==i&&(this.delay=i),void 0!==n&&(this.loop=n)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},BY=!1,HY=new Promise(e=>{VY=e}),UY=!1;function pSe(){if(BY=!0,!UY)return W6||(W6=function e(){return t.apply(this,arguments)}(),W6);function t(){return(t=(0,Dn.Z)(function*(){let i=yield mn.e(990).then(mn.bind(mn,990));VY(i),UY=!0})).apply(this,arguments)}}function FS(){return FS=(0,Dn.Z)(function*(e){return yield(yield fetch(e)).arrayBuffer()}),FS.apply(this,arguments)}var gSe=new class{load(e,t,i=(()=>{})){return(0,Dn.Z)(function*(){let{load:n}=yield HY;n(e,(r,o)=>{r||!o?i(r??"Something went wrong"):t(o)})})()}parse(e){return(0,Dn.Z)(function*(){let{parse:t,Bidi:i}=yield HY;try{let n=t(e),r=new i;return r.registerModifier("glyphIndex",null,s=>n.charToGlyphIndex(s.char)),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(n){console.error(n)}})()}};function jY(e){return BS.apply(this,arguments)}function BS(){return BS=(0,Dn.Z)(function*(e){let t,i,n=!1;if(e.url?(t=yield function mSe(e){return FS.apply(this,arguments)}(e.url),i=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t){if(!BY)return{font:void 0,url:i,intercepted:n,arr:t,bidi:null};{let r=yield gSe.parse(t);if(r)return{font:r.font,url:i,intercepted:n,arr:t,bidi:r.bidi}}}}),BS.apply(this,arguments)}function vSe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var bSe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let n=this.objects.get(e);return void 0===n?(n=this.createObject(e,t,i),this.objects.set(e,n)):n.isShared=!0,n}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&!0!==i.isShared)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},YY=class extends bSe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let n=f4(e,t,this.flatShading,i);return n.computeBoundingSphere(),n}},xSe={markNeedsUpdateRendererDirty:()=>{}},wSe=class extends yCe{constructor(e){super(),this.shared=e}create(e){return new _Y(e,this.shared)}},VS=class{constructor(e,t={}){if(this.data=e,this.geometryCache=new YY(!0),this.geometryCache2=new YY(!1),this.imageHolderCache=new wSe(this),this.thisContext={scene:xSe,shared:this},this.deletedMaterial=new RS(Wo.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Du(MC.emptyImage,this),this.deletedVideo=new Du(r6.defaultVideo,this),this.materials={},this.images={},this.canvases={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,n]of Object.entries(t.images))this.addImage(i,n);if(t.videos)for(let[i,n]of Object.entries(t.videos))this.addVideo(i,n);if(t.audios)for(let[i,n]of Object.entries(t.audios))this.addAudio(i,n);if(t.particles)for(let[i,n]of Object.entries(t.particles))this.addParticle(i,n);this.reset(e)}setRequestRender(e){this._requestRender=e}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.resetLib(e.lib);for(let{id:i,data:n}of e.variables)this.addVariableHolder(i,n),t&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(e.images))this.addImage(i,n);for(let[i,n]of Object.entries(e.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(e.colors))this.addColor(i,n);for(let[i,n]of Object.entries(e.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(e.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(e.particles))this.addParticle(i,n);for(let[i,n]of Object.entries(e.fonts))this.addFont(i,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new RS(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):null==e?(console.error("material is undefined or null"),this.deletedMaterial):new LS(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Du(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addCanvas(e,t){return this.canvases[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.canvases[e].updateSrc(t),!0):(this.canvases[e]=new Du(t,this),!1)}canvas(e){return this.canvases[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Du(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.colors[e].setRGBA(t.r,t.g,t.b,"a"in t?t.a:1),!0):(this.colors[e]=new Y6(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if("string"!=typeof e)return new Do(e.r,e.g,e.b,"a"in e?e.a:1);{let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Do(0,0,0,0))}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof _4)return t;{let i=new _4({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof _4&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=jY(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=jY(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let r=n.tokenizer.tokens,o=[],s=0,a=i.length===r.length;for(let l=0;l<i.length;l++){let c=i[l].index,h=String.fromCharCode(i[l].unicode),u=r[s];if(vSe(c,u)||a)o.push({char:h,index:c,replacements:[u.state.glyphIndex],replacementChars:[u.char]}),s++;else{let d=u.char,p="",f=[u.state.glyphIndex],m=[],g=!1;for(;!g;)s++,p=t.charAt(s),d+=p,f.push(e.charToGlyphIndex(p)),m=e.stringToGlyphs(d),1===m.length&&m[0].index===c&&(g=!0),s>t.length&&(g=!0);o.push({char:h,index:c,replacements:f,replacementChars:Array.from(d)}),s++}}return o}generateShapes(e,t){if(!this._isLoaded)return;let m,i=this.font,n=t.fontSize/this.unitsPerEm,r=t.fontSize*t.lineHeight,o=e.map(v=>this.getTextWidth(v,t)),s=t.width,a=this.getCharWidth("\n",t),l=1===t.horizontalAlign?a:0,c=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(o[0],s,t.horizontalAlign,e[0],a),u=this.getLineInitialOffsetY(r,e.length,t.height,n,t.verticalAlign),d=[],p=e.map(v=>[]),f=e.map(v=>[]);for(let v=0;v<e.length;v++){let y=e[v],_={features:{liga:!0}},b=[];try{b=i.stringToGlyphs(y,_)}catch(w){console.warn(w)}h=this.getLineInitialOffsetX(o[v],s,t.horizontalAlign,y,a);let x=[];try{x=this.reverseLigaturesTable(i,y,b)}catch(w){console.warn(w)}c=this.computeSpaceWidthForLine(e,v,t);for(let w=0;w<b.length;w++){let S=b[w],C=0===S.index?"\n":S.unicode?String.fromCharCode(S.unicode):void 0,M=x[w],z=0,E=0;0===w&&2===t.horizontalAlign&&void 0!==S.leftSideBearing&&(E=-S.leftSideBearing*n),m&&(z=i.getKerningValue(S,m)*n),h+=E+z;let D=0;if("\n"===C)D=l;else if(" "===C)D=c;else{let P=this.createPath(S,n,h,u,t);P&&(D=P.offsetX-(z+E),d.push(P.path))}if(1===M.replacements.length)f[v].push([h,u]),p[v].push(D);else{let P=M.replacements.map(R=>(i.glyphs.get(R).advanceWidth??0)*n),I=P.reduce((R,N)=>R+N,0),B=P.map(R=>R/I),V=h;for(let R=0;R<B.length;R++){let N=D*B[R];f[v].push([V,u]),p[v].push(N),V+=N}}h+=D,m=S}u-=r}let g=[];for(let v=0,y=d.length;v<y;v++)g.push(...d[v].toShapes());return{shapes:g,charWidths:p,lineWidths:o,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(e,t,i,n,r){return(3===i||2===i)&&n.indexOf("\n")>=0&&(e-=r),3===i?.5*t-.5*e:2===i?t-e:0}getLineInitialOffsetY(e,t,i,n,r){let o=t*e,s=Math.abs(this.ascender-this.descender)*n,l=-this.ascender*n-(e-s)/2;return 3===r?-(i-o-l):2===r?-(.5*i-.5*o-l):l}createPath(e,t,i,n,r){let o=e.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");let s=new class{constructor(){this.type="ShapePath",this.color=new Ct,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new t8,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath?.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath?.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,o){return this.currentPath?.bezierCurveTo(e,t,i,n,r,o),this}splineThru(e){return this.currentPath?.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,m,g){let v=p.x,y=f.x,_=m.x,b=g.x,x=p.y,w=f.y,S=m.y,C=g.y,M=(b-_)*(x-S)-(C-S)*(v-_),E=(C-S)*(y-v)-(b-_)*(w-x),D=M/E,P=((y-v)*(x-S)-(w-x)*(v-_))/E;if(0===E&&0!==M||D<=0||D>=1||P<0||P>1)return null;if(0===M&&0===E){for(let I=0;I<2;I++){if(n(0===I?m:g,p,f),t.loc===e.ORIGIN){let B=0===I?m:g;return{x:B.x,y:B.y,t:t.t}}if(t.loc===e.BETWEEN)return{x:+(v+t.t*(y-v)).toPrecision(10),y:+(x+t.t*(w-x)).toPrecision(10),t:t.t}}return null}for(let V=0;V<2;V++)if(n(0===V?m:g,p,f),t.loc===e.ORIGIN){let R=0===V?m:g;return{x:R.x,y:R.y,t:t.t}}return{x:+(v+D*(y-v)).toPrecision(10),y:+(x+D*(w-x)).toPrecision(10),t:D}}function n(p,f,m){let x,g=m.x-f.x,v=m.y-f.y,y=p.x-f.x,_=p.y-f.y,b=g*_-y*v;return p.x===f.x&&p.y===f.y?(t.loc=e.ORIGIN,void(t.t=0)):p.x===m.x&&p.y===m.y?(t.loc=e.DESTINATION,void(t.t=1)):void(b<-Number.EPSILON?t.loc=e.LEFT:b>Number.EPSILON?t.loc=e.RIGHT:g*y<0||v*_<0?t.loc=e.BEHIND:Math.sqrt(g*g+v*v)<Math.sqrt(y*y+_*_)?t.loc=e.BEYOND:(x=0!==g?y/g:_/v,t.loc=e.BETWEEN,t.t=x))}let a=0,l=999999999,c=-999999999,h=[];this.subPaths.forEach(p=>{let f=p.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let _=0;_<f.length;_++){let b=f[_];b.y>m&&(m=b.y),b.y<g&&(g=b.y),b.x>v&&(v=b.x),b.x<y&&(y=b.x)}c<=v&&(c=v+1),l>=y&&(l=y-1),f.length&&h.push({curves:p.curves,points:f,isCW:eB.isClockWise(f),identifier:a++,boundingBox:new wB(new $(y,g),new $(v,m))})});let u=h.map(p=>function s(p,f,m,g,v){(null==v||""===v)&&(v="nonzero");let y=new $;p.boundingBox.getCenter(y);let b=function o(p,f,m){let g=new $;f.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&function r(p,f){let m=[],g=[];for(let v=1;v<p.length;v++){let y=p[v-1],_=p[v];for(let b=1;b<f.length;b++){let S=i(y,_,f[b-1],f[b]);null!==S&&void 0===m.find(C=>C.t<=S.t+Number.EPSILON&&C.t>=S.t-Number.EPSILON)&&(m.push(S),g.push(new $(S.x,S.y)))}}return g}(p,y.points).forEach(_=>{v.push({identifier:y.identifier,isCW:y.isCW,point:_})})}),v.sort((y,_)=>y.point.x-_.point.x),v}([new $(m,y.y),new $(g,y.y)],p.boundingBox,f);b.sort((z,E)=>z.point.x-E.point.x);let x=[],w=[];b.forEach(z=>{z.identifier===p.identifier?x.push(z):w.push(z)});let S=x[0].point.x,C=[],M=0;for(;M<w.length&&w[M].point.x<S;)C.length>0&&C[C.length-1]===w[M].identifier?C.pop():C.push(w[M].identifier),M++;if(C.push(p.identifier),"evenodd"===v)return{identifier:p.identifier,isHole:C.length%2==0,for:C[C.length-2]};if("nonzero"===v){let z=!0,E=null,D=null;for(let P=0;P<C.length;P++){let I=C[P];f[I]&&(z?(D=f[I].isCW,z=!1,E=I):D!==f[I].isCW&&(D=f[I].isCW,z=!0))}return{identifier:p.identifier,isHole:z,for:E}}console.warn('fill-rule: "'+v+'" is currently not implemented.')}(p,h,l,c,this.userData?.style.fillRule)),d=[];return h.forEach(p=>{let f=u[p.identifier];if(f&&!f.isHole){let m=new n8;m.curves=p.curves,u.filter(g=>g?.isHole&&g.for===p.identifier).forEach(g=>{if(g){let v=h[g.identifier],y=new t8;y.curves=v.curves,m.holes.push(y)}}),d.push(m)}}),d}},a=(e.advanceWidth??1)*t;if(e)for(let l of o.commands){let c=s.currentPath?.currentPoint;if(!c||"Z"===l.type||c.x!==l.x||-c.y!==l.y)switch(l.type){case"M":s.moveTo(l.x,-l.y);break;case"L":s.lineTo(l.x,-l.y);break;case"Q":s.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":s.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y)}}return s.subPaths.forEach(l=>{let c=function _Se(e){if(e.length){let t=e[0];if(t instanceof sl)return t.v1;if(t instanceof ol||t instanceof lu)return t.v0}}(l.curves);void 0!==c&&l.currentPoint.distanceTo(c)>0&&l.lineTo(c.x,c.y)}),{offsetX:a+r.fontSize*r.letterSpacing,path:s}}getCharWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}getTextWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}computeSpaceWidthForLine(e,t,i){let n=this.getCharWidth(" ",i),r=e[t];if(r){let o=this.countSpaces(r.trimEnd());if(4===i.horizontalAlign&&t<e.length-1&&o)return(i.width-(this.getTextWidth(r,i)-o*n))/o}return n}countSpaces(e){return(e.match(/ /g)||[]).length}}(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof _4&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){return void 0===this.variables[e]?(this.variables[e]={value:t.value,locations:[]},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0):(this.variables[e].value=t.value,!1)}resetDynamicVariablePlayState(){for(let e in this.variables)void 0!==this.variables[e].dynamicVariablePlayState&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(void 0===this.variables[e])return!1;this.variables[e].value=t;let i=t;for(;"string"==typeof i;)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let o=this.variables[e].locations[r];if("material"===o[0]){let s=o[1],a=i,l={scene:n,shared:this},c=o.slice(2);n.traverseMaterial(u=>{let d=u.root??u;d.uuid===s&&d.onVariableUpdate(c,a,l)});let h=this.materials[s];h&&h.onVariableUpdate(c,a,l)}else{let s=n.find(o[0]);if(void 0===s){this.variables[e].locations.splice(r,1);continue}if("geometry"!==o[1]&&"particles"!==o[1]){for(let a=1;a<o.length-1;a++)s=s[o[a]];s[o[o.length-1]]="rotation"===o[1]?i*et.DEG2RAD:i}if(s=n.find(o[0]),"ParticleEmitter"===s.type&&s.updateVariableState(i,o),Ti.is(s))if("position"===o[1]||"rotation"===o[1]||"scale"===o[1])s.onVariableUpdate();else if("geometry"===o[1]){let a=s;s.component&&(a=s.component);let l=a.dataPatched;a.chooseGeoemtryCache(this).forceDelete(l.geometry),a.createGeometryDelayed(this.entityOpContext),a.onVariableUpdate(!0),a.instances.forEach(c=>{let h=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(h.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0)})}}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){if("mouse"===e[0])return this.mouseProperty?.[e[1]]??0;if("raycast"===e[0])return this.raycastProperty?.[e[1]]??0;let i=this.entityOpContext.scene.find(e[0]);if("width"===e[1]||"height"===e[1]||"depth"===e[1])return i.geometry.userData.parameters[e[1]];for(let n=1;n<e.length;n++)i=i[e[n]];return"rotation"===e[1]&&(i*=et.RAD2DEG),i}for(let i in this.variables){if(void 0===t)break;let n=this.variables[i],r=n.locations?.findIndex(o=>Mo.equal(o,t));void 0!==r&&-1!==r&&n.locations.splice(r,1)}if("string"==typeof e){let i=e,n=e;do{if(n=i,void 0===this.variables[i])break;i=this.variables[i].value}while("string"==typeof i);return t&&void 0!==this.variables[n]&&this.variables[n].locations.push(t),i}return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){return this.variables[e]?.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){return this.variables[e]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){"images"===e.path[0]?1===e.path.length&&1===e.type?this.addImage(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?1===e.path.length&&1===e.type?this.addVideo(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?1===e.path.length&&1===e.type?this.addAudio(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?1===e.path.length&&1===e.type?this.addParticle(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?1===e.path.length&&1===e.type?this.addColor(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteMaterial(e.id):"fonts"===e.path[0]?1===e.path.length&&1===e.type?this.addFont(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?1===e.path.length&&1===e.type?this.addVariableHolder(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVariable(e.id):"components"===e.path[0]&&t.updateByLibOp(e,this)}updateByOp(e,t,i){this.data=t,"images"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addImage(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addVideo(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):1===e.path.length&&1===e.type?this.addAudio(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):1===e.path.length&&1===e.type?this.addParticle(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?2===e.path.length&&0===e.type?this.updateColor(e.path[1],e.props):1===e.path.length&&1===e.type?this.addColor(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data):1===e.path.length&&2===e.type?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(oo.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i}):"fonts"===e.path[0]?2===e.path.length&&0===e.type?this.updateFont(e.path[1],e,i):1===e.path.length&&1===e.type?this.addFont(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?2===e.path.length&&0===e.type&&"value"in e.props?this.updateVariable(e.path[1],e.props.value):1===e.path.length&&4===e.type?this.addVariableHolder(e.id,e.data):1===e.path.length&&5===e.type&&this.deleteVariable(e.id):"lib"===e.path[0]&&this.updateLibByOp(oo.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let n=this.getFont(e),r={...this.data.fonts[e],url:t.props.url};n.update(r),n.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}},h0=(new VS(Ta.emptyData()),class extends fs{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),null!==function h9e(e,t){let i=[];if(t.length!==e.length)return null;for(var n=0;n<e.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[n,r]of Object.entries(e.props)){let o=i.shared.material(r);this.material[Number(n)]=o}else if(yn(e.path,["material"])&&this.material instanceof Au)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(oo.drop(e,1),t.material,i);else if(yn(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let r=t.materials[n];"string"!=typeof r&&this.material[n].updateByOp(oo.drop(e,2),r,i)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if("NonParametricGeometry"!==e.geometry?.type&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),t.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===e.geometry?.type||"materials"in e)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map(n=>t.shared.material(n).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let n=0;n<this.material.length;n++)this.material[n]=this.material[n].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&XV(this.material).forEach(e=>{e instanceof Au&&(e instanceof RS||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}}),GY=new T,WY=new Ut,qY=new Ut,CSe=new T,XY=new De,Xo=class extends h0{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=(new De).fromArray(t.bindMatrix),this.bindMatrixInverse=new De)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof gt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof VS){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return a6.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return a6.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),yn(e.path,["geometry"])&&this.updateByPatchedOpGeometry(oo.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if("NonParametricGeometry"===i||"SubdivGeometry"===i){let r,o,s,n=e;if(void 0===this.localGeometry){let l={...this.data.geometry,...n};this.localGeometry=f4(l,t,this.data.flatShading,this)}n.scaleBaked?[r,o,s]=n.scaleBaked:({width:r,height:o,depth:s}=n);let a=this.localGeometry.userData;void 0!==a.sxPrev&&gS(this.localGeometry.attributes,r/a.sxPrev,o/a.syPrev,s/a.szPrev),a.sxPrev=r,a.syPrev=o,a.szPrev=s}else{let n={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=f4(n,t,this.data.flatShading,this)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){let n=!1;0===e.type&&0===e.path.length&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof ps&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),n||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*i.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Ut,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);let o=1/t.manhattanLength();o!==1/0?t.multiplyScalar(o):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(void 0===i)return;let n=this.geometry;WY.fromBufferAttribute(n.attributes.skinIndex,e),qY.fromBufferAttribute(n.attributes.skinWeight,e),GY.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let o=qY.getComponent(r);if(0!==o){let s=WY.getComponent(r);XY.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(CSe.copy(GY).applyMatrix4(XY),o)}}return t.applyMatrix4(this.bindMatrixInverse)}};function HS(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof Au)||0===e.material.getLayersOfType("outline").length)return;e instanceof Xo&&e.is2DAndNoDepth?function MSe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=new T;for(let r=0;r<t.length;r+=3)n.set(t[r],t[r+1],t[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;e.geometry.setAttribute("extrudeNormal",new Ke(i,3))}(e):function SSe(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,n=i.position.array,r=i.normal.array,o=new Float32Array(n.length);for(let s=0;s<n.length;s+=3){let a=`${n[s]}_${n[s+1]}_${n[s+2]}`,l=new T(r[s],r[s+1],r[s+2]);t.has(a)?t.get(a)?.normals.push(l):t.set(a,{normals:[l],result:new T})}t.forEach((s,a)=>{for(let l of s.normals)s.result.add(l);s.result.divideScalar(s.normals.length)});for(let s=0;s<n.length;s+=3){let l=t.get(`${n[s]}_${n[s+1]}_${n[s+2]}`)?.result;l&&(o[s]=l.x,o[s+1]=l.y,o[s+2]=l.z)}e.geometry.setAttribute("extrudeNormal",new Ke(o,3))}(e)}function US(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),r=[et.seededRandom(n),et.seededRandom(n+1e4),et.seededRandom(n+2e4)];for(let o=0;o<t.length;o++)i[o]=r[o%3];e.geometry.setAttribute("randomColor",new It(i,3))}var cc=new dr,b4=new T;function zSe(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"Mesh"===n.type&&"SubdivGeometry"===n.geometry.type&&(t=!0)}),t}var x4=class extends Xo{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new De,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(!0===this.skipReactionUpdate)return;let t=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=ps.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,void 0!==i&&(this.originalGeometry?.dispose(),this.originalGeometry=i),void 0!==n&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,HS(this),US(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let i=this.material;this.material=Array.isArray(i)?i.map(n=>n.getFlavor(!1,n.side,n.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){ps.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&ps.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=ps.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=ps.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,fs.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new Ps,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.boundingSphere.center;cc.setFromBufferAttribute(e.attributes.position),cc.getCenter(i),e.boundingSphere.radius=i.distanceTo(cc.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),cc.getSize(b4),this.hasNonUniformScale&&b4.divide(this.scale);let n={width:b4.x,height:b4.y,depth:b4.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;cc.min.set(e[0],e[2],e[4]),cc.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(cc.min.applyMatrix4(this.shearScaleInv),cc.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new Ps);let i=t.boundingSphere.center;cc.getCenter(i),t.boundingSphere.radius=i.distanceTo(cc.max)}freeSubdivPointer(){this.subdivPointer&&(ps.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},ESe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},DSe={polygon_center:0,edge:1,vertex:2},q6=(e,t)=>(i,n)=>t&&0!==i&&0!==e?e*n/100:0,Kt=(e,t)=>{let i=Math.abs(t),n=-1*i;return(e- -1)*(i-n)/2+n},PSe=new T,X6=new T,ISe=new T,OSe=new T;function u0(e,t){let i=ISe.fromArray(e),n=OSe.fromArray(t);X6.copy(n).sub(i);let r=X6.length();return X6.normalize().multiplyScalar(.5*r),PSe.copy(i).add(X6).toArray()}var Aa=new Co,$6=new T,Q6=new T,f1=new T,jS=e=>.5*(1-Math.cos(e*Math.PI)),QY=new T,ZY=new De,KY=new Xp;function JY(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"Mesh"===n.type&&"TextGeometry"===n.geometry.type&&(t=!0)}),t}var hc,tG,iG,nG,eG=class extends Xo{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){return this.font?this.dataPatched.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(ZY.copy(i).invert(),KY.copy(e.ray).applyMatrix4(ZY),KY.intersectBox(this.singleBBox,QY))){let n=QY.applyMatrix4(i),r=e.ray.origin.distanceTo(n);t.push({distance:r,point:n.clone(),object:this})}}},ys=1e-4,rG=new T,oG=new T;Dj.then(e=>{tG=[(hc=e).get_face_center,hc.get_edge_midpoint,hc.get_vertex_position],iG=[hc.get_face_normal,hc.get_edge_normal,hc.get_vertex_normal],nG=[hc.face_count,hc.edge_count,hc.vertex_count]});var VSe=new De,HSe=new De,Pu=new T,Z6=new T,w4=new T,YS=new T,USe=new T,jSe=new T,wh=new class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(null==this.perlin){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let c,h,p,f,m,n=Math.floor(e),r=Math.floor(t),o=Math.floor(i),s=e-n,a=t-r,l=i-o,u=0,d=.5;for(let g=0;g<4;g++){let v=n+(r<<4)+(o<<8);c=jS(s),h=jS(a),p=this.perlin[4095&v],p+=c*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=c*(this.perlin[v+16+1&4095]-f),p+=h*(f-p),v+=256,f=this.perlin[4095&v],f+=c*(this.perlin[v+1&4095]-f),m=this.perlin[v+16&4095],m+=c*(this.perlin[v+16+1&4095]-m),f+=h*(m-f),p+=jS(l)*(f-p),u+=p*d,d*=.5,n<<=1,s*=2,r<<=1,a*=2,o<<=1,l*=2,s>=1&&(n++,s--),a>=1&&(r++,a--),l>=1&&(o++,l--)}return u}noiseSeed(e){let t=(()=>{let i,n;return{setSeed(r){n=i=(r??4294967296*Math.random())>>>0},getSeed:()=>i,rand:()=>(n=(1664525*n+1013904223)%4294967296,n/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},dl=class extends(UC(en)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof qo&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof qo&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type&&!this.parameters.toObject.object&&(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(let n=0,r=this.children.length;n<r;++n)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let n=0,r=t-i.length;n<r;++n){let o=new qo(this.object);o.expand(),this.add(o)}else for(let n=0,r=i.length-t;n<r;++n)this.remove(i[n])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,n=t-this.children.length;i<n;++i){let r=new qo(this.object);r.expand(),this.add(r)}else for(let i=0,n=this.children.length-t;i<n;++i)this.remove(this.children[0])}}_updateRadial(e){let s,t=e.radial,i=t.start*et.DEG2RAD,r=i-t.end*et.DEG2RAD,o=new Ur(t.rotation[0],t.rotation[1],t.rotation[2]);switch(t.axis){case"z":s=new T(0,0,1);break;case"y":s=new T(0,1,0);break;default:s=new T(1,0,0)}let a=e.randomnessObject??gu.defaultData([1,1,1]).randomnessObject,l="perlin"===a.noiseType;wh.noiseSeed(a.seed);let c=HC((0,s4.default)(a.seed)),h=q6(a.strength,this.parameters.randomness);for(let[u,d]of this.children.entries()){let p=u*(a.freqScale/10)+a.movement,f=l?wh.noise(p):c(p,p),m=u+1;d.scale.x=t.scale[0]+h(m,Kt(f,a.scale[0]))||ys,d.scale.y=t.scale[1]+h(m,Kt(f,a.scale[1]))||ys,d.scale.z=t.scale[2]+h(m,Kt(f,a.scale[2]))||ys,d.position.setScalar(0);let g=r/e.count*u-i;switch(t.axis){case"x":d.rotation.set(0,g,0);break;case"y":d.rotation.set(0,0,g);break;case"z":d.rotation.set(g,0,0)}d.translateOnAxis(s,t.radius),d.position.x+=t.position[0]+h(m,Kt(f,a.position[0])),d.position.y+=t.position[1]+h(m,Kt(f,a.position[1])),d.position.z+=t.position[2]+h(m,Kt(f,a.position[2]));let v=h(m,Kt(f,a.rotation[0])),y=h(m,Kt(f,a.rotation[1])),_=h(m,Kt(f,a.rotation[2]));!0===t.alignment?(d.rotation.x+=o.x+v,d.rotation.y+=o.y+y,d.rotation.z+=o.z+_):d.rotation.set(o.x+v,o.y+y,o.z+_)}}_updateLinear(e){if("linear"!==e.type)throw new Error;let t=e.linear,i=new Ur(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??gu.defaultData([1,1,1]).randomnessObject,r="perlin"===n.noiseType;wh.noiseSeed(n.seed);let o=HC((0,s4.default)(n.seed)),s=q6(n.strength,this.parameters.randomness);for(let[a,l]of this.children.entries()){let c=a*(n.freqScale/10)+n.movement,h=r?wh.noise(c):o(c,c),u=a+1,d=s(u,Kt(h,n.rotation[0])),p=s(u,Kt(h,n.rotation[1])),f=s(u,Kt(h,n.rotation[2]));l.scale.x=1+(t.scale[0]-1)*a+s(u,Kt(h,n.scale[0]))||ys,l.scale.y=1+(t.scale[1]-1)*a+s(u,Kt(h,n.scale[1]))||ys,l.scale.z=1+(t.scale[2]-1)*a+s(u,Kt(h,n.scale[2]))||ys,l.rotation.x=i.x*a+d,l.rotation.y=i.y*a+p,l.rotation.z=i.z*a+f,l.position.x=t.position[0]*a+s(u,Kt(h,n.position[0])),l.position.y=t.position[1]*a+s(u,Kt(h,n.position[1])),l.position.z=t.position[2]*a+s(u,Kt(h,n.position[2]))}}_updateGrid(e){let t=0,i=e.grid,n=e.randomnessObject??gu.defaultData([1,1,1]).randomnessObject,r=q6(n.strength,this.parameters.randomness),o="perlin"===n.noiseType;wh.noiseSeed(n.seed);let s=function Gbe(e=Math.random){let t=HU(e),i=new Float64Array(t).map(o=>VC[o%12*3]),n=new Float64Array(t).map(o=>VC[o%12*3+1]),r=new Float64Array(t).map(o=>VC[o%12*3+2]);return function(o,s,a){let l,c,h,u,S,C,M,z,E,D,d=.3333333333333333*(o+s+a),p=l4(o+d),f=l4(s+d),m=l4(a+d),g=(p+f+m)*nc,b=o-(p-g),x=s-(f-g),w=a-(m-g);b>=x?x>=w?(S=1,C=0,M=0,z=1,E=1,D=0):b>=w?(S=1,C=0,M=0,z=1,E=0,D=1):(S=0,C=0,M=1,z=1,E=0,D=1):x<w?(S=0,C=0,M=1,z=0,E=1,D=1):b<w?(S=0,C=1,M=0,z=0,E=1,D=1):(S=0,C=1,M=0,z=1,E=1,D=0);let P=b-S+nc,I=x-C+nc,B=w-M+nc,V=b-z+2*nc,R=x-E+2*nc,N=w-D+2*nc,W=b-1+.5,Q=x-1+.5,G=w-1+.5,Y=255&p,J=255&f,q=255&m,ee=.6-b*b-x*x-w*w;if(ee<0)l=0;else{let pe=Y+t[J+t[q]];ee*=ee,l=ee*ee*(i[pe]*b+n[pe]*x+r[pe]*w)}let Z=.6-P*P-I*I-B*B;if(Z<0)c=0;else{let pe=Y+S+t[J+C+t[q+M]];Z*=Z,c=Z*Z*(i[pe]*P+n[pe]*I+r[pe]*B)}let ce=.6-V*V-R*R-N*N;if(ce<0)h=0;else{let pe=Y+z+t[J+E+t[q+D]];ce*=ce,h=ce*ce*(i[pe]*V+n[pe]*R+r[pe]*N)}let te=.6-W*W-Q*Q-G*G;if(te<0)u=0;else{let pe=Y+1+t[J+1+t[q+1]];te*=te,u=te*te*(i[pe]*W+n[pe]*Q+r[pe]*G)}return 32*(l+c+h+u)}}((0,s4.default)(n.seed));if(!0===i.useCenter){let a={x:i.count[0]%2==0?2:1,y:i.count[1]%2==0?2:1,z:i.count[2]%2==0?2:1},l=new T(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let c=0;c<i.count[0];c++)for(let h=0;h<i.count[1];h++)for(let u=0;u<i.count[2];u++){let d=[(c+1)*(n.freqScale/10)+n.movement,(h+1)*(n.freqScale/10)+n.movement,(u+1)*(n.freqScale/10)+n.movement],p=o?wh.noise(...d):s(...d),f=this.children[t++];f.scale.x=1+r(t,Kt(p,n.scale[0]))||ys,f.scale.y=1+r(t,Kt(p,n.scale[1]))||ys,f.scale.z=1+r(t,Kt(p,n.scale[2]))||ys;let m=r(t,Kt(p,n.rotation[0])),g=r(t,Kt(p,n.rotation[1])),v=r(t,Kt(p,n.rotation[2]));f.rotation.set(m,g,v),f.position.x=i.size[0]*c-l.x+r(t,Kt(p,n.position[0])),f.position.y=i.size[1]*h-l.y+r(t,Kt(p,n.position[1])),f.position.z=i.size[2]*u-l.z+r(t,Kt(p,n.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let l=0;l<i.count[1];l++)for(let c=0;c<i.count[2];c++){let h=[(a+1)*(n.freqScale/10)+n.movement,(l+1)*(n.freqScale/10)+n.movement,(c+1)*(n.freqScale/10)+n.movement],u=o?wh.noise(...h):s(...h),d=this.children[t++];d.scale.x=1+r(t,Kt(u,n.scale[0]))||ys,d.scale.y=1+r(t,Kt(u,n.scale[1]))||ys,d.scale.z=1+r(t,Kt(u,n.scale[2]))||ys;let p=r(t,Kt(u,n.rotation[0])),f=r(t,Kt(u,n.rotation[1])),m=r(t,Kt(u,n.rotation[2]));d.rotation.set(p,f,m),d.position.x=i.size[0]*a+r(t,Kt(u,n.position[0])),d.position.y=-i.size[1]*l+r(t,Kt(u,n.position[1])),d.position.z=-i.size[2]*c+r(t,Kt(u,n.position[2]))}}_updateToObject(e){if("toObject"!==e.type)throw new Error;let{toObject:t}=e,i=new Ur(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??gu.defaultData([1,1,1]).randomnessObject,r="perlin"===n.noiseType;wh.noiseSeed(n.seed);let o=HC((0,s4.default)(n.seed)),s=q6(n.strength,this.parameters.randomness);if(!t.object){for(let[,m]of this.children.entries())m.position.set(0,0,0),m.scale.setScalar(1),m.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof eG){if(!this.objectForSample.font?.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);let a=this.getSubdivData(),l=[],c=m=>{let g=m.length;return[m.map(b=>b[0]).reduce((b,x)=>b+x,0)/g,m.map(b=>b[1]).reduce((b,x)=>b+x,0)/g,m.map(b=>b[2]).reduce((b,x)=>b+x,0)/g]},h=m=>Math.round(1e6*m)/1e6;a.forEach(m=>{let g=a.filter(v=>h(m.pos[0])===h(v.pos[0])&&h(m.pos[1])===h(v.pos[1])&&h(m.pos[2])===h(v.pos[2]));l.push(g.length>1?{pos:m.pos,norm:c(g.map(v=>v.norm))}:m)});let u=function ASe(e){let t=[],i={};for(var n=0,r=e.length;n<r;n++){var o=JSON.stringify(e[n].pos.map(s=>Math.round(1e4*s)/1e4));i[o]||(t.push(e[n]),i[o]=!0)}return t}(l);if(u.length>0){let m=Math.round(u.length*t.count/100);this._updateCount(m)}else{let m=this.objectForSample.geometry.getAttribute("position");if(!m||isNaN(m.count)||0===m.count)return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`)}this.objectForSample.updateMatrixWorld();let d=new class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let r=1;cl.a.fromBufferAttribute(e,n),cl.b.fromBufferAttribute(e,n+1),cl.c.fromBufferAttribute(e,n+2),r*=cl.getArea(),t[n/3]=r}this.distribution=new Float32Array(e.count/3);let i=0;for(let n=0;n<t.length;n++)i+=t[n],this.distribution[n]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let o=Math.ceil((i+n)/2);if(0===o||t[o-1]<=e&&t[o]>e){r=o;break}e<t[o]?n=o-1:i=o+1}return r}sampleFace(e,t,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),cl.a.fromBufferAttribute(this.positionAttribute,3*e),cl.b.fromBufferAttribute(this.positionAttribute,3*e+1),cl.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(cl.a,n).addScaledVector(cl.b,r).addScaledVector(cl.c,1-(n+r)),cl.getNormal(i),this}}(this.objectForSample).build(),p=ESe[t.axis],f=this.children;d.setRandomGenerator((0,s4.default)(this.object.uuid+t.seed));for(let[m,g]of f.entries()){let v=m*(n.freqScale/10)+n.movement,y=r?wh.noise(v):o(v,v),_=m+1,b=s(_,Kt(y,n.rotation[0])),x=s(_,Kt(y,n.rotation[1])),w=s(_,Kt(y,n.rotation[2]));"random"===t.spreadType?d.sample(w4,YS):(u.length&&(w4.fromArray(u[m].pos),YS.fromArray(u[m].norm)),this.objectForSample instanceof x4&&w4.applyMatrix4(VSe.copy(this.objectForSample.matrixWorld).invert())),w4.applyMatrix4(this.object.hiddenMatrix.clone().invert()),g.position.copy(w4),Pu.fromArray(p);let S="normal"===t.align?YS:this.object.getWorldDirection(jSe),C=Z6.fromArray(t.position);Z6.x+=s(_,Kt(y,n.position[0])),Z6.y+=s(_,Kt(y,n.position[1])),Z6.z+=s(_,Kt(y,n.position[2]));let M=Math.acos(S.dot(Pu)),z=USe.crossVectors(Pu,S).normalize(),E=HSe.makeRotationAxis(z,M),D=S.clone().cross(this.object.up).normalize(),P=D.clone().cross(S).normalize(),I=(new De).makeBasis(D,S,P),B=new T(Pu.y,Pu.z,Pu.x).normalize(),V=B.clone().cross(Pu).normalize(),R=(new De).makeBasis(B,Pu,V).invert(),N=(new De).multiplyMatrices(I,R);g.rotation.setFromRotationMatrix(N),C.applyMatrix4(E),g.position.add(C),g.rotation.x=g.rotation.x+i.x+b,g.rotation.y=g.rotation.y+i.y+x,g.rotation.z=g.rotation.z+i.z+w,g.scale.setScalar(1),g.scale.x=g.scale.x+t.scale[0]+s(_,Kt(y,n.scale[0]))||ys,g.scale.y=g.scale.y+t.scale[1]+s(_,Kt(y,n.scale[1]))||ys,g.scale.z=g.scale.z+t.scale[2]+s(_,Kt(y,n.scale[2]))||ys,g.scale.multiply(this.object.scale),g.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if("random"===e)return[];if(this.objectForSample instanceof x4){let t=this.objectForSample,i=DSe[e],r=tG[i],o=iG[i],s=[],a=(0,nG[i])(t.subdivPointerNew);for(let l=0;l<=a-1;l++){let c=r(t.subdivPointerNew,l),h=o(t.subdivPointerNew,l);rG.fromArray(c).applyMatrix4(t.matrixWorld),oG.fromArray(h),s.push({pos:rG.toArray(),norm:oG.toArray()})}return s}return(this.objectForSample.geometry.index?function kSe(e){let t=[];for(let i=0;i<=e.index.count;i++)if($6.fromArray(e.index.array,3*i),Aa.setFromAttributeAndIndices(e.attributes.position,$6.x,$6.y,$6.z),Aa.getNormal(Q6),Aa.getMidpoint(f1),!(isNaN(f1.x)||isNaN(f1.y)||isNaN(f1.z))){let{a:n,b:r,c:o}=Aa,s=n.toArray(),a=r.toArray(),l=o.toArray(),c=n.distanceTo(r),h=r.distanceTo(o),u=o.distanceTo(n),d=u0(s,a),p=u0(a,l),f=u0(l,s),m=[c,h,u],g=Math.max(...m),v=m.filter(b=>Math.round(b)===Math.round(g)).length>1,y=[],_=Aa.getMidpoint(f1).toArray();g===c&&!v&&(y=[p,f,f],_=d),g===h&&!v&&(y=[d,f,f],_=p),g===u&&!v&&(y=[d,p,p],_=f),v&&(y=[d,p,f]),t.push({vertices:[s,a,l],faceCenters:y,midpoint:_,norm:Aa.getNormal(Q6).toArray()})}return t}(this.objectForSample.geometry):function NSe(e){let t=[],{position:i}=e.attributes;for(let n=0;n<i.count;n++){Aa.setFromAttributeAndIndices(i,3*n,3*n+1,3*n+2),Aa.getNormal(Q6),Aa.getMidpoint(f1);let r=Aa.a.toArray(),o=Aa.b.toArray(),s=Aa.c.toArray();t.push({vertices:[r,o,s],faceCenters:[u0(r,o),u0(o,s),u0(s,r)],midpoint:f1.toArray(),norm:Q6.toArray()})}return t}(this.objectForSample.geometry)).map((t,i)=>"polygon_center"===e?{pos:t.midpoint,norm:t.norm}:"vertex"===e?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:"edge"===e?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){if(this.parameters=P8(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=t.find(this.parameters.toObject.object);this.objectForSample=i instanceof fs?i:void 0,this.matrix=new De,this.hiddenMatrix=new De,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},C4=e=>{var t;return(t=class extends e{}).geometryHelper=new rl(30,30,30),t},K6=new Xp,GS=new Ps,sG=new De,S4=(e,t,i,n,r=!1)=>{let o=t,s=e.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),GS.copy(o.boundingSphere),GS.applyMatrix4(s),!1===i.ray.intersectsSphere(GS)||(sG.copy(s).invert(),K6.copy(i.ray).applyMatrix4(sG),null!==o.boundingBox&&!1===K6.intersectsBox(o.boundingBox)))return;let a,l,c,h,f,m,u=o.index,d=o.attributes.position,p=o.drawRange;if(!1===r){for(f=Math.max(0,p.start),m=Math.min(u.count,p.start+p.count);f<m;f+=3)if(l=u.getX(f),c=u.getX(f+1),h=u.getX(f+2),a=g(e,i,K6,d,l,c,h),a)return a.faceIndex=Math.floor(f/3),void n.push(a)}else{let v=o.attributes.position,y=new T,_=new T,b=new T,x=new T,w=2,S=1/((e.scale.x+e.scale.y+e.scale.z)/3),C=S*S;for(let E=Math.max(0,p.start),D=Math.min(v.count,p.start+p.count)-1;E<D;E+=w){if(y.fromBufferAttribute(v,E),_.fromBufferAttribute(v,E+1),K6.distanceSqToSegment(y,_,x,b)>C)continue;x.applyMatrix4(e.matrixWorld);let P=i.ray.origin.distanceTo(x);P<i.near||P>i.far||n.push({distance:P,point:b.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(v,y,_,b,x,w,S){let C=new T,M=new T,z=new T,E=new T,D=new T;if(C.fromBufferAttribute(b,x),M.fromBufferAttribute(b,w),z.fromBufferAttribute(b,S),null===_.intersectTriangle(C,M,z,!1,E))return null;D.copy(E),D.applyMatrix4(v.matrixWorld);let P=y.ray.origin.distanceTo(D);return P<y.near||P>y.far?null:{faceIndex:1,distance:P,point:D.clone(),object:v}}},J6=new T,Pa=new Fd,YSe=class extends w2{constructor(e){let t=new gt,i=new au({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],o={},s=new Ct(15711266),a=new Ct(15711266),l=new Ct(2857471);function c(u,d,p){h(u,p),h(d,p)}function h(u,d){n.push(0,0,0),r.push(d.r,d.g,d.b),void 0===o[u]&&(o[u]=[]),o[u].push(n.length/3-1)}c("n1","n2",s),c("n2","n4",s),c("n4","n3",s),c("n3","n1",s),c("f1","f2",s),c("f2","f4",s),c("f4","f3",s),c("f3","f1",s),c("n1","f1",s),c("n2","f2",s),c("n3","f3",s),c("n4","f4",s),c("p","n1",a),c("p","n2",a),c("p","n3",a),c("p","n4",a),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),t.setAttribute("position",new Ke(n,3)),t.setAttribute("color",new Ke(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){let e=this.geometry,t=this.pointMap;Pa.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let o=.8;pl("n1",t,e,Pa,-1,-1,o),pl("n2",t,e,Pa,1,-1,o),pl("n3",t,e,Pa,-1,1,o),pl("n4",t,e,Pa,1,1,o);let s=o;pl("f1",t,e,Pa,-1,-1,s),pl("f2",t,e,Pa,1,-1,s),pl("f3",t,e,Pa,-1,1,s),pl("f4",t,e,Pa,1,1,s),pl("u1",t,e,Pa,.35,1.1,.8),pl("u2",t,e,Pa,-.35,1.1,.8),pl("u3",t,e,Pa,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function pl(e,t,i,n,r,o,s){J6.set(r,o,s).unproject(n);let a=t[e];if(void 0!==a){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],J6.x,J6.y,J6.z)}}var WS,GSe=class extends(C4(YSe)){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){S4(this.object,this.geometry,e,t,!0)}};(e=>{e.is=t=>"objectHelper"in t})(WS||(WS={}));var d0=(e,t)=>class extends(qC(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,n){this.objectHelper.raycast(i,n)}showGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof g8&&(n.visible=!0)}}updateEntityBoxSize(i,n){this.objectHelper.visible&&this.geometryHelper instanceof rl?(i.setScalar(0),n.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,n)}hideGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof g8&&(n.visible=!1)}}},p0=new T,qS=new T,XS=new qt,$S=new T,M4=new T,QS=new T,$o=class extends(d0(Fd,GSe)){constructor(e="",t={...W2.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Pf.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new De,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new Sx(-.5*i,.5*i,.5*n,-.5*n,-5e4,1e4),this.perspCamera=new Yo(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){"number"==typeof e&&(e=new T(e,t,i)),super.lookAt(e),this.getWorldPosition(p0),this.targetOffset=p0.distanceTo(e)}getTarget(e=new T){return this.getWorldDirection(qS),this.getWorldPosition(p0),qS.multiplyScalar(this.targetOffset),e.copy(p0).add(qS),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(p0),p0.distanceTo(e)}updateUp(){this.getWorldQuaternion(XS),$S.set(0,0,1).applyQuaternion(XS),M4.copy(en.DEFAULT_UP),this.isUpVectorFlipped&&M4.negate(),M4.applyQuaternion(XS),QS.copy(en.DEFAULT_UP).projectOnPlane($S),this.angleOffsetFromUp=QS.angleTo(M4),this.angleOffsetFromUp*=QS.cross(M4).dot($S)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new T),i=e.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new T;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let n=e>t?this.aspect:1,r=e>t?1:this.aspect;this.left=-395*n,this.right=395*n,this.top=1/r*395,this.bottom=1/r*-395}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,n,r,o){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,i,n,r,o):this.orthoCamera.setViewOffset(e,t,i,n,r,o)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return zw(t,e)}updateCameraSubtype(e,t){let i="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(i,t.zoom),void 0!==t.near&&this.setNear(i,t.near),void 0!==t.fov&&"PerspectiveCamera"===i&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},f0=new De,WSe=new De;function aG(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"BooleanGeometry"===n.geometry?.type&&(t=!0)}),t}var ZS,m1=class extends h0{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new gt,this.onAfterRender=(n,r,o,s,a,l)=>{super.onAfterRender(n,r,o,s,a,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){if(-1!==this.booleanMeshSetAddress&&!e)return;for(let n=0;n<this.children.length;n++){let r=this.children[n];r instanceof m1&&!0===r.dataPatched.visible&&r.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let r=this.children[n];if(r instanceof fs&&!0===r.dataPatched.visible&&r.geometry.attributes.position?.count>0&&r.geometry.drawRange.count>0&&0!==r.booleanMeshSetAddress){f0.multiplyMatrices(r.hiddenMatrix,r.matrix);try{if(-1===r.booleanMeshSetAddress){if((r.geometry.index??r.geometry.getAttribute("position")).count/3<15e5&&(r.booleanMeshSetAddress=vh.getMeshSet(r.geometry,!0===e,t)),-1===r.booleanMeshSetAddress)return;vh.transformMeshSet(r.booleanMeshSetAddress,f0),r.booleanMatrixInvOld.copy(f0).invert(),r.booleanWasTransformed=!1}else r instanceof m1&&!0===r.needsTransformForDownstream?(vh.transformMeshSet(r.booleanMeshSetAddress,f0),r.needsTransformForDownstream=!1):!0===r.booleanWasTransformed&&(vh.transformMeshSet(r.booleanMeshSetAddress,WSe.multiplyMatrices(f0,r.booleanMatrixInvOld)),r.booleanMatrixInvOld.copy(f0).invert(),r.booleanWasTransformed=!1)}catch(o){console.error(o),r.booleanMeshSetAddress=0,r.geometry.userData.booleanOperationDidFail=!0;continue}!1===vh.hasOpenEdges(r.booleanMeshSetAddress)||n===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(r.booleanMeshSetAddress),r.geometry.userData.booleanOperationDidFail=!1):r.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new Ke([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return vh.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new gt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=vh.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,HS(this),US(this)}dispose(){super.dispose(),this.geometry.dispose()}};(e=>{e.is=function t(i){return Ti.is(i)&&i instanceof A2}})(ZS||(ZS={}));var KS=(e,t)=>class extends(d0(e,t)){updateState_Light(i,n){this.updateState_Entity(i,n),void 0!==i.color&&(this.color=n.shared.color(i.color)),void 0!==i.intensity&&(this.intensity=i.intensity),void 0!==i.depth&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),void 0!==i.shadows&&(this.castShadow=i.shadows)}},fl=e=>e instanceof fs,Ch=e=>null!==e&&e instanceof m1,qSe=e=>e instanceof $o,XSe=e=>ZS.is(e),JS=e=>WS.is(e),z4=class extends(C4(v3e)){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){S4(this.object,z4.geometryHelper,e,t)}update(){}},m0=class extends(d0(Ud,z4)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&1===Object.keys(e).length&&t.scene.reloadSplats()}},ty=class extends(d0(Ud,z4)){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},T4="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",iy=class extends qi{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new Te(null),kernel16:new Te(null),inputBuffer:new Te(null),cocBuffer:new Te(null),texelSize:new Te(new $),scale:new Te(1)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",vertexShader:T4}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let t=new Float32Array(128),i=new Float32Array(32),n=0,r=0;for(let a=0;a<80;++a){let l=2.39996323*a,c=Math.sqrt(a)/Math.sqrt(80),h=c*Math.cos(l),u=c*Math.sin(l);a%5==0?(i[r++]=h,i[r++]=u):(t[n++]=h,t[n++]=u)}let o=[],s=[];for(let a=0;a<128;)o.push(new Ut(t[a++],t[a++],t[a++],t[a++]));for(let a=0;a<32;)s.push(new Ut(i[a++],i[a++],i[a++],i[a++]));this.uniforms.kernel64.value=o,this.uniforms.kernel16.value=s}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function cG(e,t,i){return e*(t-i)-t}function eM(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var ZSe=class extends qi{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),focusDistance:new Te(0),focusRange:new Te(0),cameraNear:new Te(.3),cameraFar:new Te(1e3)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:T4}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Jc){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-cG(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=eM(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-cG(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=eM(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Yo?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},hG=class extends qi{constructor(e=new $){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Te(null),texelSize:new Te(new $),halfTexelSize:new Te(new $),kernel:new Te(0),scale:new Te(1)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},tMe=class extends qi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Te(null),opacity:new Te(1)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:T4}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},oMe=class extends qi{constructor(e=new $,t=2){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Bp.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),predicationBuffer:new Te(null),texelSize:new Te(e)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Jc){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},ml={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},tM=class extends qi{constructor(e,t,i,n,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Bp.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),resolution:new Te(new $),texelSize:new Te(new $),cameraNear:new Te(.3),cameraFar:new Te(1e3),aspect:new Te(1),time:new Te(0)},blending:Mr,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Jc){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(ml.FRAGMENT_HEAD,e.get(ml.FRAGMENT_HEAD)).replace(ml.FRAGMENT_MAIN_UV,e.get(ml.FRAGMENT_MAIN_UV)).replace(ml.FRAGMENT_MAIN_IMAGE,e.get(ml.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(ml.VERTEX_HEAD,e.get(ml.VERTEX_HEAD)).replace(ml.VERTEX_MAIN_SUPPORT,e.get(ml.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Yo?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return ml}},cMe=class extends qi{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Bp.replace(/\D+/g,"")},uniforms:{inputBuffer:new Te(null),threshold:new Te(0),smoothing:new Te(1),range:new Te(null)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:T4}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},uMe=class extends qi{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Te(e),inputBuffer:new Te(null),strength:new Te(1)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:T4}),this.toneMapped=!1,this.setColorChannel(0),this.setMaskFunction(0)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Uo&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},fMe=class extends qi{constructor(e=new $,t=new $){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Te(null),searchTexture:new Te(null),areaTexture:new Te(null),resolution:new Te(t),texelSize:new Te(e)},blending:Mr,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},mMe=new Fd,Iu=null,_s=class{constructor(e="Pass",t=new sh,i=mMe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new Dr(function gMe(){if(null===Iu){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(Iu=new gt).setAttribute?(Iu.setAttribute("position",new It(e,3)),Iu.setAttribute("uv",new It(t,2))):(Iu.addAttribute("position",new It(e,3)),Iu.addAttribute("uv",new It(t,2)))}return Iu}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new sh),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Jc){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof sh||t===this.renderer)continue;this[e].dispose()}}}},iM=class extends _s{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new tMe,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new Wi(1,1,{minFilter:ri,magFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==Uo?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Zt&&(this.renderTarget.texture.encoding=Zt))}},vMe=class extends _s{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){let o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},nM=new Ct,rM=class extends _s{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,r){let o=this.overrideClearColor,s=this.overrideClearAlpha,a=e.getClearAlpha(),l=null!==o,c=s>=0;l?(nM.copy(e.getClearColor(nM)),e.setClearColor(o,c?s:a)):c&&e.setClearAlpha(s),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(nM,a):c&&e.setClearAlpha(a)}},Bs=class extends wo{constructor(e,t=-1,i=-1,n=1){super(),this.resizable=e,this.base=new $(1,1),this.preferred=new $(t,i),this.target=this.preferred,this.s=n}get width(){let n,{base:e,preferred:t,scale:i}=this;return n=-1!==t.width?t.width:-1!==t.height?Math.round(t.height*(e.width/Math.max(e.height,1))):Math.round(e.width*i),n}set width(e){this.preferredWidth=e}get height(){let n,{base:e,preferred:t,scale:i}=this;return n=-1!==t.height?t.height:-1!==t.width?Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):Math.round(e.height*i),n}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(-1),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return-1}},oM=!1,dG=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case As:i=this.materialsFlatShadedDoubleSide;break;case io:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded}else switch(t.material.side){case As:i=this.materialsDoubleSide;break;case io:i=this.materialsBackSide;break;default:i=this.materials}this.originalMaterials.set(t,t.material),t.material=t.isSkinnedMesh?i[2]:t.isInstancedMesh?i[1]:i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Ja;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=io,n}),this.materialsDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=As,n}),this.materialsFlatShaded=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=io,n}),this.materialsFlatShadedDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=As,n})}}render(e,t,i){let n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,oM){let r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let o of r)o[0].material=o[1];this.meshCount!==r.size&&r.clear()}else{let r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=r}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return oM}static set workaroundEnabled(e){oM=e}},yMe=class extends _s{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new rM,this.overrideMaterialManager=null===i?null:new dG(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new dG(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){let o=this.scene,s=this.camera,a=this.selection,l=s.layers.mask,c=o.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;null!==a&&s.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,o,s):e.render(o,s),s.layers.mask=l,o.background=c,e.shadowMap.autoUpdate=h}},pG=class extends _s{constructor(e,t,{resolutionScale:i=1,width:n=Bs.AUTO_SIZE,height:r=Bs.AUTO_SIZE,renderTarget:o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new yMe(e,t,new OF({depthPacking:BR}));let s=this.renderPass;s.skipShadowMapUpdate=!0,s.ignoreBackground=!0;let a=s.getClearPass();a.overrideClearColor=new Ct(16777215),a.overrideClearAlpha=1,this.renderTarget=o,void 0===this.renderTarget&&(this.renderTarget=new Wi(1,1,{minFilter:Gi,magFilter:Gi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Bs(this,n,r,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){this.renderPass.render(e,this.renderToScreen?null:this.renderTarget)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Di=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),RMe=new Map([[Di.SKIP,null],[Di.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[Di.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[Di.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[Di.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[Di.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[Di.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[Di.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[Di.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[Di.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[Di.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[Di.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[Di.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Di.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),FMe=class extends wo{constructor(e,t=1){super(),this.f=e,this.opacity=new Te(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return RMe.get(this.blendFunction)}},uc={NONE:0,DEPTH:1,CONVOLUTION:2},dc=class extends wo{constructor(e,t,{attributes:i=uc.NONE,blendFunction:n=Di.SCREEN,defines:r=new Map,uniforms:o=new Map,extensions:s=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=a,this.defines=r,this.uniforms=o,this.extensions=s,this.blendMode=new FMe(n),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Jc){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof sh||t===this.renderer)continue;this[e].dispose()}}}};function fG(e,t,i){for(let n of t){let r="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),o=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let s of i.entries())null!==s[1]&&i.set(s[0],s[1].replace(o,r))}}function BMe(e,t,i,n,r,o,s){let a=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=void 0!==a.get("fragment")&&/mainImage/.test(a.get("fragment")),c=void 0!==a.get("fragment")&&/mainUv/.test(a.get("fragment")),h=[],u=[],d=!1,p=!1;if(void 0===a.get("fragment"))console.error("Missing fragment shader",t);else if(c&&s&uc.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(l||c){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=tM.Section;if(c){let v=`\t${e}MainUv(UV);\n`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),d=!0}if(null!==a.get("vertex")&&/mainSupport/.test(a.get("vertex"))){let v=`\t${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a.get("vertex"))?"vUv);\n":");\n",i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),h=h.concat([...a.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),u=u.concat(h).concat([...a.get("vertex").matchAll(f)].map(y=>y[1]))}u=u.concat([...a.get("fragment").matchAll(f)].map(v=>v[1])),u=u.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),u=u.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>o.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>r.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),fG(e,u,r),fG(e,u,a);let g=t.blendMode;if(n.set(g.blendFunction,g),l){let y=`${e}MainImage(color0, UV, `;s&uc.DEPTH&&/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/.test(a.get("fragment"))&&(y+="depth, ",p=!0),y+="color1);\n\t";let _=e+"BlendOpacity";o.set(_,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${_});\n\n\t`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${_};\n\n`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+a.get("fragment")+"\n"),null!==a.get("vertex")&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+a.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:h,transformedUv:d,readDepth:p}}var ry=class extends _s{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new tM(null,null,null,e),this.effects=t.sort((i,n)=>n.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=tM.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,o=new Set,s=0,a=0,l=0,c=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Di.SKIP)l|=d.getAttributes()&uc.DEPTH;else if(l&d.getAttributes()&uc.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f=BMe("e"+s++,d,t,i,n,r,l);if(a+=f.varyings.length,c=c||f.transformedUv,h=h||f.readDepth,null!==d.extensions)for(let m of d.extensions)o.add(m)}let u=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(u,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+"\n")}l&uc.DEPTH?(h&&t.set(e.FRAGMENT_MAIN_IMAGE,"float depth = readDepth(UV);\n\n\t"+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,"vec2 transformedUv = vUv;\n"+t.get(e.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")):n.set("UV","vUv"),t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,"\n#"))),this.uniformCount=r.size,this.varyingCount=a,this.skipRendering=0===s,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(o).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Jc){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,r){for(let o of this.effects)o.update(e,t,n);if(!this.skipRendering||this.renderToScreen){let o=this.fullscreenMaterial;o.inputBuffer=t.texture,o.time+=n,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let n of this.effects)n.initialize(e,t,i),n.addEventListener("change",r=>this.handleEvent(r));this.updateMaterial(),this.verifyResources(),void 0!==i&&i!==Uo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){"change"===e.type&&this.recompile()}},VMe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],sM=class extends _s{constructor({resolutionScale:e=.5,width:t=Bs.AUTO_SIZE,height:i=Bs.AUTO_SIZE,kernelSize:n=oy.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Wi(1,1,{minFilter:ri,magFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new Bs(this,t,i,e);r.addEventListener("change",o=>this.setSize(r.baseWidth,r.baseHeight)),this.blurMaterial=new hG,this.ditheredBlurMaterial=new hG,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let d,p,o=this.scene,s=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=VMe[this.kernelSize],h=this.blurMaterial,u=t;for(this.fullscreenMaterial=h,d=0,p=c.length-1;d<p;++d){let f=1&d?l:a;h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(f),e.render(o,s),u=f}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(o,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Uo?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Zt&&(this.renderTargetA.texture.encoding=Zt,this.renderTargetB.texture.encoding=Zt))}static get AUTO_SIZE(){return Bs.AUTO_SIZE}},HMe=class extends _s{constructor({width:e=Bs.AUTO_SIZE,height:t=Bs.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}={}){super("LuminancePass"),this.fullscreenMaterial=new cMe(r,n),this.needsSwap=!1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new Wi(1,1,{minFilter:ri,magFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let o=this.resolution=new Bs(this,e,t);o.addEventListener("change",s=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){void 0!==i&&i!==Uo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},UMe=class extends _s{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new rM(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){let o=e.getContext(),s=e.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.stencil.setFunc(o.ALWAYS,h,4294967295),s.stencil.setClear(u),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(i),e.render(a,l)),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(o.EQUAL,1,4294967295),s.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),s.stencil.setLocked(!0)}},gl=class extends _s{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}render(e,t,i,n,r){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){void 0!==i&&i!==Uo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},oy={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},WMe=class extends dc{constructor({blendFunction:e=Di.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:o=Bs.AUTO_SIZE,height:s=Bs.AUTO_SIZE,kernelSize:a=oy.LARGE}={}){super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:e,uniforms:new Map([["map",new Te(null)],["intensity",new Te(r)]])}),this.renderTarget=new Wi(1,1,{minFilter:ri,magFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new HMe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new sM({resolutionScale:n,width:o,height:s,kernelSize:a});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,n),this.blurPass.render(e,n,n)):this.blurPass.render(e,t,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,e.outputEncoding===Zt&&(this.renderTarget.texture.encoding=Zt))}},XMe=class extends dc{constructor({blendFunction:e=Di.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new Te(t)],["contrast",new Te(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},QMe=class extends dc{constructor(e=Di.NORMAL){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:e})}},JMe=class extends dc{constructor({blendFunction:e=Di.NORMAL,offset:t=new $(.001,5e-4)}={}){super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:e,attributes:uc.CONVOLUTION,uniforms:new Map([["offset",new Te(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},tze=class extends dc{constructor(e,{blendFunction:t=Di.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:o=.1,focusRange:s=o,bokehScale:a=1,width:l=Bs.AUTO_SIZE,height:c=Bs.AUTO_SIZE}={}){super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:t,attributes:uc.DEPTH,uniforms:new Map([["nearColorBuffer",new Te(null)],["farColorBuffer",new Te(null)],["nearCoCBuffer",new Te(null)],["scale",new Te(1)]])}),this.camera=e,this.renderTarget=new Wi(1,1,{minFilter:ri,magFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new gl(new ZSe(e));let h=this.cocMaterial;h.focusDistance=r,h.focusRange=s,void 0!==i&&(h.worldFocusDistance=i),void 0!==n&&(h.worldFocusRange=n),this.blurPass=new sM({kernelSize:oy.MEDIUM,width:l,height:c});let u=this.blurPass.getResolution();u.addEventListener("change",p=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new gl(new uMe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=1,d.colorChannel=1,this.bokehNearBasePass=new gl(new iy(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new gl(new iy(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new gl(new iy(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new gl(new iy(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=a}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera;return eM(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e,t=Jc){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let n=this.renderTarget,r=this.renderTargetCoC,o=this.renderTargetCoCBlurred,s=this.renderTargetMasked;if(null!==this.target){let a=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=a}this.cocPass.render(e,null,r),this.blurPass.render(e,r,o),this.maskPass.render(e,t,s),this.bokehFarBasePass.render(e,s,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height,o=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];o.push(this.renderTargetCoC,this.renderTargetMasked),o.forEach(s=>s.setSize(e,t)),o=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],o.forEach(s=>s.setSize(n,r)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(s=>s.fullscreenMaterial.setSize(n,r))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(n=>n.initialize(e,t,i)),this.blurPass.initialize(e,t,Uo),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===Zt&&(this.renderTarget.texture.encoding=Zt,this.renderTargetNear.texture.encoding=Zt,this.renderTargetFar.texture.encoding=Zt,this.renderTargetMasked.texture.encoding=Zt))}},nze=(new T,new De,class extends dc{constructor({blendFunction:e=Di.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new Te(new T)],["saturation",new Te(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),oze=(new Ct,class extends dc{constructor({blendFunction:e=Di.SCREEN,premultiply:t=!1}={}){super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}}),aze=class extends dc{constructor(e=30){super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new Te(!1)],["d",new Te(new $)]])}),this.resolution=new $,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},mG=(Math,new T,new T,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),gG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",vG=class extends dc{constructor({preset:e=1,edgeDetectionMode:t=2,predicationMode:i=0}={}){let n,r;super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:Di.NORMAL,attributes:uc.CONVOLUTION|uc.DEPTH,uniforms:new Map([["weightMap",new Te(null)]])}),arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Wi(1,1,{minFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new rM(!0,!1,!1),this.clearPass.overrideClearColor=new Ct(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new gl(new oMe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new gl(new fMe);let o=new uB;o.onLoad=()=>{let s=new Zn(n);s.name="SMAA.Search",s.magFilter=Gi,s.minFilter=Gi,s.generateMipmaps=!1,s.needsUpdate=!0,s.flipY=!0,this.weightsMaterial.searchTexture=s;let a=new Zn(r);a.name="SMAA.Area",a.magFilter=ri,a.minFilter=ri,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!1,this.weightsMaterial.areaTexture=a,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),void 0!==n&&void 0!==r?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),n.src=mG,r.src=gG),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case 0:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case 1:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case 2:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case 3:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(e,t=Jc){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return mG}static get areaImageDataURL(){return gG}},uze=class extends dc{constructor({blendFunction:e=Di.NORMAL,technique:t=0,eskil:i=!1,offset:n=.5,darkness:r=.5}={}){super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Te(n)],["darkness",new Te(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return 1===this.technique}set eskil(e){this.technique=e?1:0}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};function lM(e,t,i){return e+(t-e)*i}function Qo(e,t,i,n){let r=lM(e,t,.75),o=lM(i,n,.75);return lM(r,o,.875)}new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),Qo(0,0,0,0),new Float32Array([0,0,0,0]),Qo(0,0,0,1),new Float32Array([0,0,0,1]),Qo(0,0,1,0),new Float32Array([0,0,1,0]),Qo(0,0,1,1),new Float32Array([0,0,1,1]),Qo(0,1,0,0),new Float32Array([0,1,0,0]),Qo(0,1,0,1),new Float32Array([0,1,0,1]),Qo(0,1,1,0),new Float32Array([0,1,1,0]),Qo(0,1,1,1),new Float32Array([0,1,1,1]),Qo(1,0,0,0),new Float32Array([1,0,0,0]),Qo(1,0,0,1),new Float32Array([1,0,0,1]),Qo(1,0,1,0),new Float32Array([1,0,1,0]),Qo(1,0,1,1),new Float32Array([1,0,1,1]),Qo(1,1,0,0),new Float32Array([1,1,0,0]),Qo(1,1,0,1),new Float32Array([1,1,0,1]),Qo(1,1,1,0),new Float32Array([1,1,1,0]),Qo(1,1,1,1),new Float32Array([1,1,1,1]);var Sh=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Di.NORMAL}},dze=class extends Sh{constructor(){super(WMe),this.blendFunction=Di.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},pze=class extends Sh{constructor(){super(XMe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},fze=class extends Sh{constructor(){super(JMe),this.effect.offset=new $(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},mze=class extends Sh{constructor(){super(QMe)}},gze=class extends Sh{constructor(){super(nze),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},vze=class extends Sh{constructor(){super(oze),this.blendFunction=Di.OVERLAY}},yze=class extends Sh{constructor(){super(uze)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},_ze=class extends Sh{constructor(e){super(tze)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&!1===this.isPerspectiveCamera||!e.isPerspectiveCamera&&!0===this.isPerspectiveCamera)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},bze=class extends Sh{constructor(){super(aze)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},cM=class extends qi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Te(null)},blending:Mr,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},Mze=class extends _s{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new cM,this.resolutionVector=new $,this.resolveMaterial=new qi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Te(null),historyBuffer:new Te(null),velocityBuffer:new Te(null),depthBuffer:new Te(null),resolution:new Te(new $)},blending:Mr,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new Wi(1024,1024,{minFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Wi(1024,1024,{minFilter:ri,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},zze=class extends _s{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new pG(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new cM,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new cM,this.depthPass=new pG(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let n=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let o=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(o),e.render(this.splineScene,this.camera),this.camera.layers.mask=n}},yG=new sh,Tze=new qi({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),hM=class extends _s{constructor(e,t,i){super("OpaquePass",t??yG,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??yG}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(n=>{n.layers.isEnabled(3)&&n instanceof fs&&(this.originalMaterials.set(n.id,n.material),n.material=Tze)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8),e.setRenderTarget(this.renderToScreen?null:t),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((n,r)=>{let o=this.scene.getObjectById(r);o&&(o.material=n)})}},Dze=new qi({name:"CombineMaterial",uniforms:{inputBufferA:new Te(null),inputBufferB:new Te(null)},blending:Mr,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),Aze=class extends _s{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=Dze,this.helperPass=new hM(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new hM(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new vG({preset:0,edgeDetectionMode:2});this.effectPass=new ry(this.camera,t),this.rt=new Wi(10,10,{minFilter:ri,magFilter:ri,wrapS:Rn,wrapT:Rn,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let n=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(n),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},E4=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Rze=new qi({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),g0=new qi({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new Te(null),texture_depth_lrez:new Te(null),texture_depth_hrez:new Te(null),near:new Te(null),far:new Te(null)}}),Fze=class extends _s{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new Wi(i,n,{type:zr,depthTexture:new df(i,n),minFilter:ri,magFilter:ri}),this.depthBufferHighRes=new Wi(i,n,{depthTexture:new df(i,n)}),this.aoBuffer=new Wi(i,n,{minFilter:ri,magFilter:ri}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(2*E4.length);for(let s=0;s<E4.length;s++){let a=2*s;r[a+0]=E4[s][0],r[a+1]=E4[s][1]}this.blueNoiseInDiskTexture=new wa(r,E4.length,1,xv,zr),this.blueNoiseInDiskTexture.wrapS=Zc,this.blueNoiseInDiskTexture.wrapT=Zc,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new qi({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new Te(null),far:new Te(null),fov:new Te(null),proj_info:new Te(new Ut),is_ortho:new Te(!1),resolution:new Te(new $),radius_of_influence:new Te(8),radius_in_screen_space:new Te(1),exponent:new Te(1),ao_color:new Te(new T),bias:new Te(.5),texture_depth:new Te(null),texture_normals:new Te(null),texture_blue_noise:new Te(null),texture_blue_noise_in_disk:new Te(this.blueNoiseInDiskTexture),frame_index:new Te(0),fog_enabled:new Te(!1),fog_near:new Te(1),fog_far:new Te(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Wi(i,n,{minFilter:ri,magFilter:ri,wrapS:Rn,wrapT:Rn,depthBuffer:!1,type:zr});let o=new vG({preset:3,edgeDetectionMode:2});this.effectPass=new ry(this.camera,o)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,n=e*i,r=t*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,g0.uniforms.texture_depth_hrez.value=e,g0.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=Rze;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let r=this.splineCamera.perspCamera.projectionMatrix.elements;this.hbaoMaterial.uniforms.proj_info.value.set(2/r[0],2/r[5],-(1-r[8])/r[0],-(1+r[9])/r[5]);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*c));this.hbaoMaterial.uniforms.radius_in_screen_space.value=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let r=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/r[5];this.hbaoMaterial.uniforms.proj_info.value.set(2/r[0],s,-(1+r[12])/r[0],-(1-r[13])/r[5]),this.hbaoMaterial.uniforms.radius_in_screen_space.value=this.hbaoMaterial.uniforms.radius_of_influence.value*(this.hbaoMaterial.uniforms.resolution.value.y/s*.5),this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=g0,g0.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,g0.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,g0.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Hze=class extends gl{constructor(){super(new qi({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new Te(null),tMap:new Te(null),uResolution:new Te(new $),uSize:new Te(new $),uCoords:new Te(new $),uScale:new Te(1),uSceneColor:new Te(new Ct(16711680)),uDPR:new Te(1),uCurrent:new Te(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},Yze=[],Gze=class extends gl{constructor(){super(new qi({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new Te(null),fromScene:new Te(null),uResolution:new Te(new $),uDPR:new Te(1),mixRatio:new Te(0),threshold:new Te(.1),useTexture:new Te(0),tMixTexture:{value:Yze[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},Xze=class extends gl{constructor(){super(new qi({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n\tgl_FragColor.a = 1.0;\n}\n",uniforms:{inputBuffer:new Te(null),blurredInputBuffer:new Te(null),overlay:new Te(null),uResolution:new Te(new $),uDPR:new Te(1),blurIntensity:new Te(0)}})),this._blurEnabled=!1,this.blurTarget=new Wi(1,1,{minFilter:ri,magFilter:ri,wrapS:Rn,wrapT:Rn}),this.blurPass=new sM({width:window.innerWidth,height:window.innerHeight,kernelSize:oy.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t).divideScalar(i),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,n=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=n/3}}render(e,t,i,n,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,n,r)),super.render(e,t,i,n,r)}};function _G(e,t){return t&&t.enabled&&e.push(t.effect),e}var $ze=e=>Object.values(Di).includes(e)?e:Di.NORMAL,Qze=class extends wo{constructor(e){super(),this.postprocessingState=l6.defaultData,this._scene=new sh,this._camera=new $o,this.effects=new Map,this.blueNoiseTexture=new wa,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=vB(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=vB();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},this.renderer=e,this.debug=!1,this.effects.set("bloom",new dze),this.effects.set("chromaticAberration",new fze),this.effects.set("vignette",new yze),this.effects.set("noise",new vze),this.effects.set("colorAverage",new mze),this.effects.set("hueSaturation",new gze),this.effects.set("brightnessContrast",new pze),this.effects.set("depthOfField",new _ze),this.effects.set("pixelation",new bze),this.effectComposer=new class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new iM,this.depthTexture=null,this.timer=new class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return.001*this.delta}getFixedDelta(){return.001*this.fixedDelta}setFixedDelta(e){return this.fixedDelta=1e3*e,this}getElapsed(){return.001*this.elapsed}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){let t=e.getSize(new $),i=e.getContext().getContextAttributes()?.alpha??!1,n=this.inputBuffer.texture[0].type;n===Uo&&e.outputEncoding===Zt&&(this.inputBuffer.texture[0].encoding=Zt,this.outputBuffer.texture[0].encoding=Zt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(t.width,t.height,!1);for(let r of this.passes)r.initialize(e,i,n)}}replaceRenderer(e,t=!0){let i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new df(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Id,e.type=Ad):e.type=Kc,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n,r,o){let c,s=this.renderer,a=null===s?new $:s.getDrawingBufferSize(new $),l={minFilter:ri,magFilter:ri,wrapS:Rn,wrapT:Rn,stencilBuffer:t,depthBuffer:e};return n>0?(c=new Wi(a.width,a.height,l),c.samples=n):(r?(c=new lpe(a.width,a.height,2,l),c.texture[1].type=Dd):c=new Wi(a.width,a.height,l),c.depthTexture=new df(2048,2048),c.depthTexture.type=zr),i===Uo&&null!==s&&s.outputEncoding===Zt&&(Array.isArray(c.texture)?c.texture.forEach(h=>h.encoding=Zt):c.texture.encoding=Zt),Array.isArray(c.texture)?c.texture.forEach((h,u)=>{h.name=`EffectComposer.Buffer ${r} ${u}`,h.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${r}`,c.texture.generateMipmaps=!1),c.name=o,c}addPass(e,t){let s,i=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new $),o=n.getContext().getContextAttributes()?.alpha??!1;if(e.MRTCompatible&&(s=this.inputBuffer.texture[0].type),e.MRTCompatible||(s=this.inputBuffer.texture.type),e.setRenderer(n),e.setSize(r.width,r.height),e.initialize(n,o,s),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let a=this.createDepthTexture();for(e of i)e.setDepthTexture(a)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);-1!==i&&t.splice(i,1).length>0&&(null!==this.depthTexture&&(t.reduce((r,o)=>r||o.needsDepthTexture,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)),this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0)))}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let l,c,h,u,t=this.renderer,i=this.copyPass,n=this.inputBuffer,r=this.outputBuffer,o=this.inputBufferSingle,s=this.outputBufferSingle,a=!1;void 0===e&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,n,r,e,a):d.render(t,o,s,e,a),d.needsSwap&&(a&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,n,r,e,a),c.setFunc(l.EQUAL,1,4294967295)),h=n,u=o,n=r,o=s,r=h,s=u),d instanceof UMe?a=!0:d instanceof vMe&&(a=!1))}setSize(e,t,i){let n=this.renderer;if(this._width=e,this._height=t,void 0===e||void 0===t){let o=n.getSize(new $);e=o.width,t=o.height}n.setSize(e,t,i);let r=n.getDrawingBufferSize(new $);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let o of this.passes)o.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}}(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new hM(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new zze(this.scene,this.camera,this.renderer),this.aoPass=new Fze(this.scene,this.camera),this.taaPass=new Mze,this.taaPass.renderToScreen=!1,this.helperPass=new Aze(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new Hze,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Xze,this.uiOverlayPass.enabled=!1,this.sceneTransitionPass=new Gze,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){void 0!==e?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];!0!==i.enabled||e||!this._renderToScreen?i.renderToScreen=!1:(i.renderToScreen=!0,e=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new wa(e,128,128),this.blueNoiseTexture.wrapS=Zc,this.blueNoiseTexture.wrapT=Zc,this.blueNoiseTexture.minFilter=Gi,this.blueNoiseTexture.magFilter=Gi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,n,r,o,s,a){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=o,this.aoPass.fogFar=s,this.aoPass.runHalfRes!==!a&&(this.aoPass.runHalfRes=!a)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let e=[this.effects.get("pixelation")].reduce(_G,[]);e.length>0&&(this.uvEffectPass=new ry(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(_G,[]);if(t.length>0&&(this.effectPass=new ry(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this.effects.get("depthOfField")?.enabled&&void 0!==window)){let i=this.renderer.viewportWidth,n=this.renderer.viewportHeight;this.renderer.setSize(i-1,n-1),this.renderer.setSize(i,n)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new $;this.renderer.getDrawingBufferSize(e),this._rt=new Wi(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Zc,wrapT:Zc}),this._rt.samples=0,this._savePass=new iM(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new iM(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(!0===e?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(null!==e?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,n=!1;t!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let o=r[1],s=this.effects.get(r[0]);if(s){s.enabled!==o.enabled&&(n=!0),s.enabled=o.enabled;for(let[a,l]of Object.entries(o))"blendFunction"===a?s.blendFunction=$ze(l):s[a]=l}}this.postprocessingState=e,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,n){e instanceof Ut?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,n),this.effectComposer.outputBuffer.scissor.set(e,t,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,i,n)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,n){e instanceof Ut?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,n),this.effectComposer.outputBuffer.viewport.set(e,t,i,n))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let n=this.renderer.getPixelRatio();this._rt.setSize(e*n,t*n)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},Kze=oi.lights_fragment_begin,Jze=oi.shadowmask_pars_fragment,bG=null,uM=new qi({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n\nvoid main()\n{\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),xG=new Zn,rTe=class extends kF{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new $,this.pipeline=new Qze(this),this.dummyCamera=new $o,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(r=!0,o=!0,s=!0)=>{let a=this.getContext(),l=0;r&&(l|=a.COLOR_BUFFER_BIT),o&&(l|=a.DEPTH_BUFFER_BIT),s&&(l|=a.STENCIL_BUFFER_BIT),a.clear(l),a.clearBufferfv(a.COLOR,1,[0,0,0,1])},this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=Lb,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let n=this.getContext();if(n&&"drawingBufferColorSpace"in n)try{n.drawingBufferColorSpace="display-p3"}catch(r){console.warn(r)}this.setPixelRatio=r=>{this._pixelRatio!==r&&(this._pixelRatio=r,t(r))},this.setSize=(r,o,s=!0)=>{(this.viewportWidth!==r||this.viewportHeight!==o)&&(this.viewportWidth=r,this.viewportHeight=o,i(r,o,s),this.normalRenderTarget?.setSize(r*this._pixelRatio,o*this._pixelRatio),this._resizeTransmission(r,o),this.transmissionDepthTarget?.setSize(r*this._pixelRatio/2,o*this._pixelRatio/2),this.pipeline.resize(r,o,s))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new Wi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:ri,magFilter:ri,wrapS:Rn,wrapT:Rn,depthBuffer:!1}))}_resizeTransmission(e,t){this.transmissionRenderTarget?.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return 1===Et.transmissionLod.value}set hdTransmission(e){Et.transmissionLod.value=!0===e?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new Wi(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Hp,magFilter:ri,wrapS:Rn,wrapT:Rn,depthBuffer:!1}),this.transmissionDepthTarget=new Wi(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Gi,magFilter:Gi,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new Wi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Gi,magFilter:Gi,type:zr,depthTexture:new df(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),uM.uniforms.depthContrast.value=i instanceof $o?(i.far-i.near)/1e4:1,t.overrideMaterial=uM,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?DM:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let n=t.height,r=t.width,o=this.viewportWidth/this.viewportHeight;r<n?r=n*o:n=r/o,this.dummyCamera.setViewplaneSize(r,n);for(let s=0;s<i;s++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i,sceneHelpersOnTop:n,overrideTransmission:r,overrideNormal:o}={}){let s=e instanceof AM?e.activePage:e,a=s.visible;s.visible=!0;let l=s.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(s.bgColor,s.bgColor.a),s.penumbraSizeArray.forEach((d,p)=>{Et.penumbraSize.value[p]=d}),Et.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?Et.resolution.value.set(this.resolution.x,this.resolution.y):Et.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==o?(Et.normalRenderTarget.value=o,Et.normalRenderTargetDepth.value=xG):l.needsNormal()&&(this.createNormalRenderTarget(),Et.normalRenderTarget.value=this.normalRenderTarget.texture,Et.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,s,t));let c=s.data.ao,h=c.occlusion;h&&(this.createAORenderTarget(),Et.aoRenderTarget.value=this.aoRenderTarget.texture),Et.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,s.aoColor,null!==s.fog,s.backupFog.near,s.backupFog.far,c.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&s.uiCanvas?.enabled&&s.uiCanvas.texture&&s.uiCanvas.texture.image.width>0?((s.uiCanvas.width!==this.viewportWidth||s.uiCanvas.height!==this.viewportHeight)&&s.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight}),s.uiCanvas.render(),this.pipeline.uiOverlayPass.uiCanvas=s.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(this.domElement.width,this.domElement.height,window.devicePixelRatio),this.pipeline.updateRenderToScreen()):(this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen());let u=!1;if(void 0!==r)Et.transmissionRenderTarget.value=r,Et.transmissionRenderTargetDepth.value=xG,this.pipeline.setTransmissionPassEnabled(!1);else{let d=l.needsTransmission();d&&(void 0===this.transmissionRenderTarget&&(u=!0),this.createTransmissionRenderTarget(),Et.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Et.aspectRatio.value=function cCe(e,t){return e>=t?new $(t/e,1):new $(1,e/t)}(this.viewportWidth,this.viewportHeight),Et.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(d)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=s,this.pipeline.camera=t,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==s.postprocessing&&(this.pipeline.updatePostprocessing(s.postprocessing),!i&&!n&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),s.overrideMaterial=l.wireframeState?DM:null,this.pipeline.render(),Et.frameIndex.value=(Et.frameIndex.value+1)%16,t instanceof $o&&t.copyHistory(),s.visible=a}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},wG=class extends(C4(g3e)){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){S4(this.object,wG.geometryHelper,e,t)}},CG=class extends(C4(m3e)){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){S4(this.object,CG.geometryHelper,e,t)}},dM=class extends(C4(f3e)){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){S4(this.object,dM.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=dM._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,o=this.cone.material.length;r<o;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},SG=dM;SG._vector=new T;var hn,MG=class extends(KS(J4e,wG)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new m8(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof m8&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function oTe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},zG=new T,TG=new T,EG=new qt,DG=class extends(KS($4e,SG)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*et.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new m8(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof m8&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),TG.setFromMatrixPosition(this.matrixWorld),EG.setFromRotationMatrix(this.matrixWorld),zG.copy(this.up).applyQuaternion(EG).negate().multiplyScalar(this.distance),this.target.position.copy(TG).add(zG),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function ay(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function AG(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}(e=>{function a(w){return[w[0],w[3],w[1],w[4],w[2],w[5]]}e.identity=function t(){return[1,0,0,0,1,0,0,0,1]},e.copy=function i(w,S=e.identity()){for(let C=0,M=w.length;C<M;C++)S[C]=w[C];return S},e.create=function n(w,S,C,M,z,E){return e.setAbcdef(e.identity(),w,S,C,M,z,E)},e.setAbcdef=function r(w,S,C,M,z,E,D){return w[0]=S,w[1]=M,w[2]=E,w[3]=C,w[4]=z,w[5]=D,w},e.append=function o(w,S){let[C,M,z,E,D,P]=a(w),[I,B,V,R,N,W]=a(S);return e.create(I*C+B*z,I*M+B*E,V*C+R*z,V*M+R*E,N*C+W*z+D,N*M+W*E+P)},e.prepend=function s(w,S){let[C,M,z,E,D,P]=a(w),[I,B,V,R,N,W]=a(S),Q=C,G=M,Y=z,J=E;return(1!==I||0!==B||0!==V||1!==R)&&(Q=C*I+M*V,G=C*B+M*R,Y=z*I+E*V,J=z*B+E*R),e.create(Q,G,Y,J,D*I+P*V+N,D*B+P*R+W)},e.getAbcdef=a,e.invert=function l(w){let[S,C,M,z,E,D]=e.getAbcdef(w),P=S*z-C*M;return e.create(z/P,-C/P,-M/P,S/P,(M*D-z*E)/P,-(S*D-C*E)/P)},e.apply=function c([w,S],C){let[M,z,E,D,P,I]=e.getAbcdef(C);return[M*w+E*S+P,z*w+D*S+I]},e.applyInverse=function h(w,S){let[C,M,z,E,D,P]=e.getAbcdef(S),I=1/(C*E+z*-M),[B,V]=w;return[E*I*B+-z*I*V+(P*z-D*E)*I,C*I*V+-M*I*B+(-P*C+D*M)*I]},e.scale=function u(w,S,C=S){let[M,z,E,D,P,I]=e.getAbcdef(w);return e.setAbcdef(w,M*S,z*C,E*S,D*C,P*S,I*C),w},e.rotate=function d(w,S){let C=Math.cos(S),M=Math.sin(S),[z,E,D,P,I,B]=e.getAbcdef(w);return e.setAbcdef(w,z*C-E*M,z*M+E*C,D*C-P*M,D*M+P*C,I*C-B*M,I*M+B*C),w},e.rotateAround=function p(w,S,C){let[M,z]=C,E=e.translate(w,-M,-z);return E=e.rotate(E,S),E=e.translate(E,M,z),E},e.translate=function f(w,S,C){let[M,z,E,D,P,I]=e.getAbcdef(w);return e.setAbcdef(w,M,z,E,D,P+S,I+C),w},e.setTranslate=function m(w,S,C){let[M,z,E,D]=e.getAbcdef(w);return e.setAbcdef(w,M,z,E,D,S,C),w},e.setPosition=function g(w,S,C){let[M,z,E,D]=e.getAbcdef(w);return e.setAbcdef(w,M,z,E,D,S,C),w},e.getScale=function v(w){let[S,C,M,z]=e.getAbcdef(w);return[Math.sqrt(S*S+C*C),Math.sqrt(M*M+z*z)]},e.getPosition=function y(w){let[,,,,S,C]=e.getAbcdef(w);return[S,C]},e.getRotation=function _(w,S){return e.decompose(w,S).rotation},e.decompose=function b(w,S){let[C,M,z,E,D,P]=e.getAbcdef(w),{rotation:I,scale:B,shear:V}=function aTe(e){let[t,i,n]=function sTe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,n=(e[1][0]+e[0][1])/2,r=(e[1][0]-e[0][1])/2,o=Math.sqrt(t*t+r*r),s=Math.sqrt(i*i+n*n),a=o+s,l=o-s,c=Math.atan2(n,i),h=Math.atan2(r,t),u=(h-c)/2,d=(h+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[a,0],[0,l]],m=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(e),r=ay(t,AG(n)),o=ay(ay(n,i),AG(n));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[o[0][0],o[1][1]],shear:[o[0][1]/o[1][1],o[1][0]/o[0][0]]}}([[C,z],[M,E]]);return{position:[D+(S[0]*C+S[1]*z)-S[0],P+(S[0]*M+S[1]*E)-S[1]],scale:B,rotation:I,shear:V,pivot:S}},e.compose=function x(w,S,C,M,z=[0,0]){let[E,D]=w,[P,I]=M,[B,V,R,N]=function lTe({rotation:e,scale:t,shear:i}){let n=Math.cos(e),r=Math.sin(e),a=ay([[n,-r],[r,n]],[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]]);return[a[0][0],a[1][0],a[0][1],a[1][1]]}({rotation:C,scale:S,shear:z});return e.create(B,V,R,N,E-(P*B+I*R)+P,D-(P*V+I*N)+I)}})(hn||(hn={}));var cTe=Math.PI/180;Math;var lo=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=hn.identity(),this.worldMatrix=hn.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new pM,this._recursiveBBox=new pM,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=function dTe(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map(function(r){r(i)}),(n=e.get("*"))&&n.slice().map(function(r){r(t,i)})}}}(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=hn.append(t.worldMatrix,i)),hn.applyInverse(e,i)}intersects(e,t,i,n=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),n)}intersectsInLocalSpace(e,t,i=!1){let{min:n,max:r}=i?this.recursiveBBox:this.singleBBox;return e>=n[0]&&e<=r[0]&&t>=n[1]&&t<=r[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=hn.compose(this.position,this.scale,function uTe(e){return e*cTe}(this.rotation),r1.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let n=this.parent;t&&null!=n&&n.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.worldMatrix=this.parent?hn.append(this.parent.worldMatrix,this.localMatrix):hn.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return r1.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;void 0!==e.position&&(t=!0,this.position=e.position),void 0!==e.rotation&&(t=!0,this.rotation=e.rotation),void 0!==e.scale&&(t=!0,this.scale=e.scale),void 0!==e.shear&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){0===e.type&&void 0!==e.props.visible&&(this.visible=e.props.visible),this.data=t,this.data=t;let n=e,r=yn(e.path,["states","*"]);if(null!==r){if(0===e.type){let[o]=r;if(this?.stateSelection===o){let s={...e.props};if(delete s.name,Object.values(e.props).some(a=>void 0===a)){let a=this.data;if(void 0!==a){let l=Mo.zoom(a,e.path.slice(2));if(l)for(let c in e.props)void 0===e.props[c]&&c in l&&(s[c]=l[c])}}n={...e,props:s,path:e.path.slice(2)}}}}else if(0===e.type){let o=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==o){if(void 0!==e.props.name&&o.name){let{name:a,...l}=o;o=l}let s=Mo.removeOverridden(e.path,e.props,o);n={...e,props:s}}}this.updateByPatchedOpBase(n,n1.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(0!==this.data.states.length||i){for(let n of this.data.states)n1.toOps(this.data,n.data).forEach(r=>{let o=Y8.replaceProps(r,this.data);this.dataPatched=this.data,this.updateByPatchedOp(o,this.data,t)});if(null!==e){let n=this.data.states.data(e);n&&(this.dataPatched=n1.patch(this.data,n),n1.toOps(this.data,n).forEach(r=>{this.updateByPatchedOp(r,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.visible&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){0===e.path.length&&0===e.type&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{"frame2d"===t.data.type&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new lo(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof lo&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},pc=class extends lo{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof pc&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(!0!==t)for(let i of this.children)i instanceof pc?i.traverse(e):t=e(i)}intersectsChildren(e,t,i,n=!1,r=[],o=!1){for(let s of this.children){let a=s instanceof Mh;if(s instanceof pc&&!a&&o&&s.intersectsChildren(e,t,i,n,r,!1),s.intersects(e,t,i,a)&&(r.push(s),n))break}return r}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let n of this.children)n.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new pc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Mh=class extends pc{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Mh(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function pTe(e,t){let[[i,n],[r,o]]=e,[[s,a],[l,c]]=t,h=(i-r)*(a-c)-(n-o)*(s-l);if(0===h)return!1;let u=((i-s)*(a-c)-(n-a)*(s-l))/h,d=-((i-r)*(n-a)-(n-o)*(i-s))/h;return u>=0&&u<=1&&d>=0&&d<=1}var OG,ly,Xt,fM,PG=[[-1,1],[-1,-1],[1,-1],[1,1]],IG=(e,t,i)=>{let n=e.getCenter(),r=e.getHalfSize(),o=hn.append(t,e.worldMatrix);0===r[0]&&0===r[1]?i.push(hn.apply(n,o)):PG.forEach(s=>{i.push(hn.apply([s[0]*r[0]+n[0],s[1]*r[1]+n[1]],o))})},pM=class{constructor(){this.matrix=hn.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),hn.copy(e.worldMatrix,this.matrix);let i=hn.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let n=[];!0===i&&e instanceof pc?e.traverse(r=>{r.visible&&IG(r,t,n)}):IG(e,t,n),this.setFromPoints(n)}getCenter(){let[e,t]=this.min,[i,n]=this.getHalfSize();return hn.apply([e+i,t+n],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[n,r,o,s]=hn.getAbcdef(this.matrix),a=hn.create(n,r,o,s,i[0],i[1]);this.vertices=PG.map(([l,c])=>hn.apply([l*e,c*t],a))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=hn.append(t.worldMatrix,i)),hn.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:n}=this;return e>=i[0]&&e<=n[0]&&t>=i[1]&&t<=n[1]}containsPoint(e){let[t,i]=e,[n,r]=this.min,[o,s]=this.max;return t>=n&&t<=o&&i>=r&&i<=s}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let n=this.edges[t];for(let r=0,o=e.edges.length;r<o;r++)if(pTe(n,e.edges[r]))return!0}for(let t=0,i=e.vertices.length;t<i;t++)if(this.containsPoint(e.vertices[t]))return!0;return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],hn.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new pM;return e.copy(this),e}},fTe=new Promise(e=>{OG=e}),kG=!1;function mTe(){if(!kG)return ly||(ly=function e(){return t.apply(this,arguments)}(),ly);function t(){return(t=(0,Dn.Z)(function*(){let i=yield mn.e(952).then(mn.bind(mn,952));OG(i.default??i),kG=!0})).apply(this,arguments)}}function NG(e){let t=!1;return e.scene.objects.traverse((i,n)=>{("Mesh"===n.type&&"UIGeometry"===n.geometry.type||"Page"===n.type&&void 0!==n.uiFrame)&&(t=!0)}),t}function mM(){return mM=(0,Dn.Z)(function*(e){let t=yield fTe;Xt||(fM||(fM=t({locateFile:()=>e})),Xt=yield fM)}),mM.apply(this,arguments)}var LG=hn.identity(),RG=class{constructor(e,t=1){this.canvas=e,this.dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=on.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=on.transparent,this._fonts=new Map;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=LG,this._currentTransform=new Float32Array(LG)}init(){var e=this;return(0,Dn.Z)(function*(){if(!e.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");yield function gTe(e){return mM.apply(this,arguments)}(e.wasmURL),e._surface=Xt.MakeWebGLCanvasSurface(e.canvas),e.ctx=e._surface?.getCanvas(),e._paint=new Xt.Paint,e._paint.setAntiAlias(!0),e._paintFill=e._paint.copy(),e._paintFill.setStyle(Xt.PaintStyle.Fill),e._paintStroke=e._paint.copy(),e._paintStroke.setStyle(Xt.PaintStyle.Stroke),e.ctx?.scale(e.dpr,e.dpr)})()}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}loadFont(e,t){var i=this;return(0,Dn.Z)(function*(){let n=yield(yield fetch(e)).arrayBuffer();i.registerFont(n,t)})()}registerFont(e,t){if(this._fonts.has(t))return;let i=Xt.FontMgr.FromData(e);if(!i)throw new Error("Invalid font data for "+t);this._fonts.set(t,i)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(cy(e),Xt.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(cy(e),Xt.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?e:2*e)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){this.ctx?.clear(Xt.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new Xt.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,n,r=0,o=0,s=0,a=0){let l=Xt.XYWHRect(e,t,i,n);if(0===r&&0===o&&0===a&&0===s)this.ctx?.clipRect(l,Xt.ClipOp.Intersect,!0);else{let c=Xt.RRectXY(l,r,r);c[4]=c[5]=r,c[6]=c[7]=o,c[8]=c[9]=s,c[10]=c[11]=a,this.ctx?.clipRRect(c,Xt.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=hn.invert(this.currentTransform);this.ctx.concat(e);let t=hn.translate(hn.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){if(this.ctx&&this._currentPath){let n,r=!1;if(i&&this._hasDropShadow()){let s,o=e.copy();o.setColor(cy(this._dropShadowColor)),this._dropShadowBlur>0&&(s=Xt.MaskFilter.MakeBlur(Xt.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),o.setMaskFilter(s)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Xt.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(o),this.ctx.restore(),o.delete(),s?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Xt.ClipOp.Intersect,!0);let o=Xt.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Xt.TileMode.Clamp,null),s=e.copy();s.setImageFilter(o),s.setAlphaf(1);let a=this._currentPath.computeTightBounds();this.ctx.saveLayer(s,a,null,Xt.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),s.delete(),o.delete(),r=!0}if(this._layerBlur>0){let o=e.copy();n=Xt.MaskFilter.MakeBlur(Xt.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),o.setMaskFilter(n),t(o),o.delete(),n.delete(),r=!0}if(r||t(e),i&&this._hasInnerShadow()){let s,o=new Xt.Paint;o.setAntiAlias(!0),o.setStyle(Xt.PaintStyle.Fill),o.setColor(cy(this._innerShadowColor)),this._innerShadowBlur>0&&(s=Xt.MaskFilter.MakeBlur(Xt.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),o.setMaskFilter(s));let a=this._currentPath.computeTightBounds(),[l,c,h,u]=a,d=h-l,p=u-c;this.ctx.save(),this.ctx.clipPath(this._currentPath,Xt.ClipOp.Intersect,!0),this.ctx.saveLayer(o,a,null,Xt.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Xt.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+d+Math.abs(2*this._innerShadowOffsetX),2e3+p+Math.abs(2*this._innerShadowOffsetY)),o),o.setBlendMode(Xt.BlendMode.Clear),this.ctx.drawPath(this._currentPath,o),this.ctx.restore(),this.ctx.restore(),o.delete(),s?.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,n=this._currentPath;this._applyEffectsToPaint(e,r=>{let o=!1;!t&&"center"!==this._strokeMode&&(i.save(),i.clipPath(n,"outside"===this._strokeMode?Xt.ClipOp.Difference:Xt.ClipOp.Intersect,!0),o=!0),i.drawPath(n,r),o&&i.restore()},t)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(e){this._currentPath?.addPath(Xt.Path.MakeFromSVGString(e))}ellipse(e,t,i,n,r,o,s,a){if(!FG([e,t,i,n])||!this._currentPath)return;if(i<0||n<0)throw Error("radii cannot be negative");let l=Xt.XYWHRect(e-i,t-n,2*i,2*n);this._currentPath?.addOval(l)}rect(e,t,i,n,r=0,o=0,s=0,a=0){let l=Xt.XYWHRect(e,t,i,n);if(FG(l))if(0===r&&0===o&&0===a&&0===s)this._currentPath?.addRect(l);else{let c=Xt.RRectXY(l,r,r);c[4]=c[5]=r,c[6]=c[7]=o,c[8]=c[9]=s,c[10]=c[11]=a,this._currentPath?.addRRect(c)}}getHorizontalAlign(e){switch(e){case 2:return Xt.TextAlign.Right;case 3:return Xt.TextAlign.Center;case 4:return Xt.TextAlign.Justify;default:return Xt.TextAlign.Left}}drawTextInner(e,t,i,[n,r,o,s],a,l,c=!0){let h=0,{ctx:u}=this;if(!u)return h;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,f=>{t.pushPaintStyle(i,f,p),t.addText(e);let m=t.build();m.layout(o);let g=r;2===a?g+=(s-m.getHeight())/2:3===a&&(g+=s-m.getHeight()),u.drawParagraph(m,n,g),h=m.getHeight(),t.reset(),m.delete()},c),d.delete(),p.delete(),h}drawText(e,t){let i=0,n=this._fonts.get(t.font),{ctx:r,_paintFill:o,_paintStroke:s}=this;if(n&&r){let a=new Xt.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new Xt.ParagraphStyle({textStyle:a,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=Xt.XYWHRect(t.x,t.y,t.width,t.height),h=Xt.ParagraphBuilder.Make(l,n);o&&(i=this.drawTextInner(e,h,a,c,t.verticalAlign,o,!0)),s&&(i=this.drawTextInner(e,h,a,c,t.verticalAlign,s,!1)),h.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(e,t){this._currentPath?.moveTo(e,t)}lineTo(e,t){this._currentPath?.lineTo(e,t)}bezierCurveTo(e,t,i,n,r,o){this._currentPath?.cubicTo(e,t,i,n,r,o)}quadraticCurveTo(e,t,i,n){this._currentPath?.quadTo(e,t,i,n)}setTransform(e,t=!1){if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),n=hn.invert(i);if(n&&this.ctx.concat(n),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),t)){let r=hn.getScale(this.camera.worldMatrix);this.ctx?.scale(1/r[0],1/r[1])}this.ctx?.concat(e),this.currentTransform=e}transform(e){this.ctx?.concat(e)}setSize(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=Xt.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function FG(e){for(let t=0;t<e.length;t++)if(void 0!==e[t]&&!Number.isFinite(e[t]))return!1;return!0}function cy({r:e,g:t,b:i,a:n}){return Xt.Color4f(e,t,i,n)}var hy,yM,_M,BG=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=on.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){void 0!==e.color&&(this.color=e.color),void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.blurRadius&&(this.blurRadius=e.blurRadius),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.spread&&(this.spread=e.spread)}},VG=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.radius&&(this.radius=e.radius)}},co=class extends lo{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=on.transparent,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color)}}(e+"-fill",t.fill,i),this.stroke=new class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=on.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color),void 0!==e.thickness&&(this.thickness=e.thickness),void 0!==e.mode&&(this.mode=e.mode)}}(e+"-stroke",t.stroke,i),this.dropShadow=new BG(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new BG(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new VG(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new VG(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:on.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:on.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){e.layerBlur=this.layerBlur.enabled?5*this.layerBlur.radius:0,e.backgroundBlur=this.backgroundBlur.enabled?5*this.backgroundBlur.radius:0,this.dropShadow.enabled?(e.dropShadowBlur=5*this.dropShadow.blurRadius,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=on.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=5*this.innerShadow.blurRadius,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=on.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(yn(e.path,["fill"])?this.fill.update(e.props):yn(e.path,["stroke"])?this.stroke.update(e.props):yn(e.path,["dropShadow"])?this.dropShadow.update(e.props):yn(e.path,["innerShadow"])?this.innerShadow.update(e.props):yn(e.path,["layerBlur"])?this.layerBlur.update(e.props):yn(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new co(this.uuid,this.data,e);return t.parent=void 0,t}},gM=class extends co{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(e,t){return function hTe(e,t,i,n,r,o){let s=e-i,a=t-n;return s*s/(r*r)+a*a/(o*o)<=1}(e,t,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new gM(this.uuid,this.data,e);return t.parent=void 0,t}},D4=class extends co{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new D4(this.uuid,this.data,e);return t.parent=void 0,t}},vM=class extends co{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:on.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:on.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),n=2===t?i.toUpperCase():3===t?i.toLowerCase():i,{height:r}=e.drawText(n,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=r}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){void 0!==e.font&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new vM(this.uuid,this.data,e);return t.parent=void 0,t}},HG=class extends co{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){0===this.curves.length&&this.computeCurves();let e=this.curves.map(n=>hy.extremas(n)),t=[1/0,1/0],i=[-1/0,-1/0];for(let n=0,r=e.length;n<r;n++){let o=e[n];o[0][0]<t[0]&&(t[0]=o[0][0]),o[0][1]<t[1]&&(t[1]=o[0][1]),o[1][0]>i[0]&&(i[0]=o[1][0]),o[1][1]>i[1]&&(i[1]=o[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,n=this.data.points.length;i<n;i++){let r=this.data.points[i].data,o=this.data.points[i-1].data;this.curves.push({start:o.position,cp1:o.controlNext.position,cp2:r.controlPrevious.position,end:r.position})}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;this.data.isClosed&&this.curves.push({start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position})}getCenter(){let[e,t]=this.extremasBBox.min,[i,n]=this.getHalfSize();return[e+i,t+n]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[.5*(t[0]-e[0]),.5*(t[1]-e[1])]}innerDraw(e){for(let n=0,r=this.data.points.length;n<r;n++){let o=this.data.points[n].data;if(0===n){let[s,a]=o.position;e.moveTo(s,a)}else{let s=this.data.points[n-1].data,[a,l]=s.controlNext.position,[c,h]=o.controlPrevious.position,[u,d]=o.position;hy.derive({start:s.position,cp1:s.controlNext.position,cp2:o.controlPrevious.position,end:o.position}),e.bezierCurveTo(a,l,c,h,u,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[n,r]=i.controlNext.position,[o,s]=t.controlPrevious.position,[a,l]=t.position;e.bezierCurveTo(n,r,o,s,a,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new HG(this.uuid,this.data,e);return t.parent=void 0,t}};(e=>{function i(s,a,l,c=!1){let h=s-2*a+l;if(0!==h){let u=-Math.sqrt(Math.abs(a*a-s*l)),d=-s+a;return[-(u+d)/h,-(-u+d)/h]}return a!==l&&0===h?[(2*a-l)/(2*(a-l))]:[]}e.derive=function t(s){let a=s.start,l=s.cp1,c=s.cp2,h=s.end,f={start:[3*(l[0]-a[0]),3*(l[1]-a[1])],cp:[3*(c[0]-l[0]),3*(c[1]-l[1])],end:[3*(h[0]-c[0]),3*(h[1]-c[1])]};return s.derivative=f,f.derivative=yM.derive(f),f},e.droot=function n(s){let a=s.derivative??e.derive(s),l=a.start,c=a.cp,h=a.end;return[i(l[0],c[0],h[0]),i(l[1],c[1],h[1])]},e.extremas=function r(s){let[a,l]=e.droot(s),c=[s.start[0],s.end[0]],h=[s.start[1],s.end[1]];for(let u of a)c.push(e.compute(s,Math.min(1,Math.max(0,u)))[0]);for(let u of l)h.push(e.compute(s,Math.min(1,Math.max(0,u)))[1]);return c.sort((u,d)=>u-d),h.sort((u,d)=>u-d),[[c[0],h[0]],[c[c.length-1],h[h.length-1]]]},e.compute=function o(s,a){if(0===a)return[...s.start];if(1===a)return[...s.end];let l=1-a,c=l*l,h=a*a,u=c*l,d=c*a*3,p=l*h*3,f=a*h;return[u*s.start[0]+d*s.cp1[0]+p*s.cp2[0]+f*s.end[0],u*s.start[1]+d*s.cp1[1]+p*s.cp2[1]+f*s.end[1]]}})(hy||(hy={})),(e=>{e.derive=function t(r){let o=r.start,s=r.cp,a=r.end,h={start:[2*(s[0]-o[0]),2*(s[1]-o[1])],end:[2*(a[0]-s[0]),2*(a[1]-s[1])]};return h.derivative=_M.derive(h),r.derivative=h,h},e.droot=function i(r){let o=r.derivative??e.derive(r),s=o.start,a=o.end;return[s[0]!==a[0]?s[0]/(s[0]-a[0]):0,s[1]!==a[1]?s[1]/(s[1]-a[1]):0]},e.compute=function n(r,o){if(0===o)return[...r.start];if(1===o)return[...r.end];let s=1-o,a=s*s,l=o*o,h=s*o*2;return[a*r.start[0]+h*r.cp[0]+l*r.end[0],a*r.start[1]+h*r.cp[1]+l*r.end[1]]}})(yM||(yM={})),(e=>{e.derive=function t(n){let r=n.start,o=n.end;return n.derivative=[o[0]-r[0],o[1]-r[1]],n.derivative},e.compute=function i(n,r){if(0===r)return[...n.start];if(1===r)return[...n.end];let o=n.start,s=n.end;return[o[0]+(s[0]-o[0])*r,o[1]+(s[1]-o[1])*r]}})(_M||(_M={}));var fc=class extends pc{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new D4(e+"-background",Q2.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(e,t,i){super.updateWorldMatrix(e,t,i),this.background?.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur),void 0!==e.clipped&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(yn(e.path,["fill"])?this.fill.update(e.props):yn(e.path,["stroke"])?this.stroke.update(e.props):yn(e.path,["dropShadow"])?this.dropShadow.update(e.props):yn(e.path,["innerShadow"])?this.innerShadow.update(e.props):yn(e.path,["layerBlur"])?this.layerBlur.update(e.props):yn(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new fc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},_Te=Qc(eR(),1),uy=class extends co{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),void 0!==e.path&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new uy(this.uuid,this.data,e);return t.parent=void 0,t}},UG=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Mh(UG.GROUP_ID,{...v6.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,n,r,o){let s=function wTe(e,t,i){switch(t.type){case"ellipse2d":return new gM(e,t,i);case"rectangle2d":return new D4(e,t,i);case"text2d":return new vM(e,t,i);case"vector2d":return new HG(e,t,i);case"path2d":return new uy(e,t,i);case"frame2d":return new fc(e,t,i);default:return new Mh(e,t,i)}}(e,t,o);s&&(n.add(s),n.children.splice(r,0,n.children.pop()),s.updateWorldMatrix(),i.length>0&&(s instanceof Mh||s instanceof fc)&&this.createChildrenObjects(i,s,o))}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,n){let r=this.find(e);if(r)try{r.updateByOp(t,i,{shared:n})}catch(o){console.error(o)}}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this.group:this.find(e.parent);void 0!==i&&i instanceof pc&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(0===e.path.length&&8===e.type){let i=this.find(e.id);if(void 0!==i&&void 0!==i.parent&&i.parent instanceof pc){let n=i.parent;i.resetBBoxNeedsUpdate(),n?.remove(i),n?.requestRender()}}else if(0===e.path.length&&9===e.type){let i=this.find(e.id);if(void 0!==i){let n=i.parent,r=null===e.parent?this:this.find(e.parent);(r instanceof pc||r===this)&&(r.add(i),r.children.splice(e.localIndex,0,r.children.pop()),i.updateWorldMatrix(!0,!1,!0),n?.requestRender(),i.requestRender()),i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,n=!1,r=[]){return this.group.intersectsChildren(e,t,i,n,r,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this.group;){let r=n;n=n.parent;let o=n.children.indexOf(r);i.splice(0,0,o)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);void 0!==n&&t.push(n)}return t.sort((i,n)=>$V(i.sortKey,n.sortKey)),t.map(i=>i.entity)}},bM=UG;function jG({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:n,initialParentHeight:r,objectInitialWidth:o,objectInitialHeight:s,objectInitialPosition:a}){let{horizontalConstraint:l,verticalConstraint:c}=e,h=t-n,u=i-r,d=o,p=s,f=a[0],m=a[1];if(0!==l)if(1===l)f+=h;else if(3===l)f+=h/2;else if(2===l)d=Math.max(1,d+h);else if(4===l){let g=t/n;d*=g,f*=g}if(0!==c)if(1===c)m+=u;else if(3===c)m+=u/2;else if(2===c)p=Math.max(1,p+u);else if(4===c){let g=i/r;p*=g,m*=g}return{width:d,height:p,position:[f,m]}}bM.GROUP_ID="scene2d",Qc(eR(),1);var CTe=hn.identity(),YG=class{constructor(e,t,i,n){this.uuid=e,this.width=t,this.height=i,this.context=n,this.enabled=!0,this.isScreenSpace=!1,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this.onFrameOverrideObjectEvent=r=>{if(void 0!==r.target?.uuid){let o=this.frameRoot?.find(r.target.uuid);o&&o.dispatchEvent({...r,target:o})}},this.scene2d=new bM(et.generateUUID(),PC.defaultData,{dpr:window.devicePixelRatio,shared:n.shared}),this.canvas=document.createElement("canvas"),this.renderer=new RG(this.canvas),n.shared.addCanvas(this.uuid,this.canvas),this.textureHolder=n.shared.canvas(this.uuid),this.promise=this.init()}init(){var e=this;return(0,Dn.Z)(function*(){e.renderer instanceof RG&&(e.renderer.wasmURL=yY.skiaWasmUrl),yield e.renderer.init()})()}render(){this.isFrameDirty&&(this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),this.textureHolder?.setNeedsUpdate(!0),this.isFrameDirty=!1)}updateEntity2DByOp(e,t,i,n){this.scene2d.updateEntityByOp(e,t,i,n),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=e?.width??this.width,i=e?.height??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=CTe,this.isScreenSpace&&(this.frameOverride.fill.color=on.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},GG({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e){let t=e?.width??this.width,i=e?.height??this.height;this.width=t,this.height=i,this.renderer.dpr=this.isScreenSpace?window.devicePixelRatio:Math.floor(2048/Math.max(t,i)),this.renderer.setSize(t,i),this.textureHolder?.dispose(),this.applyOverrides(e),this.frameOverride?.requestRender()}applyFrame(e){let t=this.context.scene.find2D(e);if(t&&t instanceof fc)return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.textureHolder?.dispose(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(i=>{i.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(i=>{i.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frame?.requestRender(),t}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(e){return this.scene2d.find(e)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse(e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),this.frameOverride?.traverse(e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function GG({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:o}){if(e instanceof fc&&t instanceof fc||e instanceof Mh&&t instanceof Mh)for(let s=0,a=e.children.length;s<a;s++){let l=e.children[s],c=t.children[s];l&&c&&l.uuid===c.uuid&&MTe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:o})}}function MTe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:o}){let[s,a]=function STe(e){if(xM(e))return[e.width,e.height];if(e instanceof uy){let[t,i]=e.getHalfSize();return[2*t,2*i]}if(e instanceof Mh){let[t,i]=e.recursiveBBox.getHalfSize();return[2*t,2*i]}return[0,0]}(t),{width:l,height:c,position:h}=jG({constraints:e.data,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:o,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:t.position});if(e.position=h,e.data={...e.data,position:h},e.states)for(let u in e.states)zTe({stateId:u,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:o});xM(e)||e instanceof Mh?(xM(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),GG({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:s,initialParentHeight:a})):e instanceof uy&&(e.path=function bTe(e,t=1,i=1){return t<=0||i<=0?e:function xTe(e){let i,t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return e.map(n=>{let r=[];t.forEach(s=>{if(s in n){let a=1*n[s];r.length&&a>=0&&r.push(","),r.push(a)}});let o=(i===n.code?r[0]<0?"":",":n.code)+r.join("");return i=n.code,o}).join("")}((0,_Te.parseSVG)(e).map(r=>{let o={...r};return"x"in o&&(o.x=o.x*t),"y"in o&&(o.y=o.y*i),"x1"in o&&(o.x1=o.x1*t),"x2"in o&&(o.x2=o.x2*t),"y1"in o&&(o.y1=o.y1*i),"y2"in o&&(o.y2=o.y2*i),"rx"in o&&(o.rx=o.rx*t),"ry"in o&&(o.ry=o.ry*i),o}))}(t.path,0!==s?l/s:1,0!==a?c/a:1),e.data={...e.data,path:e.path})}function zTe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:o,initialParentHeight:s}){let a=t.states?.[e],l=i.states?.[e];if(a&&l){let{width:c,height:h,position:u}=jG({constraints:t.data,newParentWidth:n,newParentHeight:r,initialParentWidth:o,initialParentHeight:s,objectInitialWidth:r1.isResizeable(l)?l.width:0,objectInitialHeight:r1.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:u}),r1.isResizeable(a)&&Object.assign(t.states[e],{width:c,height:h})}}function xM(e){return e instanceof D4||e instanceof fc||e instanceof gM||e instanceof vM}var ho=class extends(qC(sh)){constructor(e,t,i){super(),this.data=t,this.bgColor=new Do(1,1,1,1),this.fog=null,this.backupFog=new NF(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Ct,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new $o(Df,{...W2.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new q4e(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new bM((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(e,t){this.uiCanvas=new YG(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{this.uiCanvas?.applyFrame(e),this.uiCanvas?.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=vs(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof m1&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof h0)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&((e="medium")=>{if(bG===e)return!1;bG=e;let t=(e=>{switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(e);oi.shadowmap_pars_fragment=(e=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${e};\nconst int gShadowSamples = ${e};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`)(t);let i=Kze.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),oi.lights_fragment_begin=i;let n=Jze.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),oi.shadowmask_pars_fragment=n,!0})(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){this.fog=e.enabled?this.backupFog:null,this.isActive&&(this.scene.fog=this.fog),this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=vs(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=vs(e.aoColor,t))}updateByOp(e,t,i,n){let r=this.data.uiFrame;super.updateByOp(e,t,i,n);let o=t;yn(e.path,["fog"])?this.updateFog(o.fog,i.shared):yn(e.path,["ao"])?this.updateAo(o.ao,i.shared):yn(e.path,["ambient"])?this.updateAmbientLight(o.ambient,i.shared):yn(e.path,["shadow"])?this.updateShadow(o.shadow):0===e.type&&0===e.path.length&&(void 0!==e.props.uiFrame||r!==o.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor(vs(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof MG&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize,e+=1),i instanceof DG&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let o=r.cloner;Ti.is(r)&&(r.visible||o?.object.data.visible)&&((fl(r)||JS(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),TM(r,e,t,!0)),i(r))}};return i(this),t}updateEntity2DByOp(e,t,i,n){this.uiCanvas?.updateEntity2DByOp(e,t,i,n)}},TTe=class extends(KS(Z4e,CG)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new T(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),o=new T(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),s=new dr(r,o),a=new g8(s,new Ct(16755200));a.visible=!1,this.gizmos.shadowmap=a,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof g8){let i=this.shadow.camera,n=new T(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),r=new T(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(n,r),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},ETe=class extends Xo{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?bS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},wM=class extends Xo{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){let t,e={...this.data.geometry.extrusion.shape};for(let n in e)"string"==typeof e[n]&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));if("Custom"===e.type){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let r=this._context.scene.find(n);r?.data&&(r.attachedPaths.add(this),t=r.geometry.userData?.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=mS;break;case"Ellipse":n=lS;break;case"Polygon":n=Cj;break;case"Star":n=Sj;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(n=>n.update()))}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?bS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},v0=class extends(d0(Ud,z4)){constructor(e,t,i){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let i=p6.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let n,r;for(let o of vu.rootOverrideProps)void 0===e[o]?(void 0===n&&(n={...e}),n[o]=i.data[o]):(void 0===r&&(r={}),r[o]=e[o],void 0===n&&(n={...e}),n[o]=du.apply(i.data[o],e[o]));return this.overrideData=r,n}return{...zo.defaultData,...e,...hh(zo.defaultData,vu.rootOverrideProps)}}updateByOp(e,t,i,n){let r;if(this.isInstanceRoot&&!n)if(t=this.transformAssignData(t,i),0===e.type&&0===e.path.length&&this.component)for(let o of vu.rootOverrideProps)o in e.props&&void 0===e.props[o]&&(void 0===r&&(r={...e,props:{...e.props}}),r.props[o]=this.component.data[o]);else if(0===e.type&&e.path.length>0&&vu.rootOverrideProps.includes(e.path[0])){let o=e.path[0];void 0===r&&(r={...e,path:[],props:{[o]:t[o]}})}super.updateByOp(r??e,t,i,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){let i=e.scene.find(t.component)??null,n=!1;if(i!==this.oldComponent){if(this.oldComponent){let r=0;for(let o of this.children){if(!Ti.is(o))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(o),CM(o),r+=1}this.children.splice(0,r)}n=!0}if(i){let r={};qG(e,[this.uuid],t.overrides,this,i,i,0,n,r);for(let o of this.children)if(Ti.is(o)){let s=o.data;"Empty"===s.type&&s.animations&&o.traverseEntity(a=>{if(a instanceof Xo&&a.isSkinnedMesh){let l=a.dataPatched;if(l.bones&&l.boneInverses){let c=l.bones.map(d=>e.scene.find(r[d])),h=l.boneInverses.map(d=>(new De).fromArray(d)),u=new Ix(c,h);a.bind(u,a.bindMatrix)}}else a.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function CM(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Ti.is(i)&&CM(i)}}function WG(e,t,i,n){return e.component===t&&YV(e.identity,n)?e.overrideData===i?2:1:0}function qG(e,t,i,n,r,o,s,a,l){if(s>50)return!1;if(n.component!==r){if(n.component){let h=n.component.instances.indexOf(n);h>=0&&n.component.instances.splice(h,1)}r.instances.find(h=>h===n)||r.instances.push(n),n.component=r}r instanceof v0&&r.isInstanceRoot&&r.expandInstanceChildren(e);let c=0;for(let h of r.children)if(Ti.is(h)){let u=[...t,..."string"==typeof h.identity?[h.identity]:h.identity],d=c6.resolve(i,u,1);null!=d&&!(d instanceof Ar)&&(Object.setPrototypeOf(d,Ar.prototype),console.error("wrong prototype"));let f,p=null;if(!a){let m=n.children[c];if(p=Ti.is(m)?m:null,null!==p){let g=WG(p,h,d,u);f=g>=1?p.stateSelection:void 0,2!==g&&(p=null)}if(null===p&&(p=e.scene.findInstance(u)??null,null!==p)){let g=WG(p,h,d,u);if(f=g>=1?p.stateSelection:void 0,2!==g)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),n.children.splice(c,0,p),p.parent===n?v<=c&&console.error("not possible"):(p.parent=n,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(null===p){let m=d?du.apply(h.data,d):h.data;Zd.is(m.type)&&(m={...m,type:"Empty"}),p=Mu.createEntity(u,m,e),p.overrideData=d,n.add(p),n.children.splice(n.children.length-1,1),n.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}p.isBone&&(l[p.identity[p.identity.length-1]]=p.uuid),c+=1,qG(e,t,i,p,h,o,s+1,a,l)}if(!a){let h=c;for(;;){let u=n.children[c];if(!Ti.is(u))break;e.pendingDeletes.add(u),c+=1}n.children.splice(h,c-h)}return!0}var DTe=class extends(d0(LF,z4)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},Zo=class extends Xo{constructor(e,t,i){super(e,t,i),this.onBeforeRender=()=>{this.uiCanvas.render()},this.uiCanvas=new YG(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),0===e.type&&(void 0!==e.props.frame&&this.applyFrame(e.props.frame,i.shared),(void 0!==e.props.width||void 0!==e.props.height)&&this.applySize(e.props,i.shared))}applySize(e,t){this.uiCanvas.applySize({width:e?.width??this.dataPatched.geometry.width,height:e?.height??this.dataPatched.geometry.height}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=f4(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,n){this.uiCanvas.updateEntity2DByOp(e,t,i,n),e===this.frameId&&0===t.type&&(void 0!==t.props.cornerRadius?this.applyGeometryParametersFromFrame(n):yn(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},Ao=new Co,dy=new T;function XG(e,t){let i=e,n=new Float32Array(4*t*t);for(let o=0;o<t*t;o++)n[4*o]=i[3*o],n[4*o+1]=i[3*o+1],n[4*o+2]=i[3*o+2],n[4*o+3]=0;let r=new wa(n,t,t,no,zr);return r.needsUpdate=!0,r}var $G="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",GTe=`\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  \n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n\n  ${$G}\n`,qTe="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+$G+"  \n  \nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n\n\n",$Te=class extends qi{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],To.startContext(To.globalContext),this.lightLayer=new lc(0,"",{...ao.defaultData("light","phong"),visible:!1},new DS,{},t.shared),To.endContext(To.globalContext),this.build()}updateState(e){void 0!==e.coloring&&(this.isColoringRandom="random"===e.coloring),void 0!==e.color&&(this.uniforms.uColor.value=e.color instanceof Array?e.color:this.context.shared.color(e.color)),void 0!==e.color2&&(this.uniforms.uColor2.value=e.color2 instanceof Array?e.color2:this.context.shared.color(e.color2)),void 0!==e.size&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],this.useSizeEnd=e.size[0]!==e.size[1]),void 0!==e.ease&&(this.easeOpacity=e.ease,this.build()),void 0!==e.easeSize&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new Xj;return e.needsJitter=this.needsJitter,e.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(GTe),e.addFragmentParsCode(qTe),e.addVertexFinalCode((({easeSize:e="linearFadeOut"})=>`\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ${e}(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n`)({easeSize:this.easeSize})),e.addFragmentFinalCode((({easeOpacity:e="linearFadeOut"})=>`  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ${e}(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n`)({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},SM=class{constructor(e,t,i,n){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=function OTe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}(t),this.targetMesh="Mesh"===n?.type&&n?n:this.getMesh(i,1);let{positions:o,dataTexture:s,dataTextureNormals:a}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,1));this.positionsTexture=s,this.positionsAttribute=o,this.directionsTexture=a}createPositions(e,t){let{positions:i,normals:n}=function kTe(e,t){let i=new Dr(e.geometry,e.material),n=[],r=[],o=new T,s=new T;null!==i.geometry.index&&(i.geometry=i.geometry.toNonIndexed());let a=new class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let o=1;t&&(o=t.getX(r)+t.getX(r+1)+t.getX(r+2)),Ao.a.fromBufferAttribute(e,r),Ao.b.fromBufferAttribute(e,r+1),Ao.c.fromBufferAttribute(e,r+2),o*=Ao.getArea(),i[r/3]=o}this.distribution=new Float32Array(e.count/3);let n=0;for(let r=0;r<i.length;r++)n+=i[r],this.distribution[r]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,e,t,i)}binarySearch(e){let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let o=Math.ceil((i+n)/2);if(0===o||t[o-1]<=e&&t[o]>e){r=o;break}e<t[o]?n=o-1:i=o+1}return r}sampleFace(e,t,i,n){let r=this.randomFunction(),o=this.randomFunction();return r+o>1&&(r=1-r,o=1-o),Ao.a.fromBufferAttribute(this.positionAttribute,3*e),Ao.b.fromBufferAttribute(this.positionAttribute,3*e+1),Ao.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Ao.a,r).addScaledVector(Ao.b,o).addScaledVector(Ao.c,1-(r+o)),void 0!==i&&Ao.getNormal(i),void 0!==n&&void 0!==this.colorAttribute&&(Ao.a.fromBufferAttribute(this.colorAttribute,3*e),Ao.b.fromBufferAttribute(this.colorAttribute,3*e+1),Ao.c.fromBufferAttribute(this.colorAttribute,3*e+2),dy.set(0,0,0).addScaledVector(Ao.a,r).addScaledVector(Ao.b,o).addScaledVector(Ao.c,1-(r+o)),n.r=dy.x,n.g=dy.y,n.b=dy.z),this}}(i).build();for(let h=0;h<t;h++)a.sample(o,s),n.push(o.x,o.y,o.z),r.push(s.x,s.y,s.z);return{positions:new Float32Array(n),normals:new Float32Array(r)}}(t,e*e);return{dataTexture:XG(i,e),positions:i,dataTextureNormals:XG(n,e)}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":i=new ff(.5*t,32,32);break;case"TorusEmitterShape":i=new rB(.5*t,.3,15,40);break;case"ConeEmitterShape":i=new Vx(t,t,15);break;case"BoxEmitterShape":i=new rl(t,t,t);break;case"PlaneEmitterShape":i=new Bd(t,t),i.rotateX(-Math.PI/2);break;default:i=new ff(t,32,32)}return new Dr(i,new Rd({color:16711680}))}applyToShader(e,t){this.size=(new T).fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function A4(e){let t={...e},i=n6.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let n={...i.shape,...t.shape},r={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:n,renderMaterial:r}}var ZTe=class extends en{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new W4e,this.currentWorldPosition=new T,this.systemQuaternion=new qt,this.worldGravity=new T(0,0,0),this.directionAxis=new T(0,0,0),this.colliderV3=new T(0,0,0),this.colliderQuaternion=new qt(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new $Te(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new T(0,0,0)},uEmissionData:{value:new T(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new T(0,0,0)},uWorldQuaternion:{value:new Ut(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if("string"==typeof t){let n=this.shared.image(t),r=new Zn(n.img);return r.needsUpdate=!0,void(e.uTexture.value=r)}if("string"!=typeof i){let n=new Image;n.onload=()=>{let s=new Zn(n);s.needsUpdate=!0,e.uTexture.value=s};let r=new Blob([i],{type:"image/*"}),o=URL.createObjectURL(r);n.src=o}}updateGeometryAttributes(e,t){let i=function ITe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let n=0;n<e;n++){let r=i*e+n;t[2*r+0]=i/(e-1),t[2*r+1]=n/(e-1)}return t}(t);!this.emitterShape?.positionsAttribute||e.geometry.setAttribute("ref",new b2(i,2))}applyWorldSpace(){if(!(this.system.started&&this.worldSpace&&this.positionSimRT&&this.velocitySimRT))return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let r=this.previousRatio+(this.targetFPS/(1e3/t)-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=r,this.previousRatio=r;let o=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=o,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0];e&&(e.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3),this.colliderV3.fromArray(e.data.size),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert()))}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===t[2]&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===t[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(n,r)=>{let o=[...this.system.data.shape.size];o[n]=r,this.updateParticleState({shape:{...this.system.data.shape,size:o}})};"shape_size_0"===t[2]&&i(0,e),"shape_size_1"===t[2]&&i(1,e),"shape_size_2"===t[2]&&i(2,e),"speed"===t[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/10),"gravity"===t[2]&&this.worldGravity.set(0,e/100,0),"noiseStrength"===t[2]&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===t[2]&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===t[2]&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),"direction_z"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(this.positionSimRT&&this.velocitySimRT){if(this.shouldReInitGPUCompute(e)&&this.init(A4(this.system.data)),void 0!==e.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),void 0!==e.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10),void 0!==e.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),void 0!==e.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==e.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==e.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),void 0!==e.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),void 0!==e.renderMaterial?.size){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(void 0!==e.renderMaterial?.spriteRotation&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),void 0!==e.shape){let t=e.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],n={...A4(this.system.data).shape,size:i};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,n)}if(void 0!==e.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==e.direction){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==e.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),void 0!==e.randomScale&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(void 0!==e.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),void 0!==e.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*et.DEG2RAD,Number(e[1])*et.DEG2RAD,Number(e[2])*et.DEG2RAD],i=new Ur(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:n,shape:r,emitTimeDuration:o,emitTimeCycle:s,life:a,directionMode:l,noiseType:c}=e;return void 0!==t||void 0!==i||n||null===n||void 0!==s||void 0!==r||void 0!==a||void 0!==o||void 0!==l||void 0!==c}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:"infinity"===e.emitTimeCycle?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(e);clearInterval(t)}},100);if(!this.emitterShape)return;let i=new class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let n=zr,r=new sh,o=new Fd;o.position.z=1;let s={passThruTexture:{value:null}},a=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",s),l=new Dr(new Bd(2,2),a);function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(p,f){let m=new qi({uniforms:f=f||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:p});return c(m),m}r.add(l),this.setDataType=function(p){return n=p,this},this.addVariable=function(p,f,m){let v={name:p,initialValueTexture:m,material:this.createShaderMaterial(f),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Gi,magFilter:Gi};return this.variables.push(v),v},this.setVariableDependencies=function(p,f){p.dependencies=f},this.init=function(){if(!1===i.capabilities.isWebGL2&&!1===i.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let f=this.variables[p];f.renderTargets[0]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),f.renderTargets[1]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),this.renderTexture(f.initialValueTexture,f.renderTargets[0]),this.renderTexture(f.initialValueTexture,f.renderTargets[1]);let m=f.material,g=m.uniforms;if(null!==f.dependencies)for(let v=0;v<f.dependencies.length;v++){let y=f.dependencies[v];if(y.name!==f.name){let _=!1;for(let b=0;b<this.variables.length;b++)if(y.name===this.variables[b].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+f.name+", dependency="+y.name}g[y.name]={value:null},m.fragmentShader="\nuniform sampler2D "+y.name+";\n"+m.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,f=0===this.currentTextureIndex?1:0;for(let m=0,g=this.variables.length;m<g;m++){let v=this.variables[m];if(null!==v.dependencies){let y=v.material.uniforms;for(let _=0,b=v.dependencies.length;_<b;_++){let x=v.dependencies[_];y[x.name].value=x.renderTargets[p].texture}}this.doRenderTarget(v.material,v.renderTargets[f])}this.currentTextureIndex=f},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let f=0;f<p.length;f++){let m=p[f];m.initialValueTexture&&m.initialValueTexture.dispose();let g=m.renderTargets;for(let v=0;v<g.length;v++)g[v].dispose()}},this.addResolutionDefine=c,this.createShaderMaterial=h,this.createRenderTarget=function(p,f,m,g,v,y){return new Wi(p=p||e,f=f||t,{wrapS:m=m||Rn,wrapT:g=g||Rn,minFilter:v=v||Gi,magFilter:y=y||Gi,format:no,type:n,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),f=new wa(p,e,t,no,zr);return f.needsUpdate=!0,f},this.renderTexture=function(p,f){s.passThruTexture.value=p,this.doRenderTarget(a,f),s.passThruTexture.value=null},this.doRenderTarget=function(p,f){let m=i.getRenderTarget(),g=i.xr.enabled,v=i.shadowMap.autoUpdate,y=i.outputEncoding,_=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=el,i.toneMapping=Hl,l.material=p,i.setRenderTarget(f),i.render(r,o),l.material=a,i.xr.enabled=g,i.shadowMap.autoUpdate=v,i.outputEncoding=y,i.toneMapping=_,i.setRenderTarget(m)}}}(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),n=this.updateSimulationDefinition(e),r=i.addVariable("uCurrentPosition",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),o=i.addVariable("uCurrentVelocity",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          float offset = 0.0;\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), offset);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          float offset = 0.0;\n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      \n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n\n      // ATTRACTION\n      \n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n  \n      // VORTEX\n      \n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n",this.emitterShape.directionsTexture),s=i.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function LTe(e){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=0,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new wa(t,e,e,no,zr);return i.needsUpdate=!0,i}(this.emitterShape.textureSize));i.setVariableDependencies(r,[r,o,s]),i.setVariableDependencies(o,[r,o,s]),i.setVariableDependencies(s,[r,o,s]);let a=function NTe({size:e}){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=n,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new wa(t,e,e,no,zr);return i.needsUpdate=!0,i}({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new T(0,0,0)},uWorldQuaternion:{value:new Ut(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new T(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let h=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),u={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Ut(0,0,0,1)},uColliderPos:{value:new T(0,0,0)},uColliderSize:{value:new T(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new Ut(0,0,0,1)},uColliderQuaternionInvert:{value:new Ut(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10}};o.material.uniforms=u,s.material.uniforms={uIndex:{value:a},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...A4(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=r,this.velocitySimRT=o,this.emissionRateSimRT=s,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){return[Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let n=i?.colliderType;"sphere"===n&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===n&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===i?.forceRange&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===e.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===e.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===e.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===e.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,n]of Object.entries(this.simFeaturesDefinition))n&&(t+=`#define ${i}\n`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new T(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===e.type){let n=null;return this.system.context.scene.traverseEntity(r=>{r.uuid===e.fromMeshId&&(n=r)}),n?new SM(i,t,e.type,n):new SM(i,t,"SphereEmitterShape")}return new SM(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new s4e(new Bd(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,n=1/t;if(i>=n){let r=Math.max(1,Math.floor(i/n));return this.lastEmitTime=e,this.emittedParticlesAmount+r>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=r,r}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(A4(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},py=class extends fs{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new gt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=n=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(n))},this.context=i,this.data={...t,...A4(t)},this.geometry.setAttribute("position",new Ke([],3)),this.material=new Rd({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new ZTe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t="one_time"===this.data.emitTimeCycle;("loop"===this.data.emitTimeCycle||t)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),t||this.start("start"===this.data.emitTimeLoopDelayStart?0:1e3*this.data.emitTimeDelay))),this.emitter&&this.started&&this.emitter.update(this.actualTime/1e3,e),this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),yn(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...oo.drop(e,1).props}}),yn(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...oo.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(null!=e.colliderEntityId){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}null===e.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){this.currentLoopTime=0,e?setTimeout(()=>{this.start(0)},e):(this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting()}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function zM(e,t,i){return console.assert(void 0!==t.type),"Mesh"===t.type?function KTe(e,t,i){let n;return"TextGeometry"===t.geometry.type?new eG(e,t,i):(n="SubdivGeometry"===t.geometry.type?new x4(e,t,i):"PathGeometry"===t.geometry.type?new wM(e,t,i):"VectorGeometry"===t.geometry.type?new ETe(e,t,i):"BooleanGeometry"===t.geometry.type?new m1(e,t,i):"UIGeometry"===t.geometry.type?new Zo(e,t,i):new Xo(e,t,i),n)}(e,t,i):"Empty"===t.type?new m0(e,t):"Particle"===t.type?new py(e,t,i):"ParticleCollider"===t.type?new ty(e,t,i):"Splat"===t.type?new m0(e,t):"Bone"===t.type?new DTe(e,t):"Page"===t.type?new ho(e,t,i):"PointLight"===t.type?new TTe(e,t,i):"SpotLight"===t.type?new DG(e,t,i):"DirectionalLight"===t.type?new MG(e,t,i):"Component"===t.type||"Instance"===t.type?new v0(e,t,i):Zd.is(t.type)?new $o(e,t):(console.error(t),new m0(e,t))}function QG(e,t){let i=!1,n=t.getLayersOfType("transmission"),r=t.getLayersOfType("outline");return r.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,US(e),HS(e)),0===n.length&&0===r.length&&e.layers.set(0),e instanceof h0&&e.needsAO&&e.layers.enable(5),i}function ZG(e,t){if(!t.layers)return!1;let i=!1,n=t.getLayersOfType("transmission").filter(o=>o.data.visible),r=t.getLayersOfType("outline").filter(o=>o.data.visible);return n.length>0&&(e.layers.set(3),r.length>0&&e.layers.enable(8),i=!0),0===n.length&&0===r.length&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}Mu.createEntity=zM,Mu.changeEntityProptotype=function JTe(e,t,i){let n=zM(e.identity,t,i),r=e.children,o=e.attachedPaths,s=e.parent,a=e.component,l=e.instances,c=e.overrideData,h=e.uuid,u=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let d of Object.keys(n))e[d]=n[d];e.children=[...e.children,...r],e.attachedPaths=o,e.parent=s,e.component=a,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,i),u&&e.changeSelectedState(u,i),e.resetBBoxNeedsUpdate()},Mu.Cloner=dl;var nEe=new yB,rEe=new De,oEe=new Xp;function TM(e,t,i,n=!1){let r=e.cloner;if(r)for(let o of r.children){let s=rEe.copy(o.matrixWorld).invert(),a=oEe.copy(t.ray).applyMatrix4(s);a.applyMatrix4(e.matrixWorld);let c=nEe;c.set(a.origin,a.direction),c.near=t.near,c.far=t.far;let h=c.intersectObject(e,!1);h.length>0&&i.push({...h[0],object:n?o:e})}}var ku=class{};function lEe(e){let t,i,n,r,o,s,a,l,c,h,u,d,p,f,m,g;function y(E,D,P){let I=new Float32Array(h,o,3*i);n=0;let B=new Uint32Array(h,r,i);for(let V=0;V<P.length-1;V++){let R=D[V],N=E[V].elements,W=R.filter(G=>G.enabled&&"Include"===G.mode).map(G=>"Box"===G.type?w(G):M(G)),Q=R.filter(G=>G.enabled&&"Exclude"===G.mode).map(G=>"Box"===G.type?w(G):M(G));for(let G=P[V];G<P[V+1];G++){let Y=p[3*G],J=p[3*G+1],q=p[3*G+2];if((0===W.length||b(Y,J,q,W))&&(0===Q.length||!b(Y,J,q,Q))){let ee=1/(N[3]*Y+N[7]*J+N[11]*q+N[15]);I[3*n]=(N[0]*Y+N[4]*J+N[8]*q+N[12])*ee,I[3*n+1]=(N[1]*Y+N[5]*J+N[9]*q+N[13])*ee,I[3*n+2]=(N[2]*Y+N[6]*J+N[10]*q+N[14])*ee,B[n]=G,n++}}}}function b(E,D,P,I,B){return I["Intersect"===B?"every":"some"](V=>{let R=function x(E,D,P,I,B){let V=E-B[0],R=D-B[1],N=P-B[2],W=1/(I[3]*V+I[7]*R+I[11]*N+I[15]);return{x:(I[0]*V+I[4]*R+I[8]*N+I[12])*W+B[0],y:(I[1]*V+I[5]*R+I[9]*N+I[13])*W+B[1],z:(I[2]*V+I[6]*R+I[10]*N+I[14])*W+B[2]}}(E,D,P,V.invRotationMatrix,V.cropCenter);return Array.isArray(V)?function C(E,D,P,I){return E>=I[0]&&E<=I[3]&&D>=I[1]&&D<=I[4]&&P>=I[2]&&P<=I[5]}(R.x,R.y,R.z,V):function z(E,D,P,I){let B=(E-I.cropCenter[0])*I.invRadiusX,V=(D-I.cropCenter[1])*I.invRadiusY,R=(P-I.cropCenter[2])*I.invRadiusZ;return B*B+V*V+R*R<=1}(R.x,R.y,R.z,V)})}function w(E){let D=E.cropSize[0]/2,P=E.cropSize[1]/2,I=E.cropSize[2]/2,B=[E.cropCenter[0]-D,E.cropCenter[1]-P,E.cropCenter[2]-I,E.cropCenter[0]+D,E.cropCenter[1]+P,E.cropCenter[2]+I],V=S(E.cropRotation);return Object.assign(B,{invRotationMatrix:V,cropCenter:E.cropCenter})}function S(E){let D=[],P=E[0]*Math.PI/180,I=E[1]*Math.PI/180,B=E[2]*Math.PI/180,V=Math.cos(P),R=Math.sin(P),N=Math.cos(I),W=Math.sin(I),Q=Math.cos(B),G=Math.sin(B),Y=V*Q,J=V*G,q=R*Q,ee=R*G;return D[0]=N*Q,D[1]=-N*G,D[2]=W,D[4]=J+q*W,D[5]=Y-ee*W,D[6]=-R*N,D[8]=ee-Y*W,D[9]=q+J*W,D[10]=V*N,D[12]=0,D[13]=0,D[14]=0,D[3]=0,D[7]=0,D[11]=0,D[15]=1,D}function M(E){let D=2/E.cropSize[0],P=2/E.cropSize[1],I=2/E.cropSize[2],B=S(E.cropRotation);return{invRadiusX:D,invRadiusY:P,invRadiusZ:I,cropCenter:E.cropCenter,invRotationMatrix:B}}e.onmessage=E=>{if(E.data.getCroppedIndexes){let D=new Uint32Array(function _(E,D){let P=[],I=D.filter(R=>R.enabled&&"Include"===R.mode).map(R=>"Box"===R.type?w(R):M(R)),B=D.filter(R=>R.enabled&&"Exclude"===R.mode).map(R=>"Box"===R.type?w(R):M(R)),V=E.length;for(let R=0;R<V;R+=3){let N=E[R],W=E[R+1],Q=E[R+2];(0===I.length||b(N,W,Q,I))&&(0===B.length||!b(N,W,Q,B))||P.push(R/3)}return P}(new Float32Array(E.data.positions),E.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:D},[D])}else if(E.data.positions)u=E.data.positions,p=new Float32Array(u),m=E.data.meshMatrixWorlds,g=E.data.cropsArray,f=E.data.meshIndexIntervals,y(m,g,f),e.postMessage({sortSetupComplete:!0});else if(E.data.sort||E.data.newMatrixWorlds||E.data.newCropsArray)(E.data.newMatrixWorlds||E.data.newCropsArray)&&(g=E.data.newCropsArray||g,m=E.data.newMatrixWorlds||m,y(m,g,f)),function v(E){let P,D=new Float64Array(h,s,16);for(let I=0;I<16;I++)D[I]=E[I];if(n>1){t.exports.sortIndexes(r,o,c,s,a,l,d.DepthMapRange,n);let I=new Uint32Array(n);P=I.buffer,I.set(new Uint32Array(h,l,n))}else if(1===n){let I=new Uint32Array(n);I[0]=new Uint32Array(h,r,i)[0],P=I.buffer}else P=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:P},[P])}(E.data.sort.view);else if(E.data.init){d=E.data.init.Constants,i=E.data.init.splatCount;let D=d.BytesPerInt,P=3*d.BytesPerFloat,I=new Uint8Array(E.data.init.sorterWasmBytes),Q=Math.floor((i*(D+P)+(i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2)+32*d.MemoryPageSize)/d.MemoryPageSize)+1,G={module:{},env:{memory:new WebAssembly.Memory({initial:2*Q,maximum:3*Q,shared:!0})}};WebAssembly.compile(I).then(Y=>WebAssembly.instantiate(Y,G)).then(Y=>{t=Y,r=0,o=i*D,s=o+i*P,c=s+16*d.BytesPerFloat*2,a=c+i*d.BytesPerInt,l=a+d.DepthMapRange*d.BytesPerInt,h=G.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}r2(ku,"DepthMapRange",65536),r2(ku,"MemoryPageSize",65536),r2(ku,"BytesPerFloat",4),r2(ku,"BytesPerInt",4);var EM=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),hEe=function(e,t,i,n){return e+(t<<8)+(i<<16)+(n<<24)},fy=new $;function KG(e){let t=!1;return e.scene.objects.traverse((i,n)=>{if(!1===n.visible)return!0;"Splat"===n.type&&(t=!0)}),t}var JG,gy,tW,my=class extends Dr{constructor(e,t,i,n,r=!1,o=1,s,a){super(i,n),this.splatCount=t,this.meshIndexIntervals=s,this.meshMatrixWorlds=a,this.splatBuffers=e,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=o,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,n=1,r,o){let s=my.buildGeomtery(t),a=my.buildMaterial(r);return new my(e,t,s,a,i,n,r,o)}static buildMaterial(e){let n={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new $},viewport:{type:"v2",value:new $},basisViewport:{type:"v2",value:new $},debugColor:{type:"v3",value:new Ct},covariancesTextureSize:{type:"v2",value:new $(1024,1024)},centersColorsTextureSize:{type:"v2",value:new $(1024,1024)},orthoZoom:{type:"f",value:-1}};return new qi({uniforms:n,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:zd,depthTest:!0,depthWrite:!1,side:As})}static buildGeomtery(e){let t=new gt;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new It(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=(new mB).copy(t),o=new Uint32Array(e),s=new b2(o,1,!1);return s.setUsage(35048),r.setAttribute("splatIndex",s),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(n=>n.buildPreComputedBuffers()),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let e=0,t=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(e,e+4*r).set(n.colorsA),e+=4*r,this.centers.subarray(t,t+3*r).set(n.decoded.xyz.denormDequant().data),t+=3*r,this.covariances.subarray(i,i+6*r).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new $(4096,1024);for(;t.x*t.y*2<6*e;)t.y*=2;let n,r,i=new $(4096,1024);for(;i.x*i.y*4<4*e;)i.y*=2;if(this.halfPrecisionCovariancesOnGPU){r=new Uint16Array(t.x*t.y*2);for(let h=0;h<this.covariances.length;h++)r[h]=x3e.toHalfFloat(this.covariances[h]);n=new wa(r,t.x,t.y,xv,Dd)}else r=new Float32Array(t.x*t.y*2),r.set(this.covariances),n=new wa(r,t.x,t.y,xv,zr);n.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=n,this.material.uniforms.covariancesTextureSize.value.copy(t);let o=new Uint32Array(i.x*i.y*4);for(let h=0;h<e;h++){let u=4*h,d=3*h,p=4*h;o[p]=hEe(this.colors[u],this.colors[u+1],this.colors[u+2],this.colors[u+3]),o[p+1]=EM(this.centers[d]),o[p+2]=EM(this.centers[d+1]),o[p+3]=EM(this.centers[d+2])}let s=new wa(o,i.x,i.y,pR,Kc);s.internalFormat="RGBA32UI",s.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=s,this.material.uniforms.centersColorsTextureSize.value.copy(i);let l=new Float32Array(4096);for(let h=0;h<this.meshMatrixWorlds.length;h++)l.set(this.meshMatrixWorlds[h].elements,16*h);let c=new wa(l,1024,1,no,zr);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:r,texture:n,size:t},centerColors:{data:o,texture:s,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,n){this.splatCount>0&&(fy.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(fy),this.material.uniforms.basisViewport.value.set(2/fy.x,2/fy.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},uEe=new Promise(e=>{JG=e}),eW=!1;function dEe(){if(!eW)return gy||(gy=function e(){return t.apply(this,arguments)}(),gy);function t(){return(t=(0,Dn.Z)(function*(){let i=yield mn.e(492).then(mn.bind(mn,666));JG(i),eW=!0})).apply(this,arguments)}}uEe.then(e=>tW=e);var DM=new Rd;DM.wireframe=!0;var iW=new T,AM=class extends sh{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,n)=>{let r=[n,i],o=i;for(;this._constraints.has(o);)o=this._constraints.get(o),t.has(o)||r.push(o);for(let s=r.length-2;s>=0;s--)if(!t.has(r[s])){let a=e.find(r[s]);a?a.applyPathSnapping(e):console.warn(`missing entity ${r[s]}`),t.add(r[s])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},this.invisibleObjects=new m0("jflkdsafjasdifjaslk",{...yC.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new ho("fdasfa",{...Rf.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function iEe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof h0)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)ZG(i,i.material[n])&&(t=!0);else ZG(i,i.material)&&(t=!0)}),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function tEe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof h0)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)QG(i,i.material[n])&&(t=!0);else QG(i,i.material)&&(t=!0)}),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof ho&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this;){let r=n;n=n.parent;let o=n.children.indexOf(r);i.splice(0,0,o)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);void 0!==n&&t.push(n)}return t.sort((i,n)=>$V(i.sortKey,n.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(void 0===i)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e)return this.activePage.personalCamera;if(e===Df)return this.activePage.personalCamera}if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof ho&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof ho&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{void 0===t&&i instanceof Zo&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof ho&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{e.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){1===e.path.length&&"components"===e.path[0]&&1===e.type&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this:this.find(e.parent);if(void 0===i)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),fl(n)&&Ch(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(0===e.path.length&&8===e.type){let i=this.find(e.id);if(void 0===i)throw new Error("unexpected");this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),Ch(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),fl(i)&&(i.freeBooleanPointer(),n instanceof m1&&n.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof wM&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid),i.updatePathSnapping()}else if(0===e.path.length&&9===e.type){let i=this.find(e.id);if(void 0===i)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),i.cloner?.resetOnMove(),this.markToExpandCloner(i);let r=null===e.parent?this:this.find(e.parent);if(void 0===r)throw new Error("unexpected");r.add(i),this.markNeedsRecomputeInstancesForAncessors(r),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(this),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty(),r.children.splice(e.localIndex,0,r.children.pop()),fl(i)&&(i.invalidateUpstreamBooleanData(),Ch(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof m1&&n.invalidateDownstreamBooleanData().recomputeBoolean()),i.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof ho&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(e,t,i,n){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:o}=t.props;t={...t,props:o},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{(function eEe(e,t,i,n){e.updateByOp(t,i,n,!1)})(r,t,i,{scene:this,shared:n}),r instanceof Xo&&r.updateGeometryGroupsIfNeeded()}catch(o){console.error(o)}}updateEntity2DByOp(e,t,i,n,r,o=[]){e.updateEntityByOp(t,i,n,r),this.traverseEntity(s=>{(s instanceof Zo||s instanceof ho)&&(o.includes(s.frameId??"")||s.frameId===t)&&s.updateEntity2DByOp(t,i,n,r)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((n,r)=>({data:n[1].asset.data,children:n[1].asset.children,id:n[0],fi:r}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(n=>{n instanceof $o&&n.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{("Component"===t.data.type||"Instance"===t.data.type)&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Ti.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Ti.is(t)&&"Component"===t.data.type&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,n,r,o,s){if(e){let a=n.find(e);a&&a!==n&&r.forInstancesRec(l=>{l.data=j2(l.data,c=>{let h=c.events.data(s.id),u=l.goUp(o);if(u){let d=[...XV(u.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid;Mo.zoom(h,t)[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,n,r,o){e.forEach(s=>{("Transition"===s.data.type||"Animation"===s.data.type)&&this.relativeizeInner(s.data.object,[...t,s.id],"object",i,n,r,o)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof v0&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity((t,i)=>{t.data.events.forEach(n=>{if("GameControl"===n.data.type){let r=!1;if(t.forInstancesRec(o=>{o.data=j2(o.data,s=>{o.isInstanceRoot||(s.events.delete(n.id),r=!0)}).data}),!1===r)for(let o of u6.list)this.rewriteActions(n.data.gameActions[o],["gameActions",o],e,t,i,n)}else"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,i,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,i,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,n)),this.rewriteActions(n.data.inActions,["inActions"],e,t,i,n),this.rewriteActions(n.data.outActions,["outActions"],e,t,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],e,t,i,n)})}),!0})}expandInstances(e,t,i){let n=new Set;this.traverseEntity(r=>{if(r instanceof v0&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:n}),t||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity(o=>{i.addClip(o)}),!0});for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),CM(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof v0&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i="string"==typeof t.identity?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Ti.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],n=r=>{for(let o of r.children){let s=o.cloner;if(Ti.is(o)&&!o.raycastLock&&(o.visible||s?.object.data.visible))if(!0===t&&o.isInstanceRoot){let a=[];if(e.intersectObject(o,!0,a),a.length){let l=a[0];l.object=o,l.point.applyMatrix4(l.object.matrixWorld);let c=o.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(fl(o)||JS(o)&&this.enableHelpers&&o.objectHelper.visible)&&(e.intersectObject(o,!1,i),TM(o,e,i)),n(o)}};return n(this.activePage),i}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let o=r.cloner;Ti.is(r)&&(r.visible||o?.object.data.visible)&&((fl(r)||JS(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),TM(r,e,t,!0)),i(r))}};return i(this),t}forEachEntity(e){for(let t of this.children)Ti.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Ti.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Ti.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Xo&&"Mesh"===i.data.type&&"TextGeometry"===i.data.geometry.type&&i.data.geometry.font===e){let n=i.geometry,r=i.data.geometry;n.updateFont(e,t).then(()=>{n.update(r);let o=i.invalidateDownstreamBooleanData();Ch(o)&&o.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)c4.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Ti.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,n,r,o){let s={scene:this,shared:o},a=zM(e,t,s);return a&&(this.entityByUuid[e]=a,n.add(a),n.children.splice(r,0,n.children.pop()),i.length>0&&(a.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,a,o)),a.updateState(t,s),a instanceof Xo&&a.updateGeometryGroupsIfNeeded(),a.updateVisible(this),a.cloner&&this.toExpandCloner.add(a),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&a.traverseEntity(l=>{let c=l.dataPatched;if(l instanceof Xo&&c.bones&&c.boneInverses){let h=c.bones.map(p=>this.find(p)),u=c.boneInverses.map(p=>(new De).fromArray(p)),d=new Ix(h,u);l.bind(d,l.bindMatrix)}else l.matrixAutoUpdate=!0}),a}getCenter(e){let t=[];for(let n=0,r=e.length;n<r;++n){let{id:o,recursive:s}=e[n],a=this.find(o);t.push(...(s?a.recursiveBBox:a.singleBBox).vertices)}let i=new dr;return i.setFromPoints(t),i.getCenter(iW),iW}copyMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e)?.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof fs)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Au&&e(t.material[i]);else t.material instanceof Au&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(n=>{n instanceof $o&&n.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new class{constructor(e={}){r2(this,"updateView",function(){let t=new De,i=[],n=new T(0,0,-1),r=new T(0,0,-1),o=new T,s=new T;return function(a=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),h=this.cropsChanged();if(!a){r.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(r.dot(n)<=.95&&(d=!0),s.copy(l.position).sub(o).length()>=1&&(p=!0),!(d||p||c||h||this.needsInitialRender))return}this.needsInitialRender=!1,o.copy(l.position),n.copy(r),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let u={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...h?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=u:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(u))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new De).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new $;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=(new T).fromArray(e.position)),e.orientation&&(e.orientation=(new qt).fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(o=>{"Splat"===o.data.type&&t.push(o)}),this.splatMesh&&this.splatMesh.dispose(),0===t.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(o=>o.matrixWorld),this.meshMatrixWorldsOld=t.map(o=>o.matrixWorld.clone()),this.cropsArray=t.map(o=>o.data.crops.map(s=>s.data));let i=t.map(o=>new tW.GSplineBuffer(new Uint8Array(o.data.buffer).buffer)),n=0,r=[0];for(let o of i)n+=o.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,16*t);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{t.data.crops.forEach((n,r)=>{void 0===this.cropsArray[i][r]?(e=!0,this.cropsArray[i][r]=n.data):Object.entries(n.data).forEach(([o,s])=>{(Array.isArray(s)&&s.some((a,l)=>a!==this.cropsArray[i][r][o][l])||s!==this.cropsArray[i][r]?.[o])&&(e=!0,this.cropsArray[i][r][o]=s)})}),t.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new T,n=new qt,r=!1,o=1,s,a){this.splatMesh=my.buildMesh(e,t,r,o,s,a),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,h)=>this.update(l,h)}setupSortWorker(e){this.sortWorker=function cEe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",lEe.toString(),")(self)"],{type:"application/javascript"}))),i=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:e,Constants:{BytesPerFloat:ku.BytesPerFloat,BytesPerInt:ku.BytesPerInt,DepthMapRange:ku.DepthMapRange,MemoryPageSize:ku.MemoryPageSize}}}),t}(e),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){null!==this.splatMesh&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}}({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},vy=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},PM=e=>e*(Math.PI/180),IM=new Map,nW=e=>{IM.has(e)&&clearTimeout(IM.get(e)),IM.set(e,setTimeout(e,100))},yy=(e,t,i)=>{let r,n=t.split(/[ ,]+/g);for(let o=0;o<n.length;o+=1)r=n[o],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent&&e.attachEvent(r,i)},rW=(e,t,i)=>{let r,n=t.split(/[ ,]+/g);for(let o=0;o<n.length;o+=1)r=n[o],e.removeEventListener?e.removeEventListener(r,i):e.detachEvent&&e.detachEvent(r,i)},oW=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),sW=()=>{if(!(typeof window>"u"))return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},OM=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},kM=(e,t,i)=>{let n=aW(e);for(let r in n)if(n.hasOwnProperty(r))if("string"==typeof t)n[r]=t+" "+i;else{let o="";for(let s=0,a=t.length;s<a;s+=1)o+=t[s]+" "+i+", ";n[r]=o.slice(0,-2)}return n},aW=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},NM=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},LM=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)};typeof window<"u"&&(lW="ontouchstart"in window,cW=!!window.PointerEvent,hW=!!window.MSPointerEvent);var lW,cW,hW,y0,P4_mouse={start:"mousedown",move:"mousemove",end:"mouseup"},I4={};function v1(){}cW?y0={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:hW?y0={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:lW?(y0={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},I4=P4_mouse):y0=P4_mouse,v1.prototype.on=function(e,t){var r,i=this,n=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)i._handlers_[r=n[o]]=i._handlers_[r]||[],i._handlers_[r].push(t);return i},v1.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},void 0===e?i._handlers_={}:void 0===t?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i},v1.prototype.trigger=function(e,t){var r,i=this,n=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)i._handlers_[r=n[o]]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(s){s.call(i,{type:r,target:i},t)})},v1.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{let i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i})(t.options,e))},v1.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},yy(e,y0[t],i._domHandlers_[t]),I4[t]&&yy(e,I4[t],i._domHandlers_[t]),i},v1.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},rW(e,y0[t],i._domHandlers_[t]),I4[t]&&rW(e,I4[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var RM=v1;function Wr(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Wr.id,Wr.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Wr.prototype=new RM,Wr.constructor=Wr,Wr.id=0,Wr.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Wr.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{let i=aW("borderRadius");for(let n in i)i.hasOwnProperty(n)&&(i[n]="50%");return i})(),i=kM("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},NM(n.el,i),"circle"===this.options.shape&&NM(n.back,t),NM(n.front,t),this.applyStyles(n),this},Wr.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},Wr.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Wr.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Wr.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Wr.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},Wr.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){t.ui.el.style.display="dynamic"===t.options.mode?"none":"block","function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},Wr.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r={};r.front=kM("transition",["top","left"],i.options.fadeTime+"ms");var o={front:{}};o.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(o),i.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(i),i.restCallback()},i.options.fadeTime)},Wr.prototype.restCallback=function(){var e=this,t={};t.front=kM("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},Wr.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Wr.prototype.computeDirection=function(e){var r,o,s,t=e.angle.radian,i=Math.PI/4,n=Math.PI/2;if(t>i&&t<3*i&&!e.lockX?r="up":t>-i&&t<=i&&!e.lockY?r="left":t>3*-i&&t<=-i&&!e.lockX?r="down":e.lockY||(r="right"),e.lockY||(o=t>-n&&t<n?"left":"right"),e.lockX||(s=t>0?"up":"down"),e.force>this.options.threshold){var l,a={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(a[l]=this.direction[l]);var c={};for(l in this.direction={x:o,y:s,angle:r},e.direction=this.direction,a)a[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+o,e),c.y||this.trigger("plain:"+s,e),c.angle||this.trigger("dir dir:"+r,e)}else this.resetDirection();return e};var xEe=Wr;function mr(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=mr.id,mr.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),("static"===i.options.mode||"semi"===i.options.mode)&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}mr.prototype=new RM,mr.constructor=mr,mr.id=0,mr.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(void 0===i)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===i)return t[n];return!1}},mr.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},mr.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}},mr.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},o=i.options;if(e.x&&e.y)r={x:e.x-(i.parentIsFlex?n.x:n.x+i.box.left),y:e.y-(i.parentIsFlex?n.y:n.y+i.box.top)};else if(e.top||e.right||e.bottom||e.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",o.zone.appendChild(a);var l=a.getBoundingClientRect();o.zone.removeChild(a),r=e,e={x:l.left+n.x,y:l.top+n.y}}var c=new xEe(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(OM(c.ui.el,r),OM(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c},mr.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},mr.prototype.bindNipple=function(e){var t=this,n=function(r,o){t.trigger(r.type+" "+o.id+":"+r.type,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},mr.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var o=e.force||e.pressure||e.webkitForce||0;o!==r&&(t.trigger("pressure",o),n.trigger("pressure "+t.identifier+":pressure",o),r=o)}.bind(n),100)},mr.prototype.onstart=function(e){var t=this,i=t.options,n=e;return e=oW(e),t.updateBox(),LM(e,function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(s){if(Object.values(n.touches).findIndex(function(l){return l.identifier===s})<0){var a=[e[0]];a.identifier=s,t.processOnEnd(a)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))}),t.manager.bindDocument(),!1},mr.prototype.processOnStart=function(e){var n,t=this,i=t.options,r=t.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},a=t.getOrCreate(r,s);a.identifier!==r&&t.manager.removeIdentifier(a.identifier),a.identifier=r;var l=function(h){h.trigger("start",h),t.trigger("start "+h.id+":start",h),h.show(),o>0&&t.pressureFn(e,h,h.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(a))>=0&&t.idles.splice(n,1),t.actives.push(a),t.ids.push(a.identifier),"semi"!==i.mode)l(a);else{if(!(vy(s,a.position)<=i.catchDistance))return a.destroy(),void t.processOnStart(e);l(a)}return a},mr.prototype.getOrCreate=function(e,t){var r,i=this,n=i.options;return/(semi|static)/.test(n.mode)?(r=i.idles[0])?(i.idles.splice(0,1),r):"semi"===n.mode?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):r=i.createNipple(t,e)},mr.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+n),void t.manager.removeIdentifier(n);if(i.dynamicPage){var s=r.el.getBoundingClientRect();r.position={x:o.x+s.left,y:o.y+s.top}}r.identifier=n;var a=r.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var f,m,c=vy(l,r.position),h=((e,t)=>(e=>e*(180/Math.PI))(Math.atan2(t.y-e.y,t.x-e.x)))(l,r.position),u=PM(h),d=c/a,p={distance:c,position:l};if("circle"===r.options.shape?(f=Math.min(c,a),m=((e,t,i)=>{let n={x:0,y:0};return i=PM(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n})(r.position,f,h)):(m=((e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)}))(l,r.position,a),f=vy(m,r.position)),i.follow){if(c>a){let b=l.y-m.y;r.position.x+=l.x-m.x,r.position.y+=b,r.el.style.top=r.position.y-(t.box.top+o.y)+"px",r.el.style.left=r.position.x-(t.box.left+o.x)+"px",c=vy(l,r.position)}}else l=m,c=f;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},i.dataOnly||OM(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:u,degree:h},vector:{x:g/a,y:-v/a},raw:p,instance:r,lockX:i.lockX,lockY:i.lockY};(y=r.computeDirection(y)).angle={radian:PM(180-h),degree:180-h},r.trigger("move",y),t.trigger("move "+r.id+":move",y)}else this.processOnEnd(e)},mr.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide(function(){"dynamic"===i.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))},mr.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()},mr.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()}),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var wEe=mr;function uo(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=sW(),t.config(e),t.prepareCollections();var i=function(){var r;t.collections.forEach(function(o){o.forEach(function(s){r=s.el.getBoundingClientRect(),s.position={x:t.scroll.x+r.left,y:t.scroll.y+r.top}})})};if(typeof window>"u")return t.collections;yy(window,"resize",function(){nW(i)});var n=function(){t.scroll=sW()};return yy(window,"scroll",function(){nW(n)}),t.collections}uo.prototype=new RM,uo.constructor=uo,uo.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return!(i=n.get(t))}),i}},uo.prototype.create=function(e){return this.createCollection(e)},uo.prototype.createCollection=function(e){var t=this,i=new wEe(t,e);return t.bindCollection(i),t.collections.push(i),i},uo.prototype.bindCollection=function(e){var t=this,n=function(r,o){t.trigger(r.type+" "+o.id+":"+r.type,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},uo.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},uo.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},uo.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},uo.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},uo.prototype.onmove=function(e){return this.onAny("move",e),!1},uo.prototype.onend=function(e){return this.onAny("end",e),!1},uo.prototype.oncancel=function(e){return this.onAny("end",e),!1},uo.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=oW(t);var o=function(a,l,c){c.ids.indexOf(l)>=0&&(c[r](a),a._found_=!0)};return LM(t,function(a){n=i.getIdentifier(a),LM(i.collections,o.bind(null,a,n)),a._found_||i.removeIdentifier(n)}),!1},uo.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()},uo.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var uW=new uo,dW=new Map,O4=new Map,y1=class{constructor(e,t,i,n){this.data=t;let{audio:r,volume:o,delay:s,loop:a}=t;if(!r)throw new Error("Missing property");let l="string"==typeof r?n.getAudio(r).src:r.data;this.audioPlayer=new _4({src:l,volume:o,delay:s,loop:a}),O4.has(i.uuid)?O4.get(i.uuid).push(this):O4.set(i.uuid,[this]),dW.set(e,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},FM=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=dW.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=O4.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...O4.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},pW=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new y1(e,t,i,n);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new FM(t)}}dispatchBasic(){if(!1===Jn(this.shared,this.condition))return!1;this.interaction instanceof y1?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===Jn(this.shared,this.condition))return!1;this.interaction instanceof y1?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(!1===Jn(this.shared,this.condition))return!1;this.interaction instanceof y1&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},fW=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.delay=0,this.emission=e.emission,void 0!==e.delay&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop():this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze():this.unFreeze()}start(e=0){e?this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},this.delay):this.particleSystem.start()}stop(){this.particleSystem.stop(),this.clearDelay()}freeze(){this.particleSystem.froze(),this.clearDelay()}unFreeze(){this.particleSystem.unFroze(),this.clearDelay()}reset(){this.particleSystem.reset(),this.clearDelay()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze()}}dispatchBasic(){if(!1===Jn(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze();break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop();break;case"reset":this.reset()}}dispatchConditional(){if(!1===Jn(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.particleSystem.start();break;case"stop":this.particleSystem.stop();break;case"reset":this.particleSystem.reset()}}dispatchGameControl(e){if(!1===Jn(this.shared,this.condition)||!this.particleSystem)return!1;"start"===e?this.particleSystem.start():this.particleSystem.stop()}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},mW=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),DEe=class{constructor({url:e,context:t},i,n,r){if(this.controlsManager=i,this.shared=n,this.condition=r,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:function EEe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return((e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:n,data:r,hash:o}=i.groups,s=n.split(";");o=t?"":o;let a=!1;"base64"===s[s.length-1]&&(s.pop(),a=!0);let l=(s.shift()||"").toLowerCase(),c=[...s.map(h=>{let[u,d=""]=h.split("=").map(p=>p.trim());return"charset"===u&&(d=d.toLowerCase(),"us-ascii"===d)?"":`${u}${d?`=${d}`:""}`}).filter(Boolean)];return a&&c.push("base64"),(c.length>0||l&&"text/plain"!==l)&&c.unshift(l),`data:${c.join(";")},${a?r.trim():r}${o?`#${o}`:""}`})(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let n=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===n.protocol&&(n.protocol="http:"),t.forceHttps&&"http:"===n.protocol&&(n.protocol="https:"),t.stripAuthentication&&(n.username="",n.password=""),t.stripHash?n.hash="":t.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let o=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,s=0,a="";for(;;){let c=o.exec(n.pathname);if(!c)break;let h=c[0],u=c.index;a+=n.pathname.slice(s,u).replace(/\/{2,}/g,"/"),a+=h,s=u+h.length}a+=n.pathname.slice(s,n.pathname.length).replace(/\/{2,}/g,"/"),n.pathname=a}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let o=n.pathname.split("/");mW(o[o.length-1],t.removeDirectoryIndex)&&(o=o.slice(0,-1),n.pathname=o.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let o of[...n.searchParams.keys()])mW(o,t.removeQueryParameters)&&n.searchParams.delete(o);if(!0===t.removeQueryParameters&&(n.search=""),t.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}t.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=e;return e=n.toString(),!t.removeSingleSlash&&"/"===n.pathname&&!r.endsWith("/")&&""===n.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===n.pathname)&&""===n.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){if(!1===Jn(this.shared,this.condition))return!1;Tw?window.location.assign(this.url):("tab"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(Ot[0]),function W_e(){Ot.splice(0,Ot.length)}())}},gW=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=o=>{this.timeoutIdQueue.shift();let s=this.page.scene.find(o);if(void 0===s)return;let a=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=!a||s.dataPatched.physics?.fusedBody;if(s.cloner){for(let c of s.cloner.children)l?(c.playModeVisible=!1,c.rigidBody&&"positioned"===s.dataPatched.physics?.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),a.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0)):void 0===this.clone||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),a.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):void 0===c.playModeVisible&&(c.playModeVisible=!0);(l||void 0===this.clone||!1===this.clone)&&(s.visible=!1,s.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(s.rigidBody.collider(0).handle),a.removeRigidBody(s.rigidBody),s.rigidBody=void 0),s.bvhGeometry&&(s.bvhGeometry=void 0))}else s.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(s.rigidBody.collider(0).handle),a.removeRigidBody(s.rigidBody),s.rigidBody=void 0),s.bvhGeometry&&(s.bvhGeometry=void 0),s.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(void 0===a?c=>void 0!==c.bvhGeometry:c=>void 0!==c.rigidBody),s.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(!1===Jn(this.shared,this.condition))return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===Jn(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},vW=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){if(!1===Jn(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),JM(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},1e3*(this.data.delay??0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},yW={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},BM={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},AEe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],_y={CSS:{},springs:{}};function vl(e,t,i){return Math.min(Math.max(e,t),i)}function k4(e,t){return e.indexOf(t)>-1}function VM(e,t){return e.apply(null,t)}var Nt={arr:function(e){return Array.isArray(e)},obj:function(e){return k4(Object.prototype.toString.call(e),"Object")},pth:function(e){return Nt.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Nt.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Nt.hex(e)||Nt.rgb(e)||Nt.hsl(e)},key:function(e){return!yW.hasOwnProperty(e)&&!BM.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function _W(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function bW(e,t){var i=_W(e),n=vl(Nt.und(i[0])?1:i[0],.1,100),r=vl(Nt.und(i[1])?100:i[1],.1,100),o=vl(Nt.und(i[2])?10:i[2],.1,100),s=vl(Nt.und(i[3])?0:i[3],.1,100),a=Math.sqrt(r/n),l=o/(2*Math.sqrt(r*n)),c=l<1?a*Math.sqrt(1-l*l):0,h=1,u=l<1?(l*a-s)/c:-s+a;function d(f){var m=t?t*f/1e3:f;return m=l<1?Math.exp(-m*l*a)*(h*Math.cos(c*m)+u*Math.sin(c*m)):(h+u*m)*Math.exp(-m*a),0===f||1===f?f:1-m}return t?d:function p(){var f=_y.springs[e];if(f)return f;for(var m=1/6,g=0,v=0;;)if(1===d(g+=m)){if(++v>=16)break}else v=0;var y=g*m*1e3;return _y.springs[e]=y,y}}function PEe(e){return void 0===e&&(e=10),function(t){return Math.ceil(vl(t,1e-6,1)*e)*(1/e)}}var IEe=function(){var e=11,t=1/(e-1);function i(h,u){return 1-3*u+3*h}function n(h,u){return 3*u-6*h}function r(h){return 3*h}function o(h,u,d){return((i(u,d)*h+n(u,d))*h+r(u))*h}function s(h,u,d){return 3*i(u,d)*h*h+2*n(u,d)*h+r(u)}return function c(h,u,d,p){if(0<=h&&h<=1&&0<=d&&d<=1){var f=new Float32Array(e);if(h!==u||d!==p)for(var m=0;m<e;++m)f[m]=o(m*t,h,d);return function(v){return h===u&&d===p||0===v||1===v?v:o(function g(v){for(var y=0,_=1,b=e-1;_!==b&&f[_]<=v;++_)y+=t;--_;var w=y+(v-f[_])/(f[_+1]-f[_])*t,S=s(w,h,d);return S>=.001?function l(h,u,d,p){for(var f=0;f<4;++f){var m=s(u,d,p);if(0===m)return u;u-=(o(u,d,p)-h)/m}return u}(v,w,h,d):0===S?w:function a(h,u,d,p,f){var m,g,v=0;do{(m=o(g=u+(d-u)/2,p,f)-h)>0?d=g:u=g}while(Math.abs(m)>1e-7&&++v<10);return g}(v,y,y+t,h,d)}(v),u,p)}}}}(),xW=function(){var e={linear:function(){return function(n){return n}}},t={Sine:function(){return function(n){return 1-Math.cos(n*Math.PI/2)}},Circ:function(){return function(n){return 1-Math.sqrt(1-n*n)}},Back:function(){return function(n){return n*n*(3*n-2)}},Bounce:function(){return function(n){for(var r,o=4;n<((r=Math.pow(2,--o))-1)/11;);return 1/Math.pow(4,3-o)-7.5625*Math.pow((3*r-2)/22-n,2)}},Elastic:function(n,r){void 0===n&&(n=1),void 0===r&&(r=.5);var o=vl(n,1,10),s=vl(r,.1,2);return function(a){return 0===a||1===a?a:-o*Math.pow(2,10*(a-1))*Math.sin((a-1-s/(2*Math.PI)*Math.asin(1/o))*(2*Math.PI)/s)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach(function(n,r){t[n]=function(){return function(o){return Math.pow(o,r+2)}}}),Object.keys(t).forEach(function(n){var r=t[n];e["easeIn"+n]=r,e["easeOut"+n]=function(o,s){return function(a){return 1-r(o,s)(1-a)}},e["easeInOut"+n]=function(o,s){return function(a){return a<.5?r(o,s)(2*a)/2:1-r(o,s)(-2*a+2)/2}}}),e}();function HM(e,t){if(Nt.fnc(e))return e;var i=e.split("(")[0],n=xW[i],r=_W(e);switch(i){case"spring":return bW(e,t);case"cubicBezier":return VM(IEe,r);case"steps":return VM(PEe,r);default:return VM(n,r)}}function wW(e){try{return document.querySelectorAll(e)}catch{return}}function by(e,t){for(var i=e.length,n=arguments.length>=2?arguments[1]:void 0,r=[],o=0;o<i;o++)if(o in e){var s=e[o];t.call(n,s,o,e)&&r.push(s)}return r}function xy(e){return e.reduce(function(t,i){return t.concat(Nt.arr(i)?xy(i):i)},[])}function CW(e){return Nt.arr(e)?e:(Nt.str(e)&&(e=wW(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function UM(e,t){return e.some(function(i){return i===t})}function jM(e){var t={};for(var i in e)t[i]=e[i];return t}function YM(e,t){var i=jM(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function wy(e,t){var i=jM(e);for(var n in t)i[n]=Nt.und(e[n])?t[n]:e[n];return i}function zh(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function GM(e,t){return Nt.fnc(e)?e(t.target,t.id,t.total):e}function mc(e,t){return e.getAttribute(t)}function WM(e,t,i){if(UM([i,"deg","rad","turn"],zh(t)))return t;var r=_y.CSS[t+i];if(!Nt.und(r))return r;var s=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(s),s.style.position="absolute",s.style.width=100+i;var l=100/s.offsetWidth;a.removeChild(s);var c=l*parseFloat(t);return _y.CSS[t+i]=c,c}function SW(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?WM(e,r,i):r}}function qM(e,t){return Nt.dom(e)&&!Nt.inp(e)&&(mc(e,t)||Nt.svg(e)&&e[t])?"attribute":Nt.dom(e)&&UM(AEe,t)?"transform":Nt.dom(e)&&"transform"!==t&&SW(e,t)?"css":null!=e[t]?"object":void 0}function MW(e){if(Nt.dom(e)){for(var r,t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,n=new Map;r=i.exec(t);)n.set(r[1],r[2]);return n}}function XM(e,t,i,n){switch(qM(e,t)){case"transform":return function FEe(e,t,i,n){var r=k4(t,"scale")?1:0+function REe(e){return k4(e,"translate")||"perspective"===e?"px":k4(e,"rotate")||k4(e,"skew")?"deg":void 0}(t),o=MW(e).get(t)||r;return i&&(i.transforms.list.set(t,o),i.transforms.last=t),n?WM(e,o,n):o}(e,t,n,i);case"css":return SW(e,t,i);case"attribute":return mc(e,t);default:return e[t]||0}}function $M(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var n=zh(e)||0,r=parseFloat(t),o=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+o+n;case"-":return r-o+n;case"*":return r*o+n}}function zW(e,t){if(Nt.col(e))return function LEe(e){return Nt.rgb(e)?function OEe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):Nt.hex(e)?function kEe(e){var i=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,l,c,h){return l+l+c+c+h+h}),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return"rgba("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+",1)"}(e):Nt.hsl(e)?function NEe(e){var a,l,c,t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100,o=t[4]||1;function s(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+6*(p-d)*f:f<.5?p:f<2/3?d+(p-d)*(2/3-f)*6:d}if(0==n)a=l=c=r;else{var h=r<.5?r*(1+n):r+n-r*n,u=2*r-h;a=s(u,h,i+1/3),l=s(u,h,i),c=s(u,h,i-1/3)}return"rgba("+255*a+","+255*l+","+255*c+","+o+")"}(e):void 0}(e);if(/\s/g.test(e))return e;var i=zh(e),n=i?e.substr(0,e.length-i.length):e;return t?n+t:n}function QM(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function TW(e){for(var n,t=e.points,i=0,r=0;r<t.numberOfItems;r++){var o=t.getItem(r);r>0&&(i+=QM(n,o)),n=o}return i}function EW(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function BEe(e){return 2*Math.PI*mc(e,"r")}(e);case"rect":return function VEe(e){return 2*mc(e,"width")+2*mc(e,"height")}(e);case"line":return function HEe(e){return QM({x:mc(e,"x1"),y:mc(e,"y1")},{x:mc(e,"x2"),y:mc(e,"y2")})}(e);case"polyline":return TW(e);case"polygon":return function UEe(e){var t=e.points;return TW(e)+QM(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function DW(e,t){var i=t||{},n=i.el||function YEe(e){for(var t=e.parentNode;Nt.svg(t)&&Nt.svg(t.parentNode);)t=t.parentNode;return t}(e),r=n.getBoundingClientRect(),o=mc(n,"viewBox"),s=r.width,a=r.height,l=i.viewBox||(o?o.split(" "):[0,0,s,a]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:s/l[2],h:a/l[3]}}function WEe(e,t){function i(a){return void 0===a&&(a=0),e.el.getPointAtLength(t+a>=1?t+a:0)}var n=DW(e.el,e.svg),r=i(),o=i(-1),s=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(s.y-o.y,s.x-o.x)/Math.PI}}function AW(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=zW(Nt.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:Nt.str(e)||t?n.split(i):[]}}function PW(e){return by(e?xy(Nt.arr(e)?e.map(CW):CW(e)):[],function(i,n,r){return r.indexOf(i)===n})}function IW(e){var t=PW(e);return t.map(function(i,n){return{target:i,id:n,total:t.length,transforms:{list:MW(i)}}})}function qEe(e,t){var i=jM(t);if(/^spring/.test(i.easing)&&(i.duration=bW(i.easing)),Nt.arr(e)){var n=e.length;2!==n||Nt.obj(e[0])?Nt.fnc(t.duration)||(i.duration=t.duration/n):e={value:e}}var o=Nt.arr(e)?e:[e];return o.map(function(s,a){var l=Nt.obj(s)&&!Nt.pth(s)?s:{value:s};return Nt.und(l.delay)&&(l.delay=a?0:t.delay),Nt.und(l.endDelay)&&(l.endDelay=a===o.length-1?t.endDelay:0),l}).map(function(s){return wy(s,i)})}var OW={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var o="";n.list.forEach(function(s,a){o+=a+"("+s+") "}),e.style.transform=o}}};function kW(e,t){IW(e).forEach(function(n){for(var r in t){var o=GM(t[r],n),s=n.target,a=zh(o),l=XM(s,r,a,n),h=$M(zW(o,a||zh(l)),l),u=qM(s,r);OW[u](s,r,h,n.transforms,!0)}})}function JEe(e,t){return by(xy(e.map(function(i){return t.map(function(n){return function KEe(e,t){var i=qM(e.target,t.name);if(i){var n=function ZEe(e,t){var i;return e.tweens.map(function(n){var r=function QEe(e,t){var i={};for(var n in e){var r=GM(e[n],t);Nt.arr(r)&&1===(r=r.map(function(o){return GM(o,t)})).length&&(r=r[0]),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,t),o=r.value,s=Nt.arr(o)?o[1]:o,a=zh(s),l=XM(t.target,e.name,a,t),c=i?i.to.original:l,h=Nt.arr(o)?o[0]:c,u=zh(h)||zh(l),d=a||u;return Nt.und(s)&&(s=c),r.from=AW(h,d),r.to=AW($M(s,h),d),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=HM(r.easing,r.duration),r.isPath=Nt.pth(o),r.isColor=Nt.col(r.from.original),r.isColor&&(r.round=1),i=r,r})}(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(i,n)})})),function(i){return!Nt.und(i)})}function NW(e,t){var i=e.length,n=function(o){return o.timelineOffset?o.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map(function(o){let s=o.startOnceDelay??0,a=o.pingPongDelayCorrection??0,l=o.pingPongEndDelayCorrection??0;return n(o)+s+a+l+o.duration*(o.loop??1)})):t.duration,r.delay=i?Math.min.apply(Math,e.map(function(o){let s=o.startOnceDelay??0,a=o.pingPongDelayCorrection??0;return n(o)+s+a+o.delay})):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map(function(o){let s=o.startOnceDelay??0,a=o.pingPongDelayCorrection??0,l=o.pingPongEndDelayCorrection??0;return n(o)+s+a+o.duration*(o.loop??1)-o.endDelay-l})):t.endDelay,r}var Cy,LW=0,Ia=[],RW=[],tDe=function(){function e(){Cy=requestAnimationFrame(t)}function t(i){var n=Ia.length;if(n){for(var r=0;r<n;){var o=Ia[r];o.paused?(Ia.splice(r,1),n-=1):(o.tick(i),r++)}e()}else Cy=cancelAnimationFrame(Cy)}return e}();function gr(e){void 0===e&&(e={});var r,o,t=0,i=0,n=0,s=0,a=null;function l(S){var C=window.Promise&&new Promise(function(M){return a=M});return S.finished=C,C}var c=function eDe(e){var t=YM(yW,e),i=YM(BM,e),n=function $Ee(e,t){var i=[],n=t.keyframes;for(var r in n&&(t=wy(function XEe(e){for(var t=by(xy(e.map(function(o){return Object.keys(o)})),function(o){return Nt.key(o)}).reduce(function(o,s){return o.indexOf(s)<0&&o.push(s),o},[]),i={},n=function(o){var s=t[o];i[s]=e.map(function(a){var l={};for(var c in a)Nt.key(c)?c==s&&(l.value=a[c]):l[c]=a[c];return l})},r=0;r<t.length;r++)n(r);return i}(n),t)),t)Nt.key(r)&&i.push({name:r,tweens:qEe(t[r],e)});return i}(i,e),r=IW(e.targets),o=JEe(r,n),s=NW(o,i),a=LW;return LW++,wy(t,{id:a,children:[],animatables:r,animations:o,duration:s.duration,delay:s.delay,endDelay:s.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}(e);function u(){var S=c.direction;"alternate"!==S&&(c.direction="normal"!==S?"normal":"reverse"),c.reversed=!c.reversed,o.forEach(function(C){(1===C.loop||C.loop%2==0)&&(C.reversed=c.reversed)})}function p(S){return c.reversed?c.duration-S:S}function m(S,C,M=!1){C&&C.seek(c.reversed?C.duration*C.loop-(S-C.timelineOffset-C.pingPongDelayCorrection):S-C.timelineOffset-C.startOnceDelay-C.pingPongDelayCorrection,M)}function v(S){var C=0,M=c.animations,z=M.length;for("alternate"!==c.direction&&"alternate"===c.parent?.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind&&(S=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-S:c.duration+c.delay-c.endDelay-S):x(!1,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)&&(S=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-S:c.duration+c.delay-c.endDelay-S);C<z;){var E=M[C],D=E.animatable,P=E.tweens,I=P.length-1,B=P[I];let pe;I&&(B=by(P,function(se){return S<se.end})[0]||B),pe=c.parent?.reversed&&"alternate"===c.direction?vl(S-B.start-B.endDelay,0,B.duration)/B.duration:vl(S-B.start-B.delay,0,B.duration)/B.duration;for(var V=isNaN(pe)?1:B.easing(pe),R=B.to.strings,N=B.round,W=[],Q=B.to.numbers.length,G=void 0,Y=0;Y<Q;Y++){var J=void 0;let se,ze;"alternate"!==c.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind?(se=B.to.numbers[Y],ze=B.from.numbers[Y]||0):(ze=B.to.numbers[Y],se=B.from.numbers[Y]||0):x(!0,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)?(se=B.to.numbers[Y],ze=B.from.numbers[Y]||0):(ze=B.to.numbers[Y],se=B.from.numbers[Y]||0),J=B.isPath?WEe(B.value,V*ze):se+V*(ze-se),N&&(B.isColor&&Y>2||(J=Math.round(J*N)/N)),W.push(J)}var q=R.length;if(q){G=R[0];for(var ee=0;ee<q;ee++){var ce=R[ee+1],te=W[ee];isNaN(te)||(G+=ce?te+ce:te+" ")}}else G=W[0];OW[E.type](D.target,E.property,G,D.transforms),E.currentValue=G,C++}}function y(S){c[S]&&!c.passThrough&&c[S](c)}l(c);let b={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function x(S,C,M,z,E){return b[S<<4|C<<3|M<<2|z<<1|E]}function w(S,C=!1){var M=c.duration;let z=c.delay,E=M-c.endDelay;c.parent?.reversed&&"alternate"===c.direction&&(z=c.endDelay,E=M-c.delay);var D=p(S);if(c.progress=vl(D/M*100,0,100),C||(c.reversePlayback=D<c.currentTime),s&&function g(S,C=!1){if(c.reversed)for(var M=s;M--;)m(S,o[M],C);else for(var z=0;z<s;z++)m(S,o[z],C)}(D,C),!c.began&&c.currentTime>=0&&(c.began=!0,y("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,y("loopBegin")),(c.reversed||D>=0)&&D<=z&&0!==c.currentTime&&(v(0),y("change")),(D>=E&&c.currentTime!==M+c.pingPongDelayCorrection||!M)&&(v(M),y("change")),D>z&&D<E?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,y("changeBegin")),v(D),y("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,y("change"),s&&y("timelineChangeComplete")):c.began&&D>E&&y("changeComplete"),c.currentTime=vl(D,0,M+c.pingPongDelayCorrection),c.began&&y("update"),S>=M)if(function _(){c.remaining&&!0!==c.remaining&&c.remaining--}(),c.remaining){t+=s?c.duration/gr.speed:c.duration;for(let P of o)P.setStartTime(0),P.remaining=P.loop;y("loopComplete"),c.loopBegan=!1,"alternate"===c.direction?u():s&&function d(){c.direction="normal",c.reversed=!1,o.forEach(function(S){return S.reversed=!1})}()}else c.paused=!0,c.completed||(c.completed=!0,y("loopComplete"),y("complete"),!c.passThrough&&"Promise"in window&&(a(),l(c)))}return c.reset=function(){var S=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===S,c.remaining=c.loop;for(var C=s=(o=c.children).length;C--;)c.children[C].reset();v(c.reversed?c.duration:0)},c.setStartTime=function(S){t=S},c.set=function(S,C){return kW(S,C),c},c.tick=function(S){n=S,t||(t=n),w((n+(i-t))*gr.speed)},c.seek=function(S,C=!1){w(S-t,C)},c.pause=function(S){c.paused=!0,s&&(r=S??performance.now())},c.play=function(S){!c.paused||(c.completed&&c.reset(),c.paused=!1,Ia.push(c),s&&void 0!==r&&(t+=(S??performance.now())-r),Cy||tDe())},c.reverse=function(){u(),c.completed=!c.reversed,function f(){t=0,i=p(c.currentTime)*(1/gr.speed)}()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function FW(e,t){for(var i=t.length;i--;)UM(e,t[i].animatable.target)&&t.splice(i,1)}typeof document<"u"&&document.addEventListener("visibilitychange",function iDe(e){document.hidden?(Ia.forEach(function(t){return t.pause(e.timeStamp)}),RW=Ia.slice(0),gr.running=Ia=[]):RW.forEach(function(t){return t.play(e.timeStamp)})}),gr.version="3.2.0",gr.speed=1,gr.running=Ia,gr.remove=function nDe(e){for(var t=PW(e),i=Ia.length;i--;){var n=Ia[i],r=n.animations,o=n.children;FW(t,r);for(var s=o.length;s--;){var a=o[s],l=a.animations;FW(t,l),!l.length&&!a.children.length&&o.splice(s,1)}!r.length&&!o.length&&n.pause()}},gr.get=XM,gr.set=kW,gr.convertPx=WM,gr.path=function GEe(e,t){var i=Nt.str(e)?wW(e)[0]:e,n=t||100;return function(r){return{property:r,el:i,svg:DW(i),totalLength:EW(i)*(n/100)}}},gr.setDashoffset=function jEe(e){var t=EW(e);return e.setAttribute("stroke-dasharray",t),t},gr.stagger=function rDe(e,t){void 0===t&&(t={});var i=t.direction||"normal",n=t.easing?HM(t.easing):null,r=t.grid,o=t.axis,s=t.from||0,a="first"===s,l="center"===s,c="last"===s,h=Nt.arr(e),u=parseFloat(h?e[0]:e),d=h?parseFloat(e[1]):0,p=zh(h?e[1]:e)||0,f=t.start||0+(h?u:0),m=[],g=0;return function(v,y,_){if(a&&(s=0),l&&(s=(_-1)/2),c&&(s=_-1),!m.length){for(var b=0;b<_;b++){if(r){var x=l?(r[0]-1)/2:s%r[0],w=l?(r[1]-1)/2:Math.floor(s/r[0]),M=x-b%r[0],z=w-Math.floor(b/r[0]),E=Math.sqrt(M*M+z*z);"x"===o&&(E=-M),"y"===o&&(E=-z),m.push(E)}else m.push(Math.abs(s-b));g=Math.max.apply(Math,m)}n&&(m=m.map(function(P){return n(P/g)*g})),"reverse"===i&&(m=m.map(function(P){return o?P<0?-1*P:-P:Math.abs(g-P)}))}return f+(h?(d-u)/g:u)*(Math.round(100*m[y])/100)+p}},gr.timeline=function oDe(e){void 0===e&&(e={});var t=gr(e);return t.duration=0,t.add=function(i,n){var r=Ia.indexOf(t),o=t.children;function s(d){d.passThrough=!0}r>-1&&Ia.splice(r,1);for(var a=0;a<o.length;a++)s(o[a]);var l=wy(i,YM(BM,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=Nt.und(n)?c:$M(n,c),s(t);var h=gr(l);s(h),o.push(h),h.parent=t;var u=NW(o,e);return t.delay=u.delay,t.endDelay=u.endDelay,t.duration=u.duration,!0===h.loop&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},gr.easing=HM,gr.penner=xW,gr.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var BW=gr,VW=new T,HW=new T,UW=new qt;function Po(e,t,i,n,r,o){let s=i[e]?i[e]:void 0,a=n[e];if(null==a)return;let l=null!=s?"string"==typeof s?Number(r.getVariable(s)??0):s:t[e],c="string"==typeof a?Number(r.getVariable(a)??0):a;return l!==c?{update:h=>{let u=et.lerp(l,c,h);t[e]=o?Math.trunc(u):u},start:()=>{t[e]=l},end:()=>{t[e]=c}}:void 0}function ZM(e,t,i,n,r,o){let a=n[e];if(!a)return;let c=[...(i[e]?i[e]:void 0)??t[e]].map(u=>"string"==typeof u?Number(r.getVariable(u)??0):u),h=[...a].map(u=>"string"==typeof u?Number(r.getVariable(u)??0):u);return c.length!==h.length||YV(c,h)?void 0:{update:u=>{c.forEach((d,p)=>{let f=et.lerp(d,h[p],u);t[e][p]=o?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],h)}}}function Sy(e,t,i){return t.forEach((n,r)=>{e.setComponent(r,"string"==typeof n?Number(i.getVariable(n)??0):n)}),e}function jW(e,t,i,n,r){let o=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],l=o?Sy(new T,o,r):a.clone(),c=Sy(new T,s,r);return l.equals(c)?void 0:{update:h=>{a.lerpVectors(l,c,h)},start:()=>{a.copy(l)},end:()=>{a.copy(c)}}}function YW(e,t,i){return t.forEach((n,r)=>{e.setComponent(r,"string"==typeof n?Number(i.getVariable(n)??0):n)}),e}function My(e,t,i,n,r){let o=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],l=!(a instanceof $),c=a instanceof $?a:(new $).fromArray(a),h=o?YW(new $,o,r):c.clone(),u=YW(new $,s,r);return h.equals(u)?void 0:{update:d=>{c.lerpVectors(h,u,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(h),l&&(t[e]=c.toArray())},end:()=>{c.copy(u),l&&(t[e]=c.toArray())}}}function zy(e,t,i,n,r){let o=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],l=new Do(a.r,a.g,a.b,a.a),c=o?"string"==typeof o?r.getColor(o).clone():new Do(o.r,o.g,o.b,o.a):l.clone(),h="string"==typeof s?r.getColor(s).clone():new Do(s.r,s.g,s.b,s.a);return c.equals(h)?void 0:{update:u=>{l.lerpColors(c,h,u);let d=et.lerp(c.a,h.a,u);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(h)}}}function Nu(e,t,i,n,r){return"number"==typeof t[e]?Po(e,t,i??{},n,r):Array.isArray(t[e])?ZM(e,t,i??{},n,r):void 0}function GW(e,t,i,n){let r=[],o=c0(i,n)||!!t.layers&&c0(t,n);r.push(function CDe(e,t){return{update:()=>{e.transparent=t}}}(e,o));for(let s of e.layers){let a=t.layers?.data(s.uuid),l=i.layers.data(s.uuid);if(!l||"light"!==s.type&&(!(s.visible??1)||!(l.visible??1)))continue;let c=s.getNames().filter(h=>!iU.some(u=>h.includes(u)));for(let h of c)try{let d,u=s.getValue(h);if("colors"===h)d=xDe(s,a,l,h);else if(Array.isArray(u))"steps"===h&&(d=bDe(s,a,l,h));else if("number"==typeof u)d=mDe(s,a,l,h,n);else{if("boolean"==typeof u)continue;u instanceof $?d=gDe(s,a,l,h):u instanceof T?d=vDe(s,a,l,h,n):u instanceof Do?d=_De(s,a,l,h,n):u instanceof Ct?d=yDe(s,a,l,h,n):"isTexture"in u&&(d=wDe(s,a,l,h))}d&&(Array.isArray(d)?r.push(...d):r.push(d))}catch(u){console.error(`lerpMaterial: unexpected material layer for ${h}`,u)}}return r}function mDe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let o=t?t[n]:e.getValue(n),s=i[n],a="string"==typeof o?Number(r.getVariable(o)??0):o,l="string"==typeof s?Number(r.getVariable(s)??0):s;return a!==l?{update:c=>{e.setValue(n,et.lerp(a,l,c))},start:()=>{e.setValue(n,a)},end:()=>{e.setValue(n,l)}}:void 0}function gDe(e,t,i,n){if(!e.hasValue(n)||!(n in i))return;let r=e.getValue(n),o=t?(new $).fromArray(t[n]):r.clone(),s=(new $).fromArray(i[n]);return o.equals(s)?void 0:{update:a=>{r.lerpVectors(o,s,a)},start:()=>{r.copy(o)},end:()=>{r.copy(s)}}}function vDe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let o=e.getValue(n),s=t?t[n]:void 0,a=i[n],l=s?Sy(new T,s,r):o.clone(),c=Sy(new T,a,r);return l.equals(c)?void 0:{update:h=>{o.lerpVectors(l,c,h)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function yDe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let o=t?t[n]:void 0,s=i[n],a=e.getValue(n),l=o?"string"==typeof o?r.getColor(o).clone():(new Ct).setRGB(o.r,o.g,o.b):a.clone(),c="string"==typeof s?r.getColor(s).clone():(new Ct).setRGB(s.r,s.g,s.b);if(l.equals(c))return;let h=a.clone();return{update:u=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function _De(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let o=t?t[n]:void 0,s=i[n],a=e.getValue(n),l=o?"string"==typeof o?r.getColor(o).clone():(new Ct).setRGB(o.r,o.g,o.b):a.clone(),c="string"==typeof s?r.getColor(s).clone():new Do(s.r,s.g,s.b,s.a);if(l.equals(c))return;let h=a.clone();return{update:u=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function bDe(e,t,i,n="steps"){if(!e.hasValue(n)||!(n in i))return;let r=[],o=e.getValue(n),s=t?t[n]:o,a=i[n];for(let l=0;l<o.length;++l){let c=s[l],h=a[l];c!==h&&r.push({update:u=>{o[l]=et.lerp(c,h,u)},start:()=>{o[l]=c},end:()=>{o[l]=h}})}return r.length?r:void 0}function xDe(e,t,i,n="colors"){if(!e.hasValue(n)||!(n in i))return;let r=[],o=e.getValue(n),s=t?t[n]:o.map(l=>l.toArray()),a=i[n];for(let l=0;l<o.length;++l){let c=[...s[l]],h=[...a[l]];t6.isEqual(c,h)||r.push({update:u=>{o[l].fromArray(t6.lerp(c,h,u))},start:()=>{o[l].fromArray(c)},end:()=>{o[l].fromArray(h)}})}return r.length?r:void 0}function wDe(e,t,i,n="texture"){if(!e.hasValue(n)||!(n in i))return;let r=e.getNode("rotation"),o=t?.[n]?.rotation??0,s=i[n]?.rotation??0;if(r&&o!==s)return{update:g=>{r.value=et.lerp(o,s,g)*et.DEG2RAD},start:()=>{r.value=o*et.DEG2RAD},end:()=>{r.value=s*et.DEG2RAD}};let a=e.getNode("mat");if(!a)return;let l=t?t[n]:a,c=i[n],h=[...l.repeat],u=[...l.offset],d=[...c.repeat],p=[...c.offset],f=l.rotation??0,m=c.rotation??0;return dh.isEqual(h,d)&&dh.isEqual(u,p)&&f===m?void 0:{update:g=>{a.repeat=dh.lerp(h,d,g),a.offset=dh.lerp(u,p,g),a.rotation=et.lerp(f,m,g),a.updateMatrix()},start:()=>{a.repeat=[...h],a.offset=[...u],a.rotation=f,a.updateMatrix()},end:()=>{a.repeat=[...d],a.offset=[...p],a.rotation=m,a.updateMatrix()}}}var KM=new T,WW=new Ur;function qW(e,t,i,n,r){let o=[];return e.data.visible&&o.push(...function SDe(e,t,i,n,r){let s,a,l,c,h,u,d,p,o=[];if(e instanceof lo?(s=My("position",e,t,i,r),s&&o.push(s),l=Po("rotation",e,t,i,r),l&&o.push(l),c=My("shear",e,t,i,r),c&&o.push(c)):(p={slide:t.pathSnapping?.slide??e.updatedPathSnapping?.slide??e.dataPatched.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??e.updatedPathSnapping?.offset??e.dataPatched.pathSnapping?.offset??0},u=Po("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),u&&o.push(u),d=Po("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),d&&o.push(d),!u&&!d&&(s=jW("position",e,t,i,r),s&&o.push(s),a=jW("scale",e,t,i,r),a&&o.push(a),l=function MDe(e,t,i,n,r){let o=t?.rotation?t.rotation.map(h=>("string"==typeof h?Number(r.getVariable(h)??0):h)*et.DEG2RAD):void 0,s=i.rotation?.map(h=>("string"==typeof h?Number(r.getVariable(h)??0):h)*et.DEG2RAD);if(!s)return;let a=o?(new T).fromArray(o):(new T).setFromEuler(e.rotation),l=(new T).fromArray(s);if(a.equals(l))return;let c=KM.subVectors(l,a);if(n&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=(new qt).setFromEuler(WW.setFromVector3(a)),u=(new qt).setFromEuler(WW.setFromVector3(l));return{update:d=>{!function sDe(e,t,i,n){if(0===n)return i.copy(e);if(1===n)return i.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return i.copy(e);let o=1-r*r;if(o<=Number.EPSILON){let h=1-n;return i.w=h*e.w+n*t.w,i.x=h*e.x+n*t.x,i.y=h*e.y+n*t.y,i.z=h*e.z+n*t.z,i.normalize(),i}let s=Math.sqrt(o),a=Math.atan2(s,r),l=Math.sin((1-n)*a)/s,c=Math.sin(n*a)/s;i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c}(h,u,e.quaternion,d)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(l)}}}return{update:h=>{KM.lerpVectors(a,l,h),e.rotation.setFromVector3(KM)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(l)}}}(e,t,i,n,r),l&&o.push(l),h=function aDe(e,t,i,n){let r=i[e]?i[e]:void 0,o=n[e];if(!o)return;let s=t[e],a=r?(new De).fromArray(r):s.clone(),l=new T,c=new qt,h=new T;a.decompose(l,c,h);let u=(new De).fromArray(o),d=new T,p=new qt,f=new T;return u.decompose(d,p,f),a.equals(u)?void 0:{update:m=>{UW.slerpQuaternions(c,p,m),VW.lerpVectors(l,d,m),HW.lerpVectors(h,f,m),s.compose(VW,UW,HW)},start:()=>{s.compose(l,c,h)},end:()=>{s.compose(d,p,f)}}}("hiddenMatrix",e,t,i),h&&o.push(h))),s||a||l||h||u||d){let f=e instanceof lo?()=>{e.updateWorldMatrix(!0)}:()=>{e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e.parent?.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),fl(e)&&Ch(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};o.push({update:f,start:f,end:f})}return o}(e,t,i,r,n)),e instanceof lo?o.push(...function FDe(e,t,i,n,r){let s,a,l,c,h,u,d,p,f,m,g,v,y,_,b,o=[];if("width"in e&&(s=Po("width",e,t,i,r),s&&o.push(s)),"height"in e&&(a=Po("height",e,t,i,r),a&&o.push(a)),e instanceof co||e instanceof fc){let x={...t.fill},w={...i.fill};void 0!==x.enabled&&x.enabled!==w.enabled&&(o.push(function IDe(e,t){return{update:()=>{e instanceof co&&(e.fill.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,color:{...x.color,a:0}}),w.enabled||Object.assign(w,{enabled:!0,color:{...w.color,a:0}})),l=zy("color",e.fill,x,w,r),l&&o.push(l)}if(e instanceof co){let x={...t.stroke},w={...i.stroke};(x.enabled||w.enabled)&&(o.push(function ODe(e,t){return{update:()=>{e instanceof co&&(e.stroke.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,color:{...x.color,a:0}}),w.enabled||Object.assign(w,{enabled:!0,color:{...w.color,a:0}})),c=zy("color",e.stroke,x,w,r),c&&o.push(c),h=Po("thickness",e.stroke,x,w,r),h&&o.push(h)}if(e instanceof co){let x={...t.dropShadow},w={...i.dropShadow};(x.enabled||w.enabled)&&(o.push(function kDe(e,t){return{update:()=>{e instanceof co&&(e.dropShadow.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,color:{...x.color,a:0}}),w.enabled||Object.assign(w,{enabled:!0,color:{...w.color,a:0}})),u=zy("color",e.dropShadow,x,w,r),u&&o.push(u),d=Po("blurRadius",e.dropShadow,x,w,r),d&&o.push(d),f=Po("spread",e.dropShadow,x,w,r),f&&o.push(f),p=My("offset",e.dropShadow,x,w,r),p&&o.push(p)}if(e instanceof co){let x={...t.innerShadow},w={...i.innerShadow};(x.enabled||w.enabled)&&(o.push(function NDe(e,t){return{update:()=>{e instanceof co&&(e.innerShadow.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,color:{...x.color,a:0}}),w.enabled||Object.assign(w,{enabled:!0,color:{...w.color,a:0}})),m=zy("color",e.innerShadow,x,w,r),m&&o.push(m),g=Po("blurRadius",e.innerShadow,x,w,r),g&&o.push(g),y=Po("spread",e.innerShadow,x,w,r),y&&o.push(y),v=My("offset",e.innerShadow,x,w,r),v&&o.push(v)}if(e instanceof co||e instanceof fc){let x={...t.backgroundBlur},w={...i.backgroundBlur};(x.enabled||w.enabled)&&(o.push(function LDe(e,t){return{update:()=>{e instanceof co&&(e.backgroundBlur.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,radius:0}),w.enabled||Object.assign(w,{enabled:!0,radius:0})),_=Po("radius",e.backgroundBlur,x,w,r),_&&o.push(_)}if(e instanceof co){let x={...t.layerBlur},w={...i.layerBlur};(x.enabled||w.enabled)&&(o.push(function RDe(e,t){return{update:()=>{e instanceof co&&(e.layerBlur.enabled=t)}}}(e,!0)),x.enabled||Object.assign(x,{enabled:!0,radius:0}),w.enabled||Object.assign(w,{enabled:!0,radius:0})),b=Po("radius",e.layerBlur,x,w,r),b&&o.push(b)}if(e instanceof fc||e instanceof D4){let x=ZM("cornerRadius",e,t,i,r);x&&o.push(x)}return o}(e,t,i,0,n)):(e.data.visible&&o.push(...function zDe(e,t,i,n){let r=[];if(!("cloner"in i)||!e.cloner)return r;let o=e.cloner,s="cloner"in t?t.cloner:{},a=i.cloner;qH.forEach(p=>{let f;f="count"===p?Po("count",o.parameters,s,a,n,!0):Nu(p,o.parameters,s??{},a,n),f&&r.push(f)});let l=function TDe(e,t,i,n){if("radial"!==e.parameters.type)return;let r=t.radial,o=i.radial;if(!o)return;let s=e.parameters.radial,a=[];return XH.forEach(l=>{let c=Nu(l,s,r??{},o,n);c&&a.push(c)}),a}(o,s,a,n);l?.length&&r.push(...l);let c=function EDe(e,t,i,n){if("linear"!==e.parameters.type)return;let r=t.linear,o=i.linear;if(!o)return;let s=[],a=e.parameters.linear;return $H.forEach(l=>{let c=Nu(l,a,r??{},o,n);c&&s.push(c)}),s}(o,s,a,n);c?.length&&r.push(...c);let h=function DDe(e,t,i,n){if("grid"!==e.parameters.type)return;let r=t.grid,o=i.grid;if(!o)return;let s=[],a=e.parameters.grid;return QH.forEach(l=>{let c;c="count"===l?ZM(l,a,r??{},o,n,!0):Nu(l,a,r??{},o,n),c&&s.push(c)}),s}(o,s,a,n);h?.length&&r.push(...h);let u=function ADe(e,t,i,n){if("toObject"!==e.parameters.type)return;let r=t.toObject,o=i.toObject;if(!o)return;let s=[],a=e.parameters.toObject;return ZH.forEach(l=>{let c;c="count"===l?Po(l,a,r??{},o,n,!0):Nu(l,a,r??{},o,n),c&&s.push(c)}),s}(o,s,a,n);u?.length&&r.push(...u);let d=function PDe(e,t,i,n){if(!e.parameters.randomness)return;let r=t.randomnessObject,o=i.randomnessObject;if(!o)return;let s=[],a=e.parameters.randomnessObject;return KH.forEach(l=>{let c=Nu(l,a,r??{},o,n);c&&s.push(c)}),s}(o,s,a,n);return d?.length&&r.push(...d),r.length&&r.push({update:()=>{o.update()}}),r}(e,t,i,n)),fl(e)?(e instanceof Xo&&e.data.visible&&o.push(...function dDe(e,t,i,n){let r=[];if(!("geometry"in i))return r;let o=e.geometry.userData.parameters,s="geometry"in t?t.geometry:{},a=i.geometry;if(e instanceof x4){let l=function hDe(e,t,i,n){if(void 0===i.scaleBaked)return;let r=(t.scaleBaked??e.data.geometry.scaleBaked).map(a=>"string"==typeof a?Number(n.getVariable(a)??0):a),o=i.scaleBaked.map(a=>"string"==typeof a?Number(n.getVariable(a)??0):a);if(Qd.isEqual(r,o))return;let s=[];return s.push({update:a=>{e.updateGeometryInteractions({scaleBaked:[et.lerp(r[0],o[0],a),et.lerp(r[1],o[1],a),et.lerp(r[2],o[2],a)]},n),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:r},n),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:o},n),e.invalidateDownstreamBooleanData()}}),s}(e,s,a,n);l&&r.push(...l)}else{let l={};if(Object.assign(l,hh(o,sU)),sU.forEach(c=>{let h=Nu(c,l,s,a,n);h&&r.push(h)}),e instanceof wM){Object.assign(l,{extrusion:{...o.extrusion}});let c=function uDe(e,t,i,n){if(!i.extrusion)return;let r=e.extrusion,o=t.extrusion??{},s=i.extrusion,a=[];return oU.forEach(l=>{let c=Nu(l,r,o,s,n);c&&a.push(c)}),a}(l,s,a,n);c&&r.push(...c)}r.length&&r.push({update:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()},start:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()},end:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()}})}return r}(e,t,i,n)),e.data.visible&&o.push(...function fDe(e,t,i,n){let r=[];if(Array.isArray(e.material)){if(!("materials"in i)||!i.materials)return r;let o="materials"in t&&t.materials?t.materials:[],s=i.materials;e.material.forEach((a,l)=>{if(!s[l])return;let c=o[l]??{},h=s[l];"string"==typeof c||"string"==typeof h||r.push(...GW(a,c,h,n))})}else{if(!("material"in i)||!i.material)return r;let o="material"in t&&t.material?t.material:{},s=i.material;if("string"==typeof o||"string"==typeof s)return r;r.push(...GW(e.material,o,s,n))}return r}(e,t,i,n))):XSe(e)?e.data.visible&&o.push(...function pDe(e,t,i,n){let r=[];if(void 0!==i.intensity){let o=Po("intensity",e,t,i,n);o&&r.push(o)}if(void 0!==i.color){let o=function lDe(e,t,i,n,r){let o=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],l=o?"string"==typeof o?r.getColor(o).clone():(new Ct).setRGB(o.r,o.g,o.b):a.clone(),c="string"==typeof s?r.getColor(s).clone():(new Ct).setRGB(s.r,s.g,s.b);if(l.equals(c))return;let h=a.clone();return t[e]=h,{update:u=>{h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}("color",e,t,i,n);o&&r.push(o)}return r}(e,t,i,n)):qSe(e)&&o.push(...function cDe(e,t,i,n){let r=[],s="OrthographicCamera"===e.cameraType?i.orthographic?.zoom:i.perspective?.zoom;if(void 0!==s){let a=("OrthographicCamera"===e.cameraType?t.orthographic?.zoom:t.perspective?.zoom)??e.zoom,l=s;a!==l&&r.push({update:c=>{e.zoom=et.lerp(a,l,c),e.updateProjectionMatrix()},start:()=>{e.zoom=a,e.updateProjectionMatrix()},end:()=>{e.zoom=l,e.updateProjectionMatrix()}})}if(void 0!==i.targetOffset){let a=Po("targetOffset",e,t,i,n);a&&r.push(a)}return r}(e,t,i,n))),o.length?{update:s=>{o.forEach(a=>a.update(s))},start:s=>{o.forEach(a=>a.start?.(s))},end:s=>{o.forEach(a=>a.end?.(s))}}:void 0}var XW=new T;function JM(e,t,i=!1){let n=[],r=o=>{let s=o.data;delete o.states,o.currentState=null,o.reversibleToState=null,o.currentTransitionEvent=null;for(let a of s.states){let l={...a.data};o.states||(o.states={}),o.states[a.id]=n1.patch(s,l)}QW(e.scene,o,null,t,void 0!==s.events.find(a=>"Follow"===a.data.type||"LookAt"===a.data.type)),$W(e)};e.scene.traverse2D(r),e.traverseChildren(o=>{if(i&&(o.rigidBody?.setTranslation(o.position0,!0),o.rigidBody?.setRotation(o.rotation0,!0),o.rigidBody?.setLinvel(XW,!0),o.rigidBody?.setAngvel(XW,!0)),!Ti.is(o))return;let s=o.uuid,a=o.data;if(delete o.states,o.uuid===Df)return;let l=!1;n.some(c=>e.scene.find(s)?.isDescendantOf(c))?l=!0:!0===a.physics?.fusedBody&&"dynamic"===a.physics.rigidBody&&n.push(s),o.data=a,o.currentState=null,o.reversibleToState=null,o.currentTransitionEvent=null;for(let c of a.states){let h={...c.data};!0===e.data.globalPhysics.usePhysics&&a.physics&&("dynamic"===a.physics.rigidBody||l)&&(void 0!==c.data.position&&delete h.position,void 0!==c.data.rotation&&delete h.rotation,void 0!==c.data.hiddenMatrix&&delete h.hiddenMatrix),o.states||(o.states={}),o.states[c.id]=Kd.patch(a,h)}QW(e.scene,o,null,t,void 0!==a.events.find(c=>"Follow"===c.data.type||"LookAt"===c.data.type)),$W(e),o instanceof Zo&&o.frame&&(o.frame.traverse(c=>r(c)),o.uiCanvas?.applySize())}),e.frame&&(e.frame.traverse(o=>r(o)),e.uiCanvas?.applySize())}function $W(e){e.traverseEntity(t=>{for(let i of t.data.events){let n=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":n.push(...i.data.actions);break;case"GameControl":for(let r of Object.values(i.data.gameActions))n.push(...r);break;case"DragDrop":n.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":n.push(...i.data.inActions,...i.data.outActions)}for(let r of n)if("Create"===r.data.type&&"Yes"===r.data.hideBase){let o=e.scene.find(r.data.object);o&&(o.visible=!1)}}})}function QW(e,t,i,n,r=!1){if(t instanceof Xo&&t.removeInteractionGeometry(n),t.changeSelectedState(i,t instanceof lo?{shared:n}:{scene:e,shared:n},r),t instanceof Xo&&t.updateGeometryGroupsIfNeeded(),t instanceof $o&&t.updateCameraState(t.dataPatched,{scene:e,shared:n}),!(t instanceof lo)){if(t.cloner)for(let o of t.cloner.children)o.playModeVisible=void 0;t.updateVisible()}}function ZW(e){let t;if(5===e.easing){let{control1:i,control2:n}=e;t=`cubicBezier(\n\t\t\t${i[0]}, ${i[1]}, ${n[0]}, ${n[1]}\n\t\t)`}else if(6===e.easing){let{mass:i,stiffness:n,damping:r,velocity:o}=e;t=`spring( ${i}, ${n}, ${r}, ${o} )`}else{let i;switch(e.easing){case 0:default:i=mu.linear;break;case 1:i=mu.ease;break;case 2:i=mu.easeIn;break;case 3:i=mu.easeOut;break;case 4:i=mu.easeInOut}let[n,r,o,s]=i;t=`cubicBezier( ${n}, ${r}, ${o}, ${s} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function ez(e){let t={delay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return"alternate"===t.direction&&(t.delay/=2,t.endDelay/=2,"start"===e.delayDirection?(t.pingPongDelayCorrection=t.delay,"number"==typeof t.loop&&t.loop%2==0&&(t.pingPongEndDelayCorrection=t.delay)):"end"===e.delayDirection?"number"==typeof t.loop&&t.loop%2!=0&&(t.pingPongEndDelayCorrection=t.endDelay):"start-end"===e.delayDirection&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var BDe={type:"beginState"},VDe={type:"completeState",isfromEntity:!1},KW=class{constructor(e,t,i,n,r,o){if(this.object=e,this.data=n,this.sharedAssets=r,this.allowSlerp=o,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let s=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=s,this.object.dispatchEvent({type:"beginState",state:s}),this.object instanceof lo||this.object.traverseEntity(a=>{a!==this.object&&a instanceof $o&&a.dispatchEvent(BDe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let s=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=s,this.object.dispatchEvent({type:"completeState",state:s}),this.object instanceof lo||this.object.traverseEntity(a=>{a!==this.object&&a instanceof $o&&a.dispatchEvent(VDe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=qW(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===t){let s=Ty(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!s)throw new Error("Missing property");this.from=s}else{let s=Ty(this.object,t);if(!s)throw new Error("Missing property");this.from=s}if(void 0===i)throw new Error("Missing property");{let s=Ty(this.object,i);if(!s)throw new Error("Missing property");this.to=s}this.useCurrentState=void 0===t||void 0===i,this.params={targets:this.targets,t:1,autoplay:!1,...ez(n),...ZW(n),change:this.onChange},this.callback=qW(this.object,void 0===t?{}:this.from.data,void 0===i?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},JW=class extends wo{constructor(e,t,i,n){if(super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let r=this.page.scene.find(e.object)??this.page.uiCanvas?.find(e.object)??this.page.scene.find2DInUIObjects(e.object);if(!r)throw new Error("Missing property");if(!r.states)throw new Error("Missing property");if(this.object=r,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===e.tweens[0].data.delayDirection?e.tweens[0].data.delay:0,this.init()}get playing(){return!1===this.timeline?.paused}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=Ty(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){try{let n=ez(this.data.tweens[0].data);i&&"number"==typeof n.loop&&n.loop--,this.timeline?.pause(),this.timeline=BW.timeline({autoplay:!1,...n,...!0===n.loop||n.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let r=this.tweens.findIndex(o=>o?.changeBegan);if(!0===t&&(this.timelineNeedsRebuild=!0),e){let o=-1===r?0:r;for(let s=o;s<this.data.tweens.length-1;s++){let c,a=this.data.tweens[s],l=this.data.tweens[s+1];s!==o||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?c=void 0===a.data.state?this.currentState:a.data.state:(c=void 0,this.object instanceof $o&&(this.object.wasMovedByUser=!1));let h=new KW(this.object,c,void 0===l.data.state?this.currentState:l.data.state,l.data,this.shared,this.data.allowSlerp??!1);-1!==r&&s===o&&Object.assign(h.params,{startOnceDelay:0}),this.tweens[s]=h,this.timeline.add(h.params,this.timeline.duration+(s===o?n.delay:0))}this.timeline.duration+=n.endDelay}else{let o=-1===r?this.data.tweens.length-1:r+1;for(let s=o;s>0;s--){let c,a=this.data.tweens[s],l=this.data.tweens[s-1];s!==o||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?c=void 0===a.data.state?this.currentState:a.data.state:(c=void 0,this.object instanceof $o&&(this.object.wasMovedByUser=!1));let h=new KW(this.object,c,void 0===l.data.state?this.currentState:l.data.state,a.data,this.shared,this.data.allowSlerp??!1);-1!==r&&s===o&&Object.assign(h.params,{startOnceDelay:0}),this.tweens[s-1]=h,this.timeline.add(h.params,this.timeline.duration+(s===o?n.endDelay:0))}this.timeline.duration+=n.delay}}catch(n){n instanceof Error&&console.error(n.message)}!0===this.object.previousAction?.playing&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===Jn(this.shared,this.condition)||this.playing)return!1;clearTimeout(this.timeoutId);let e=ez(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(e,this.object instanceof lo?{shared:this.shared}:{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){void 0===this.timeline&&this.buildTimeline(),this.timeline?.seek(e*this.timeline.duration,!0)}toggle(e){if(!1===Jn(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function Ty(e,t){let i,n;if("string"==typeof t?(i=t,n=e.states?.[i]):null===t&&(i=null,n=e.data),void 0!==i&&void 0!==n)return{id:i,data:n}}var HDe={type:"beginState"},eq={type:"completeState",isfromEntity:!1},tq={type:"requestRender"},iq=class extends wo{constructor(e,t,i,n){super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new T,this.posEnd=new T,this.qStart=new qt,this.qEnd=new qt,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=BW({targets:i,t:1,...ZW(this.data),update:()=>{0===i.t&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(HDe));let n=this.page.activeCamera;n.position.lerpVectors(this.posStart,this.posEnd,i.t),n.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),n.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,n.wasMovedBySwitchCameraAction=!0,n.updateMatrix(),n.updateMatrixWorld(),n.updateProjectionMatrix(),n.dispatchEvent(tq),1===i.t&&n.dispatchEvent(eq)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(!1===Jn(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},1e3*this.data.delay)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(!1===Jn(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward;try{this.playing?(this.animation?.pause(),this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(eq),this.page.activeCamera.dispatchEvent(tq))},1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},nq=class extends wo{constructor(e,t,i,n,r){super(),this.page=t,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let o=e.object,s=t.scene.find(e.object);s&&Array.isArray(s.identity)&&(o=s.identity[0]),this.data={...e,object:o};let a=this.animationControls.clipIdToAction[e.clipId+"/"+o];this.duration=a?.getClip()?.duration??1;let l=a?.getClip()?.tracks[0]?.times.length??1/0;this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration,this.startOnceDelay=e.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(e=!1){if(!1===Jn(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,n])=>{let r=i.split("/")[1];this.threeAnimAction!==n&&r===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=et.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(!1===Jn(this.shared,this.condition))return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,r])=>{let o=n.split("/")[1];this.threeAnimAction!==r&&o===i&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())}),t&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();e&&(e.duration=this.duration),this.pause()}},rq=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(!1===Jn(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{"ParticleSystem"===t.type&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),JM(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},oq=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Jn(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let e=this.shared.getVariable(this.data.variableId),t=Mj(this.data.expression,this.shared,oa.typeOfVariable(e));void 0!==t&&this.shared.updateVariable(this.data.variableId,"string"==typeof t?{textValue:t}:t)}dispose(){}},sq=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(!1===Jn(this.shared,this.condition))return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===e?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==e)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===e?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==t&&!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===t&&(e=this.data.pauseDelay),0!==e?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function Jn(e,t){if(void 0===t)return!0;if(0===t.expression.length)return!1;let i=Mj(t.expression,e,"boolean");return t.negate?!i:!!i}function bs(e,t,i,n,r,o){let s={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},a=l=>({id:c,data:h})=>{try{"Audio"===h.type?Os[e.type].includes("Audio")&&s.Audio.push(new pW(c,h,o,n,l)):"Video"!==h.type||o instanceof lo?"Particles"===h.type?Os[e.type].includes("Particles")&&s.Particles.push(new fW(h,i,n,l)):"Link"===h.type?Os[e.type].includes("Link")&&s.Link.push(new DEe(h,r.controlsManager,n,l)):"Create"===h.type?Os[e.type].includes("Create")&&s.Create.push(new dq(h,i,r.controlsManager,n,l)):"Destroy"===h.type?Os[e.type].includes("Destroy")&&s.Destroy.push(new gW(h,i,r.controlsManager,n,l)):"Reset"===h.type?Os[e.type].includes("Reset")&&s.Reset.push(new vW(h,i,n,r,l)):"Transition"===h.type?Os[e.type].includes("Transition")&&s.Transition.push(new JW(h,i,n,l)):"SwitchCamera"===h.type?Os[e.type].includes("SwitchCamera")&&s.SwitchCamera.push(new iq(h,i,n,l)):"SceneTransition"===h.type?Os[e.type].includes("SceneTransition")&&s.SceneTransition.push(new rq(h,i,r,n,l)):"Animation"===h.type?Os[e.type].includes("Animation")&&s.Animation.push(new nq(h,i,r.animationControls,n,l)):"SetVariable"===h.type?Os[e.type].includes("SetVariable")&&s.SetVariable.push(new oq(h,i,n,l)):"DynamicVariablePlay"===h.type?Os[e.type].includes("DynamicVariablePlay")&&s.DynamicVariablePlay.push(new sq(h,i,n,l)):"Conditional"===h.type&&Os[e.type].includes("Conditional")&&(h.ifActions.forEach(a({expression:h.condition,negate:!1})),h.elseActions.forEach(a({expression:h.condition,negate:!0}))):Os[e.type].includes("Video")&&s.Video.push(new lq(c,h,o,n,l))}catch{}};return t.forEach(a()),s}function po(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof pW||i instanceof lq||i instanceof fW||i instanceof nq||i instanceof JW||i instanceof dq||i instanceof gW||i instanceof iq||i instanceof rq||i instanceof vW||i instanceof oq||i instanceof sq)&&i.dispose()})})}var aq=new Map,N4=new Map,_0=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:o,delay:s}=t;if(this.object=i,void 0===n)throw new Error("Missing property");let a=function UDe(e,t){let i;if("material"in e&&(i=Array.isArray(e.material)?e.material[0].layers.find(r=>r.uuid===t):e.material.layers.find(r=>r.uuid===t)),i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}(i,n);a&&(this.videoElement=a,this.videoElement.loop=r===1/0,Tw&&(this.videoElement.autoplay=!0),void 0!==o&&(this.videoElement.volume=o)),void 0!==s&&(this.delay=s),N4.has(i.uuid)?N4.get(i.uuid).push(this):N4.set(i.uuid,[this]),aq.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();void 0!==i&&i.then(n=>{}).catch(n=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},tz=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=aq.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=N4.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...N4.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},lq=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new _0(e,t,i);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new tz(t)}}dispatchBasic(){if(!1===Jn(this.shared,this.condition))return!1;this.interaction instanceof _0?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===Jn(this.shared,this.condition))return!1;this.interaction instanceof _0?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},cq=(()=>{let e,t,i,n;function r(a){!e&&!hq()&&t?.sharedGameControlGlobals.createdObjects.length>0&&(e=requestAnimationFrame(o)),a&&(t=a,n=a.requestRender)}function o(a){let l=i?a-i:0,c=t.sharedGameControlGlobals.createdObjects,h=t.sharedGameControlGlobals.nCreatedPerAction,u=c.length,d=0;for(;d<u;){let p=c[d];void 0===p.userData.createdTime&&(p.userData.createdTime=a),void 0===p.userData.lifetime&&void 0===p.userData.quantity||p.userData.lifetime&&a-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&h[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),n()),d++):(h[p.userData.actionId]>p.userData.quantity&&h[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>void 0!==f.bvhGeometry)),u--,n())}e=d>0?requestAnimationFrame(o):void 0,i=d>0?a:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",function s(){hq()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):r()}),r})();function hq(){return!!document&&document.hidden}var uq=new qt,jDe=new T,YDe=new T,dq=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=et.generateUUID(),this.dispatch=()=>{if(!1===Jn(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===Jn(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=function O_e(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ll(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Mw(e,t,{leading:n,maxWait:t,trailing:r})}(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let s=new qo(this.object);if(s.playModeVisible=!0,s.expand(),"world"!==this.data.coordinateSystem){let c=this.page.scene.find(this.data.coordinateSystem);c&&(c.updateMatrixWorldSVD(),s.hiddenMatrix.copy(c.matrixWorldRigid))}s.position.fromArray(this.data.position),s.rotation.fromArray(this.data.rotation),s.updateMatrix(),this.page.add(s);let a=this.controlsManager.sharedGameControlGlobals;a.createdObjects.push(s),void 0===a.nCreatedPerAction[this.uniqueId]?a.nCreatedPerAction[this.uniqueId]=1:a.nCreatedPerAction[this.uniqueId]++,s.updateWorldMatrix(!0,!0),s.traverseObject(this.traverseObjectCB),cq(),this.controlsManager.requestRender()},this.traverseObjectCB=s=>{let a;if(s.hasNonUniformScale&&s.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){if(s instanceof dl){if(!s.objectForSample)return!0===s.object.dataPatched.physics.fusedBody&&"dynamic"===s.object.dataPatched.physics.rigidBody||void 0;if(s.objectForSample.dataPatched.physics.fusedBody)return;a=s.object}else if(s instanceof qo)a=s.object;else if(a=s,a.dataPatched.cloner?.hideBase)return!0}else{if(s instanceof dl)return;a=s instanceof qo?s.object:s}"Time"===this.data.destroy?s.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(s.userData.quantity=this.data.destroyAfterQuantity,s.userData.actionId=this.uniqueId);let l=(new T).fromArray(this.data.velocity),c=a.dataPatched;if(!("visibility"===c.physics.enabled?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(s,a,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(s.rigidBody?.collider(0).setActiveEvents(1),s.userData.hasCollisionDestroy=!0),s.matrixWorld.decompose(jDe,uq,YDe),l.applyQuaternion(uq),this.data.velocity.some(h=>0!==h)&&this.data.dynamic&&s.rigidBody?.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in s.object&&this.controlsManager.addBoundsTree(s),this.data.velocity.some(h=>0!==h)&&this.data.dynamic&&(s.userData.velocity=l)),!0===a.dataPatched.physics?.fusedBody))return!0};let o=this.page.scene.find(this.data.object);if(!o)throw new Error("Missing Property");if(this.object=o,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");cq(i)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},fq=(new T,new T),mq=new T,WDe=new T,xs=new T,Vs=new T,Lu=new T,rz=new De,gq=new De,qDe=new De,yl=(new De,new qt),Th=new qt,gc=new Ur(0,0,0,"YXZ"),XDe=new T(1,0,0),_l=new T(0,1,0),$De=new T(0,0,1),vq=new T(1,1,1),fo=(new Ps,new Ca),Oa=new dr,eAe={type:"requestRender"},tAe={type:"updateMatrix"},_q=Math.PI/6,oz=class extends wo{constructor(e,t,i,n,r,o,s,a,l){super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=o,this.camera=s,this.page=a,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new De,this.target0=new T,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new Ur(0,0,0,"YXZ"),this.position0Cam=new T,this.quat0Cam=new qt,this.scale0Cam=new T,this.hiddenMatrix0Cam=new De,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Ca(new T(0,-40,0),new T(0,40,0)),matrix:new De,position:new T,rotation:new qt},this.euler=new Ur(0,0,0,"YXZ"),this.eulerDelta=new T,this.lastPosition=new T,this.lastCameraQuaternion=new qt,this.lastCameraPosition=new T,this.PI_2=Math.PI/2,this.prevMouse=new $,this.velocityTarget=new T,this.velocity=new T,this.directionXZ=new T,this.rotVelocityStick=new T,this.rotVelocityTarget=new T,this.rotVelocity=new T,this.rotDirection=new T,this.nonColliderRotOffset=new De,this.nonColliderPosOffset=new De,this.firstPointerId=-1,this.rot=new T,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new De,this.objectToTarget=new T,this.objectToTarget0=new T,this.objectToCamXZ=new T,this.objectToCamXZ0=new T,this.targetToCamera=new T,this.targetToCamera0=new T,this.cameraPolarAxis0=new T,this.targetPos=new T,this.targetQuat=new qt,this.lerpFactorPos=(new T).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new qt,this.objXZQuatInv=new qt,this.objXZRotMat=new De,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new T,this.pushedVelocity=new T,this.groundYRotation=0,this.objectRealQuat=new qt,this.colliderWorldQuat=new qt,this.groundNormal=new T,this.groundTilt=new qt,this.groundTiltInv=new qt,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new T,this.quaternion=new qt,this.scale=new T,this.initialAction=!0,this.onPointerDown=f=>{f.target!==this.domElement||-1!==this.firstPointerId||(this.firstPointerId=f.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!ia&&(!WV||qV>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(f.clientX,f.clientY))},this.onPointerUp=f=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===f.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=f=>{if(f.pointerId!==this.firstPointerId)return;let m=f.clientX-this.prevMouse.x,g=f.clientY-this.prevMouse.y;this.prevMouse.set(f.clientX,f.clientY),"mouse"===f.pointerType&&"keys"!==this.rotBy&&(WV&&qV<15.5&&!ia?(this.eulerDelta.y=-m*this.mouseOrbitSensitivity,this.eulerDelta.x=-g*this.mouseOrbitSensitivity):(this.eulerDelta.y=-f.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-f.movementY*this.mouseOrbitSensitivity)),"mouse"!==f.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-m*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-g*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=f=>{oz.isLocked=this.domElement.ownerDocument.pointerLockElement===this.domElement},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let f in this.movementState)this.movementState[f]=0},this.onKeyDown=f=>{!(f.target instanceof HTMLInputElement)&&("ArrowLeft"===f.code||"ArrowUp"===f.code||"ArrowRight"===f.code||"ArrowDown"===f.code||"Space"===f.code)&&f.preventDefault();for(let m of this.keyAssignments)if(f.key.toUpperCase()===m[1]||f.key===m[1]){this.movementState[m[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=f=>{for(let m of this.keyAssignments)if(f.key.toUpperCase()===m[1]||f.key===m[1]||f.code.slice(3,f.code.length).toUpperCase()===m[1]){this.movementState[m[0]]=0;break}},this.copyVRGamePadValues=(f,m)=>{for(let g=2;g<4;g++){let v=f.axes[g];0===m?2===g?this.movementState.movePosX=v:this.movementState.movePosZ=v:(this.movementState.jump=f.buttons[3].pressed?1:0,2===g?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(v)>=.3&&(this.vrEulerYOffset+=v<0?1:-1),this.movementState.rotPosY=v):"fly"===this.moveMode&&(this.movementState.moveNegY=v))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===s&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),h=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,h,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let g,v,f=new T(0,0,-1).applyQuaternion(this.camera.quaternion),m=(new T).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(m),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(f.y)<1e-6?(m.y=0,f.y=0,v=m.projectOnVector(f)):v=f.multiplyScalar(m.y/f.y>0?m.y/f.y:m.length()),this.targetToCamera0.copy(v).negate(),g=this.camera.position.clone().add(v),this.objectToTarget0.subVectors(g,this.position);let y=(new Ur).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-y.x,y.x=0,y.z=0,y.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(y)}if(this.object instanceof $o&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=1*(i.speedTranslate??250),this.speedOrbit=.025*(i.speedRotate??100),this.mouseOrbitSensitivity=16e-6*(i.speedRotate??100),this.keyAssignments=i.keyAssignments.map(f=>{let m=[f[0],f[1]];return"\u25b2"===m[1]?m[1]="ArrowUp":"\u25c0"===m[1]?m[1]="ArrowLeft":"\u25bc"===m[1]?m[1]="ArrowDown":"\u25b6"===m[1]?m[1]="ArrowRight":"\u21e7"===m[1]?m[1]="Shift":"\u21b5"===m[1]?m[1]="Enter":"Space"===m[1]?m[1]=" ":"\u2318"===m[1]?m[1]="Meta":"Ctrl"===m[1]?m[1]="Control":"Esc"===m[1]&&(m[1]="Escape"),m}),"mouse"===i.rotBy){let f;f=this.keyAssignments.findIndex(m=>"rotNegX"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotPosX"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotPosY"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotNegY"===m[0]),-1!==f&&(this.keyAssignments[f][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(i.delayPos[0]??.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(i.delayPos[1]??.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(i.delayRot[0]??.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(i.delayRot[1]??.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(i.delayPosCamera??.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(i.delayRotCamera??.3))),this.gravity=12*(this.gloabalPhysics.gravity??kf.defaultData.gravity),this.usePhysics=this.gloabalPhysics.usePhysics??kf.defaultData.usePhysics,this.jumpPower=20*i.jumpPower,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??d6.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=.02*i.collider.height/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height):"sphere"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*.02/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*i.collider.radius):(this.offset=.02*i.collider.height/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let u=(new T).fromArray(i.collider.position),d=(new qt).setFromEuler((new Ur).fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(u).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(u,d,vq),void 0!==i.cameraXAxis&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=2*i.navmesh.destinationHelperRadius;if(p>0){let f=new xt;f.push({fi:0,data:{...ao.defaultData("light","phong"),alpha:0},id:"layer1"}),f.push({fi:0,data:{...ao.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let m=new LS({layers:f},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new Dr(WU.create({parameters:{width:p,height:p/10,hollow:.7}}),m),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=(new Ur).setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof $o?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;void 0!==e.gameActions&&(this.actions={},u6.list.forEach(i=>{this.actions[i]=bs({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),po(this.actions.idle),po(this.actions.move),po(this.actions.run),po(this.actions.jump)}dispatchStartEvent(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(!1===this.initialAction)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return xs.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let n=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let r=60*n,o=!1;if(this.usePhysics&&this.collisionEnabled){let a=Vs.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*n,0).divideScalar(this.pixelsPerMeter),l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,a,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(l){this.onObject=!0,this.groundNormal.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(o=!0),0===l.collider.parent()?.bodyType()&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let c=l.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let h of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(h.rigidBody===c&&h.userData.isFollowingObj!==this.object.uuid){(h.hasNonUniformScale?h.matrixWorldRigid:h.matrixWorld).decompose(xs,Th,Vs),this.groundVelocity.subVectors(xs,h.prevT),this.object.getWorldPosition(Vs).add(this.collider.position).sub(xs),this.groundYRotation=gc.setFromQuaternion(Th).y-h.prevR.y,Lu.copy(Vs).applyAxisAngle(_l,this.groundYRotation),this.groundVelocity.add(Lu.sub(Vs)).divideScalar(n);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*r),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let a=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let l=xs.subVectors(this.path[1],this.position),c=Vs.subVectors(this.path[1],this.path[0]);l.dot(c)<0?this.path.shift():(this.directionXZ.x=c.x,this.directionXZ.z=c.z),a.opacity=a.userData.opacity0}else a.opacity-=.05*a.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.moveForce=this.movementState.run?this.runMultiplier:1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**r),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**r),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**r)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let s=WDe.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let a=Vs.copy(s);a.y=0,s.set(0,s.y,a.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&&!1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let a=xs;this.camera.getWorldDirection(a);let l=Lu.copy(_l).multiplyScalar(a.dot(_l));a.sub(l);let c=Vs.copy(this.directionXZ);c.x*=-1,this.rot.y=a.angleTo(c)*(a.cross(c).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(gc.setFromVector3(this.rot),"walk"===this.moveMode&&(gc.x=0),s.applyEuler(gc),o&&(Th.setFromUnitVectors(_l,this.groundNormal),s.applyQuaternion(Th)),i){let a=gc.set(0,this.vrEulerYOffset*_q,0);i.applyEuler(a),s.x+=i.x,s.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*n}if(!0===this.usePhysics){let a=Vs;this.pushedVelocity.set(0,0,0);for(let l of this.sharedGameControlGlobals.entitiesWithTransformAnim){let c=Lu.setFromMatrixPosition(l.matrixWorld).sub(l.prevT).divideScalar(n).divideScalar(this.pixelsPerMeter),h=l.rigidBody.collider(0).castCollider(c,this.object.rigidBody.collider(0),xs.copy(s).divideScalar(this.pixelsPerMeter),n,!1);c.multiplyScalar(this.pixelsPerMeter);let u=Ti.is(l)?l:l.object;if(null!==h&&this.lastHitObj!==u){let d;l instanceof qo&&(d=l);let p=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(p)for(let f of p)"character"===f.data.target&&(f.dispatch(d),u.dispatchEvent(bz));this.lastHitObj=u}if(null!==h){this.pushedVelocity.copy(c),a.copy(h.normal1).applyQuaternion(l.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let l=a.dot(s);l<0&&s.addScaledVector(a,-l),s.add(this.pushedVelocity)}else s.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotVelocityStick.x="normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?-this.rotDirection.x*this.speedOrbit*this.rotForce:0,this.rotVelocityStick.y="normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?-this.rotDirection.y*this.speedOrbit*this.rotForce:0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(n),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**r):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**r),this.euler.x+=this.rotVelocity.x*n,this.euler.y+=this.rotVelocity.y*n+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*n),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(_l,this.euler.y-this.euler0.y);let a=Vs.copy(this.objectToCamXZ).normalize(),l=Lu.copy(s).multiplyScalar(n);l.y=0;let c=l.sub(xs.copy(a).multiplyScalar(l.dot(a))).cross(a).y;this.euler.y-=Math.atan2(c,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*n+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?this.euler.x="Limit"===this.cameraXAxis?et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=et.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(gc.copy(t),gc.y=0):(gc.copy(this.euler),gc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(gc)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*_q),yl.setFromAxisAngle(XDe,this.rot.x),Th.setFromAxisAngle(_l,this.rot.y),Th.multiply(yl),yl.setFromAxisAngle($De,this.rot.z),Th.multiply(yl),this.quaternion.copy(Th),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let a=Vs.copy(s).multiplyScalar(n/this.pixelsPerMeter),l=null;this.didHit=!1;let c=new T;for(let h=0;h<5;h++){let u=a.length(),d=Lu.copy(a).normalize();if(l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),this.colliderWorldQuat,d,this.object.rigidBody?.collider(0).shape,u,!1,24,void 0,void 0,this.object.rigidBody),null===l){0===h&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),c.add(a);break}{this.didHit=!0;let p=this.sharedGameControlGlobals.colliderToEntity.get(l.collider.handle);if(p!==this.lastHitObj&&0===h){this.lastHitObj=p;let v=this.sharedGameControlGlobals.entityToCollisionEvents[p?.uuid];if(v)for(let y of v)if("character"===y.data.target){let b,_=this.sharedGameControlGlobals.rapierWorld?.getCollider(l.collider.handle)._parent;if(p.cloner)for(let x of p.cloner.children)if(x.rigidBody===_){b=x;break}y.dispatch(b),p.dispatchEvent(bz)}}let f=fq.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat),m=mq.copy(d).multiplyScalar(l.toi).dot(f),g=l.toi;if(0===g&&(this.position.y+=this.offset*this.pixelsPerMeter),m>this.offset&&(g=l.toi*(m-this.offset)/m,c.addScaledVector(d,g)),a.copy(d).multiplyScalar(u-g),Math.acos(-f.y)>this.slopeThresh){let v=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),y=Lu.copy(l.witness2).applyQuaternion(this.colliderWorldQuat);y.y=0;let _=v.add(y);_.y+=this.stepThresh;let b=this.sharedGameControlGlobals.rapierWorld.castShape(_,this.colliderWorldQuat,a,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==b&&0===b.toi&&(f.y=0,f.normalize())}a.addScaledVector(f,-a.dot(f))}}this.position.addScaledVector(c,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(xs.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(yl.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let a=this.onObject?1:5,l=s.multiplyScalar(n/a);for(let c=0;c<a;c++)this.position.add(l),this.collisionAdjustment(n/a)}else this.position.addScaledVector(s,n);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let a=this.objectToTarget.add(this.position),l=this.targetToCamera.add(a);rz.lookAt(l,a,_l).setPosition(l),rz.decompose(this.targetPos,this.targetQuat,xs),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**r),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**r),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=et.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=et.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(tAe),!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&("fly"===this.moveMode||!0===this.onObject||!1===this.collisionEnabled)&&(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0)||(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(eAe),0))}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t,e=yl.setFromAxisAngle(_l,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?et.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(e),t="Limit"===this.cameraXAxis?et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=xs.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&i.applyQuaternion(e);let n=Th.setFromAxisAngle(i,t);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(e),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(e){180*_l.angleTo(e)/Math.PI<15||180*_l.angleTo(e)/Math.PI>85?yl.identity():yl.setFromUnitVectors(_l,e),this.groundTilt.slerp(yl,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){let t=mq.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=rz.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(xs,yl,Vs).compose(xs,yl,vq);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(r=>{if(r===this.object||r.isDescendantOf(this.object))return;Oa.makeEmpty(),r.updateMatrixWorldSVD();let o=r.matrixWorldRigid,s=gq.copy(o).invert(),a=qDe.copy(gq).multiply(i);fo.copy(this.collider.segment),fo.start.applyMatrix4(a),fo.end.applyMatrix4(a);let l=fq.copy(this.position).applyMatrix4(s);Oa.expandByPoint(fo.start),Oa.expandByPoint(fo.end),Oa.min.addScalar(-this.collider.radius),Oa.max.addScalar(this.collider.radius),r.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:c=>c.distanceToPoint(fo.end),intersectsBounds:c=>c.intersectsBox(Oa),intersectsTriangle:c=>{let h=xs,u=Vs,d=c.closestPointToSegment(fo,h,u);if(d<this.collider.radius){let p=this.collider.radius-d,f=u.sub(h).normalize(),m=Lu.copy(l);m.addScaledVector(f,p);let g=m.applyMatrix4(o).sub(this.position);t.add(g),fo.start.addScaledVector(f,p),fo.end.addScaledVector(f,p)}}})}),Oa.makeEmpty(),fo.copy(this.collider.segment),fo.start.applyMatrix4(i),fo.end.applyMatrix4(i),Oa.expandByPoint(fo.start),Oa.expandByPoint(fo.end),Oa.min.addScalar(-this.collider.radius),Oa.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder:r=>r.distanceToPoint(fo.end),intersectsBounds:r=>r.intersectsBox(Oa),intersectsTriangle:r=>{let o=xs,s=Vs,a=r.closestPointToSegment(fo,o,s);if(a<this.collider.radius){let l=this.collider.radius-a,c=s.sub(o).normalize();this.alignToGround&&this.groundTiltAdjustment(c),t.addScaledVector(c,l),fo.start.addScaledVector(c,l),fo.end.addScaledVector(c,l)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let n=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(n),this.position.add(t)}},bq=oz;bq.isLocked=!1;var iAe=Qc(JL());function Eh(e,t){let i=new gt;if(!e.getAttribute("position"))return i.setAttribute("position",new Ke([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=V6(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Ke(n,3)),i.setIndex(r),t&&i.applyMatrix4(t),i}var nAe=new De,rAe=new De,vc=[[0,0,0],[0,0,0],[0,0,0]];function xq(e){let t=e.elements;vc[0][0]=t[0],vc[0][1]=t[4],vc[0][2]=t[8],vc[1][0]=t[1],vc[1][1]=t[5],vc[1][2]=t[9],vc[2][0]=t[2],vc[2][1]=t[6],vc[2][2]=t[10];let{u:i,v:n}=(0,iAe.SVD)(vc),r=nAe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),o=rAe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(o.transpose())}var oAe=class extends yB{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(n=>{n.visible&&this.intersectObject(n,t,i)}),i}createRaycastLineHelper(){let e=new au({color:65280,linewidth:10}),t=new T(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new T(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=(new T).addVectors(t,i.multiplyScalar(n)),o=new gt;return o.setFromPoints([t,r]),new Zv(o,e)}},wq=e=>e instanceof m0||e instanceof v0;function sAe(e,t){return e.distance-t.distance}function Cq(e,t,i){if(gh(t)&&t.visible){fl(t)&&t.raycast(e,i);for(let n of t.children)Cq(e,n,i)}}function Ey(e,t,i,n=!1){if(!n&&!i.some(o=>void 0!==Dy(e,o)))return[];let r=[];return t.children.forEach(o=>Cq(e,o,r)),r.sort(sAe),r}function sz(e){let t=[];if(e.length){let i=e[0].object;gh(i)&&t.push(i);let n=i.parent;for(;n;)wq(n)&&t.push(n),n=n.parent}return t}function Dh(e,t,i,n){let r=e.frame;if(r){let o=t[0]*r.width,s=(1-t[1])*r.height;for(let a of i){let l=a===r.uuid?r:r.find(a);if(l?.intersects(o,s))return n(l),!0}}return!1}function Dy(e,t){if(fl(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(wq(t))return Sq(e,t)}function Sq(e,t){if(gh(t)&&t.visible){if(fl(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let n=Sq(e,i);if(n)return n}}}var bl=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},az=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Mq=e=>az.find(([t,i])=>i===e)?.[0],L4=e=>az.find(([t])=>t===e)?.[1],hAe=(e,t)=>{let i=Mq(e);if(i){let n=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(n,"target",{writable:!1,value:t}),n}},uAe=class extends bl{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=i=>{if(!i.eventName||!i.target||"Scroll"===i.eventName)return;let n=this.splineEvents[Mq(i.eventName)]?.[i.target.uuid];if(!n)return;"Scroll"===i.eventName&&void 0!==i.deltaY&&Object.assign(n,{deltaY:i.deltaY});let{domElement:r}=this.eventContext;r.dispatchEvent(n)};let{page:t}=this.eventContext;t.traverseEntity(i=>{if(i.data?.events.length)for(let[n,r]of az)if(i.data.events.some(o=>o.data.type===r&&!o.data.disabled)){this.objectsPerEvents.has(n)?this.objectsPerEvents.get(n)?.push(i):this.objectsPerEvents.set(n,[i]);let s=hAe(r,{id:i.uuid,name:i.name}),a=this.splineEvents[n];a?a[i.uuid]=s:this.splineEvents[n]={[i.uuid]:s}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},dAe=class{constructor(e,t,i,n,r,o){if(this.id=e,this.data=t,this.object=i,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle="Toggle"===t.runMode,("KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type)&&!t.key)throw new Error("Missing property");this.actions=bs(t,t.actions,n,r,o,i)}disconnect(){po(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(t)}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()}),this.actions.SwitchCamera.forEach(t=>{t.toggle()})):"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing)||this.actions.Transition.forEach(t=>{!1===this.alreadyPlayedNonTogglingActions.has(t)&&t.play()}),this.actions.SwitchCamera.some(t=>t.playing)||this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),!1===e&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},pAe=class extends bl{constructor(e,t,i){super(e),this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=s=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(s);let{raycaster:a,page:l}=this.eventContext,c=Ey(a,l,[],!0);this.sceneInterects=c,c.length&&(this.eventContext.sharedAssets.raycastProperty={x:c[0].point.x,y:c[0].point.y,z:c[0].point.z,objX:c[0].object.matrixWorld.elements[12],objY:c[0].object.matrixWorld.elements[13],objZ:c[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=s=>{(s.target===this.eventContext.domElement||"SPLINE-VIEWER"===s.target.tagName)&&this.canvasMouseEvents.forEach(a=>{("MouseDown"===a.data.type||"MousePress"===a.data.type)&&(this.onCanvasRaycast(s),a.dispatch())})},this.onCanvasMouseUp=s=>{(s.target===this.eventContext.domElement||"SPLINE-VIEWER"===s.target.tagName)&&this.canvasMouseEvents.forEach(a=>{"MouseUp"===a.data.type?(this.onCanvasRaycast(s),a.dispatch()):"MousePress"===a.data.type&&a.dispatchRelease()})},this.onMouseDown=s=>{Ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseEvent("MouseDown"))},this.onMouseUp=s=>{Ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=s=>{Ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMousePressEvent())},this.onMousePressRelease=s=>{Ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMousePressEvent(!0))},this.onKeyDown=s=>{this.heldKeys[s.key]||(this.handleKeyEvent(s,"KeyDown"),this.handleKeyEventHeld(s,"KeyDown",!0)),this.heldKeys[s.key]=!0},this.onKeyUp=s=>{this.handleKeyEvent(s,"KeyUp"),this.handleKeyEventHeld(s,"KeyUp",!0)},this.onKeyPressDown=s=>{this.heldKeysPress[s.key]?this.handleKeyEventHeld(s,"KeyPress"):(this.handleKeyEvent(s,"KeyPress"),this.handleKeyEventHeld(s,"KeyPress",!0)),this.heldKeysPress[s.key]=!0},this.onKeyPressUp=s=>{this.handleKeyEvent(s,"KeyPress",!0)},this.releaseHeldKey=s=>{delete this.heldKeys[s.key]},this.releaseHeldKeyPress=s=>{delete this.heldKeysPress[s.key]},this._onUserEvent=({eventName:s,target:a,reverse:l})=>{if(!s||!a)return;let c=L4(s);c&&("MouseDown"===c||"MouseUp"===c||"MousePress"===c?(a.dispatchEvent({type:"beginEvent",eventName:c}),this.eventsPerObjects[c]?.[a.uuid]?.forEach(h=>{h.dispatchUserEvent(l)})):("KeyDown"===c||"KeyUp"===c||"KeyPress"===c)&&(a.dispatchEvent({type:"beginEvent",eventName:c}),this.eventsPerObjects[c]?.[a.uuid]?.forEach(h=>{h.dispatchUserEvent()})))};let{page:n,sharedAssets:r}=this.eventContext,o=(s,a)=>{if(!s.data?.events.length)return;let l=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let c of l){let h=this.eventsPerObjects[c];s.data.events.filter(({data:u})=>u.type===c&&!0!==u.disabled).forEach(({id:u,data:d})=>{try{let p=new dAe(u,d,s,n,r,t);p.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==d.type&&"MouseUp"!==d.type&&"MousePress"!==d.type||"Canvas"!==d.mode&&"Window"!==d.mode?h[s.uuid]?h[s.uuid].some(f=>f.id===p.id)||h[s.uuid].push(p):h[s.uuid]=[p]:this.canvasMouseEvents.push(p)}catch{}}),h[s.uuid]?.length&&this.objectsPerTypes[c].push(s instanceof lo&&("MouseDown"===c||"MouseUp"===c||"MousePress"===c)?a:s)}};n.traverseEntity(s=>{(s instanceof Zo||s instanceof ho)&&s.frame?.traverse(a=>{o(a,s)}),o(s)})}connect(){let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),e.addEventListener("pointerdown",this.onCanvasMouseDown),e.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(n=>{n.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(n=>{n.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(n=>{n.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,o=this.objectsPerTypes[e],s=o.filter(a=>!(a instanceof lo));if((o.length||this.useForRaycastProperty)&&(!n.uiCanvas||!Dh(n,[r.x,r.y],Object.keys(this.eventsPerObjects[e]),a=>{this.handleObjectMouseEventDispatch(a,e)}))){if(t||this.useForRaycastProperty){let a;if(null===this.sceneInterects?a=Ey(i,n,s,this.useForRaycastProperty):(a=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]}),t){let l=[a[0]?.uv?.x??0,a[0]?.uv?.y??0];sz(a).forEach(c=>{c instanceof Zo&&Dh(c,l,Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}),this.eventsPerObjects[e][c.uuid]&&this.handleObjectMouseEventDispatch(c,e)})}}t||s.forEach(a=>{let l=Dy(i,a);l&&(this.handleObjectMouseEventDispatch(a,e),a instanceof Zo&&Dh(a,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),c=>{this.handleObjectMouseEventDispatch(c,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],n=i.filter(o=>!(o instanceof lo)),r=[];if(i.length){if(!e){let{stopRaycast:o,raycaster:s,page:a,pointerScreen:l}=this.eventContext,c=!1;if(a.uiCanvas&&(c=Dh(a,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),h=>{r.push(h)})),o&&!c){let h=Ey(s,a,n);r=sz(h),h.forEach(u=>{u.object instanceof Zo&&Dh(u.object,[u?.uv?.x??0,u?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),d=>{r.push(d)})})}else n.forEach(h=>{let u=Dy(s,h);u&&(r.push(h),h instanceof Zo&&Dh(h,[u?.uv?.x??0,u?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),d=>{r.push(d)}))})}this._prevObjects.length&&this._prevObjects.forEach(o=>{r.includes(o)||this.handleObjectMouseEventDispatchRelease(o,t)}),r.length&&r.forEach(o=>{this.handleObjectMouseEventDispatch(o,t)}),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{let r=this.eventsPerObjects[t][n.uuid];r.some(({data:o})=>"key"in o&&o.key===e.key)&&n.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach(o=>{"key"in o.data&&o.data.key===e.key&&(i?o.dispatchRelease():o.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{this.eventsPerObjects[t][n.uuid].forEach(r=>{"key"in r.data&&r.data.key===e.key&&r.dispatchHeld(i)})})}},fAe=new T,mAe=new T,zq=class{constructor(e,t,i,n,r){this.actionsIn=bs(e,e.inActions,i,n,r,t),this.actionsOut=bs(e,e.outActions,i,n,r,t)}disconnect(){po(this.actionsIn),po(this.actionsOut)}},gAe=class extends zq{constructor(e,t,i,n,r,o){super(t,i,n,r,o),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=fAe.setFromMatrixPosition(this.objects[0].matrixWorld),h=mAe.setFromMatrixPosition(this.objects[1].matrixWorld),u=c.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==u){this.stage=u;let d="in"===u?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch())}};let{distance:s,fromObject:a,toObject:l}=t.condition;this.distance=s;for(let c of[a,l]){if(!c)throw new Error("Missing property");let h=n.find(c);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},vAe=class extends zq{constructor(e,t,i,n,r,o){super(t,i,n,r,o),this.id=e,this.data=t,this.object=i,this.onBegin=({state:c})=>{this.toState!==c&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()))},this.onComplete=({state:c})=>{this.toState===c&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()))};let{condition:s}=t;if(!s.object)throw new Error("Missing property");let a=n.find(s.object)??n.scene.find2D(s.object);if(!a)throw new Error("Missing property");if(this.toObject=a,s.state&&!this.toObject.states?.[s.state])throw new Error("Missing property");this.toState=s.state}connect(){qd(this.actionsOut).forEach(e=>{this.actionsOut[e]?.length&&this.toObject.addEventListener("beginState",this.onBegin)}),qd(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),qd(this.actionsOut).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),qd(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},yAe=class extends bl{constructor(e,t){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:i,sharedAssets:n}=this.eventContext;i.traverseEntity(r=>{if(r.data?.events.length)for(let{id:o,data:s}of r.data.events)if(!s.disabled&&"Conditional"===s.type)try{let a;"Comparison"===s.condition.type||("Distance"===s.condition.type?a=new gAe(o,s,r,i,n,t):"State"===s.condition.type&&(a=new vAe(o,s,r,i,n,t))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},R4=new T,Ru=new T,_1=new T,Tq=new ta,Xi=new T,qr=new T,Eq=new T,b1=new qt,lz=new Ur,bAe=new De,cz=new Vr,b0=new T,yc=new T;function hz(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var xAe=function(){let e=new De;return(t,i,n)=>{let r=t.obj;e.copy(r.hiddenMatrix),null!==r.parent&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(i),"global"===t.reference&&hz(r.position,t.limits),r.position.applyMatrix4(e),"parent"===t.reference?hz(r.position,t.limits):"local"===t.reference&&(b1.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(b1),hz(r.position,t.limits),b1.invert(),r.position.applyQuaternion(b1),r.position.add(t.position0)),e.multiply(n??r.matrixWorld).decompose(Xi,r.quaternion,qr),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof fs&&Ch(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),CAe=class extends bl{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=n=>{if(Ot.length>1)return;this.eventContext.updateRaycaster(n);let{raycaster:r,page:o}=this.eventContext,s=o.raycastWithClones(r);if(this.lastDropDestination=null,0!==s.length){for(let a of this.events){let l=0;for(let{obj:c,pointEnd:h,pointStart:u}of a.dragItems){if(c===s[0].object||c===s[0].object.object||Ti.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(a.activeIdx=l,a.activeDragItem.reset=!1,a.activeDragItem.currentDampingFactor=a.data.dampingFactor,a.activeDragItem.snapped=!1,"hand"===a.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){a.activeDragItem.obj.rigidBody&&a.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=a.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Xi,b1,qr),lz.setFromQuaternion(b1),void 0===d.prevR?(d.prevR=lz.clone(),d.prevT=Xi.clone()):(d.prevR.copy(lz),d.prevT.copy(Xi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(a.activeDragItem.obj)}return this.calcPlaneIntersectPos(c,u,a.data.plane,a.data.referenceFrame),h.copy(u),(this.eventManager.controlsManager.usePhysics&&"dynamic"===c.data.physics?.rigidBody||!1===a.data.drop||!1===a.data.resetOnSnapFail)&&a.activeDragItem.fromPosition.setFromMatrixPosition(a.activeDragItem.obj.matrixWorld),this.activeEvent=a,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}l++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=n=>{if(Ot.length>1)return;this.eventContext.updateRaycaster(n);let{raycaster:r,page:o}=this.eventContext,s=o.raycastWithClones(r);if(0!==Ot.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let l,a=this.activeEvent.activeDragItem;if(a.snapped=!1,this.activeEvent.data.drop&&(l=s.filter(c=>a.obj!==c.object&&!a.obj.isAncestorOf(c.object.uuid)&&!(c.object instanceof m0)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some(h=>h===c.object.uuid||o.scene.find(h).isAncestorOf(c.object.uuid))))[0]),l){let c=Eq.copy(l.face.normal).applyMatrix3(cz.getNormalMatrix(l.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)a.fromPosition.setFromMatrixPosition(l.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(a.fromPosition.copy(l.point),"bbox"===this.activeEvent.data.snapSurfaceMode){Xi.copy(c).applyMatrix3(cz.setFromMatrix4(a.obj.matrixWorld).transpose());let h=a.obj;Xi.x>.2?qr.x=-h.recursiveBBox.min.x:Xi.x<-.2&&(qr.x=-h.recursiveBBox.max.x),Xi.y>.2?qr.y=-h.recursiveBBox.min.y:Xi.y<-.2&&(qr.y=-h.recursiveBBox.max.y),Xi.z>.2?qr.z=-h.recursiveBBox.min.z:Xi.z<-.2&&(qr.z=-h.recursiveBBox.max.z),qr.applyMatrix3(cz.invert())}else qr.copy(c).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);a.fromPosition.add(qr)}this.activeEvent.data.autoOrient&&(Xi.set(0,1,0).cross(c),Xi.length()<1e-4&&Xi.set(-1,0,0).cross(c),qr.crossVectors(Eq,Xi),a.orientationMatrix.makeBasis(Xi,qr,c)),a.pointStart.copy(a.fromPosition),a.pointEnd.copy(a.pointStart),a.currentDampingFactor=this.activeEvent.snapDampingFactor,a.snapped=!0,this.lastDropDestination!==l.object&&(this.lastDropDestination=l.object,this.activeEvent.actionsDrop.Transition.forEach(h=>{h.play()}),this.activeEvent.actionsDrop.Animation.forEach(h=>{h.play()}),this.activeEvent.actionsDrop.Audio.forEach(h=>{h.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(h=>{h.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(h=>{h.dispatchThrottled()}))}else a.orientationMatrix.makeRotationFromQuaternion(a.quat0),this.lastDropDestination=null,a.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(a.obj,a.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(c=>{c.stop(),null!==c.object.currentState&&c.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(c=>{c.stop()}),this.activeEvent.actionsDrop.Audio.forEach(c=>{c.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(c=>{c.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(c=>{c.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(c=>c.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(c=>c.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(c=>c.dispatch()),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(c=>{c.play()}),this.activeEvent.actionsDrag.Animation.forEach(c=>{c.play()}),this.activeEvent.actionsDrag.Audio.forEach(c=>{c.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(c=>{c.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(c=>{c.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(c=>{c.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(c=>{c.stop(),null!==c.object.currentState&&c.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(c=>{c.stop()}))},500),this.updateDragItem(a),a.obj.dispatchEvent({type:"requestRender"})}}else{let a=!1;for(let l of this.events){for(let{obj:c}of l.dragItems)if(c===s[0]?.object||c===s[0]?.object?.object||Ti.is(c)&&c.isAncestorOf(s[0]?.object.uuid)){switch(a=!0,l.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}if(a)break}a||this.setCursor("default")}},this.onPointerUp=n=>{if(this.activeEvent&&this.activeEvent.activeDragItem){"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let r="dynamic"===this.activeEvent.activeDragItem.obj.data.physics?.rigidBody;!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(o=>{o.stop(),null!==o.object.currentState&&o.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(o=>{o.stop()}),this.activeEvent.actionsDrag.Audio.forEach(o=>{o.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(o=>{o.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(o=>o.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(o=>o.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(o=>o.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let i={};e.page.traverseEntity(n=>{n.component&&(i[n.component.uuid]?i[n.component.uuid].push(n.uuid):i[n.component.uuid]=[n.uuid])}),e.page.traverseEntity(n=>{n.data?.events.filter(r=>"DragDrop"===r.data.type&&!r.data.disabled).forEach(r=>{this.events.push(new class{constructor(e,t,i,n,r,o){this.object=e,this.data=t,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=bs(t,t.dragDropActions.drag,i,n,r,this.object),this.actionsDrop=bs(t,t.dragDropActions.drop,i,n,r,this.object);let s=[];this.data.objects.forEach(a=>{let l=i.find(a);!l||!1!==l.data.visible&&(s.push(l),o[l.uuid]&&o[l.uuid].forEach(c=>{let h=i.find(c);!h||!1!==h.data.visible&&s.push(h)}))}),this.data.dropDestinations.forEach(a=>{let l=i.find(a);!l||!1!==l.data.visible&&(this.dropDestIds.push(l.uuid),o[l.uuid]&&o[l.uuid].forEach(c=>{let h=i.find(c);!h||!1!==h.data.visible&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=s.map(a=>("locked"===this.data.planeMode&&(a.userData.lockedPlane=!0),a.userData.worldPosition0=(new T).setFromMatrixPosition(a.matrixWorld),{obj:a,fromPosition:(new T).setFromMatrixPosition(a.matrixWorld),pointStart:new T,pointEnd:new T,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new T).copy(a.position),quat0:(new qt).copy(a.quaternion),snapped:!1,orientationMatrix:new De,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){po(this.actionsDrag),po(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}}(n,r.data,e.page,e.sharedAssets,t,i))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,n){let{getCamera:r,raycaster:o}=this.eventContext;r().getWorldDirection(Ru),Ru.negate();let s=b1.identity();switch("parent"===n?bAe.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Xi,s,qr):"local"===n&&e.matrixWorld.decompose(Xi,s,qr),i){case"x":Xi.set(1,0,0).applyQuaternion(s),b0.copy(Ru).cross(Xi),yc.copy(Xi).cross(b0);break;case"y":Xi.set(0,1,0).applyQuaternion(s),b0.copy(Ru).cross(Xi),yc.copy(Xi).cross(b0);break;case"z":Xi.set(0,0,1).applyQuaternion(s),b0.copy(Ru).cross(Xi),yc.copy(Xi).cross(b0);break;case"xy":yc.set(0,0,1).applyQuaternion(s);break;case"yz":yc.set(1,0,0).applyQuaternion(s);break;case"xz":yc.set(0,1,0).applyQuaternion(s);break;case"adaptive":Ru.angleTo(qr.set(0,1,0))>Math.PI/6?(Xi.crossVectors(qr.set(0,1,0),Ru),yc.crossVectors(Xi,qr)):yc.set(0,1,0);break;default:yc.copy(Ru)}_1.setFromMatrixPosition(e.matrixWorld);let a=e.userData.lockedPlane?e.userData.worldPosition0:_1;if(Tq.setFromNormalAndCoplanarPoint(yc,a),o.ray.intersectPlane(Tq,t)&&("x"===i||"y"===i||"z"===i)){let l=qr.subVectors(t,a).dot(Xi);t.copy(a).addScaledVector(Xi,l)}}updateDragItem(e,t=!1){_1.setFromMatrixPosition(e.obj.matrixWorld),"current"===e.reset?R4.subVectors(e.fromPosition,_1).divideScalar(e.currentDampingFactor):"original"===e.reset?(R4.subVectors(e.obj.userData.worldPosition0,_1).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):R4.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(_1).divideScalar(e.currentDampingFactor),e.paused=!(e.currentDampingFactor>1)||R4.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||t)&&xAe(e,R4.add(_1),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},w0=new T,uz=new T,Ah=new T,Ph=new T,Dq=new ta,MAe={type:"requestRender"},zAe=function(){let e=new T,t=new T;return(i,n,r)=>r>0?(e.subVectors(i,n),e.length()<=r?i:t.copy(n).add(e.normalize().multiplyScalar(r))):n}(),Aq=function(){let e=new De;return(t,i)=>{t.position.copy(i),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof fs&&Ch(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),EAe=class extends bl{constructor(e,t){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=n=>{if(!(Ot.length>1)){this.eventContext.updateRaycaster(n);for(let r of this.events)void 0===r.target&&this.updateSingleEvent(r)}},this.onMouseEnter=n=>{for(let r of this.events)void 0===r.target&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=n=>{for(let r of this.events)void 0===r.target&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=n=>()=>{this.updateSingleEvent(n)};let{page:i}=this.eventContext;i.traverseEntity(n=>{let r=n.data?.events.find(o=>"Follow"===o.data.type&&!o.data.disabled);r&&(!i.data.globalPhysics.usePhysics||"dynamic"!==n.dataPatched.physics?.rigidBody)&&this.events.push(new class{constructor(e,t,i,n,r){this.data=e,this.object=t,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new T,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...Kw.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=bs(e,e.actions,i,n,r,t)}}(r.data,n,i,e.sharedAssets,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ia&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(void 0!==i.target){let n=i.target,r=this.onTargetChange(i);this.pairOfEventListeners.push([n,r]),n.addEventListener("requestRender",r)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ia&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,po(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){this.events.forEach(s=>{s.actions.Create.forEach(a=>{a.dispatchThrottled()})});let{plane:i,limitDistance:n,limitDistanceEnabled:r}=e.data;if(e.object.getWorldPosition(Ah),e.isReset)Ph.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Ph);else{let{getCamera:s,raycaster:a}=this.eventContext;if("custom"===i?(s().getWorldDirection(uz),uz.negate(),w0.copy(uz)):"xy"===i?w0.set(0,0,1):"xz"===i?w0.set(0,1,0):"yz"===i&&w0.set(1,0,0),Dq.setFromNormalAndCoplanarPoint(w0,Ah),!a.ray.intersectPlane(Dq,Ph))return}if(!e.isReset)if(Ph.distanceTo(e.worldPosition0)>n&&r&&e.target){if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;Ph.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor}else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;!1===e.data.enabledTranslation[0]&&(Ph.x=Ah.x),!1===e.data.enabledTranslation[1]&&(Ph.y=Ah.y),!1===e.data.enabledTranslation[2]&&(Ph.z=Ah.z);let o=zAe(Ah,Ph,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let s=w0.subVectors(o,Ah).divideScalar(e.currentDampingFactor);Ah.add(s),t&&Aq(e.object,Ah),e.paused=s.length()<.01}else Aq(e.object,o),e.paused=!0;e.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(MAe)}},F4=new T,Ay=new T,B4=new De,C0=new qt,Fu=new qt,V4=new T,H4=new T,x1=new T,Ih=new T,dz=new ta,AAe={type:"requestRender"},PAe={type:"changeRotation"},Pq=function(){let e=new De;return function(t,i){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(xq(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof fs&&Ch(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),OAe=class extends bl{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=i=>{if(!(Ot.length>1)){this._lastMouseEvent=i,this.eventContext.updateRaycaster(i);for(let n of this.events)void 0===n.target&&this.updateSingleEvent(n)}},this.onMouseEnter=i=>{for(let n of this.events)void 0===n.target&&(n.isReset=!1,n.currentDampingFactor=n.data.dampingFactor)},this.onMouseLeave=i=>{for(let n of this.events)void 0===n.target&&(n.data.resetOnPointerLeave&&(n.isReset=!0,n.currentDampingFactor=n.resetDampingFactor),this.updateSingleEvent(n))},this.onScroll=i=>{if(this._lastMouseEvent){let n=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(n)}},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)},this.createUserEventListener=i=>({eventName:n,target:r})=>{if(!n||!r)return;let o=L4(n);o&&"LookAt"===o&&this.updateSingleEvent(i)};let{page:t}=this.eventContext;t.traverseEntity(i=>{let n=i.data?.events.find(r=>"LookAt"===r.data.type&&!r.data.disabled);n&&(!t.data.globalPhysics.usePhysics||"dynamic"!==i.dataPatched.physics?.rigidBody)&&this.events.push(new class{constructor(e,t,i){this.object=t,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new qt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...Jw.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}}(n.data,i,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ia&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?t.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(void 0!==i.target){let o=this.onTargetChange(i),s=i.target;this.pairOfEventListeners.push([s,o]),s.addEventListener("requestRender",o)}let n=this.createUserEventListener(i),r=i.object;this.pairOfUserEventListeners.push([r,n]),r.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ia&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){let{tilt:t,axis:i,distance:n,plane:r,limitDistance:o,enabledRotation:s,limitDistanceEnabled:a}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:h,target:u}=e;if(h.getWorldPosition(V4),!e.isReset)if(e.target)e.target.getWorldPosition(H4);else{if("custom"===r?(l().getWorldDirection(Ay),Ay.negate(),dz.setFromNormalAndCoplanarPoint(Ay,V4)):("xy"===r?F4.set(0,0,1):"xz"===r?F4.set(0,1,0):"yz"===r&&F4.set(1,0,0),dz.setFromNormalAndCoplanarPoint(F4,V4)),!c.ray.intersectPlane(dz,H4))return;n>0&&("custom"===r||void 0===r)&&H4.addScaledVector(Ay,n)}if(e.isReset||(u?"target"===t?x1.copy(u.up).applyMatrix4(B4.extractRotation(u.matrixWorld)).normalize():s.some(d=>!1===d)?("x"===i?(Ih.set(0,0,1),!1===s[2]&&Ih.set(0,1,0)):"y"===i?(Ih.set(1,0,0),!1===s[0]&&Ih.set(0,0,1)):(Ih.set(0,1,0),!1===s[1]&&Ih.set(1,0,0)),x1.copy(Ih).applyQuaternion(e.worldQuaternion0).normalize()):x1.set(0,1,0):"custom"===r?x1.set(0,1,0):x1.copy(F4)),e.isReset)Fu.copy(e.worldQuaternion0);else if(V4.distanceTo(H4)>o&&a&&u){if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;Fu.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor}else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;(function kAe(e,t,i,n,r,o){let s=e.elements;vr.subVectors(t,i),0===vr.lengthSq()&&(vr.z=1),vr.normalize(),Xr.crossVectors(n,vr),0===Xr.lengthSq()&&(1===Math.abs(n.z)?vr.x+=1e-4:vr.z+=1e-4,vr.normalize(),Xr.crossVectors(n,vr)),Xr.normalize(),ka.crossVectors(vr,Xr),"x"===r?1===o.z?[Xr,ka,vr]=[vr,Xr,ka]:(Xr.negate(),[Xr,vr]=[vr,Xr]):"y"===r?1===o.x?[Xr,ka,vr]=[ka,vr,Xr]:(Xr.negate(),[ka,vr]=[vr,ka]):1===o.x&&(Xr.negate(),[Xr,ka]=[ka,Xr]),s[0]=Xr.x,s[4]=ka.x,s[8]=vr.x,s[1]=Xr.y,s[5]=ka.y,s[9]=vr.y,s[2]=Xr.z,s[6]=ka.z,s[10]=vr.z})(B4,H4,V4,x1,i,Ih),Fu.setFromRotationMatrix(B4),C0.setFromUnitVectors(Ih.applyQuaternion(Fu),x1),s.some(d=>!1===d)&&"target"!==t&&Fu.premultiply(C0).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),C0.setFromRotationMatrix(xq(h.matrixWorld)),C0.slerp(Fu,1/e.currentDampingFactor),Pq(h,B4.makeRotationFromQuaternion(C0)),e.paused=8*(1-C0.dot(Fu))<1e-6):(Pq(h,B4.makeRotationFromQuaternion(Fu)),e.paused=!0),e.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(AAe),h.dispatchEvent(PAe)}},ka=new T,Xr=new T,vr=new T,NAe=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=bs(t,t.actions,n,r,o,i)}disconnect(){po(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},LAe=class extends bl{constructor(e,t){super(e),this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=o=>{Ot.length>1||(this.eventContext.updateRaycaster(o),this.handleMouseHoverEvent())},this.onMouseUp=o=>{Ot.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=o=>{Ot.length>1||(this.eventContext.updateRaycaster(o),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:o,target:s,reverse:a})=>{if(!o||!s)return;let l=L4(o);l&&"MouseHover"===l&&(s.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[s.uuid]?.forEach(c=>c.dispatchUserEvent(a)))};let{page:i,sharedAssets:n}=this.eventContext,r=(o,s)=>{if(o.visible&&o.data?.events.length){for(let{id:a,data:l}of o.data.events)if(!l.disabled&&"MouseHover"===l.type)try{let c=new NAe(a,l,o,i,n,t);this.eventsPerObjects[o.uuid]?this.eventsPerObjects[o.uuid].push(c):this.eventsPerObjects[o.uuid]=[c]}catch{}this.eventsPerObjects[o.uuid]?.length&&this.objects.push(o instanceof lo?s:o)}};i.traverseEntity(o=>{(o instanceof Zo||o instanceof ho)&&o.frame?.traverse(s=>{r(s,o)}),r(o)})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),ia&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(t=>{t.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),ia&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:n,page:r,pointerScreen:o}=this.eventContext,s=!1;if(r.uiCanvas&&(s=Dh(r,[o.x,o.y],Object.keys(this.eventsPerObjects),a=>{t.push(a)})),i&&!s){let a=Ey(n,r,this.objects);t=sz(a),a.forEach(l=>{l.object instanceof Zo&&Dh(l.object,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),c=>{t.push(c)})})}else this.objects.forEach(a=>{let l=Dy(n,a);l&&(t.push(a),a instanceof Zo&&Dh(a,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),c=>{t.push(c)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},RAe=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=bs(t,t.actions,n,r,o,i)}connect(){this.scrollCounter=0}disconnect(){po(this.actions)}dispatch(e){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(n=>n.seek(i)),this.actions.Animation.forEach(n=>n.seek(t)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},FAe=class{constructor(e,t,i,n,r,o,s){this.id=e,this.data=t,this.object=i,this.domElement=o,this.eventManager=s,this.scrollStart=0,this.scrollEnd=0,this.actions=bs(t,t.actions,n,r,s,i)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),t=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||t.scrollTop,o=Math.round(e.top+n-(i.clientTop||t.clientTop||0));if("enter"===this.data.startFrom){let s=window.innerHeight,a=e.height,l=this.data.enterAnchor;this.scrollStart=o-("top"===l?s:"bottom"===l?s-a:s-.5*a)}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=e,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){po(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll({y:t}){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let n=Math.min(1,Math.max(0,(t-this.scrollStart)/(this.scrollEnd-this.scrollStart)));this.actions.Transition.forEach(r=>r.seek(n)),this.actions.Animation.forEach(r=>r.seek(n)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},BAe=class extends bl{constructor(e,t){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([a,l])=>{l.forEach(c=>c.handleResize())})},this.onScroll=a=>{if(!this.isInview)return;let l={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([c,h])=>{c.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:l}),h.forEach(u=>u.dispatch(l))})},this.onWheel=a=>{!this.isInview||a.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([l,c])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:a.deltaY}),c.forEach(h=>h.dispatch(a.deltaY))})},this.onUserEvent=({eventName:a,target:l,reverse:c})=>{if(!a||!l)return;let h=L4(a);h&&"Scroll"===h&&(l.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(l)?.forEach(u=>{u.dispatchUserEvent(c)}))};let{page:i,sharedAssets:n,domElement:r,isExport:o}=this.eventContext,s=a=>{if(a.data?.events.length)for(let{id:l,data:c}of a.data.events)if(!c.disabled&&"Scroll"===c.type)if("load"!==c.trigger&&o){let h=new FAe(l,c,a,i,n,r,t);this.scrollEventsPerObject.has(a)?this.scrollEventsPerObject.get(a)?.push(h):this.scrollEventsPerObject.set(a,[h])}else{let h=new RAe(l,c,a,i,n,t);this.wheelEventsPerObject.has(a)?this.wheelEventsPerObject.get(a)?.push(h):this.wheelEventsPerObject.set(a,[h])}};i.traverseEntity(a=>{(a instanceof Zo||a instanceof ho)&&a.frame?.traverse(l=>{s(l)}),s(a)}),this.intersectionObserver=new IntersectionObserver(a=>{let l=a[0];l&&(this.isInview=l.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},VAe=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.actions=bs(t,t.actions,n,r,o,i)}disconnect(){po(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof y1?t.interaction.audioPlayer.play():t.interaction instanceof FM&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof _0?t.interaction.play("autoplay"===i):t.interaction instanceof tz&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof y1?t.interaction.audioPlayer.play():t.interaction instanceof FM&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof _0?t.interaction.play():t.interaction instanceof tz&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},HAe=class extends bl{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:n}=this.eventContext,r=n?document:i;r.removeEventListener("pointerdown",this.onAny),r.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([o,s])=>{o.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.actions.Audio.forEach(o=>{o.interaction instanceof y1&&o.interaction.audioPlayer.play()}),r.actions.Video.forEach(o=>{o.interaction instanceof _0&&o.interaction.play("autoplay"===(o.interaction.data.triggerAfter??"autoplay"))}),r.actions.Particles.forEach(o=>{o.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:n,reverse:r})=>{if(!i||!n)return;let o=L4(i);o&&"Start"===o&&(n instanceof lo||n.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(n)?.forEach(s=>{s.dispatchUserEvent(r)}),this.eventsAfterPerObject.get(n)?.forEach(s=>{s.dispatchUserEvent(r)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=n=>{if(n.data?.events.length)for(let{id:r,data:o}of n.data.events){if(o.disabled||"Start"!==o.type)continue;let s=new VAe(r,o,n,t,e,this.eventManager);(s.actions.Transition.length||s.actions.Animation.length||s.actions.SwitchCamera.length||s.actions.Create.length||s.actions.Destroy.length||s.actions.SceneTransition.length||s.actions.Reset.length||s.actions.SetVariable.length||s.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(n)?this.eventsPerObject.get(n)?.push(s):this.eventsPerObject.set(n,[s])),s.actions.Audio.length&&(this.eventsAfterPerObject.has(n)?this.eventsAfterPerObject.get(n)?.push(s):this.eventsAfterPerObject.set(n,[s])),s.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(n)?this.eventsAfterPerObject.get(n)?.push(s):this.eventsAfterPerObject.set(n,[s])),s.actions.Particles.length&&(this.eventsAfterPerObject.has(n)?this.eventsAfterPerObject.get(n)?.push(s):this.eventsAfterPerObject.set(n,[s]))}};if(t.traverseEntity(n=>{(n instanceof Zo||n instanceof ho)&&n.frame?.traverse(r=>{i(r)}),i(n)}),[...this.eventsAfterPerObject.values()].some(n=>n.length)){if(0===this.eventManager.activateCount){let{domElement:n,isExport:r}=this.eventContext,o=r?document:n;o.addEventListener("pointerdown",this.onMouseDown,{once:!0}),o.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),o.addEventListener("pointerdown",this.onAny),o.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([n,r])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(o=>o.dispatch()),n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,r])=>{n.removeEventListener("userEvent",this.onUserEvent),r.forEach(o=>o.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},UAe=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=bs(t,t.actions,n,r,o,i),this.target=t.target,this.useToggle="Toggle"===t.runMode}disconnect(){po(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(t)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()})):(this.actions.Transition.forEach(t=>{!1===this.alreadyPlayedNonTogglingActions.has(t)&&t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}))}},jAe=class extends bl{constructor(e,t,i,n,r){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=o=>{this.rafId=window.requestAnimationFrame(this.onFrame);let s=new Date,a=[],l=[];for(let u=0;u<this.propertiesToWatch.length;u++){let{objectId:d,property:p,prevValue:f}=this.propertiesToWatch[u],m=this.eventContext.scene.find(d),g=tC.propertyPaths[p];if("width"===g[0]||"height"===g[0]||"depth"===g[0])m=m.geometry.userData.parameters[g[0]];else for(let v=0;v<g.length;v++)m=m[g[v]];null===f?this.propertiesToWatch[u].prevValue=m instanceof T?m.clone():m:(m instanceof T?!m.equals(f):f!==m)&&(l.push({objId:d,property:p}),m instanceof T?this.propertiesToWatch[u].prevValue.copy(m):this.propertiesToWatch[u].prevValue=m)}for(let u=0;u<this.variablesToWatch.length;u++){let{id:d,prevValue:p}=this.variablesToWatch[u],f=this.shared.getVariable(d);f!==p&&(a.push(d),this.variablesToWatch[u].prevValue=f)}for(let u=0;u<this.dynamicVars.length;u++){let{id:d,expectedTime:p,last:f,data:m,timerSeconds:g,startValue:v}=this.dynamicVars[u],y=1e3;if("timer"!==m.dynamicVariableType&&"stopwatch"!==m.dynamicVariableType||"number3decimal"!==m.format?"counter"===m.dynamicVariableType?y=m.updateInterval:"random"===m.dynamicVariableType&&(y=m.isStatic?1/0:m.updateInterval):y=1,-1!==p){if("Stopped"!==this.shared.getDynamicVariablePlayState(d)&&"Restarted"!==this.shared.getDynamicVariablePlayState(d)||(this.dynamicVars[u].last=o,this.dynamicVars[u].expectedTime=o+y,"counter"===m.dynamicVariableType&&this.shared.getVariable(d)!==v&&(this.shared.updateVariable(d,v),this.eventManager.requestRender()),("timer"===m.dynamicVariableType||"stopwatch"===m.dynamicVariableType)&&this.dynamicVars[u].timerSeconds!==v&&(this.dynamicVars[u].timerSeconds=v,this.shared.updateVariable(d,Ta.getFormattedTimerTime(v,m)),this.eventManager.requestRender()),"Restarted"===this.shared.getDynamicVariablePlayState(d)&&this.shared.setDynamicVariablePlayState(d,"Playing"),"Stopped"!==this.shared.getDynamicVariablePlayState(d))){if("Paused"===this.shared.getDynamicVariablePlayState(d)){void 0===this.dynamicVars[u].deltaToExpectedTime&&(this.dynamicVars[u].deltaToExpectedTime=Math.max(this.dynamicVars[u].expectedTime-o,0)),this.dynamicVars[u].last=o-(y-this.dynamicVars[u].deltaToExpectedTime),this.dynamicVars[u].expectedTime=o+this.dynamicVars[u].deltaToExpectedTime;continue}if(this.dynamicVars[u].deltaToExpectedTime=void 0,o>=p)if(this.dynamicVars[u].last=o,this.dynamicVars[u].expectedTime+=y,"random"===m.dynamicVariableType){let _=m.min+Math.random()*(m.max-m.min),b=m.decimals;_=Math.round(_*Math.pow(10,b))/Math.pow(10,b),this.shared.updateVariable(d,_),a.push(d),this.eventManager.requestRender()}else if("counter"===m.dynamicVariableType){if(0===m.increment)continue;let _=this.shared.getVariable(d),b=this.shared.getDynamicVariableToggleIsForward(d)??!0,x=this.shared.getVariable(d)+m.increment*(b?1:-1);m.hasEnd&&(x=m.increment>0?et.clamp(x,v,m.endValue):et.clamp(x,m.endValue,v),x===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?x===m.endValue&&(x=v):(x===v||x===m.endValue)&&this.shared.setDynamicVariablePlayState(d,"Paused")),x!==_&&(a.push(d),this.shared.updateVariable(d,x),this.eventManager.requestRender())}else if("time"===m.dynamicVariableType)this.shared.updateVariable(d,PY(s,m)),a.push(d),this.eventManager.requestRender();else{let _=oa.isTextValue(m.endValue)?Iq(m.endValue.textValue):m.endValue,b=this.shared.getDynamicVariableToggleIsForward(d)??!0,x=g+(o-f)/1e3*("timer"===m.dynamicVariableType?-1:1)*(b?1:-1);x=Math.max(x,0),m.hasEnd&&(x="stopwatch"===m.dynamicVariableType?et.clamp(x,v,_):et.clamp(x,_,v),x===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?Math.abs(x-_)<("number3decimal"===m.format?1e-4:.1)&&(x=v):(Math.abs(x-v)<("number3decimal"===m.format?1e-4:.1)||Math.abs(x-_)<("number3decimal"===m.format?1e-4:.1))&&this.shared.setDynamicVariablePlayState(d,"Paused")),x!==g&&(a.push(d),this.dynamicVars[u].timerSeconds=x,this.shared.updateVariable(d,Ta.getFormattedTimerTime(x,m)),this.eventManager.requestRender())}}}else this.dynamicVars[u].last=o,this.dynamicVars[u].expectedTime=o+y}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(u=>{"mouseProperty"===u.data.variableId&&(u.dispatch(),this.eventManager.requestRender())}));let c=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,c=!0);let h=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,h=!0),this.events.forEach(u=>{(a.includes(u.data.variableId)||l.find(d=>d.objId===u.data.objectId&&d.property===u.data.property)||"mouseProperty"===u.data.variableId&&c||"raycastProperty"===u.data.variableId&&h)&&(u.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},e.page.traverseEntity(o=>{o.data?.events.filter(s=>"VariableChange"===s.data.type&&!s.data.disabled).forEach(s=>{this.events.push(new YAe(o.uuid,s.data,o,e.page,e.sharedAssets,i))})}),this.propertiesToWatch=this.events.filter(o=>"objectProperty"===o.data.variableId&&null!==o.data.objectId).map(o=>({objectId:o.data.objectId,property:o.data.property,prevValue:null})),this.shared=e.sharedAssets,this.sharedVariables.forEach(({id:o,data:s})=>{if(!("dynamicVariableType"in s))return void(this.events.find(l=>l.data.variableId===o)&&this.variablesToWatch.push({id:o,prevValue:this.shared.getVariable(o)}));let a;if("timer"===s.dynamicVariableType||"stopwatch"===s.dynamicVariableType){let l;if(oa.isTextValue(s.value)&&Array.isArray(s.value.textValue)){let c=s.value.textValue;l=3===c.length?c[2]+60*c[1]+3600*c[0]:c[1]+60*c[0]}else l=s.value;a=l,this.dynamicVars.push({id:o,last:-1,expectedTime:-1,data:s,timerSeconds:l,startValue:a})}else"time"===s.dynamicVariableType&&this.shared.updateVariable(o,PY(new Date,s)),"counter"===s.dynamicVariableType&&(a=oa.isTextValue(s.value)?Iq(s.value.textValue):s.value),this.dynamicVars.push({id:o,last:-1,expectedTime:-1,data:s,startValue:a})})}pause(){this.pauseTime=Date.now()}resume(){let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},YAe=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.actions=bs(t,t.actions,n,r,o,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch())}dispose(){po(this.actions)}};function Iq(e){return 3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}var kq,bi,Io,QAe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};$_e.then(e=>{kq=e,bi=new e.Vec3,Io=new e.Vec3});var ZAe=new T;function ePe(e){let t=!1;return e.scene.objects.forEach(i=>{"Page"===i.data.type&&!t&&i.data.publish.gameControlObject&&q2.traverseModuleInstances(e,i.id,(n,r,o)=>{for(let s of o)"GameControl"===s.data.type&&s.data.navmesh.enabled&&(t=!0)})}),t}var tPe={type:"change"},Nq={type:"changeZoom"},iPe={type:"changePan"},S0={type:"start"},M0={type:"end",changed:!0},nPe={type:"end",changed:!1},pz=new qt,Lq=new $,rPe=2*Math.PI,fz=new T,Py=new $,mz=new T,Iy=new qt,Rq=new De,aPe={type:"requestRender"},Fq=class extends wo{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,3,1],this.offset=new T,this.eye=new T,this.lastPosition=new T,this.lastQuaternion=new qt,this.current=new $,this.overShoot=new $,this.overRatio=new $,this.spherical=new bB,this.sphericalDelta=new bB,this.panOffset=new T,this.panLeftV=new T,this.panUpV=new T,this.panV=new T,this.rotateStart=new $,this.rotateEnd=new $,this.rotateDelta=new $,this.panStart=new $,this.panEnd=new $,this.panDelta=new $,this.dollyStart=new $,this.dollyEnd=new $,this.dollyDelta=new $,this.rotationRangeFactor=new $,this.panRangeFactor=new $,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=n=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=n.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(mz,Iy,fz),this.offset.copy(mz).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(pz.copy(Iy).invert()),this.panOffset.applyQuaternion(pz),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Iy),this.panOffset.applyQuaternion(Iy)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),mz.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(Rq.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(Rq));let n=this.spherical.phi%rPe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(en.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),n>0&&n>Math.PI||n<0&&n>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let r=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-r,this.sphericalDelta.phi*=1-r}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(tPe),this.object.dispatchEvent(aPe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=n=>{!1!==this.enabled&&("touch"===n.pointerType||"pen"===n.pointerType&&ia?this.onPointerDownTouch(n):this.onPointerDownMouse(n),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(S0),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),n.stopPropagation(),"touch"===n.pointerType||"pen"===n.pointerType&&ia||this.domElement.setPointerCapture(n.pointerId)))},this.onPointerLeave=n=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,fz.subVectors(this.position0,this.target0),this.spherical.setFromVector3(fz),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=n},this.onPointerEnter=n=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?Py.set(n.clientX-this.domElement.clientWidth/2,n.clientY-this.domElement.clientHeight/2):Py.set(n.clientX-this.pointerLeaveEvent.clientX,n.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(Py).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(Lq,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(n.clientX,n.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(Py).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(n.clientX,n.clientY)),this.update()},this.onPointerMove=n=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===n.pointerType||"pen"===n.pointerType&&ia?this.onPointerMoveTouch(n):this.onPointerMoveMouse(n),n.stopPropagation()))},this.onPointerUp=n=>{this.isPointerDown=!1,0===Ot.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Ot.length>1&&n.preventDefault(),this.dispatchEvent(this.hasChange?M0:nPe),this.state=-1,n&&(n.stopPropagation(),"touch"===n.pointerType||"pen"===n.pointerType&&ia||this.domElement.releasePointerCapture(n.pointerId))},this.onPointerDownMouse=n=>{let r;switch(r=this.useKeyEvents?this.mouseButtons[n.button]:this.mouseButtonsPlay[n.button],r){case 0:if(!0!==n.altKey||n.shiftKey||N8(n)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2;break;case 3:if(N8(n)||n.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}break;case 5:if(N8(n)||n.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=n=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(n);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(n);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(n)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=n=>{switch(Ot.length>1&&n.preventDefault(),this.touches[Ot.length-1]){case 0:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case 1:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case 3:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=n=>{switch(Ot.length>1&&n.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(n),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(n),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(n),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(n),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Mw(()=>this.dispatchEvent(M0),33),this.onMouseWheel=n=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&n.preventDefault(),this.dispatchEvent(S0),this.handleMouseWheel(n),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=n=>{if(n.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!Tw)if("gesturechange"===n.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(S0),n.scale>this.prevScale?this.dollyIn(this.getZoomScale()):n.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=n.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(M0)},this.onContextMenu=n=>{n.preventDefault()},this.onTouchEnd=n=>{n.preventDefault()},this.onKeyDown=n=>{!1!==this.enabled&&(this.key=n.key," "===n.key&&this.dispatchEvent(S0))},this.onKeyUp=n=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===n.key&&this.onPointerUp(Ot[0])," "===n.key&&this.dispatchEvent(M0))},this.onPointerHover=n=>{"mouse"!==n.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(n,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(n,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=n=>{n.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){this.hasChange="start"!==e.type,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents="window"===t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.hoverRotatePanStrength=(e.hoverRotatePanStrength/100)**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let n=this.object.getTarget().applyQuaternion(pz.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+n.y,this.maxV=e.panVerticalOffset.max+n.y,this.minH=-e.panHorizontalOffset.min+n.x,this.maxH=e.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=_c(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=_c(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=_c(_c(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=_c(_c(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=0),1===e.panTouches&&(this.touches[0]=1),2===e.orbitTouches&&(this.touches[1]=3),2===e.panTouches&&(this.touches[1]=2),3===e.orbitTouches&&(this.touches[2]=0),3===e.panTouches&&(this.touches[2]=1),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,n,r,o,s,a){let l,c,h;this.overShoot.set(0,0),e instanceof T?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(_c(this.spherical.theta),_c(this.spherical.phi)),h=!1),0===i&&(this.current.x+=l,this.current.y+=c),(3===t||2===t)&&(!h&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===t||1===t)&&(this.current.y>o?this.overShoot.y=o-this.current.y:this.current.y<s&&(this.overShoot.y=s-this.current.y)),h||(this.overShoot.x=_c(this.overShoot.x),this.overShoot.y=_c(this.overShoot.y)),0!==i?(this.overRatio.copy(this.overShoot).divide(a),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===i&&(this.overRatio.x=Bq(Math.abs(this.overRatio.x)),this.overRatio.y=Bq(Math.abs(this.overRatio.y))),this.isPointerDown||1===i?2===i&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):2===i&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(c=.05*this.overShoot.y),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof T?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=!0===e?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){this.panV.copy(this.object.position).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(iPe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Nq)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Nq)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(S0),this.dollyOut(e),this.dispatchEvent(M0)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(S0),this.dollyIn(e),this.dispatchEvent(M0)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){void 0!==e.movementX?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(Lq,-this.object.angleOffsetFromUp);let n=this.useWindowEvents?window.innerHeight:this.domElement.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,o=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(o),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){void 0!==e.movementX?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(!1===Y_e&&!1===N8(e)&&!0===function G_e(e){return 0===e.wheelDeltaY||0===e.deltaY?!(k8&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):this.pan(this.panDelta.x,e.shiftKey?0:this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(!1===this.enableZoom)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){2===Ot.length?this.rotateStart.set(.5*(Ot[0].pageX+Ot[1].pageX),.5*(Ot[0].pageY+Ot[1].pageY)):this.rotateStart.set(Ot[0].pageX,Ot[0].pageY)}handleTouchStartPan(){2===Ot.length?this.panStart.set(.5*(Ot[0].pageX+Ot[1].pageX),.5*(Ot[0].pageY+Ot[1].pageY)):this.panStart.set(Ot[0].pageX,Ot[0].pageY)}handleTouchStartDolly(){let e=Ot[0].pageX-Ot[1].pageX,t=Ot[0].pageY-Ot[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(2===Ot.length){let i=Ew(e);this.rotateEnd.set(.5*(e.pageX+i.x),.5*(e.pageY+i.y))}else{if(e.pointerId!==Ot[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(2===Ot.length){let t=Ew(e);this.panEnd.set(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}else{if(e.pointerId!==Ot[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=Ew(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=this.options?.showCameraLock;return e&&e(),!0}}return!1}};function _c(e){let t=2*Math.PI;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function Bq(e){return 1-Math.pow(1-e,4)}var Ai,Vq=class{constructor(e,t,i,n,r,o){this.id=e,this.data=t,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=bs(t,t.actions,n,r,o,i),this.target=t.target,this.useToggle="Toggle"===t.runMode,this.triggeringObjects=[];for(let s of t.triggeringObjects){let a=n.scene.find(s);a&&this.triggeringObjects.push(a)}}isValidTriggeringObject(e){return"all"===this.target||this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){po(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(e)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{!1===this.alreadyPlayedNonTogglingActions.has(e)&&e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}};Z_e.then(e=>Ai=e);var Or=new T,xl=new qt,Bu=new T,gz=new Ur(0,0,0,"YXZ"),Hq=new Ur(0,0,0,"XYZ"),wl=new T,vz=new T,yz=new T(1,1,1),z0=new qt,Oy=new De,Uq=new De,lPe={type:"updateMatrix"},jq=new qt,_z=new Ps,bz={type:"beginEvent",eventName:"Collision"},cPe={type:"beginEvent",eventName:"Trigger"},ky=e=>e.states.some(t=>void 0!==t.data.position||void 0!==t.data.rotation||void 0!==t.data.hiddenMatrix||void 0!==t.data.cloner||void 0!==t.data.pathSnapping);function dPe(e){let t=this._clip.duration,i=this._clip.start??0,n=this.loop,r=this.time+e,o=this._loopCount,s=n===qb;if(0===e)return-1===o?r:s&&1==(1&o)?t-(r-i):r;if(n===RR){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=t||r<i){let a=Math.floor((r-i)/(t-i));r-=(t-i)*a,o+=Math.abs(a);let l=this.repetitions-o;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s||(r=e>0?t:i,1===this.repetitions&&(r=t)),this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===l){let c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&1==(1&o))return t-(r-i)}return r}var Vu,Yq=!1,xz=new WeakMap,fPe=class extends D2{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){let r=new Gx(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.decodeDracoFile(o,t).catch(n)},i,n)}decodeDracoFile(e,t,i,n){return this.decodeGeometry(e,{attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i}).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(xz.has(e)){let a=xz.get(e);if(a.key===i)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,s=this._getWorker(r,e.byteLength).then(a=>(n=a,new Promise((l,c)=>{n._callbacks[r]={resolve:l,reject:c},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return s.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),xz.set(e,{key:i,promise:s}),s}_createGeometry(e){let t=new gt;e.index&&t.setIndex(new It(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i];t.setAttribute(n.name,new It(n.array,n.itemSize))}return t}_loadLibrary(e,t){let i=new Gx(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let r=mPe.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){let o=r.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function mPe(){let e,t;function r(s,a,l,c,h,u){let d=u.num_components(),p=l.num_points()*d,f=p*h.BYTES_PER_ELEMENT,m=function o(s,a){switch(a){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}(s,h),g=s._malloc(f);a.GetAttributeDataArrayForAllPoints(l,u,m,f,g);let v=new h(s.HEAPF32.buffer,g,p).slice();return s._free(g),{name:c,array:v,itemSize:d}}onmessage=function(s){let a=s.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(e)});break;case"decode":let l=a.buffer,c=a.taskConfig;t.then(h=>{let u=h.draco,d=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=function i(s,a,l,c){let d,p,h=c.attributeIDs,u=c.attributeTypes,f=a.GetEncodedGeometryType(l);if(f===s.TRIANGULAR_MESH)d=new s.Mesh,p=a.DecodeBufferToMesh(l,d);else{if(f!==s.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");d=new s.PointCloud,p=a.DecodeBufferToPointCloud(l,d)}if(!p.ok()||0===d.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let m={index:null,attributes:[]};for(let g in h){let y,_,v=self[u[g]];if(c.useUniqueIDs)_=h[g],y=a.GetAttributeByUniqueId(d,_);else{if(_=a.GetAttributeId(d,s[h[g]]),-1===_)continue;y=a.GetAttribute(d,_)}m.attributes.push(r(s,a,d,g,v,y))}return f===s.TRIANGULAR_MESH&&(m.index=function n(s,a,l){let c=3*l.num_faces(),h=4*c,u=s._malloc(h);a.GetTrianglesUInt32Array(l,h,u);let d=new Uint32Array(s.HEAPF32.buffer,u,c).slice();return s._free(u),{array:d,itemSize:1}}(s,a,d)),s.destroy(d),m}(u,d,p,c),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(p),u.destroy(d)}})}}}function vPe(e){return wz.apply(this,arguments)}function wz(){return wz=(0,Dn.Z)(function*(e){if(Vu){let i,t={attributeIDs:Vu.defaultAttributeIDs,attributeTypes:Vu.defaultAttributeTypes,useUniqueIDs:!1};try{i=yield Vu.decodeGeometry(new Int8Array(e).buffer,t)}catch(n){console.error(n)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([n,r])=>({name:n,itemSize:r.itemSize,array:r.array}))}}return null}),wz.apply(this,arguments)}function Cz(){return Cz=(0,Dn.Z)(function*(e,t){let[i,n]=lH(Qw.deserialize(new Uint8Array(e)));return zU(i),t&&t(i),n.result().data}),Cz.apply(this,arguments)}function Sz(){return Sz=(0,Dn.Z)(function*(e){for(let t of e){let i=yield vPe(t.geometry.data.draco);if(i){let n=t.geometry.data;i.index&&(n.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let r={};i.attributes.forEach(({name:o,array:s,itemSize:a})=>{r[o]={array:s,itemSize:a,type:"Float32Array",normalized:!1}}),n.attributes=r,n.draco=void 0}}}),Sz.apply(this,arguments)}var xPe=class{constructor(e,t,i,n,r,o,s){this.id=e,this.data=t,this.dataEvent=i,this.object=n,this.stage=!1,this.actions=bs(i,t.actions,r,o,s,n)}disconnect(){po(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},wPe=class extends bl{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,n)=>{this.breakpoints.forEach(r=>{let a,o=eC.deviceToSize(r.data.size),s="horizontal"===r.dataEvent.orientation?i:n;switch(r.data.operator){case"<":a=s<o[0];break;case">":a=s>o[0];break;case"<>":a=s>o[0]&&s<o[1]}r.stage!==a&&(r.stage=a,r.stage?r.dispatchIn():r.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let n of i){let{width:r,height:o}=n.contentRect;this.resize(r,o)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let n=r=>{if(r.visible&&r.data?.events.length)for(let{data:o}of r.data.events)o.disabled||"Resize"===o.type&&o.breakpoints.forEach(({data:s,id:a})=>{try{let l=new xPe(a,s,o,r,e,t,this.eventManager);this.breakpoints.push(l)}catch{}})};e.traverseEntity(r=>{(r instanceof Zo||r instanceof ho)&&r.frame?.traverse(o=>{n(o)}),n(r)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}};function EPe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function U4(e){return e instanceof x4?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}var IPe=Qc(Zde(),1),OPe=new $;function Oh(e){return!!e&&(e instanceof Li||wi(e.lift)&&wi(e.subscribe))}function Gq(...e){const t=l7(e),{args:i,keys:n}=VN(e),r=new Li(o=>{const{length:s}=i;if(!s)return void o.complete();const a=new Array(s);let l=s,c=s;for(let h=0;h<s;h++){let u=!1;eo(i[h]).subscribe($i(o,d=>{u||(u=!0,c--),a[h]=d},()=>l--,void 0,()=>{(!l||!u)&&(c||o.next(n?HN(n,a):a),o.complete())}))}});return t?r.pipe(ob(t)):r}const Mz={now:()=>(Mz.delegate||Date).now(),delegate:void 0};class Ny extends He{constructor(t=1/0,i=1/0,n=Mz){super(),this._bufferSize=t,this._windowTime=i,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,i)}next(t){const{isStopped:i,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:o,_windowTime:s}=this;i||(n.push(t),!r&&n.push(o.now()+s)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const i=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:r}=this,o=r.slice();for(let s=0;s<o.length&&!t.closed;s+=n?1:2)t.next(o[s]);return this._checkFinalizedStatuses(t),i}_trimBuffer(){const{_bufferSize:t,_timestampProvider:i,_buffer:n,_infiniteTimeWindow:r}=this,o=(r?1:2)*t;if(t<1/0&&o<n.length&&n.splice(0,n.length-o),!r){const s=i.now();let a=0;for(let l=1;l<n.length&&n[l]<=s;l+=2)a=l;a&&n.splice(0,a+1)}}}function zz(e,t,i){let n,r=!1;return e&&"object"==typeof e?({bufferSize:n=1/0,windowTime:t=1/0,refCount:r=!1,scheduler:i}=e):n=e??1/0,c7({connector:()=>new Ny(n,t,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}class j4{}let Wq=(()=>{class e extends j4{getTranslation(i){return tt({})}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class Tz{}let qq=(()=>{class e{handle(i){return i.key}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();function w1(e){return typeof e<"u"&&null!==e}function Ez(e){return e&&"object"==typeof e&&!Array.isArray(e)}function $q(e,t){let i=Object.assign({},e);return Ez(e)&&Ez(t)&&Object.keys(t).forEach(n=>{Ez(t[n])?n in e?i[n]=$q(e[n],t[n]):Object.assign(i,{[n]:t[n]}):Object.assign(i,{[n]:t[n]})}),i}class Ly{}let Qq=(()=>{class e extends Ly{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(i,n){let r;return r="string"==typeof i?this.interpolateString(i,n):"function"==typeof i?this.interpolateFunction(i,n):i,r}getValue(i,n){let r="string"==typeof n?n.split("."):[n];n="";do{n+=r.shift(),!w1(i)||!w1(i[n])||"object"!=typeof i[n]&&r.length?r.length?n+=".":i=void 0:(i=i[n],n="")}while(r.length);return i}interpolateFunction(i,n){return i(n)}interpolateString(i,n){return n?i.replace(this.templateMatcher,(r,o)=>{let s=this.getValue(n,o);return w1(s)?s:r}):i}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class Ry{}let Zq=(()=>{class e extends Ry{compile(i,n){return i}compileTranslations(i,n){return i}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class Kq{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new Re,this.onLangChange=new Re,this.onDefaultLangChange=new Re}}const Dz=new Fe("USE_STORE"),Az=new Fe("USE_DEFAULT_LANG"),Pz=new Fe("DEFAULT_LANGUAGE"),Iz=new Fe("USE_EXTEND");let Fy=(()=>{class e{constructor(i,n,r,o,s,a=!0,l=!1,c=!1,h){this.store=i,this.currentLoader=n,this.compiler=r,this.parser=o,this.missingTranslationHandler=s,this.useDefaultLang=a,this.isolate=l,this.extend=c,this.pending=!1,this._onTranslationChange=new Re,this._onLangChange=new Re,this._onDefaultLangChange=new Re,this._langs=[],this._translations={},this._translationRequests={},h&&this.setDefaultLang(h)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(i){this.isolate?this._defaultLang=i:this.store.defaultLang=i}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(i){this.isolate?this._currentLang=i:this.store.currentLang=i}get langs(){return this.isolate?this._langs:this.store.langs}set langs(i){this.isolate?this._langs=i:this.store.langs=i}get translations(){return this.isolate?this._translations:this.store.translations}set translations(i){this.isolate?this._translations=i:this.store.translations=i}setDefaultLang(i){if(i===this.defaultLang)return;let n=this.retrieveTranslations(i);typeof n<"u"?(null==this.defaultLang&&(this.defaultLang=i),n.pipe(Fr(1)).subscribe(r=>{this.changeDefaultLang(i)})):this.changeDefaultLang(i)}getDefaultLang(){return this.defaultLang}use(i){if(i===this.currentLang)return tt(this.translations[i]);let n=this.retrieveTranslations(i);return typeof n<"u"?(this.currentLang||(this.currentLang=i),n.pipe(Fr(1)).subscribe(r=>{this.changeLang(i)}),n):(this.changeLang(i),tt(this.translations[i]))}retrieveTranslations(i){let n;return(typeof this.translations[i]>"u"||this.extend)&&(this._translationRequests[i]=this._translationRequests[i]||this.getTranslation(i),n=this._translationRequests[i]),n}getTranslation(i){this.pending=!0;const n=this.currentLoader.getTranslation(i).pipe(zz(1),Fr(1));return this.loadingTranslations=n.pipe(bt(r=>this.compiler.compileTranslations(r,i)),zz(1),Fr(1)),this.loadingTranslations.subscribe({next:r=>{this.translations[i]=this.extend&&this.translations[i]?{...r,...this.translations[i]}:r,this.updateLangs(),this.pending=!1},error:r=>{this.pending=!1}}),n}setTranslation(i,n,r=!1){n=this.compiler.compileTranslations(n,i),this.translations[i]=(r||this.extend)&&this.translations[i]?$q(this.translations[i],n):n,this.updateLangs(),this.onTranslationChange.emit({lang:i,translations:this.translations[i]})}getLangs(){return this.langs}addLangs(i){i.forEach(n=>{-1===this.langs.indexOf(n)&&this.langs.push(n)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(i,n,r){let o;if(n instanceof Array){let s={},a=!1;for(let l of n)s[l]=this.getParsedResult(i,l,r),Oh(s[l])&&(a=!0);return a?Gq(n.map(c=>Oh(s[c])?s[c]:tt(s[c]))).pipe(bt(c=>{let h={};return c.forEach((u,d)=>{h[n[d]]=u}),h})):s}if(i&&(o=this.parser.interpolate(this.parser.getValue(i,n),r)),typeof o>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(o=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],n),r)),typeof o>"u"){let s={key:n,translateService:this};typeof r<"u"&&(s.interpolateParams=r),o=this.missingTranslationHandler.handle(s)}return typeof o<"u"?o:n}get(i,n){if(!w1(i)||!i.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe(Wc(r=>Oh(r=this.getParsedResult(r,i,n))?r:tt(r)));{let r=this.getParsedResult(this.translations[this.currentLang],i,n);return Oh(r)?r:tt(r)}}getStreamOnTranslationChange(i,n){if(!w1(i)||!i.length)throw new Error('Parameter "key" required');return wd(Bm(()=>this.get(i,n)),this.onTranslationChange.pipe(Sr(r=>{const o=this.getParsedResult(r.translations,i,n);return"function"==typeof o.subscribe?o:tt(o)})))}stream(i,n){if(!w1(i)||!i.length)throw new Error('Parameter "key" required');return wd(Bm(()=>this.get(i,n)),this.onLangChange.pipe(Sr(r=>{const o=this.getParsedResult(r.translations,i,n);return Oh(o)?o:tt(o)})))}instant(i,n){if(!w1(i)||!i.length)throw new Error('Parameter "key" required');let r=this.getParsedResult(this.translations[this.currentLang],i,n);if(Oh(r)){if(i instanceof Array){let o={};return i.forEach((s,a)=>{o[i[a]]=i[a]}),o}return i}return r}set(i,n,r=this.currentLang){this.translations[r][i]=this.compiler.compile(n,r),this.updateLangs(),this.onTranslationChange.emit({lang:r,translations:this.translations[r]})}changeLang(i){this.currentLang=i,this.onLangChange.emit({lang:i,translations:this.translations[i]}),null==this.defaultLang&&this.changeDefaultLang(i)}changeDefaultLang(i){this.defaultLang=i,this.onDefaultLangChange.emit({lang:i,translations:this.translations[i]})}reloadLang(i){return this.resetLang(i),this.getTranslation(i)}resetLang(i){this._translationRequests[i]=void 0,this.translations[i]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let i=window.navigator.languages?window.navigator.languages[0]:null;return i=i||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof i>"u"?void 0:(-1!==i.indexOf("-")&&(i=i.split("-")[0]),-1!==i.indexOf("_")&&(i=i.split("_")[0]),i)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let i=window.navigator.languages?window.navigator.languages[0]:null;return i=i||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,i}}return e.\u0275fac=function(i){return new(i||e)(he(Kq),he(j4),he(Ry),he(Ly),he(Tz),he(Az),he(Dz),he(Iz),he(Pz))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),LPe=(()=>{class e{static forRoot(i={}){return{ngModule:e,providers:[i.loader||{provide:j4,useClass:Wq},i.compiler||{provide:Ry,useClass:Zq},i.parser||{provide:Ly,useClass:Qq},i.missingTranslationHandler||{provide:Tz,useClass:qq},Kq,{provide:Dz,useValue:i.isolate},{provide:Az,useValue:i.useDefaultLang},{provide:Iz,useValue:i.extend},{provide:Pz,useValue:i.defaultLanguage},Fy]}}static forChild(i={}){return{ngModule:e,providers:[i.loader||{provide:j4,useClass:Wq},i.compiler||{provide:Ry,useClass:Zq},i.parser||{provide:Ly,useClass:Qq},i.missingTranslationHandler||{provide:Tz,useClass:qq},{provide:Dz,useValue:i.isolate},{provide:Az,useValue:i.useDefaultLang},{provide:Iz,useValue:i.extend},{provide:Pz,useValue:i.defaultLanguage},Fy]}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),Oz=(()=>{class e{constructor(i){this.translate=i,this.title="frontend";let n=localStorage.getItem("locale")||"es";["es","en"].includes(n)||(n="es",localStorage.setItem("locale",n)),i.setDefaultLang(n||"es")}switchLanguage(i){localStorage.setItem("locale",i),this.translate.use(i)}ngOnInit(){const i=document.getElementById("canvas");new class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=n=>{this.time=n,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer||!this._isPaused&&("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)||(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity(r=>{"ParticleSystem"===r.type&&(r.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&(this._eventManager.handlers?.Follow.onAnimationFrameDamping(),this._eventManager.handlers?.LookAt.onAnimationFrameDamping(),this._eventManager.handlers?.DragDrop.onAnimationFrameDamping()),this._scene&&this._camera&&(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0?(this._renderer.sceneTransitionTimeRemaining-=this.dt,this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration,this._skipRender=!1):this._renderer.pipeline.sceneTransitionFromTexture=null,this._renderer.renderSplineScene(this._scene,this._camera)),this.canvas.dispatchEvent(this._renderedEvent)),this._perfs?.end()},this._resize=()=>{if(this._renderer){if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=OPe.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let n=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera("fullscreen"!==n),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Mw(this._resize,10),this._onScroll=n=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}}({x:10,y:10})),function q_e(e){e.addEventListener("pointerdown",QV,!0),e.addEventListener("pointerdown",F8,!0),e.addEventListener("pointermove",F8,!0),e.addEventListener("pointerup",Mf,!0),e.addEventListener("pointercancel",Mf,!0),e.addEventListener("pointerleave",Mf,!0),window.addEventListener("keydown",ZV,!0),window.addEventListener("keyup",KV,!0)}(e)}load(e,t,i){var n=this;return(0,Dn.Z)(function*(){(function kPe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)})(e),n.disposed=!1;let r=yield(yield fetch(e,i)).arrayBuffer();yield n.start(r,{variables:t})})()}start(e,{interactive:t=!0,variables:i}={}){var n=this;return(0,Dn.Z)(function*(){if(n.disposed)return;let r=yield function yPe(e,t){return Cz.apply(this,arguments)}(e);n._data=r;let o=function _Pe(e){let t=[];return e.scene.objects.traverse((i,n)=>{"Mesh"===n.type&&"NonParametricGeometry"===n.geometry.type&&void 0!==n.geometry.data.draco&&t.push(n)}),t}(r);r.version&&(0,IPe.default)(r.version,"1.0.81")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),yield Promise.all([o.length&&(Vu||(Vu=new fPe).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),Vu.decoderPending),aG(r)&&Iwe(),zSe(r)&&Ewe(),q2.physicsEnabled(r.scene.objects)&&K_e(),JY(r)&&pSe(),KG(r)&&dEe(),uSe(r)&&hSe(),NG(r)&&mTe(),ePe(r)&&Q_e()].filter(Boolean)),o.length&&(yield function bPe(e){return Sz.apply(this,arguments)}(o)),n._eventManager?.deactivate(),n._controls?.deactivate(),n._scene?.dispose();let s=new class{get sharedAssets(){return this.shared}constructor(e,t={}){this.shared=new VS(e.shared,t),this.scene=new AM(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof ho&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Xo&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}}(r);if(s.resetPersonalCameraFromDocumentData(),n._scene=s.scene,n._sharedAssetsManager=s.sharedAssets,n._camera=n._scene.activeCamera,window.location.search.includes("merge-geometries")){let c=performance.now();!function PPe(e,t){let i=function DPe(e,t){let i={};return e.traverseEntity(n=>{if(!n.visible||!(n instanceof fs)||"Mesh"!==n.type||Array.isArray(n.material)||n.states&&Object.keys(n.states).length)return;let r=n.parent;for(;r;){if(r instanceof fs&&n.states&&Object.keys(n.states).length)return;r=r.parent}let o=n.material.uuid,s=t.shared.materials[o];if(s){if(!Wo.isMergable(s))return}else{let l=t.scene.objects.get(n.uuid)?.data;if(l&&"material"in l&&"string"!=typeof l.material){if(!Wo.isMergable(l.material))return;o=Wo.getHash(l.material)}}i[o]||(i[o]={});let a=i[o][U4(n)];if(a){if(a.push(n),n.cloner)for(let l of n.cloner.children)a.push(l)}else if(i[o][U4(n)]=[n],n.cloner)for(let l of n.cloner.children)i[o][U4(n)].push(l)}),i}(t,e),n=function APe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(n=>{let r=n.length;r>t&&(t=r)})}),t}(i),r=new Array(n),o=0,s=new Array(n),a=0,l=new Array(n),c=0,h=new Array(n),u=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(a=0,c=0,f.forEach(g=>{g instanceof fs&&(s[a++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),s[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&EPe(s[g]);let m=o1(s.slice(0,a),!1);if(m){let g;"SubdivObject"===d?(console.warn("Turning subdiv object into mesh"),g=new Dr(m,l[0].material)):g=new Dr(m,l[0].material),g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let v=y=>{u=0;for(let _ of y)_.children&&v(_.children),_ instanceof fs&&(Array.isArray(_.material)||i[_.material.uuid]&&i[_.material.uuid][U4(_)]&&i[_.material.uuid][U4(_)].length>1||(h[u++]=_));for(let _=0;_<u;_++)t.attach(h[_])};for(let y=0;y<c;y++){let _=l[y];v(_.children),r[o++]=_}}}for(let d=0;d<o;d++)r[d].removeFromParent()}(r,s.scene);let h=performance.now();console.log("Merged geometries in ",h-c," ms")}aG(r)&&n._scene.traverse(c=>{Ch(c)&&c.recomputeBoolean()}),n._sharedAssetsManager.setRequestRender(()=>{n._requestRenderAutoMode(),n._scene?.traverse(c=>{c instanceof dl&&c.pendingMediaLoad&&c.update()})}),n._scene?.traverse(c=>{"ParticleSystem"===c.type&&(c.wakeUp(),c.data.autoPlay?c.start():c.stop())});let a=Object.keys(r.shared.fonts).map(c=>n._sharedAssetsManager.getFont(c).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),n._requestRenderAutoMode()}),JY(r)&&function hPe(e){if(q2.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,n)=>{if(n.events)if(Array.isArray(n.events)){for(let r of n.events)if(!0!==r.data.disabled&&"GameControl"===r.data.type&&r.data.collisionEnabled){t=!0;break}}else for(let r of Object.values(n.events))if(!0!==r.disabled&&"GameControl"===r.type&&r.collisionEnabled){t=!0;break}}),t}(r)&&(yield Promise.all(a)),NG(r)){let c=[];n._scene.traverseEntity(h=>{(h instanceof Zo||h instanceof ho)&&h.uiCanvas&&c.push(h.uiCanvas)}),yield Promise.all(c.map(h=>h.promise))}n._scene.rewriteEventsBeforeGoToPlayMode(),JM(n._scene.activePage,n._sharedAssetsManager),n._renderer||(n._renderer=new rTe({canvas:n.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),n._renderer.hdTransmission=!0===r.scene.publish.hdTransmission,n._renderer.setPixelRatio(window.devicePixelRatio),n._renderer.pipeline.enableUIOverlay(),n._renderer.pipeline.addEventListener("smaaloaded",n._requestRenderAutoMode)),KG(r)&&n._scene.initializeSplatViewer(),void 0!==r.scene.blueNoiseTextureData&&n._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let l=Object.values(r.frames)[0];if(n._frameView?n._frameView.setCamera(n._camera):("fullscreen"===l.preset?(n._viewportMode=1,n.canvas.style.display="block",n.canvas.parentElement&&(n._viewportWidth=n.canvas.parentElement.clientWidth||300,n.canvas.style.width="100%"),n.canvas.parentElement&&(n._viewportHeight=n.canvas.parentElement.clientHeight||150,n.canvas.style.height="100%")):(n._viewportMode=2,n._viewportWidth=l.size[0],n._viewportHeight=l.size[1],n.canvas.style.width=`${n._viewportWidth}px`,n.canvas.style.height=`${n._viewportHeight}px`),n._renderer.setSize(n._viewportWidth,n._viewportHeight,!1),n._frameView=new class{constructor(e,t,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=(new $).copy(i),this._editorSize=(new $).copy(n),this._aspect=t.aspect,this._fov=r??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let t=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(e&&t>i){let r=function MPe(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n}(t,1080,2160,1,15)/100;n*=t/i,n*=1-r}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}}(n._renderer,n._camera,new $(n._viewportWidth,n._viewportHeight),new $(window.innerWidth,window.innerHeight)),n._frameView.enableResponsive=(l.allowResponsive??!1)&&"fullscreen"===l.preset),t){let c=new class{constructor(e,t,i,n,r,o,s,a){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=o,this.isExport=s,this.frame=a,this.raycaster=new oAe,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===t.mouseEventTarget,this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){let{pageX:t,pageY:i}=e.touches?.length>0?e.touches[0]:e;this.pointerWorld=function aAe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-(t-(i.top+window.scrollY))/i.height*2+1}}(t,i,this._domRect),this.pointerScreen=function lAe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}}(n._renderer,n.data.scene.publish,n._scene,()=>n._scene.activeCamera,n._sharedAssetsManager,n._requestRenderAutoMode,!0,l);n._scene.updateMatrixWorld(!0),n._controls=new class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Ai.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,n,r]=this.rigidBodyToMesh.get(t.handle);if(Or.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),xl.copy(t.rotation()),i.matrixWorld.compose(Or,xl,n),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(lPe),r){let o=i.cloner;if(o&&void 0===o.objectForSample){o.matrixWorld.copy(i.matrixWorld);for(let s of o.children)s.updateMatrixWorld(!0)}for(let s of i.children)s.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,n)=>{if(!1===n)return;let r,o;if(this.sensorToTriggerEvent[t]?(r=this.sensorToTriggerEvent[t],o=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(r=this.sensorToTriggerEvent[i],o=this.sharedGameControlGlobals.colliderToEntity.get(t)),r&&o&&r.isValidTriggeringObject(o))r.dispatch();else{for(let s=this.sharedGameControlGlobals.createdObjects.length-1;s>=0;s--){let a=this.sharedGameControlGlobals.createdObjects[s];if(a.userData.hasCollisionDestroy&&(a.rigidBody?.collider(0).handle===t||a.rigidBody?.collider(0).handle===i)){this.sharedGameControlGlobals.createdObjects.splice(s,1),a.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(a.rigidBody));break}}if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let s=this.sharedGameControlGlobals.colliderToEntity.get(i),a=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(void 0===a)return;for(let l of a)"character"===l.data.target&&this.dispatchCollisionEvent(l,s,i)}else if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let s=this.sharedGameControlGlobals.colliderToEntity.get(t),a=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(void 0===a)return;for(let l of a)"character"===l.data.target&&this.dispatchCollisionEvent(l,s,t)}else{let s=this.sharedGameControlGlobals.colliderToEntity.get(t),a=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(void 0!==a)for(let h of a)"scene"===h.data.target&&this.dispatchCollisionEvent(h,s,t);let l=this.sharedGameControlGlobals.colliderToEntity.get(i),c=this.sharedGameControlGlobals.entityToCollisionEvents[l?.uuid];if(void 0!==c)for(let h of c)"scene"===h.data.target&&this.dispatchCollisionEvent(h,l,i)}}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events){if(!0===i.data.disabled)continue;let n=i.data.actions?.find(r=>"Destroy"===r.data.type)?.data;if(n)for(let r of n.objects){let o=this.page.scene.find(r);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!0!==i.data.disabled&&"DragDrop"===i.data.type)for(let n of i.data.objects){let r=this.page.scene.find(n);r&&(r.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{let i;if(t instanceof dl||t instanceof ty||t instanceof py)return;i=t instanceof qo?t.object:t;let o=i.dataPatched;if("visibility"===o.physics?.enabled?!o.visible:!o.physics?.enabled)return!0;let s=t.geometry,a=!0===i.userData.hasDestroy,l=!0===i.userData.hasDrag;if(ky(o)||a||l||i.dataPatched.events.some(c=>!0!==c.data.disabled&&"GameControl"===c.data.type))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;s&&e.push(Eh(s,t.matrixWorld))}),e.length>0){let t=o1(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new o4(t)}}addRigidBody(e,t,i){let n=[],r="geometry"in e?e.geometry:void 0,o=t.dataPatched;if(void 0!==r?.getAttribute("position")&&n.push(Eh(r,e.shearScale)),o.physics.fusedBody){let s=this.gatherChildrenGeom(e,n);e.traverseObject(s),e.children.forEach(l=>l.updateMatrixWorld(!0));let a=e.cloner;a&&void 0===a.objectForSample&&"dynamic"===o.physics.rigidBody&&(a.traverseObject(s),a.children.forEach(l=>l.updateMatrixWorld(!0)))}if(n.length>0){let s,a=!i.fromCreate&&"dynamic"===o.physics.rigidBody||i.fromCreate&&i.dynamic;a?(s=Ai.RigidBodyDesc.dynamic(),s.setLinearDamping(o.physics.damping).setAngularDamping(o.physics.damping).setAdditionalMass(1e-9).setGravityScale(o.physics.gravityScale).enabledRotations(...o.physics.enabledRotation).enabledTranslations(...o.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(s=Ai.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):s=Ai.RigidBodyDesc.fixed();let l=o1(n);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Or,xl,Bu),e.position0=Or.clone().divideScalar(this.pixelsPerMeter),e.rotation0=xl.clone(),Or.divideScalar(this.pixelsPerMeter),s.setTranslation(Or.x,Or.y,Or.z).setRotation(xl),r?l?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l?.scale(Bu.x/this.pixelsPerMeter,Bu.y/this.pixelsPerMeter,Bu.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(s);a&&this.rigidBodyToMesh.set(c.handle,[e,Bu.clone(),o.physics.fusedBody]);let h=!(void 0===o.geometry||"SubdivGeometry"===o.geometry.type||"NonParametricGeometry"===o.geometry.type||"BooleanGeometry"===o.geometry.type||"VectorGeometry"===o.geometry.type||"StarGeometry"===o.geometry.type||"RectangleGeometry"===o.geometry.type||"EllipseGeometry"===o.geometry.type||"TriangleGeometry"===o.geometry.type||"TorusGeometry"===o.geometry.type||"HelixGeometry"===o.geometry.type);try{this.addCollider(c,o.physics,l,t,h)}catch{try{this.addCollider(c,o.physics,l,t,!1)}catch(u){console.error(u)}}e.rigidBody=c}}addBoundsTree(e){let t=[];if(void 0!==e.geometry?.getAttribute("position")&&e.geometry?.getAttribute("position").count>0&&t.push(Eh(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(i=>i.updateMatrixWorld(!0)),t.length>0){let i=o1(t,!1);e.bvhGeometry=i,e.bvhGeometry.boundsTree=new o4(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,t,i,n,r=!0){if(0===i?.getAttribute("position").count||0===i?.getIndex()?.count)return;let o;i&&(o="trimesh"===t.colliderType?Ai.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):Ai.ColliderDesc.convexMesh(i.getAttribute("position").array,r?i.getIndex().array:void 0)),o.setFrictionCombineRule(Ai.CoefficientCombineRule.Average).setRestitutionCombineRule(Ai.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let s=this.sharedGameControlGlobals.rapierWorld.createCollider(o,e);this.sharedGameControlGlobals.colliderToEntity.set(s.handle,n),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]?.some(a=>"scene"===a.target)&&s.setActiveEvents(Ai.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,n)=>{if(0===n)return;let r;if(i instanceof dl){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;r=i.object}else if(i instanceof qo)r=i.object;else if(r=i,r.dataPatched.cloner?.hideBase)return!0;let o=r.dataPatched;if("visibility"===o.physics.enabled?!o.visible:!o.physics.enabled)return!0;1===n?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let s=i.geometry;void 0!==s?.getAttribute("position")&&t.push(Eh(s,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,n=5,r=8,o=9,s="drag",a=this.page.data.publish.gameControlObject,l=null!==a?this.page.find(a):null,c=null;if(l)for(let d of l.data.events){if(d.data.disabled||"GameControl"!==d.data.type)break;let p=l;for(;this.usePhysics&&null!==(p=p.parent)?.parent&&!p.data.physics?.fusedBody;);d.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===c&&(c=d.data)}if(this.page.traverseEntity(d=>{for(let p of d.dataPatched.events)if(!1===p.data.disabled&&"Trigger"===p.data.type)return this.needsCollisionDetection=!0,!0}),l&&c&&(!0===l.data.visible||!0===l.data.physics.enabled)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let d=new bq(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=d,n=c.joystickPosLoc,r=c.joystickRotLoc,o=c.jumpTouchButtonLoc,s=c.rotByTouch,ia&&c.touchControl&&(this.joystickToGameControls[n]="pos","walk"===c.moveMode&&(this.joystickToGameControls[o]="jmp"),"joystick"===s&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let d=this.gameControl.data;if(!this.navigationMeshWrapper){let p;this.navigationMeshWrapper=new class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(1!==Ot.length)return;let{raycaster:n,page:r}=this.eventContext;this.eventContext.updateRaycaster(i);let o=r.raycastWithClones(n);if(0!==o.length){if(this.gameControl){let s=ZAe.copy(this.gameControl.colliderWorldPosition);s.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(s,o[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,n)=>r=>{let o;if(r instanceof dl){if(!r.objectForSample)return!0===r.object.dataPatched.physics.fusedBody&&"dynamic"===r.object.dataPatched.physics.rigidBody||void 0;if(r.objectForSample.dataPatched.physics.fusedBody)return;o=r.object}else if(r instanceof qo)o=r.object;else if(o=r,!1===o.dataPatched.cloner?.disabled&&o.dataPatched.cloner?.hideBase&&!0!==o.dataPatched.physics?.fusedBody)return!0;if(n&&!o.userData.navmesh)return;let s=o.dataPatched;if(!s.visible&&!0!==s.physics?.enabled)return!0;r.updateMatrixWorldSVD();let a=ky(s),l=o.userData.hasDestroy,c=o.userData.hasDrag,h=!1,u=!1;for(let d of s.events)!0!==d.data.disabled&&("GameControl"===d.data.type?h=!0:"Follow"===d.data.type&&(u=!0));if(h||a||u||l||c)return!0;if(this.usePhysics&&"dynamic"===s.physics?.rigidBody){if(this.usePhysics&&s.physics?.fusedBody)return!0}else if("geometry"in r&&r.geometry&&i.push(Eh(r.geometry,r.matrixWorld)),this.usePhysics&&s.physics?.fusedBody)return r.traverseObject((d,p)=>{if(0===p)return;let f;if(d instanceof dl){if(!d.objectForSample)return!0===d.object.dataPatched.physics.fusedBody&&"dynamic"===d.object.dataPatched.physics.rigidBody||void 0;if(d.objectForSample.dataPatched.physics.fusedBody)return;f=d.object}else if(d instanceof qo)f=d.object;else if(f=d,d.dataPatched.cloner?.hideBase)return!0;let m=f.dataPatched;if(!m.visible&&!0!==m.physics?.enabled)return!0;"geometry"in d&&d.geometry&&i.push(Eh(d.geometry,d.matrixWorld))}),!0},this.traverseNoPhysics=(i,n)=>r=>{let o;if(r instanceof dl)return;o=r instanceof qo?r.object:r;let s=o.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;if(n&&!o.userData.navmesh)return;let a=r.geometry,l=!0===o.userData.hasDestroy,c=!0===o.userData.hasDrag;if(ky(s)||l||c||o.dataPatched.events.some(h=>!0!==h.data.disabled&&"GameControl"===h.data.type))return!0;a&&i.push(Eh(a,r.matrixWorld))},this.navmeshWasm=kq,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('https://unpkg.com/@splinetool/runtime@1.0.81/build/' + 'navmesh.js'),\n\t\tfetch('https://unpkg.com/@splinetool/navmesh-wasm@1.0.81/build/' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n":"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent((new T).setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,n=>{this.buildFromNavmeshData(n.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),c.cloner?.traverseObject(h=>{h.userData.navmesh=!0})});let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,"custom"===t.zones);if(e.traverseChildren(r),t.objects.forEach(l=>{let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),c.cloner?.traverseObject(h=>{h.userData.navmesh=void 0})}),0===n.length)return!1;let o=o1(n),{positions:s,triIndices:a}=V6(o.getAttribute("position"),o.getIndex());return this._worker.postMessage([s,s.length/3,a,a.length,{...QAe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(3*n),o=new Float32Array(3*n*3);for(e=0;e<3*n;e++)r[e]=e;for(e=0;e<n;e++)for(t=0;t<3;t++){let a=i.getTriangle(e).getPoint(t);o[9*e+3*t+0]=a.x,o[9*e+3*t+1]=a.y,o[9*e+3*t+2]=a.z}let s=new gt;return s.setIndex(new It(r,1)),s.setAttribute("position",new It(o,3)),s}getClosestPoint(e){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.getClosestPoint(bi)}getClosestPointToRef(e,t){bi.x=e.x,bi.y=e.y,bi.z=e.z;let i=this.navMesh.getClosestPoint(bi);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.getRandomPointAround(bi,t)}getRandomPointAroundToRef(e,t,i){bi.x=e.x,bi.y=e.y,bi.z=e.z;let n=this.navMesh.getRandomPointAround(bi,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Io.x=t.x,Io.y=t.y,Io.z=t.z,this.navMesh.moveAlong(bi,Io)}moveAlongToRef(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Io.x=t.x,Io.y=t.y,Io.z=t.z,this.navMesh.moveAlong(bi,Io)}computePath(e,t){let i=this.getClosestPoint(t);if(Io.x=i.x,Io.y=i.y,Io.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let n=this.navMesh.computePath(bi,Io),r=n.getPointCount(),o=[];for(let s=0;s<r;s++){let a=n.getPoint(s);o.push(new T(a.x,a.y,a.z))}return o}createCrowd(e,t){return new class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new T(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);void 0!==t.radius&&(i.radius=t.radius),void 0!==t.height&&(i.height=t.height),void 0!==t.maxAcceleration&&(i.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(i.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(i.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(i.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),!(e<=.001)){{let n=Math.floor(e/.016666666666666666);n>10&&(n=10),n<1&&(n=1);let r=e/n;for(let o=0;o<n;o++)this.crowd.update(r)}for(let n=0;n<this.agents.length;n++){let r=this.agents[n],o=this.getAgentPosition(r);if(this.transforms[n].copy(o),this._agentDestinationArmed[n]){let s=o.x-this._agentDestination[n].x,a=o.z-this._agentDestination[n].z,l=this.reachRadii[n];o.y>this._agentDestination[n].y-this.reachRadii[n]&&o.y<this._agentDestination[n].y+this.reachRadii[n]&&s*s+a*a<l*l&&(this.onReachTarget(r,this._agentDestination[n]),this._agentDestinationArmed[n]=!1)}}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),n=i.getPointCount(),r=[];for(t=0;t<n;t++){let o=i.getPoint(t);r.push(new T(o.x,o.y,o.z))}return r}dispose(){this.crowd.destroy()}}(this,e,t)}setDefaultQueryExtent(e){bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.setDefaultQueryExtent(bi)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);n.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.addCylinderObstacle(bi,t,i)}addBoxObstacle(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Io.x=t.x,Io.y=t.y,Io.z=t.z,this.navMesh.addBoxObstacle(bi,Io,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.navmeshWasm}}(this.usePhysics,this.isExport),p="sphere"===d.collider.type?2*d.collider.radius:d.collider.height,p=Math.floor(p/d.navmesh.ch-1),this.navigationMeshWrapper.init({...d.navmesh,walkableHeight:p},this.gameControl,this.eventContext)}}if(!1===i){let{enableRotate:d,enablePan:p,enableZoom:f,autoRotate:m,hoverRotatePanMode:g}=this.eventManager.publish.orbitControls;(d||p||f||m||0!==g)&&(this.orbitControls=new Fq(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),u=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((d,p)=>{let f=document.body.appendChild(document.createElement("div")),[m,g,v]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[p],y=(h-5*m)/4+m,_={},b="jmp"===d,x=b?0:m;p<10?(p<5?_.top=x/2:_.bottom=x/2,_.left=x/2+p%5*y):10===p?(_.left=x/2,_.top=u/2):(_.right=x/2,_.top=u/2),_.top?_.top-=g[1]:_.bottom+=g[1],_.left?_.left+=g[0]:_.right-=g[0];for(let C in _)_[C]+="px";if(b){let C=f.appendChild(document.createElement("div"));return Object.assign(C.style,_,{position:"absolute",width:m+"px",height:m+"px",backgroundColor:`rgba(255,255,255,${"show"===v?.4:0})`,zIndex:"9999",borderRadius:m+"px",border:"show"===v?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"}),"show"===v&&(C.innerHTML=`\n\t\t\t\t\t\t<svg width="${m/16*16*.4}" height="${.4*m}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",z=>z.preventDefault()),void(this.joysticks[p]=[void 0,f])}let w={zone:f,mode:"static",position:_,size:m};"hide"===v&&(w.restOpacity=0);let S=function(e){return uW.create(e)}(w);S.on("move",(C,M)=>{let z=this.gameControl;"pos"===d?M.force<.2?z.moveForce=0:(z.movementState.movePosZ=Math.sin(-M.angle.radian),z.movementState.movePosX=Math.cos(-M.angle.radian),z.movementState.run=M.force>1.2?1:0,z.moveForce=M.force<.3?(M.force-.2)/.1:1):"rot"===d&&(M.force<.2?z.rotForce=0:(z.movementState.rotPosX=M.vector.y,z.movementState.rotPosY=-M.vector.x,z.rotForce=M.force<.3?(M.force-.2)/.1:1)),this.requestRender()}),S.on("end",(C,M)=>{let z=this.gameControl;"pos"===d?(z.movementState.movePosZ=0,z.movementState.movePosX=0,z.moveForce=1):"rot"===d&&(z.movementState.rotPosX=0,z.movementState.rotPosY=0,z.rotForce=1)}),this.joysticks[p]=[S,f]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(d=>d.disabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new Ai.World(new Ai.Vector3(0,this.gravity,0)),this.events=new Ai.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(s=>{let a;if(s instanceof dl){if(!s.objectForSample)return!0===s.object.dataPatched.physics.fusedBody&&"dynamic"===s.object.dataPatched.physics.rigidBody||void 0;if(s.objectForSample.dataPatched.physics.fusedBody)return;a=s.object}else if(s instanceof qo)a=s.object;else{if(s instanceof py||s instanceof ty)return;if(a=s,!1===a.dataPatched.cloner?.disabled&&a.dataPatched.cloner?.hideBase&&!0!==a.dataPatched.physics?.fusedBody)return!0}let c,l=a.dataPatched;for(let g of l.events)!0!==g.data.disabled&&"GameControl"===g.data.type&&(c=g.data);if(!l.physics||("visibility"===l.physics.enabled?!l.visible:!l.physics.enabled))return!0;s.updateMatrixWorldSVD();let h=ky(l),u=!1,d=a.userData.hasDestroy,p=a.userData.hasDrag,f=!1;for(let g of l.events)if(!0!==g.data.disabled)if("Collision"===g.data.type){u=!0;let v=new UAe(g.id,g.data,a,this.page,this.sharedAssets,this.eventManager);v.disabled=!0,this.collisionEvents.push(v),this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid].every(y=>y.id!==g.id)?this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid].push(v):this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid]=[v]}else if("Follow"===g.data.type){f=!0;let v=g.data.target;s.traverseVisible(y=>{y.userData.isFollowingObj=v})}"dynamic"===l.physics.rigidBody&&!1===l.physics.fusedBody&&(s.matrixWorldFusedFalse=s.matrixWorld.clone());let m=s.geometry;if(void 0!==c){let g=Ai.RigidBodyDesc.kinematicPositionBased();(s.hasNonUniformScale?s.matrixWorldRigid:s.matrixWorld).decompose(Or,xl,Bu),s.position0=Or.clone().divideScalar(this.pixelsPerMeter),s.rotation0=xl.clone(),Or.divideScalar(this.pixelsPerMeter),g.setTranslation(Or.x,Or.y,Or.z).setRotation(xl);let y,v=this.sharedGameControlGlobals.rapierWorld.createRigidBody(g);s.rigidBody=v,y="sphere"===c.collider.type?Ai.ColliderDesc.ball(c.collider.radius/this.pixelsPerMeter):"capsule"===c.collider.type?Ai.ColliderDesc.capsule((c.collider.height/2-c.collider.radius)/this.pixelsPerMeter,c.collider.radius/this.pixelsPerMeter):Ai.ColliderDesc.cuboid(c.collider.width/this.pixelsPerMeter/2,c.collider.height/this.pixelsPerMeter/2,c.collider.depth/this.pixelsPerMeter/2),y.setFrictionCombineRule(Ai.CoefficientCombineRule.Average).setRestitutionCombineRule(Ai.CoefficientCombineRule.Average).setDensity(l.physics.density).setFriction(l.physics.friction).setRestitution(l.physics.restitution);let _=this.sharedGameControlGlobals.rapierWorld.createCollider(y,v);this.sharedGameControlGlobals.colliderToEntity.set(_.handle,a),Or.fromArray(c.collider.position).multiply(Bu.setFromMatrixScale(a.matrixWorld)).divideScalar(this.pixelsPerMeter),_.setTranslationWrtParent(Or);let b=(new qt).setFromEuler((new Ur).setFromVector3((new T).fromArray(c.collider.rotation)));_.setRotationWrtParent(b),_.setActiveEvents(Ai.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(a,!0)}else"dynamic"===l.physics.rigidBody||h||f||d||p||u?(this.addRigidBody(s,a,{hasFollow:f,hasTransformAnim:h,hasDrag:p}),this.generateSensorColliderDescs(a,l.physics.fusedBody)):(m&&e.push(Eh(m,s.matrixWorld)),l.physics.fusedBody&&s.traverseObject((g,v)=>{if(0===v)return;let y;if(g instanceof dl){if(!g.objectForSample)return!0===g.object.dataPatched.physics.fusedBody&&"dynamic"===g.object.dataPatched.physics.rigidBody||void 0;if(g.objectForSample.dataPatched.physics.fusedBody)return;y=g.object}else{if(g instanceof py||g instanceof ty)return;if(g instanceof qo)y=g.object;else if(y=g,y.dataPatched.cloner?.hideBase)return!0}let _=y.dataPatched;if("visibility"===_.physics.enabled?!_.visible:!_.physics.enabled)return!0;let b=g.geometry;void 0!==b?.getAttribute("position")&&e.push(Eh(b,g.matrixWorld))}),this.generateSensorColliderDescs(a,l.physics.fusedBody,t));return!(!0!==l.physics?.fusedBody&&!c)||void 0}),0===e.length)return;let i=o1(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let n=Ai.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n),o=Ai.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Ai.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Ai.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(o,r);for(let[s,a]of t){let l=this.sharedGameControlGlobals.rapierWorld.createCollider(s,r);this.sensorToTriggerEvent[l.handle]=a}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let i=new Vq(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),n=(new De).compose(wl.fromArray(t.data.position),z0.setFromEuler(Hq.fromArray(t.data.rotation)),yz);if("box"===t.data.triggerZone){let r=new dr;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,n,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse(e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([e,t])=>{e?.destroy(),t.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach(t=>t.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let n=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):2===this.initializationCounter&&this.gameControl&&(n=!this.gameControl.update(e,t,i)&&n),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let r=.016666666666666666;if(0===e)n=this.stepPhysics()&&n;else{let o=e/1e3;o<r&&o>.55*r&&(o=r),this.accumulator+=o;let s=performance.now(),a=0,l=6;for(;this.accumulator>=r&&a<l&&(n=this.stepPhysics()&&n,this.accumulator-=r,a++,!(performance.now()-s>1e3*r)););this.accumulator=this.accumulator%r}}return n}stepPhysics(){for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Or,xl,Bu),gz.setFromQuaternion(xl);let t=e;void 0===t.prevR?(t.prevR=gz.clone(),t.prevT=Or.clone()):(t.prevR.copy(gz),t.prevT.copy(Or)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(Or.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(xl))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){let r,n=this.sharedGameControlGlobals.rapierWorld?.getCollider(i)._parent;if(t.cloner)for(let o of t.cloner.children)if(o.rigidBody===n){r=o;break}e.dispatch(r),t.dispatchEvent(bz)}updateUseWindowEvents(e){this.orbitControls?.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let n=Uq.copy(e.matrixWorld).invert();e.traverseEntity((r,o)=>{if(!1===t&&1===o)return!0;for(let s of r.dataPatched.events)if("Trigger"===s.data.type&&!0!==s.data.disabled){let l,a=new Vq(s.id,s.data,r,this.page,this.sharedAssets,this.eventManager);if(l="box"===s.data.triggerZone?Ai.ColliderDesc.cuboid(...s.data.size.map(c=>c/(2*this.pixelsPerMeter))):Ai.ColliderDesc.ball(s.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Ai.ActiveEvents.COLLISION_EVENTS),wl.fromArray(s.data.position),z0.setFromEuler(Hq.fromArray(s.data.rotation)),Oy.compose(wl,z0,yz).premultiply(r.matrixWorld),i?(Oy.decompose(wl,z0,vz),l.setActiveCollisionTypes(Ai.ActiveCollisionTypes.KINEMATIC_FIXED|Ai.ActiveCollisionTypes.DYNAMIC_FIXED)):(Oy.premultiply(n).decompose(wl,z0,vz),e.rigidBody.bodyType()===Ai.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Ai.RigidBodyType.Fixed?l.setActiveCollisionTypes(Ai.ActiveCollisionTypes.KINEMATIC_FIXED|Ai.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Ai.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Ai.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),wl.divideScalar(this.pixelsPerMeter),l.setTranslation(wl.x,wl.y,wl.z),l.setRotation(z0),i)i.push([l,a]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=a}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,n,r,o]=this.sharedGameControlGlobals.triggers[t];for(let s=0;s<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;s++){let a=this.sharedGameControlGlobals.entitiesWithTransformAnim[s];if(r===a||!1===o.isValidTriggeringObject(Ti.is(a)?a:a.object))continue;let l=Uq.copy(r.matrixWorld).decompose(wl,jq,vz).compose(wl,jq,yz).multiply(n),c=Oy.copy(a.matrixWorld).invert().multiply(l);i instanceof dr?e=a.bvhGeometry.boundsTree.intersectsBox(i,c):(_z.radius=i,_z.center.setFromMatrixPosition(c),e=a.bvhGeometry.boundsTree.intersectsSphere(_z)),e?-1===o.currentIntersectedObjects.indexOf(a)&&(o.currentIntersectedObjects.push(a),o.dispatch(),r.dispatchEvent(cPe)):o.currentIntersectedObjects=o.currentIntersectedObjects.filter(h=>h!==a)}}}}(c),n._animationControls=new class{constructor(e,t,i,n){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=r=>{"Empty"===r.data.type&&r.data.animations&&r.data.animations.forEach((o,s)=>{let a=o[0]+"/";if(Array.isArray(r.identity)?a+=r.identity[0]:a+=r.uuid,this.clipIdToAction[a])return;let l=Yx.parse(JSON.parse(o[2]));r.animations[s]=l;let c=this.mixer.clipAction(l,r);!1===Yq&&(Object.getPrototypeOf(c)._updateTime=dPe,Yq=!0),c.clampWhenFinished=!0,this.clipIdToAction[a]=c})},this.mixer=new p3e(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let n=i.animations.find(o=>o.uuid===e);if(!n)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[e],i.animations=i.animations.filter(o=>o.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=2201}),this.mixer.stopAllAction(),this.requestRender()}play(e){let i=this.clipIdToAction[e.clipId+"/"+e.object];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),"pingpong"===e.direction&&0!==e.repeat&&(i.loop=qb)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||this.animationInspectorState?.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){return this.activeClip?.tracks[0]?.times.length??0}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}}(n._scene,n._requestRenderAutoMode),n._eventManager=new class{constructor(e,t,i,n,r){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=o=>{let s=window.parent!==window,a=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(o.touches.length>1||this.preventTouchScroll||!1===s&&!1===a)&&o.preventDefault()},this.onMouseWheelPreventScroll=o=>{this.preventScroll&&o.preventDefault()},this.onMouseMove=o=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(o),pressed:o.buttons>0}},this.onMouseDown=o=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(o),pressed:!0}},this.onMouseUp=o=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(o),pressed:!1}},this.getMousePosition=o=>{let{domRect:s}=this.eventContext,{pageX:a,pageY:l}=o.touches?.length>0?o.touches[0]:o;return{x:a-(s.left+window.scrollX),y:l-(s.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=n.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new uAe(this.eventContext),DynamicVariable:new jAe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new yAe(this.eventContext,this),Start:new HAe(this.eventContext,this),Basic:new pAe(this.eventContext,this,this.needsRaycast),MouseHover:new LAe(this.eventContext,this),Scroll:new BAe(this.eventContext,this),Follow:new EAe(this.eventContext,this),DragDrop:new CAe(this.eventContext,this),LookAt:new OAe(this.eventContext),Resize:new wPe(this.eventContext,this)};let{page:e,domElement:t}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(i=>i.connect()),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(i=>i.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender),i.destroyedInAction=!1}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if("Conditional"===i.data.type&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),"Conditional"===i.data.type||"SetVariable"===i.data.type)for(let n of"Conditional"===i.data.type?i.data.condition:i.data.expression)"id"in n&&Array.isArray(n.id)&&("mouse"===n.id[0]&&(this.needsMouse=!0),"raycast"===n.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===i.data.type&&""!==i.data.variableId&&("Play"===i.data.mode||"PlayPause"===i.data.mode||"Toggle"===i.data.mode)&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{if(i.data?.events.length)for(let n of i.data.events)if(!n.data.disabled)if("VariableChange"===n.data.type&&("mouseProperty"===n.data.variableId&&(this.needsMouse=!0),"raycastProperty"===n.data.variableId&&(this.needsRaycast=!0)),"Conditional"===n.data.type)for(let r of["inActions","outActions"])n.data[r].forEach(t);else if("DragDrop"===n.data.type)for(let r of["drag","drop"])n.data.dragDropActions[r].forEach(t);else if("GameControl"===n.data.type)for(let r of["idle","move","jump","run"])n.data.gameActions[r].forEach(t);else if("Resize"===n.data.type)for(let r of n.data.breakpoints)r.data.actions.forEach(t);else"LookAt"===n.data.type||n.data.actions.forEach(t)})}}(r.scene.publish,n._controls,n._animationControls,c,r.shared.variables),n._eventManager.activate(),n._controls.activate(n._eventManager)}n._resize(),void 0!==i&&n.setVariables(i),0===n.dt&&(n.render(performance.now()),setTimeout(()=>{n._renderer?.setAnimationLoop(n.render)},0)),n._resizeObserverTimeout=setTimeout(()=>{!n._resizeObserver&&n.canvas.parentElement&&(n._resizeObserver=new ResizeObserver(()=>{n._viewportWidth=n.canvas.clientWidth,n._viewportHeight=n.canvas.clientHeight,n._debouncedResize()}),n._resizeObserver.observe(n.canvas.parentElement))},300),document.addEventListener("scroll",n._onScroll)})()}setVariables(e){if(void 0!==this._data){let t=Object.entries(e);for(let[i,n]of t)this.setVariable(i,n)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;"number"==typeof i.data.value?n="number"==typeof t?t:"boolean"==typeof t?!0===t?1:0:parseFloat(t):"boolean"==typeof i.data.value?n="number"==typeof t?!!t:"boolean"==typeof t?t:"false"!==t.toLocaleLowerCase()&&!!t:"string"!=typeof i.data.value&&void 0!==i.data.value.textValue&&(n=t.toString()),this._sharedAssetsManager?.updateVariable(i.id,"string"==typeof n?{textValue:n}:n),this.requestRender(),this._requestRenderAutoMode()}else void 0===i?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{void 0===e[t.data.name]&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return"string"!=typeof e&&oa.isTextValue(e)?oa.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){let t=this._scene?.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){let t=this._scene?.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){let e=[];return this._scene?.traverseEntity(t=>{if(!(t.uuid===Df||this._scene.isInvisibleObjects(t)||t instanceof ho)){let i=this._createProxyObject(t);i&&e.push(i)}}),e}getSplineEvents(){return this._eventManager?.handlers?.Spline.splineEvents}emitEvent(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEvent(e)}emitEventReverse(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){this._controls?.orbitControls instanceof Fq&&this._controls?.orbitControls.zoomOut(e)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){let{r:t,g:i,b:n,a:r}={r:0,g:0,b:0,a:1},o=new Do(t,i,n,r);try{o.setStyle(e)}catch{console.error("This is not a valid css color",e)}this._scene?.activePage.setBackgroundColor(o),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(e=>{FB.unsubscribe(e)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,function X_e(e){e.removeEventListener("pointerdown",QV,!0),e.removeEventListener("pointerdown",F8,!0),e.removeEventListener("pointermove",F8,!0),e.removeEventListener("pointerup",Mf,!0),e.removeEventListener("pointercancel",Mf,!0),e.removeEventListener("pointerleave",Mf,!0),window.removeEventListener("keydown",ZV,!0),window.removeEventListener("keyup",KV,!0)}(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(e){this._eventManager?.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(null==e)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(r=>{r instanceof ho&&(t=r.name)});let n=FB({name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof ho||e instanceof AM?void 0:e.parent?.uuid,emitEvent(r){e.dispatchEvent({type:"userEvent",eventName:r})},emitEventReverse(r){e.dispatchEvent({type:"userEvent",eventName:r,reverse:!0})}},(r,o)=>{"object"!=typeof e[r]&&Object.getOwnPropertyDescriptor(e,r)?.writable&&(e[r]=o),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,n),n}setUIWasmUrl(e){yY.skiaWasmUrl=e}}(i).load("https://prod.spline.design/DrkSoSj95LUVvfbh/scene.splinecode")}}return e.\u0275fac=function(i){return new(i||e)(L(Fy))},e.\u0275cmp=ut({type:e,selectors:[["app-root"]],decls:9,vars:0,consts:[[1,"d-flex","h-100"],["id","canvas"],[1,"container","d-flex","w-100","h-100","p-3","mx-auto","flex-column"],[1,"mb-auto"],[1,"element-front","py-3","px-4"],[1,"px-3","element-front"],[1,"mt-auto","text-white-50","element-front"]],template:function(i,n){1&i&&(Ee(0,"nz-layout",0)(1,"div",0),Je(2,"canvas",1),Ee(3,"div",2),Je(4,"div",3)(5,"app-navbar",4)(6,"app-home",5),Ee(7,"footer",6),Je(8,"app-footer"),Pe()()()())},styles:["canvas[_ngcontent-%COMP%]{position:absolute;left:0;top:0}.element-front[_ngcontent-%COMP%]{z-index:1;pointer-events:none}.element-front-action[_ngcontent-%COMP%]{z-index:1}"]}),e})();const Jq={isTestMode:!1};const Y4=(...e)=>function tX(e,...t){Jq.isTestMode&&e(...t)}((...t)=>console.warn("[NG-ZORRO]:",...t),...e);var iX={locale:"en",Pagination:{items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"},DatePicker:{lang:{placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"],locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"Ok",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"},timePickerLocale:{placeholder:"Select time",rangePlaceholder:["Start time","End time"]}},TimePicker:{placeholder:"Select time",rangePlaceholder:["Start time","End time"]},Calendar:{lang:{placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"],locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"Ok",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"},timePickerLocale:{placeholder:"Select time",rangePlaceholder:["Start time","End time"]}},global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",selectNone:"Clear all data"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No Data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand"},PageHeader:{back:"Back"},Image:{preview:"Preview"},CronExpression:{cronError:"Invalid cron expression",second:"second",minute:"minute",hour:"hour",day:"day",month:"month",week:"week",secondError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><p><span>0-59</span>Allowable range</p>",minuteError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><p><span>0-59</span>Allowable range</p>",hourError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><p><span>0-23</span>Allowable range</p>",dayError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><p><span>1-31</span>Allowable range</p>",monthError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><p><span>1-12</span>Allowable range</p>",weekError:"<p><span>*</span>Any value</p><p><span>,</span>Separator between multiple values</p><p><span>-</span>Connector for interval values</p><p><span>/</span>Equally distributed</p><span>?</span> Not specify</p><p><p><span>0-7</span>Allowable range (0 represents Sunday, 1-7 are Monday to Sunday)</p>"},QRCode:{expired:"QR code expired",refresh:"Refresh"}},FPe={locale:"zh-cn",Pagination:{items_per_page:"\u6761/\u9875",jump_to:"\u8df3\u81f3",jump_to_confirm:"\u786e\u5b9a",page:"\u9875",prev_page:"\u4e0a\u4e00\u9875",next_page:"\u4e0b\u4e00\u9875",prev_5:"\u5411\u524d 5 \u9875",next_5:"\u5411\u540e 5 \u9875",prev_3:"\u5411\u524d 3 \u9875",next_3:"\u5411\u540e 3 \u9875",page_size:"\u9875\u7801"},DatePicker:{lang:{placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",yearPlaceholder:"\u8bf7\u9009\u62e9\u5e74\u4efd",quarterPlaceholder:"\u8bf7\u9009\u62e9\u5b63\u5ea6",monthPlaceholder:"\u8bf7\u9009\u62e9\u6708\u4efd",weekPlaceholder:"\u8bf7\u9009\u62e9\u5468",rangePlaceholder:["\u5f00\u59cb\u65e5\u671f","\u7ed3\u675f\u65e5\u671f"],rangeYearPlaceholder:["\u5f00\u59cb\u5e74\u4efd","\u7ed3\u675f\u5e74\u4efd"],rangeMonthPlaceholder:["\u5f00\u59cb\u6708\u4efd","\u7ed3\u675f\u6708\u4efd"],rangeWeekPlaceholder:["\u5f00\u59cb\u5468","\u7ed3\u675f\u5468"],locale:"zh_CN",today:"\u4eca\u5929",now:"\u6b64\u523b",backToToday:"\u8fd4\u56de\u4eca\u5929",ok:"\u786e\u5b9a",timeSelect:"\u9009\u62e9\u65f6\u95f4",dateSelect:"\u9009\u62e9\u65e5\u671f",weekSelect:"\u9009\u62e9\u5468",clear:"\u6e05\u9664",month:"\u6708",year:"\u5e74",previousMonth:"\u4e0a\u4e2a\u6708 (\u7ffb\u9875\u4e0a\u952e)",nextMonth:"\u4e0b\u4e2a\u6708 (\u7ffb\u9875\u4e0b\u952e)",monthSelect:"\u9009\u62e9\u6708\u4efd",yearSelect:"\u9009\u62e9\u5e74\u4efd",decadeSelect:"\u9009\u62e9\u5e74\u4ee3",yearFormat:"YYYY\u5e74",dayFormat:"D\u65e5",dateFormat:"YYYY\u5e74M\u6708D\u65e5",dateTimeFormat:"YYYY\u5e74M\u6708D\u65e5 HH\u65f6mm\u5206ss\u79d2",previousYear:"\u4e0a\u4e00\u5e74 (Control\u952e\u52a0\u5de6\u65b9\u5411\u952e)",nextYear:"\u4e0b\u4e00\u5e74 (Control\u952e\u52a0\u53f3\u65b9\u5411\u952e)",previousDecade:"\u4e0a\u4e00\u5e74\u4ee3",nextDecade:"\u4e0b\u4e00\u5e74\u4ee3",previousCentury:"\u4e0a\u4e00\u4e16\u7eaa",nextCentury:"\u4e0b\u4e00\u4e16\u7eaa"},timePickerLocale:{placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4",rangePlaceholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"]}},TimePicker:{placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4",rangePlaceholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"]},Calendar:{lang:{placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",yearPlaceholder:"\u8bf7\u9009\u62e9\u5e74\u4efd",quarterPlaceholder:"\u8bf7\u9009\u62e9\u5b63\u5ea6",monthPlaceholder:"\u8bf7\u9009\u62e9\u6708\u4efd",weekPlaceholder:"\u8bf7\u9009\u62e9\u5468",rangePlaceholder:["\u5f00\u59cb\u65e5\u671f","\u7ed3\u675f\u65e5\u671f"],rangeYearPlaceholder:["\u5f00\u59cb\u5e74\u4efd","\u7ed3\u675f\u5e74\u4efd"],rangeMonthPlaceholder:["\u5f00\u59cb\u6708\u4efd","\u7ed3\u675f\u6708\u4efd"],rangeWeekPlaceholder:["\u5f00\u59cb\u5468","\u7ed3\u675f\u5468"],locale:"zh_CN",today:"\u4eca\u5929",now:"\u6b64\u523b",backToToday:"\u8fd4\u56de\u4eca\u5929",ok:"\u786e\u5b9a",timeSelect:"\u9009\u62e9\u65f6\u95f4",dateSelect:"\u9009\u62e9\u65e5\u671f",weekSelect:"\u9009\u62e9\u5468",clear:"\u6e05\u9664",month:"\u6708",year:"\u5e74",previousMonth:"\u4e0a\u4e2a\u6708 (\u7ffb\u9875\u4e0a\u952e)",nextMonth:"\u4e0b\u4e2a\u6708 (\u7ffb\u9875\u4e0b\u952e)",monthSelect:"\u9009\u62e9\u6708\u4efd",yearSelect:"\u9009\u62e9\u5e74\u4efd",decadeSelect:"\u9009\u62e9\u5e74\u4ee3",yearFormat:"YYYY\u5e74",dayFormat:"D\u65e5",dateFormat:"YYYY\u5e74M\u6708D\u65e5",dateTimeFormat:"YYYY\u5e74M\u6708D\u65e5 HH\u65f6mm\u5206ss\u79d2",previousYear:"\u4e0a\u4e00\u5e74 (Control\u952e\u52a0\u5de6\u65b9\u5411\u952e)",nextYear:"\u4e0b\u4e00\u5e74 (Control\u952e\u52a0\u53f3\u65b9\u5411\u952e)",previousDecade:"\u4e0a\u4e00\u5e74\u4ee3",nextDecade:"\u4e0b\u4e00\u5e74\u4ee3",previousCentury:"\u4e0a\u4e00\u4e16\u7eaa",nextCentury:"\u4e0b\u4e00\u4e16\u7eaa"},timePickerLocale:{placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4",rangePlaceholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"]}},global:{placeholder:"\u8bf7\u9009\u62e9"},Table:{filterTitle:"\u7b5b\u9009",filterConfirm:"\u786e\u5b9a",filterReset:"\u91cd\u7f6e",filterEmptyText:"\u65e0\u7b5b\u9009\u9879",selectAll:"\u5168\u9009\u5f53\u9875",selectInvert:"\u53cd\u9009\u5f53\u9875",selectionAll:"\u5168\u9009\u6240\u6709",sortTitle:"\u6392\u5e8f",expand:"\u5c55\u5f00\u884c",collapse:"\u5173\u95ed\u884c",triggerDesc:"\u70b9\u51fb\u964d\u5e8f",triggerAsc:"\u70b9\u51fb\u5347\u5e8f",cancelSort:"\u53d6\u6d88\u6392\u5e8f",filterCheckall:"\u5168\u9009",filterSearchPlaceholder:"\u5728\u7b5b\u9009\u9879\u4e2d\u641c\u7d22",selectNone:"\u6e05\u7a7a\u6240\u6709"},Modal:{okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",justOkText:"\u77e5\u9053\u4e86"},Popconfirm:{cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a"},Transfer:{searchPlaceholder:"\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9",itemUnit:"\u9879",itemsUnit:"\u9879",remove:"\u5220\u9664",selectCurrent:"\u5168\u9009\u5f53\u9875",removeCurrent:"\u5220\u9664\u5f53\u9875",selectAll:"\u5168\u9009\u6240\u6709",removeAll:"\u5220\u9664\u5168\u90e8",selectInvert:"\u53cd\u9009\u5f53\u9875"},Upload:{uploading:"\u6587\u4ef6\u4e0a\u4f20\u4e2d",removeFile:"\u5220\u9664\u6587\u4ef6",uploadError:"\u4e0a\u4f20\u9519\u8bef",previewFile:"\u9884\u89c8\u6587\u4ef6",downloadFile:"\u4e0b\u8f7d\u6587\u4ef6"},Empty:{description:"\u6682\u65e0\u6570\u636e"},Icon:{icon:"\u56fe\u6807"},Text:{edit:"\u7f16\u8f91",copy:"\u590d\u5236",copied:"\u590d\u5236\u6210\u529f",expand:"\u5c55\u5f00"},PageHeader:{back:"\u8fd4\u56de"},Image:{preview:"\u9884\u89c8"},CronExpression:{cronError:"cron \u8868\u8fbe\u5f0f\u4e0d\u5408\u6cd5",second:"\u79d2",minute:"\u5206\u949f",hour:"\u5c0f\u65f6",day:"\u65e5",month:"\u6708",week:"\u5468",secondError:"<p><span>*</span>\u4efb\u610f\u503c</p><p><span>,</span>\u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span>\u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span>\u5e73\u5747\u5206\u914d</p><p><span>0-59</span>\u5141\u8bb8\u8303\u56f4</p>",minuteError:"<p><span>*</span>\u4efb\u610f\u503c</p><p><span>,</span>\u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span>\u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span>\u5e73\u5747\u5206\u914d</p><p><span>0-59</span>\u5141\u8bb8\u8303\u56f4</p>",hourError:"<p><span>*</span> \u4efb\u610f\u503c</p><p><span>,</span> \u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span> \u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span> \u5e73\u5747\u5206\u914d</p><p><span>0-23</span> \u5141\u8bb8\u8303\u56f4</p>",dayError:"<p><span>*</span> \u4efb\u610f\u503c</p><p><span>,</span> \u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span> \u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span> \u5e73\u5747\u5206\u914d</p><p><span>1-31</span> \u5141\u8bb8\u8303\u56f4</p>",monthError:"<p><span>*</span> \u4efb\u610f\u503c</p><p><span>,</span> \u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span> \u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span> \u5e73\u5747\u5206\u914d</p><p><span>1-12</span> \u5141\u8bb8\u8303\u56f4</p>",weekError:"<p><span>*</span> \u4efb\u610f\u503c</p><p><span>,</span> \u591a\u4e2a\u503c\u4e4b\u95f4\u7684\u5206\u9694\u7b26</p><p><span>-</span> \u533a\u95f4\u503c\u7684\u8fde\u63a5\u7b26</p><p><span>/</span> \u5e73\u5747\u5206\u914d</p><p><span>?</span> \u4e0d\u6307\u5b9a</p><p><span>0-7</span> \u5141\u8bb8\u8303\u56f4\uff080\u4ee3\u8868\u5468\u65e5\uff0c1-7\u4f9d\u6b21\u4e3a\u5468\u4e00\u5230\u5468\u65e5\uff09</p>"},QRCode:{expired:"\u4e8c\u7ef4\u7801\u8fc7\u671f",refresh:"\u70b9\u51fb\u5237\u65b0"}};const nX=new Fe("nz-i18n"),BPe=new Fe("nz-date-locale");let G4=(()=>{class e{constructor(i,n){this._change=new Yi(this._locale),this.setLocale(i||FPe),this.setDateLocale(n||null)}get localeChange(){return this._change.asObservable()}translate(i,n){let r=this._getObjectPath(this._locale,i);return"string"==typeof r?(n&&Object.keys(n).forEach(o=>r=r.replace(new RegExp(`%${o}%`,"g"),n[o])),r):i}setLocale(i){this._locale&&this._locale.locale===i.locale||(this._locale=i,this._change.next(i))}getLocale(){return this._locale}getLocaleId(){return this._locale?this._locale.locale:""}setDateLocale(i){this.dateLocale=i}getDateLocale(){return this.dateLocale}getLocaleData(i,n){const r=i?this._getObjectPath(this._locale,i):this._locale;return!r&&!n&&Y4(`Missing translations for "${i}" in language "${this._locale.locale}".\nYou can use "NzI18nService.setLocale" as a temporary fix.\nWelcome to submit a pull request to help us optimize the translations!\nhttps://github.com/NG-ZORRO/ng-zorro-antd/blob/master/CONTRIBUTING.md`),r||n||this._getObjectPath(iX,i)||{}}_getObjectPath(i,n){let r=i;const o=n.split("."),s=o.length;let a=0;for(;r&&a<s;)r=r[o[a++]];return a===s?r:null}}return e.\u0275fac=function(i){return new(i||e)(he(nX,8),he(BPe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Vy=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();new Fe("date-config");const C1=void 0,YPe=["en",[["a","p"],["AM","PM"],C1],[["AM","PM"],C1,C1],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],C1,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],C1,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",C1,"{1} 'at' {0}",C1],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function jPe(e){const i=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===i&&0===n?1:5}];let rX=(()=>{class e{constructor(i,n){this._renderer=i,this._elementRef=n,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(i,n){this._renderer.setProperty(this._elementRef.nativeElement,i,n)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}}return e.\u0275fac=function(i){return new(i||e)(L(Nn),L(yt))},e.\u0275dir=Ge({type:e}),e})(),S1=(()=>{class e extends rX{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275dir=Ge({type:e,features:[Ci]}),e})();const Na=new Fe("NgValueAccessor"),WPe={provide:Na,useExisting:nn(()=>Hy),multi:!0},sX=new Fe("CompositionEventMode");let Hy=(()=>{class e extends rX{constructor(i,n,r){super(i,n),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function qPe(){const e=Hc()?Hc().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(i){this.setProperty("value",i??"")}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}}return e.\u0275fac=function(i){return new(i||e)(L(Nn),L(yt),L(sX,8))},e.\u0275dir=Ge({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,n){1&i&&pt("input",function(o){return n._handleInput(o.target.value)})("blur",function(){return n.onTouched()})("compositionstart",function(){return n._compositionStart()})("compositionend",function(o){return n._compositionEnd(o.target.value)})},features:[vi([WPe]),Ci]}),e})();const XPe=!1,Ko=new Fe("NgValidators"),Uu=new Fe("NgAsyncValidators");function gX(e){return null!=e}function vX(e){const t=ym(e)?Wn(e):e;if(XPe&&!q_(t)){let i="Expected async validator to return Promise or Observable.";throw"object"==typeof e&&(i+=" Are you using a synchronous validator where an async validator is expected?"),new xe(-1101,i)}return t}function yX(e){let t={};return e.forEach(i=>{t=null!=i?{...t,...i}:t}),0===Object.keys(t).length?null:t}function _X(e,t){return t.map(i=>i(e))}function bX(e){return e.map(t=>function QPe(e){return!e.validate}(t)?t:i=>t.validate(i))}function kz(e){return null!=e?function xX(e){if(!e)return null;const t=e.filter(gX);return 0==t.length?null:function(i){return yX(_X(i,t))}}(bX(e)):null}function Nz(e){return null!=e?function wX(e){if(!e)return null;const t=e.filter(gX);return 0==t.length?null:function(i){return Gq(_X(i,t).map(vX)).pipe(bt(yX))}}(bX(e)):null}function CX(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function Lz(e){return e?Array.isArray(e)?e:[e]:[]}function jy(e,t){return Array.isArray(e)?e.includes(t):e===t}function zX(e,t){const i=Lz(t);return Lz(e).forEach(r=>{jy(i,r)||i.push(r)}),i}function TX(e,t){return Lz(t).filter(i=>!jy(e,i))}class EX{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=kz(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=Nz(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,i){return!!this.control&&this.control.hasError(t,i)}getError(t,i){return this.control?this.control.getError(t,i):null}}class ws extends EX{get formDirective(){return null}get path(){return null}}class kh extends EX{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class DX{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Rz=(()=>{class e extends DX{constructor(i){super(i)}}return e.\u0275fac=function(i){return new(i||e)(L(kh,2))},e.\u0275dir=Ge({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,n){2&i&&Dt("ng-untouched",n.isUntouched)("ng-touched",n.isTouched)("ng-pristine",n.isPristine)("ng-dirty",n.isDirty)("ng-valid",n.isValid)("ng-invalid",n.isInvalid)("ng-pending",n.isPending)},features:[Ci]}),e})();const W4="VALID",Gy="INVALID",T0="PENDING",q4="DISABLED";function Wy(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class OX{constructor(t,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===W4}get invalid(){return this.status===Gy}get pending(){return this.status==T0}get disabled(){return this.status===q4}get enabled(){return this.status!==q4}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(zX(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(zX(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(TX(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(TX(t,this._rawAsyncValidators))}hasValidator(t){return jy(this._rawValidators,t)}hasAsyncValidator(t){return jy(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=T0,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=q4,this.errors=null,this._forEachChild(n=>{n.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!0))}enable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=W4,this._forEachChild(n=>{n.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===W4||this.status===T0)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?q4:W4}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=T0,this._hasOwnPendingAsyncValidator=!0;const i=vX(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,i={}){this.errors=t,this._updateControlsErrors(!1!==i.emitEvent)}get(t){let i=t;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((n,r)=>n&&n._find(r),this)}getError(t,i){const n=i?this.get(i):this;return n&&n.errors?n.errors[t]:null}hasError(t,i){return!!this.getError(t,i)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Re,this.statusChanges=new Re}_calculateStatus(){return this._allControlsDisabled()?q4:this.errors?Gy:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(T0)?T0:this._anyControlsHaveStatus(Gy)?Gy:W4}_anyControlsHaveStatus(t){return this._anyControls(i=>i.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Wy(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function rIe(e){return Array.isArray(e)?kz(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function oIe(e){return Array.isArray(e)?Nz(e):e||null}(this._rawAsyncValidators)}}const E0=new Fe("CallSetDisabledState",{providedIn:"root",factory:()=>qy}),qy="always";function X4(e,t,i=qy){(function Yz(e,t){const i=function SX(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(CX(i,t.validator)):"function"==typeof i&&e.setValidators([i]);const n=function MX(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(CX(n,t.asyncValidator)):"function"==typeof n&&e.setAsyncValidators([n]);const r=()=>e.updateValueAndValidity();Qy(t._rawValidators,r),Qy(t._rawAsyncValidators,r)})(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===i)&&t.valueAccessor.setDisabledState?.(e.disabled),function lIe(e,t){t.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&kX(e,t)})}(e,t),function hIe(e,t){const i=(n,r)=>{t.valueAccessor.writeValue(n),r&&t.viewToModelUpdate(n)};e.registerOnChange(i),t._registerOnDestroy(()=>{e._unregisterOnChange(i)})}(e,t),function cIe(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&kX(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function aIe(e,t){if(t.valueAccessor.setDisabledState){const i=n=>{t.valueAccessor.setDisabledState(n)};e.registerOnDisabledChange(i),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}(e,t)}function Qy(e,t){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(t)})}function kX(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function RX(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}function FX(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const BX=class extends OX{constructor(t=null,i,n){super(function Hz(e){return(Wy(e)?e.validators:e)||null}(i),function Uz(e,t){return(Wy(t)?t.asyncValidators:e)||null}(n,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Wy(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=FX(t)?t.value:t)}setValue(t,i={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(t,i={}){this.setValue(t,i)}reset(t=this.defaultValue,i={}){this._applyFormState(t),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){RX(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){RX(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){FX(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},yIe={provide:kh,useExisting:nn(()=>Ky)},UX=(()=>Promise.resolve())();let Ky=(()=>{class e extends kh{constructor(i,n,r,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this.control=new BX,this._registered=!1,this.update=new Re,this._parent=i,this._setValidators(n),this._setAsyncValidators(r),this.valueAccessor=function qz(e,t){if(!t)return null;let i,n,r;return Array.isArray(t),t.forEach(o=>{o.constructor===Hy?i=o:function pIe(e){return Object.getPrototypeOf(e.constructor)===S1}(o)?n=o:r=o}),r||n||i||null}(0,o)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){const n=i.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),function Wz(e,t){if(!e.hasOwnProperty("model"))return!1;const i=e.model;return!!i.isFirstChange()||!Object.is(t,i.currentValue)}(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){X4(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(i){UX.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){const n=i.isDisabled.currentValue,r=0!==n&&Mp(n);UX.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?function Xy(e,t){return[...t.path,e]}(i,this._parent):[i]}}return e.\u0275fac=function(i){return new(i||e)(L(ws,9),L(Ko,10),L(Uu,10),L(Na,10),L(Ri,8),L(E0,8))},e.\u0275dir=Ge({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[vi([yIe]),Ci,Ht]}),e})(),YX=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),jIe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[YX]}),e})(),tT=(()=>{class e{static withConfig(i){return{ngModule:e,providers:[{provide:E0,useValue:i.callSetDisabledState??qy}]}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[jIe]}),e})();class Jy{}class Q4{}class Nh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(i=>{const n=i.indexOf(":");if(n>0){const r=i.slice(0,n),o=r.toLowerCase(),s=i.slice(n+1).trim();this.maybeSetNormalizedName(r,o),this.headers.has(o)?this.headers.get(o).push(s):this.headers.set(o,[s])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(i=>{let n=t[i];const r=i.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(i,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof Nh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){const i=new Nh;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof Nh?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){const i=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,i);const r=("a"===t.op?this.headers.get(i):void 0)||[];r.push(...n),this.headers.set(i,r);break;case"d":const o=t.value;if(o){let s=this.headers.get(i);if(!s)return;s=s.filter(a=>-1===o.indexOf(a)),0===s.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,s)}else this.headers.delete(i),this.normalizedNames.delete(i)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}}class GIe{encodeKey(t){return l$(t)}encodeValue(t){return l$(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const qIe=/%(\d[a-f0-9])/gi,XIe={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function l$(e){return encodeURIComponent(e).replace(qIe,(t,i)=>XIe[i]??t)}function e5(e){return`${e}`}class ju{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new GIe,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function WIe(e,t){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(r=>{const o=r.indexOf("="),[s,a]=-1==o?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,o)),t.decodeValue(r.slice(o+1))],l=i.get(s)||[];l.push(a),i.set(s,l)}),i}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{const n=t.fromObject[i],r=Array.isArray(n)?n.map(e5):[e5(n)];this.map.set(i,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){const i=[];return Object.keys(t).forEach(n=>{const r=t[n];Array.isArray(r)?r.forEach(o=>{i.push({param:n,value:o,op:"a"})}):i.push({param:n,value:r,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const i=this.encoder.encodeKey(t);return this.map.get(t).map(n=>i+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const i=new ju({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const i=("a"===t.op?this.map.get(t.param):void 0)||[];i.push(e5(t.value)),this.map.set(t.param,i);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let n=this.map.get(t.param)||[];const r=n.indexOf(e5(t.value));-1!==r&&n.splice(r,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class $Ie{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function c$(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function h$(e){return typeof Blob<"u"&&e instanceof Blob}function u$(e){return typeof FormData<"u"&&e instanceof FormData}class Z4{constructor(t,i,n,r){let o;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function QIe(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,o=r):o=n,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params)),this.headers||(this.headers=new Nh),this.context||(this.context=new $Ie),this.params){const s=this.params.toString();if(0===s.length)this.urlWithParams=i;else{const a=i.indexOf("?");this.urlWithParams=i+(-1===a?"?":a<i.length-1?"&":"")+s}}else this.params=new ju,this.urlWithParams=i}serializeBody(){return null===this.body?null:c$(this.body)||h$(this.body)||u$(this.body)||function ZIe(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ju?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||u$(this.body)?null:h$(this.body)?this.body.type||null:c$(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ju?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const i=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,o=void 0!==t.body?t.body:this.body,s=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,a=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let l=t.headers||this.headers,c=t.params||this.params;const h=t.context??this.context;return void 0!==t.setHeaders&&(l=Object.keys(t.setHeaders).reduce((u,d)=>u.set(d,t.setHeaders[d]),l)),t.setParams&&(c=Object.keys(t.setParams).reduce((u,d)=>u.set(d,t.setParams[d]),c)),new Z4(i,n,o,{params:c,headers:l,context:h,reportProgress:a,responseType:r,withCredentials:s})}}var kr=(()=>((kr=kr||{})[kr.Sent=0]="Sent",kr[kr.UploadProgress=1]="UploadProgress",kr[kr.ResponseHeader=2]="ResponseHeader",kr[kr.DownloadProgress=3]="DownloadProgress",kr[kr.Response=4]="Response",kr[kr.User=5]="User",kr))();class iT{constructor(t,i=200,n="OK"){this.headers=t.headers||new Nh,this.status=void 0!==t.status?t.status:i,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class nT extends iT{constructor(t={}){super(t),this.type=kr.ResponseHeader}clone(t={}){return new nT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class t5 extends iT{constructor(t={}){super(t),this.type=kr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new t5({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class d$ extends iT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function rT(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let oT=(()=>{class e{constructor(i){this.handler=i}request(i,n,r={}){let o;if(i instanceof Z4)o=i;else{let l,c;l=r.headers instanceof Nh?r.headers:new Nh(r.headers),r.params&&(c=r.params instanceof ju?r.params:new ju({fromObject:r.params})),o=new Z4(i,n,void 0!==r.body?r.body:null,{headers:l,context:r.context,params:c,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const s=tt(o).pipe(Wc(l=>this.handler.handle(l)));if(i instanceof Z4||"events"===r.observe)return s;const a=s.pipe(rn(l=>l instanceof t5));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return a.pipe(bt(l=>{if(null!==l.body&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return a.pipe(bt(l=>{if(null!==l.body&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return a.pipe(bt(l=>{if(null!==l.body&&"string"!=typeof l.body)throw new Error("Response is not a string.");return l.body}));default:return a.pipe(bt(l=>l.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(i,n={}){return this.request("DELETE",i,n)}get(i,n={}){return this.request("GET",i,n)}head(i,n={}){return this.request("HEAD",i,n)}jsonp(i,n){return this.request("JSONP",i,{params:(new ju).append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,n={}){return this.request("OPTIONS",i,n)}patch(i,n,r={}){return this.request("PATCH",i,rT(r,n))}post(i,n,r={}){return this.request("POST",i,rT(r,n))}put(i,n,r={}){return this.request("PUT",i,rT(r,n))}}return e.\u0275fac=function(i){return new(i||e)(he(Jy))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();function p$(e,t){return t(e)}function KIe(e,t){return(i,n)=>t.intercept(i,{handle:r=>e(r,n)})}const eOe=new Fe("HTTP_INTERCEPTORS"),K4=new Fe("HTTP_INTERCEPTOR_FNS");function tOe(){let e=null;return(t,i)=>(null===e&&(e=(si(eOe,{optional:!0})??[]).reduceRight(KIe,p$)),e(t,i))}let f$=(()=>{class e extends Jy{constructor(i,n){super(),this.backend=i,this.injector=n,this.chain=null}handle(i){if(null===this.chain){const n=Array.from(new Set(this.injector.get(K4)));this.chain=n.reduceRight((r,o)=>function JIe(e,t,i){return(n,r)=>i.runInContext(()=>t(n,o=>e(o,r)))}(r,o,this.injector),p$)}return this.chain(i,n=>this.backend.handle(n))}}return e.\u0275fac=function(i){return new(i||e)(he(Q4),he(Ol))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const oOe=/^\)\]\}',?\n/;let g$=(()=>{class e{constructor(i){this.xhrFactory=i}handle(i){if("JSONP"===i.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Li(n=>{const r=this.xhrFactory.build();if(r.open(i.method,i.urlWithParams),i.withCredentials&&(r.withCredentials=!0),i.headers.forEach((p,f)=>r.setRequestHeader(p,f.join(","))),i.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!i.headers.has("Content-Type")){const p=i.detectContentTypeHeader();null!==p&&r.setRequestHeader("Content-Type",p)}if(i.responseType){const p=i.responseType.toLowerCase();r.responseType="json"!==p?p:"text"}const o=i.serializeBody();let s=null;const a=()=>{if(null!==s)return s;const p=r.statusText||"OK",f=new Nh(r.getAllResponseHeaders()),m=function sOe(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(r)||i.url;return s=new nT({headers:f,status:r.status,statusText:p,url:m}),s},l=()=>{let{headers:p,status:f,statusText:m,url:g}=a(),v=null;204!==f&&(v=typeof r.response>"u"?r.responseText:r.response),0===f&&(f=v?200:0);let y=f>=200&&f<300;if("json"===i.responseType&&"string"==typeof v){const _=v;v=v.replace(oOe,"");try{v=""!==v?JSON.parse(v):null}catch(b){v=_,y&&(y=!1,v={error:b,text:v})}}y?(n.next(new t5({body:v,headers:p,status:f,statusText:m,url:g||void 0})),n.complete()):n.error(new d$({error:v,headers:p,status:f,statusText:m,url:g||void 0}))},c=p=>{const{url:f}=a(),m=new d$({error:p,status:r.status||0,statusText:r.statusText||"Unknown Error",url:f||void 0});n.error(m)};let h=!1;const u=p=>{h||(n.next(a()),h=!0);let f={type:kr.DownloadProgress,loaded:p.loaded};p.lengthComputable&&(f.total=p.total),"text"===i.responseType&&r.responseText&&(f.partialText=r.responseText),n.next(f)},d=p=>{let f={type:kr.UploadProgress,loaded:p.loaded};p.lengthComputable&&(f.total=p.total),n.next(f)};return r.addEventListener("load",l),r.addEventListener("error",c),r.addEventListener("timeout",c),r.addEventListener("abort",c),i.reportProgress&&(r.addEventListener("progress",u),null!==o&&r.upload&&r.upload.addEventListener("progress",d)),r.send(o),n.next({type:kr.Sent}),()=>{r.removeEventListener("error",c),r.removeEventListener("abort",c),r.removeEventListener("load",l),r.removeEventListener("timeout",c),i.reportProgress&&(r.removeEventListener("progress",u),null!==o&&r.upload&&r.upload.removeEventListener("progress",d)),r.readyState!==r.DONE&&r.abort()}})}}return e.\u0275fac=function(i){return new(i||e)(he(pN))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const sT=new Fe("XSRF_ENABLED"),v$=new Fe("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),y$=new Fe("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class _${}let cOe=(()=>{class e{constructor(i,n,r){this.doc=i,this.platform=n,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=nN(i,this.cookieName),this.lastCookieString=i),this.lastToken}}return e.\u0275fac=function(i){return new(i||e)(he(_i),he(Dg),he(v$))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();function hOe(e,t){const i=e.url.toLowerCase();if(!si(sT)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return t(e);const n=si(_$).getToken(),r=si(y$);return null!=n&&!e.headers.has(r)&&(e=e.clone({headers:e.headers.set(r,n)})),t(e)}var yr=(()=>((yr=yr||{})[yr.Interceptors=0]="Interceptors",yr[yr.LegacyInterceptors=1]="LegacyInterceptors",yr[yr.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",yr[yr.NoXsrfProtection=3]="NoXsrfProtection",yr[yr.JsonpSupport=4]="JsonpSupport",yr[yr.RequestsMadeViaParent=5]="RequestsMadeViaParent",yr))();function D0(e,t){return{\u0275kind:e,\u0275providers:t}}function uOe(...e){const t=[oT,g$,f$,{provide:Jy,useExisting:f$},{provide:Q4,useExisting:g$},{provide:K4,useValue:hOe,multi:!0},{provide:sT,useValue:!0},{provide:_$,useClass:cOe}];for(const i of e)t.push(...i.\u0275providers);return function eie(e){return{\u0275providers:e}}(t)}const b$=new Fe("LEGACY_INTERCEPTOR_FN");let pOe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:[uOe(D0(yr.LegacyInterceptors,[{provide:b$,useFactory:tOe},{provide:K4,useExisting:b$,multi:!0}]))]}),e})();class x${}class fOe{}const Lh="*";function Cl(e,t){return{type:7,name:e,definitions:t,options:{}}}function Bn(e,t=null){return{type:4,styles:t,timings:e}}function w$(e,t=null){return{type:2,steps:e,options:t}}function Jt(e){return{type:6,styles:e,offset:null}}function La(e,t,i){return{type:0,name:e,styles:t,options:i}}function Yn(e,t,i=null){return{type:1,expr:e,animation:t,options:i}}function C$(e,t,i=null){return{type:11,selector:e,animation:t,options:i}}function S$(e,t){return{type:12,timings:e,animation:t}}function M$(e){Promise.resolve().then(e)}class J4{constructor(t=0,i=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+i}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){M$(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const i="start"==t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}class z${constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let i=0,n=0,r=0;const o=this.players.length;0==o?M$(()=>this._onFinish()):this.players.forEach(s=>{s.onDone(()=>{++i==o&&this._onFinish()}),s.onDestroy(()=>{++n==o&&this._onDestroy()}),s.onStart(()=>{++r==o&&this._onStart()})}),this.totalTime=this.players.reduce((s,a)=>Math.max(s,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const i=t*this.totalTime;this.players.forEach(n=>{const r=n.totalTime?Math.min(1,i/n.totalTime):1;n.setPosition(r)})}getPosition(){const t=this.players.reduce((i,n)=>null===i||n.totalTime>i.totalTime?n:i,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const i="start"==t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}const aT="!";function T$(e){return new xe(3e3,!1)}function $Oe(){return typeof window<"u"&&typeof window.document<"u"}function lT(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Yu(e){switch(e.length){case 0:return new J4;case 1:return e[0];default:return new z$(e)}}function E$(e,t,i,n,r=new Map,o=new Map){const s=[],a=[];let l=-1,c=null;if(n.forEach(h=>{const u=h.get("offset"),d=u==l,p=d&&c||new Map;h.forEach((f,m)=>{let g=m,v=f;if("offset"!==m)switch(g=t.normalizePropertyName(g,s),v){case aT:v=r.get(m);break;case Lh:v=o.get(m);break;default:v=t.normalizeStyleValue(m,g,v,s)}p.set(g,v)}),d||a.push(p),c=p,l=u}),s.length)throw function ROe(e){return new xe(3502,!1)}();return a}function cT(e,t,i,n){switch(t){case"start":e.onStart(()=>n(i&&hT(i,"start",e)));break;case"done":e.onDone(()=>n(i&&hT(i,"done",e)));break;case"destroy":e.onDestroy(()=>n(i&&hT(i,"destroy",e)))}}function hT(e,t,i){const o=uT(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,i.totalTime??e.totalTime,!!i.disabled),s=e._data;return null!=s&&(o._data=s),o}function uT(e,t,i,n,r="",o=0,s){return{element:e,triggerName:t,fromState:i,toState:n,phaseName:r,totalTime:o,disabled:!!s}}function sa(e,t,i){let n=e.get(t);return n||e.set(t,n=i),n}function D$(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}let dT=(e,t)=>!1,A$=(e,t,i)=>[],P$=null;function pT(e){const t=e.parentNode||e.host;return t===P$?null:t}(lT()||typeof Element<"u")&&($Oe()?(P$=(()=>document.documentElement)(),dT=(e,t)=>{for(;t;){if(t===e)return!0;t=pT(t)}return!1}):dT=(e,t)=>e.contains(t),A$=(e,t,i)=>{if(i)return Array.from(e.querySelectorAll(t));const n=e.querySelector(t);return n?[n]:[]});let z1=null,I$=!1;const O$=dT,k$=A$;let N$=(()=>{class e{validateStyleProperty(i){return function ZOe(e){z1||(z1=function KOe(){return typeof document<"u"?document.body:null}()||{},I$=!!z1.style&&"WebkitAppearance"in z1.style);let t=!0;return z1.style&&!function QOe(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in z1.style,!t&&I$&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in z1.style)),t}(i)}matchesElement(i,n){return!1}containsElement(i,n){return O$(i,n)}getParentElement(i){return pT(i)}query(i,n,r){return k$(i,n,r)}computeStyle(i,n,r){return r||""}animate(i,n,r,o,s,a=[],l){return new J4(r,o)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),fT=(()=>{class e{}return e.NOOP=new N$,e})();const JOe=1e3,mT="ng-enter",n5="ng-leave",r5="ng-trigger",o5=".ng-trigger",R$="ng-animating",gT=".ng-animating";function Rh(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:vT(parseFloat(t[1]),t[2])}function vT(e,t){return"s"===t?e*JOe:e}function s5(e,t,i){return e.hasOwnProperty("duration")?e:function tke(e,t,i){let r,o=0,s="";if("string"==typeof e){const a=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return t.push(T$()),{duration:0,delay:0,easing:""};r=vT(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(o=vT(parseFloat(l),a[4]));const c=a[5];c&&(s=c)}else r=e;if(!i){let a=!1,l=t.length;r<0&&(t.push(function mOe(){return new xe(3100,!1)}()),a=!0),o<0&&(t.push(function gOe(){return new xe(3101,!1)}()),a=!0),a&&t.splice(l,0,T$())}return{duration:r,delay:o,easing:s}}(e,t,i)}function e3(e,t={}){return Object.keys(e).forEach(i=>{t[i]=e[i]}),t}function F$(e){const t=new Map;return Object.keys(e).forEach(i=>{t.set(i,e[i])}),t}function Gu(e,t=new Map,i){if(i)for(let[n,r]of i)t.set(n,r);for(let[n,r]of e)t.set(n,r);return t}function V$(e,t,i){return i?t+":"+i+";":""}function H$(e){let t="";for(let i=0;i<e.style.length;i++){const n=e.style.item(i);t+=V$(0,n,e.style.getPropertyValue(n))}for(const i in e.style)e.style.hasOwnProperty(i)&&!i.startsWith("_")&&(t+=V$(0,oke(i),e.style[i]));e.setAttribute("style",t)}function bc(e,t,i){e.style&&(t.forEach((n,r)=>{const o=_T(r);i&&!i.has(r)&&i.set(r,e.style[o]),e.style[o]=n}),lT()&&H$(e))}function T1(e,t){e.style&&(t.forEach((i,n)=>{const r=_T(n);e.style[r]=""}),lT()&&H$(e))}function t3(e){return Array.isArray(e)?1==e.length?e[0]:w$(e):e}const yT=new RegExp("{{\\s*(.+?)\\s*}}","g");function U$(e){let t=[];if("string"==typeof e){let i;for(;i=yT.exec(e);)t.push(i[1]);yT.lastIndex=0}return t}function n3(e,t,i){const n=e.toString(),r=n.replace(yT,(o,s)=>{let a=t[s];return null==a&&(i.push(function yOe(e){return new xe(3003,!1)}()),a=""),a.toString()});return r==n?e:r}function a5(e){const t=[];let i=e.next();for(;!i.done;)t.push(i.value),i=e.next();return t}const rke=/-+([a-z0-9])/g;function _T(e){return e.replace(rke,(...t)=>t[1].toUpperCase())}function oke(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function aa(e,t,i){switch(t.type){case 7:return e.visitTrigger(t,i);case 0:return e.visitState(t,i);case 1:return e.visitTransition(t,i);case 2:return e.visitSequence(t,i);case 3:return e.visitGroup(t,i);case 4:return e.visitAnimate(t,i);case 5:return e.visitKeyframes(t,i);case 6:return e.visitStyle(t,i);case 8:return e.visitReference(t,i);case 9:return e.visitAnimateChild(t,i);case 10:return e.visitAnimateRef(t,i);case 11:return e.visitQuery(t,i);case 12:return e.visitStagger(t,i);default:throw function _Oe(e){return new xe(3004,!1)}()}}function j$(e,t){return window.getComputedStyle(e)[t]}const h5="*";function uke(e,t){const i=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(n=>function dke(e,t,i){if(":"==e[0]){const l=function pke(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(i,n)=>parseFloat(n)>parseFloat(i);case":decrement":return(i,n)=>parseFloat(n)<parseFloat(i);default:return t.push(function OOe(e){return new xe(3016,!1)}()),"* => *"}}(e,i);if("function"==typeof l)return void t.push(l);e=l}const n=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==n||n.length<4)return i.push(function IOe(e){return new xe(3015,!1)}()),t;const r=n[1],o=n[2],s=n[3];t.push(Y$(r,s));"<"==o[0]&&!(r==h5&&s==h5)&&t.push(Y$(s,r))}(n,i,t)):i.push(e),i}const u5=new Set(["true","1"]),d5=new Set(["false","0"]);function Y$(e,t){const i=u5.has(e)||d5.has(e),n=u5.has(t)||d5.has(t);return(r,o)=>{let s=e==h5||e==r,a=t==h5||t==o;return!s&&i&&"boolean"==typeof r&&(s=r?u5.has(e):d5.has(e)),!a&&n&&"boolean"==typeof o&&(a=o?u5.has(t):d5.has(t)),s&&a}}const fke=new RegExp("s*:selfs*,?","g");function bT(e,t,i,n){return new mke(e).build(t,i,n)}class mke{constructor(t){this._driver=t}build(t,i,n){const r=new yke(i);return this._resetContextStyleTimingState(r),aa(this,t3(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,i){let n=i.queryCount=0,r=i.depCount=0;const o=[],s=[];return"@"==t.name.charAt(0)&&i.errors.push(function xOe(){return new xe(3006,!1)}()),t.definitions.forEach(a=>{if(this._resetContextStyleTimingState(i),0==a.type){const l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(h=>{l.name=h,o.push(this.visitState(l,i))}),l.name=c}else if(1==a.type){const l=this.visitTransition(a,i);n+=l.queryCount,r+=l.depCount,s.push(l)}else i.errors.push(function wOe(){return new xe(3007,!1)}())}),{type:7,name:t.name,states:o,transitions:s,queryCount:n,depCount:r,options:null}}visitState(t,i){const n=this.visitStyle(t.styles,i),r=t.options&&t.options.params||null;if(n.containsDynamicStyles){const o=new Set,s=r||{};n.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{U$(l).forEach(c=>{s.hasOwnProperty(c)||o.add(c)})})}),o.size&&(a5(o.values()),i.errors.push(function COe(e,t){return new xe(3008,!1)}()))}return{type:0,name:t.name,style:n,options:r?{params:r}:null}}visitTransition(t,i){i.queryCount=0,i.depCount=0;const n=aa(this,t3(t.animation),i);return{type:1,matchers:uke(t.expr,i.errors),animation:n,queryCount:i.queryCount,depCount:i.depCount,options:E1(t.options)}}visitSequence(t,i){return{type:2,steps:t.steps.map(n=>aa(this,n,i)),options:E1(t.options)}}visitGroup(t,i){const n=i.currentTime;let r=0;const o=t.steps.map(s=>{i.currentTime=n;const a=aa(this,s,i);return r=Math.max(r,i.currentTime),a});return i.currentTime=r,{type:3,steps:o,options:E1(t.options)}}visitAnimate(t,i){const n=function bke(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return xT(s5(e,t).duration,0,"");const i=e;if(i.split(/\s+/).some(o=>"{"==o.charAt(0)&&"{"==o.charAt(1))){const o=xT(0,0,"");return o.dynamic=!0,o.strValue=i,o}const r=s5(i,t);return xT(r.duration,r.delay,r.easing)}(t.timings,i.errors);i.currentAnimateTimings=n;let r,o=t.styles?t.styles:Jt({});if(5==o.type)r=this.visitKeyframes(o,i);else{let s=t.styles,a=!1;if(!s){a=!0;const c={};n.easing&&(c.easing=n.easing),s=Jt(c)}i.currentTime+=n.duration+n.delay;const l=this.visitStyle(s,i);l.isEmptyStep=a,r=l}return i.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(t,i){const n=this._makeStyleAst(t,i);return this._validateStyleAst(n,i),n}_makeStyleAst(t,i){const n=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let a of r)"string"==typeof a?a===Lh?n.push(a):i.errors.push(new xe(3002,!1)):n.push(F$(a));let o=!1,s=null;return n.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(s=a.get("easing"),a.delete("easing")),!o))for(let l of a.values())if(l.toString().indexOf("{{")>=0){o=!0;break}}),{type:6,styles:n,easing:s,offset:t.offset,containsDynamicStyles:o,options:null}}_validateStyleAst(t,i){const n=i.currentAnimateTimings;let r=i.currentTime,o=i.currentTime;n&&o>0&&(o-=n.duration+n.delay),t.styles.forEach(s=>{"string"!=typeof s&&s.forEach((a,l)=>{const c=i.collectedStyles.get(i.currentQuerySelector),h=c.get(l);let u=!0;h&&(o!=r&&o>=h.startTime&&r<=h.endTime&&(i.errors.push(function MOe(e,t,i,n,r){return new xe(3010,!1)}()),u=!1),o=h.startTime),u&&c.set(l,{startTime:o,endTime:r}),i.options&&function nke(e,t,i){const n=t.params||{},r=U$(e);r.length&&r.forEach(o=>{n.hasOwnProperty(o)||i.push(function vOe(e){return new xe(3001,!1)}())})}(a,i.options,i.errors)})})}visitKeyframes(t,i){const n={type:5,styles:[],options:null};if(!i.currentAnimateTimings)return i.errors.push(function zOe(){return new xe(3011,!1)}()),n;let o=0;const s=[];let a=!1,l=!1,c=0;const h=t.steps.map(v=>{const y=this._makeStyleAst(v,i);let _=null!=y.offset?y.offset:function _ke(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(i=>{if(i instanceof Map&&i.has("offset")){const n=i;t=parseFloat(n.get("offset")),n.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}return t}(y.styles),b=0;return null!=_&&(o++,b=y.offset=_),l=l||b<0||b>1,a=a||b<c,c=b,s.push(b),y});l&&i.errors.push(function TOe(){return new xe(3012,!1)}()),a&&i.errors.push(function EOe(){return new xe(3200,!1)}());const u=t.steps.length;let d=0;o>0&&o<u?i.errors.push(function DOe(){return new xe(3202,!1)}()):0==o&&(d=1/(u-1));const p=u-1,f=i.currentTime,m=i.currentAnimateTimings,g=m.duration;return h.forEach((v,y)=>{const _=d>0?y==p?1:d*y:s[y],b=_*g;i.currentTime=f+m.delay+b,m.duration=b,this._validateStyleAst(v,i),v.offset=_,n.styles.push(v)}),n}visitReference(t,i){return{type:8,animation:aa(this,t3(t.animation),i),options:E1(t.options)}}visitAnimateChild(t,i){return i.depCount++,{type:9,options:E1(t.options)}}visitAnimateRef(t,i){return{type:10,animation:this.visitReference(t.animation,i),options:E1(t.options)}}visitQuery(t,i){const n=i.currentQuerySelector,r=t.options||{};i.queryCount++,i.currentQuery=t;const[o,s]=function gke(e){const t=!!e.split(/\s*,\s*/).find(i=>":self"==i);return t&&(e=e.replace(fke,"")),e=e.replace(/@\*/g,o5).replace(/@\w+/g,i=>o5+"-"+i.slice(1)).replace(/:animating/g,gT),[e,t]}(t.selector);i.currentQuerySelector=n.length?n+" "+o:o,sa(i.collectedStyles,i.currentQuerySelector,new Map);const a=aa(this,t3(t.animation),i);return i.currentQuery=null,i.currentQuerySelector=n,{type:11,selector:o,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:a,originalSelector:t.selector,options:E1(t.options)}}visitStagger(t,i){i.currentQuery||i.errors.push(function AOe(){return new xe(3013,!1)}());const n="full"===t.timings?{duration:0,delay:0,easing:"full"}:s5(t.timings,i.errors,!0);return{type:12,animation:aa(this,t3(t.animation),i),timings:n,options:null}}}class yke{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function E1(e){return e?(e=e3(e)).params&&(e.params=function vke(e){return e?e3(e):null}(e.params)):e={},e}function xT(e,t,i){return{duration:e,delay:t,easing:i}}function wT(e,t,i,n,r,o,s=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:i,postStyleProps:n,duration:r,delay:o,totalTime:r+o,easing:s,subTimeline:a}}class p5{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,i){let n=this._map.get(t);n||this._map.set(t,n=[]),n.push(...i)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Cke=new RegExp(":enter","g"),Mke=new RegExp(":leave","g");function CT(e,t,i,n,r,o=new Map,s=new Map,a,l,c=[]){return(new zke).buildKeyframes(e,t,i,n,r,o,s,a,l,c)}class zke{buildKeyframes(t,i,n,r,o,s,a,l,c,h=[]){c=c||new p5;const u=new ST(t,i,c,r,o,h,[]);u.options=l;const d=l.delay?Rh(l.delay):0;u.currentTimeline.delayNextStep(d),u.currentTimeline.setStyles([s],null,u.errors,l),aa(this,n,u);const p=u.timelines.filter(f=>f.containsAnimation());if(p.length&&a.size){let f;for(let m=p.length-1;m>=0;m--){const g=p[m];if(g.element===i){f=g;break}}f&&!f.allowOnlyTimelineStyles()&&f.setStyles([a],null,u.errors,l)}return p.length?p.map(f=>f.buildKeyframes()):[wT(i,[],[],[],0,d,"",!1)]}visitTrigger(t,i){}visitState(t,i){}visitTransition(t,i){}visitAnimateChild(t,i){const n=i.subInstructions.get(i.element);if(n){const r=i.createSubContext(t.options),o=i.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);o!=s&&i.transformIntoNewTimeline(s)}i.previousNode=t}visitAnimateRef(t,i){const n=i.createSubContext(t.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],i,n),this.visitReference(t.animation,n),i.transformIntoNewTimeline(n.currentTimeline.currentTime),i.previousNode=t}_applyAnimationRefDelays(t,i,n){for(const r of t){const o=r?.delay;if(o){const s="number"==typeof o?o:Rh(n3(o,r?.params??{},i.errors));n.delayNextStep(s)}}}_visitSubInstructions(t,i,n){let o=i.currentTimeline.currentTime;const s=null!=n.duration?Rh(n.duration):null,a=null!=n.delay?Rh(n.delay):null;return 0!==s&&t.forEach(l=>{const c=i.appendInstructionToTimeline(l,s,a);o=Math.max(o,c.duration+c.delay)}),o}visitReference(t,i){i.updateOptions(t.options,!0),aa(this,t.animation,i),i.previousNode=t}visitSequence(t,i){const n=i.subContextCount;let r=i;const o=t.options;if(o&&(o.params||o.delay)&&(r=i.createSubContext(o),r.transformIntoNewTimeline(),null!=o.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=f5);const s=Rh(o.delay);r.delayNextStep(s)}t.steps.length&&(t.steps.forEach(s=>aa(this,s,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),i.previousNode=t}visitGroup(t,i){const n=[];let r=i.currentTimeline.currentTime;const o=t.options&&t.options.delay?Rh(t.options.delay):0;t.steps.forEach(s=>{const a=i.createSubContext(t.options);o&&a.delayNextStep(o),aa(this,s,a),r=Math.max(r,a.currentTimeline.currentTime),n.push(a.currentTimeline)}),n.forEach(s=>i.currentTimeline.mergeTimelineCollectedStyles(s)),i.transformIntoNewTimeline(r),i.previousNode=t}_visitTiming(t,i){if(t.dynamic){const n=t.strValue;return s5(i.params?n3(n,i.params,i.errors):n,i.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,i){const n=i.currentAnimateTimings=this._visitTiming(t.timings,i),r=i.currentTimeline;n.delay&&(i.incrementTime(n.delay),r.snapshotCurrentStyles());const o=t.style;5==o.type?this.visitKeyframes(o,i):(i.incrementTime(n.duration),this.visitStyle(o,i),r.applyStylesToKeyframe()),i.currentAnimateTimings=null,i.previousNode=t}visitStyle(t,i){const n=i.currentTimeline,r=i.currentAnimateTimings;!r&&n.hasCurrentStyleProperties()&&n.forwardFrame();const o=r&&r.easing||t.easing;t.isEmptyStep?n.applyEmptyStep(o):n.setStyles(t.styles,o,i.errors,i.options),i.previousNode=t}visitKeyframes(t,i){const n=i.currentAnimateTimings,r=i.currentTimeline.duration,o=n.duration,a=i.createSubContext().currentTimeline;a.easing=n.easing,t.styles.forEach(l=>{a.forwardTime((l.offset||0)*o),a.setStyles(l.styles,l.easing,i.errors,i.options),a.applyStylesToKeyframe()}),i.currentTimeline.mergeTimelineCollectedStyles(a),i.transformIntoNewTimeline(r+o),i.previousNode=t}visitQuery(t,i){const n=i.currentTimeline.currentTime,r=t.options||{},o=r.delay?Rh(r.delay):0;o&&(6===i.previousNode.type||0==n&&i.currentTimeline.hasCurrentStyleProperties())&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=f5);let s=n;const a=i.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,i.errors);i.currentQueryTotal=a.length;let l=null;a.forEach((c,h)=>{i.currentQueryIndex=h;const u=i.createSubContext(t.options,c);o&&u.delayNextStep(o),c===i.element&&(l=u.currentTimeline),aa(this,t.animation,u),u.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,u.currentTimeline.currentTime)}),i.currentQueryIndex=0,i.currentQueryTotal=0,i.transformIntoNewTimeline(s),l&&(i.currentTimeline.mergeTimelineCollectedStyles(l),i.currentTimeline.snapshotCurrentStyles()),i.previousNode=t}visitStagger(t,i){const n=i.parentContext,r=i.currentTimeline,o=t.timings,s=Math.abs(o.duration),a=s*(i.currentQueryTotal-1);let l=s*i.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":l=a-l;break;case"full":l=n.currentStaggerTime}const h=i.currentTimeline;l&&h.delayNextStep(l);const u=h.currentTime;aa(this,t.animation,i),i.previousNode=t,n.currentStaggerTime=r.currentTime-u+(r.startTime-n.currentTimeline.startTime)}}const f5={};class ST{constructor(t,i,n,r,o,s,a,l){this._driver=t,this.element=i,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=o,this.errors=s,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=f5,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new m5(this._driver,i,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,i){if(!t)return;const n=t;let r=this.options;null!=n.duration&&(r.duration=Rh(n.duration)),null!=n.delay&&(r.delay=Rh(n.delay));const o=n.params;if(o){let s=r.params;s||(s=this.options.params={}),Object.keys(o).forEach(a=>{(!i||!s.hasOwnProperty(a))&&(s[a]=n3(o[a],s,this.errors))})}}_copyOptions(){const t={};if(this.options){const i=this.options.params;if(i){const n=t.params={};Object.keys(i).forEach(r=>{n[r]=i[r]})}}return t}createSubContext(t=null,i,n){const r=i||this.element,o=new ST(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(t),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(t){return this.previousNode=f5,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,i,n){const r={duration:i??t.duration,delay:this.currentTimeline.currentTime+(n??0)+t.delay,easing:""},o=new Tke(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(o),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,i,n,r,o,s){let a=[];if(r&&a.push(this.element),t.length>0){t=(t=t.replace(Cke,"."+this._enterClassName)).replace(Mke,"."+this._leaveClassName);let c=this._driver.query(this.element,t,1!=n);0!==n&&(c=n<0?c.slice(c.length+n,c.length):c.slice(0,n)),a.push(...c)}return!o&&0==a.length&&s.push(function POe(e){return new xe(3014,!1)}()),a}}class m5{constructor(t,i,n,r){this._driver=t,this.element=i,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(i),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(i,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const i=1===this._keyframes.size&&this._pendingStyles.size;this.duration||i?(this.forwardTime(this.currentTime+t),i&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,i){return this.applyStylesToKeyframe(),new m5(this._driver,t,i||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,i){this._localTimelineStyles.set(t,i),this._globalTimelineStyles.set(t,i),this._styleSummary.set(t,{time:this.currentTime,value:i})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[i,n]of this._globalTimelineStyles)this._backFill.set(i,n||Lh),this._currentKeyframe.set(i,Lh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,i,n,r){i&&this._previousKeyframe.set("easing",i);const o=r&&r.params||{},s=function Eke(e,t){const i=new Map;let n;return e.forEach(r=>{if("*"===r){n=n||t.keys();for(let o of n)i.set(o,Lh)}else Gu(r,i)}),i}(t,this._globalTimelineStyles);for(let[a,l]of s){const c=n3(l,o,n);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Lh),this._updateStyle(a,c)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,i)=>{this._currentKeyframe.set(i,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,i)=>{this._currentKeyframe.has(i)||this._currentKeyframe.set(i,t)}))}snapshotCurrentStyles(){for(let[t,i]of this._localTimelineStyles)this._pendingStyles.set(t,i),this._updateStyle(t,i)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let i in this._currentKeyframe)t.push(i);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((i,n)=>{const r=this._styleSummary.get(n);(!r||i.time>r.time)&&this._updateStyle(n,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,i=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,l)=>{const c=Gu(a,new Map,this._backFill);c.forEach((h,u)=>{h===aT?t.add(u):h===Lh&&i.add(u)}),n||c.set("offset",l/this.duration),r.push(c)});const o=t.size?a5(t.values()):[],s=i.size?a5(i.values()):[];if(n){const a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return wT(this.element,r,o,s,this.duration,this.startTime,this.easing,!1)}}class Tke extends m5{constructor(t,i,n,r,o,s,a=!1){super(t,i,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=o,this._stretchStartingKeyframe=a,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:i,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&i){const o=[],s=n+i,a=i/s,l=Gu(t[0]);l.set("offset",0),o.push(l);const c=Gu(t[0]);c.set("offset",q$(a)),o.push(c);const h=t.length-1;for(let u=1;u<=h;u++){let d=Gu(t[u]);const p=d.get("offset");d.set("offset",q$((i+p*n)/s)),o.push(d)}n=s,i=0,r="",t=o}return wT(this.element,t,this.preStyleProps,this.postStyleProps,n,i,r,!0)}}function q$(e,t=3){const i=Math.pow(10,t-1);return Math.round(e*i)/i}class MT{}const Dke=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Ake extends MT{normalizePropertyName(t,i){return _T(t)}normalizeStyleValue(t,i,n,r){let o="";const s=n.toString().trim();if(Dke.has(i)&&0!==n&&"0"!==n)if("number"==typeof n)o="px";else{const a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function bOe(e,t){return new xe(3005,!1)}())}return s+o}}function X$(e,t,i,n,r,o,s,a,l,c,h,u,d){return{type:0,element:e,triggerName:t,isRemovalTransition:r,fromState:i,fromStyles:o,toState:n,toStyles:s,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:h,totalTime:u,errors:d}}const zT={};class $${constructor(t,i,n){this._triggerName=t,this.ast=i,this._stateStyles=n}match(t,i,n,r){return function Pke(e,t,i,n,r){return e.some(o=>o(t,i,n,r))}(this.ast.matchers,t,i,n,r)}buildStyles(t,i,n){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(i,n):new Map}build(t,i,n,r,o,s,a,l,c,h){const u=[],d=this.ast.options&&this.ast.options.params||zT,f=this.buildStyles(n,a&&a.params||zT,u),m=l&&l.params||zT,g=this.buildStyles(r,m,u),v=new Set,y=new Map,_=new Map,b="void"===r,x={params:Ike(m,d),delay:this.ast.options?.delay},w=h?[]:CT(t,i,this.ast.animation,o,s,f,g,x,c,u);let S=0;if(w.forEach(M=>{S=Math.max(M.duration+M.delay,S)}),u.length)return X$(i,this._triggerName,n,r,b,f,g,[],[],y,_,S,u);w.forEach(M=>{const z=M.element,E=sa(y,z,new Set);M.preStyleProps.forEach(P=>E.add(P));const D=sa(_,z,new Set);M.postStyleProps.forEach(P=>D.add(P)),z!==i&&v.add(z)});const C=a5(v.values());return X$(i,this._triggerName,n,r,b,f,g,w,C,y,_,S)}}function Ike(e,t){const i=e3(t);for(const n in e)e.hasOwnProperty(n)&&null!=e[n]&&(i[n]=e[n]);return i}class Oke{constructor(t,i,n){this.styles=t,this.defaultParams=i,this.normalizer=n}buildStyles(t,i){const n=new Map,r=e3(this.defaultParams);return Object.keys(t).forEach(o=>{const s=t[o];null!==s&&(r[o]=s)}),this.styles.styles.forEach(o=>{"string"!=typeof o&&o.forEach((s,a)=>{s&&(s=n3(s,r,i));const l=this.normalizer.normalizePropertyName(a,i);s=this.normalizer.normalizeStyleValue(a,l,s,i),n.set(a,s)})}),n}}class Nke{constructor(t,i,n){this.name=t,this.ast=i,this._normalizer=n,this.transitionFactories=[],this.states=new Map,i.states.forEach(r=>{this.states.set(r.name,new Oke(r.style,r.options&&r.options.params||{},n))}),Q$(this.states,"true","1"),Q$(this.states,"false","0"),i.transitions.forEach(r=>{this.transitionFactories.push(new $$(t,r,this.states))}),this.fallbackTransition=function Lke(e,t,i){return new $$(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(s,a)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,i,n,r){return this.transitionFactories.find(s=>s.match(t,i,n,r))||null}matchStyles(t,i,n){return this.fallbackTransition.buildStyles(t,i,n)}}function Q$(e,t,i){e.has(t)?e.has(i)||e.set(i,e.get(t)):e.has(i)&&e.set(t,e.get(i))}const Rke=new p5;class Fke{constructor(t,i,n){this.bodyNode=t,this._driver=i,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,i){const n=[],r=[],o=bT(this._driver,i,n,r);if(n.length)throw function FOe(e){return new xe(3503,!1)}();this._animations.set(t,o)}_buildPlayer(t,i,n){const r=t.element,o=E$(0,this._normalizer,0,t.keyframes,i,n);return this._driver.animate(r,o,t.duration,t.delay,t.easing,[],!0)}create(t,i,n={}){const r=[],o=this._animations.get(t);let s;const a=new Map;if(o?(s=CT(this._driver,i,o,mT,n5,new Map,new Map,n,Rke,r),s.forEach(h=>{const u=sa(a,h.element,new Map);h.postStyleProps.forEach(d=>u.set(d,null))})):(r.push(function BOe(){return new xe(3300,!1)}()),s=[]),r.length)throw function VOe(e){return new xe(3504,!1)}();a.forEach((h,u)=>{h.forEach((d,p)=>{h.set(p,this._driver.computeStyle(u,p,Lh))})});const c=Yu(s.map(h=>{const u=a.get(h.element);return this._buildPlayer(h,new Map,u)}));return this._playersById.set(t,c),c.onDestroy(()=>this.destroy(t)),this.players.push(c),c}destroy(t){const i=this._getPlayer(t);i.destroy(),this._playersById.delete(t);const n=this.players.indexOf(i);n>=0&&this.players.splice(n,1)}_getPlayer(t){const i=this._playersById.get(t);if(!i)throw function HOe(e){return new xe(3301,!1)}();return i}listen(t,i,n,r){const o=uT(i,"","","");return cT(this._getPlayer(t),n,o,r),()=>{}}command(t,i,n,r){if("register"==n)return void this.register(t,r[0]);if("create"==n)return void this.create(t,i,r[0]||{});const o=this._getPlayer(t);switch(n){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const Z$="ng-animate-queued",TT="ng-animate-disabled",jke=[],K$={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Yke={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ra="__ng_removed";class ET{get params(){return this.options.params}constructor(t,i=""){this.namespaceId=i;const n=t&&t.hasOwnProperty("value");if(this.value=function Xke(e){return e??null}(n?t.value:t),n){const o=e3(t);delete o.value,this.options=o}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const i=t.params;if(i){const n=this.options.params;Object.keys(i).forEach(r=>{null==n[r]&&(n[r]=i[r])})}}}const r3="void",DT=new ET(r3);class Gke{constructor(t,i,n){this.id=t,this.hostElement=i,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Fa(i,this._hostClassName)}listen(t,i,n,r){if(!this._triggers.has(i))throw function UOe(e,t){return new xe(3302,!1)}();if(null==n||0==n.length)throw function jOe(e){return new xe(3303,!1)}();if(!function $ke(e){return"start"==e||"done"==e}(n))throw function YOe(e,t){return new xe(3400,!1)}();const o=sa(this._elementListeners,t,[]),s={name:i,phase:n,callback:r};o.push(s);const a=sa(this._engine.statesByElement,t,new Map);return a.has(i)||(Fa(t,r5),Fa(t,r5+"-"+i),a.set(i,DT)),()=>{this._engine.afterFlush(()=>{const l=o.indexOf(s);l>=0&&o.splice(l,1),this._triggers.has(i)||a.delete(i)})}}register(t,i){return!this._triggers.has(t)&&(this._triggers.set(t,i),!0)}_getTrigger(t){const i=this._triggers.get(t);if(!i)throw function GOe(e){return new xe(3401,!1)}();return i}trigger(t,i,n,r=!0){const o=this._getTrigger(i),s=new AT(this.id,i,t);let a=this._engine.statesByElement.get(t);a||(Fa(t,r5),Fa(t,r5+"-"+i),this._engine.statesByElement.set(t,a=new Map));let l=a.get(i);const c=new ET(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(i,c),l||(l=DT),c.value!==r3&&l.value===c.value){if(!function Kke(e,t){const i=Object.keys(e),n=Object.keys(t);if(i.length!=n.length)return!1;for(let r=0;r<i.length;r++){const o=i[r];if(!t.hasOwnProperty(o)||e[o]!==t[o])return!1}return!0}(l.params,c.params)){const m=[],g=o.matchStyles(l.value,l.params,m),v=o.matchStyles(c.value,c.params,m);m.length?this._engine.reportError(m):this._engine.afterFlush(()=>{T1(t,g),bc(t,v)})}return}const d=sa(this._engine.playersByElement,t,[]);d.forEach(m=>{m.namespaceId==this.id&&m.triggerName==i&&m.queued&&m.destroy()});let p=o.matchTransition(l.value,c.value,t,c.params),f=!1;if(!p){if(!r)return;p=o.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:i,transition:p,fromState:l,toState:c,player:s,isFallbackTransition:f}),f||(Fa(t,Z$),s.onStart(()=>{A0(t,Z$)})),s.onDone(()=>{let m=this.players.indexOf(s);m>=0&&this.players.splice(m,1);const g=this._engine.playersByElement.get(t);if(g){let v=g.indexOf(s);v>=0&&g.splice(v,1)}}),this.players.push(s),d.push(s),s}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(i=>i.delete(t)),this._elementListeners.forEach((i,n)=>{this._elementListeners.set(n,i.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const i=this._engine.playersByElement.get(t);i&&(i.forEach(n=>n.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,i){const n=this._engine.driver.query(t,o5,!0);n.forEach(r=>{if(r[Ra])return;const o=this._engine.fetchNamespacesByElement(r);o.size?o.forEach(s=>s.triggerLeaveAnimation(r,i,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,i,n,r){const o=this._engine.statesByElement.get(t),s=new Map;if(o){const a=[];if(o.forEach((l,c)=>{if(s.set(c,l.value),this._triggers.has(c)){const h=this.trigger(t,c,r3,r);h&&a.push(h)}}),a.length)return this._engine.markElementAsRemoved(this.id,t,!0,i,s),n&&Yu(a).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const i=this._elementListeners.get(t),n=this._engine.statesByElement.get(t);if(i&&n){const r=new Set;i.forEach(o=>{const s=o.name;if(r.has(s))return;r.add(s);const l=this._triggers.get(s).fallbackTransition,c=n.get(s)||DT,h=new ET(r3),u=new AT(this.id,s,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:s,transition:l,fromState:c,toState:h,player:u,isFallbackTransition:!0})})}}removeNode(t,i){const n=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,i),this.triggerLeaveAnimation(t,i,!0))return;let r=!1;if(n.totalAnimations){const o=n.players.length?n.playersByQueriedElement.get(t):[];if(o&&o.length)r=!0;else{let s=t;for(;s=s.parentNode;)if(n.statesByElement.get(s)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)n.markElementAsRemoved(this.id,t,!1,i);else{const o=t[Ra];(!o||o===K$)&&(n.afterFlush(()=>this.clearElementCache(t)),n.destroyInnerAnimations(t),n._onRemovalComplete(t,i))}}insertNode(t,i){Fa(t,this._hostClassName)}drainQueuedTransitions(t){const i=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const o=n.element,s=this._elementListeners.get(o);s&&s.forEach(a=>{if(a.name==n.triggerName){const l=uT(o,n.triggerName,n.fromState.value,n.toState.value);l._data=t,cT(n.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):i.push(n)}),this._queue=[],i.sort((n,r)=>{const o=n.transition.ast.depCount,s=r.transition.ast.depCount;return 0==o||0==s?o-s:this._engine.driver.containsElement(n.element,r.element)?1:-1})}destroy(t){this.players.forEach(i=>i.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let i=!1;return this._elementListeners.has(t)&&(i=!0),i=!!this._queue.find(n=>n.element===t)||i,i}}class Wke{_onRemovalComplete(t,i){this.onRemovalComplete(t,i)}constructor(t,i,n){this.bodyNode=t,this.driver=i,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,o)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(i=>{i.players.forEach(n=>{n.queued&&t.push(n)})}),t}createNamespace(t,i){const n=new Gke(t,i,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,i)?this._balanceNamespaceList(n,i):(this.newHostElements.set(i,n),this.collectEnterElement(i)),this._namespaceLookup[t]=n}_balanceNamespaceList(t,i){const n=this._namespaceList,r=this.namespacesByHostElement;if(n.length-1>=0){let s=!1,a=this.driver.getParentElement(i);for(;a;){const l=r.get(a);if(l){const c=n.indexOf(l);n.splice(c+1,0,t),s=!0;break}a=this.driver.getParentElement(a)}s||n.unshift(t)}else n.push(t);return r.set(i,t),t}register(t,i){let n=this._namespaceLookup[t];return n||(n=this.createNamespace(t,i)),n}registerTrigger(t,i,n){let r=this._namespaceLookup[t];r&&r.register(i,n)&&this.totalAnimations++}destroy(t,i){if(!t)return;const n=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(n);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>n.destroy(i))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const i=new Set,n=this.statesByElement.get(t);if(n)for(let r of n.values())if(r.namespaceId){const o=this._fetchNamespace(r.namespaceId);o&&i.add(o)}return i}trigger(t,i,n,r){if(g5(i)){const o=this._fetchNamespace(t);if(o)return o.trigger(i,n,r),!0}return!1}insertNode(t,i,n,r){if(!g5(i))return;const o=i[Ra];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;const s=this.collectedLeaveElements.indexOf(i);s>=0&&this.collectedLeaveElements.splice(s,1)}if(t){const s=this._fetchNamespace(t);s&&s.insertNode(i,n)}r&&this.collectEnterElement(i)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,i){i?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Fa(t,TT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),A0(t,TT))}removeNode(t,i,n,r){if(g5(i)){const o=t?this._fetchNamespace(t):null;if(o?o.removeNode(i,r):this.markElementAsRemoved(t,i,!1,r),n){const s=this.namespacesByHostElement.get(i);s&&s.id!==t&&s.removeNode(i,r)}}else this._onRemovalComplete(i,r)}markElementAsRemoved(t,i,n,r,o){this.collectedLeaveElements.push(i),i[Ra]={namespaceId:t,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:o}}listen(t,i,n,r,o){return g5(i)?this._fetchNamespace(t).listen(i,n,r,o):()=>{}}_buildInstruction(t,i,n,r,o){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,n,r,t.fromState.options,t.toState.options,i,o)}destroyInnerAnimations(t){let i=this.driver.query(t,o5,!0);i.forEach(n=>this.destroyActiveAnimationsForElement(n)),0!=this.playersByQueriedElement.size&&(i=this.driver.query(t,gT,!0),i.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(t){const i=this.playersByElement.get(t);i&&i.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(t){const i=this.playersByQueriedElement.get(t);i&&i.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Yu(this.players).onDone(()=>t());t()})}processLeaveNode(t){const i=t[Ra];if(i&&i.setForRemoval){if(t[Ra]=K$,i.namespaceId){this.destroyInnerAnimations(t);const n=this._fetchNamespace(i.namespaceId);n&&n.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}t.classList?.contains(TT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(t=-1){let i=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,r)=>this._balanceNamespaceList(n,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)Fa(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{i=this._flushAnimations(n,t)}finally{for(let r=0;r<n.length;r++)n[r]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){const n=this._whenQuietFns;this._whenQuietFns=[],i.length?Yu(i).onDone(()=>{n.forEach(r=>r())}):n.forEach(r=>r())}}reportError(t){throw function WOe(e){return new xe(3402,!1)}()}_flushAnimations(t,i){const n=new p5,r=[],o=new Map,s=[],a=new Map,l=new Map,c=new Map,h=new Set;this.disabledNodes.forEach(V=>{h.add(V);const R=this.driver.query(V,".ng-animate-queued",!0);for(let N=0;N<R.length;N++)h.add(R[N])});const u=this.bodyNode,d=Array.from(this.statesByElement.keys()),p=tQ(d,this.collectedEnterElements),f=new Map;let m=0;p.forEach((V,R)=>{const N=mT+m++;f.set(R,N),V.forEach(W=>Fa(W,N))});const g=[],v=new Set,y=new Set;for(let V=0;V<this.collectedLeaveElements.length;V++){const R=this.collectedLeaveElements[V],N=R[Ra];N&&N.setForRemoval&&(g.push(R),v.add(R),N.hasAnimation?this.driver.query(R,".ng-star-inserted",!0).forEach(W=>v.add(W)):y.add(R))}const _=new Map,b=tQ(d,Array.from(v));b.forEach((V,R)=>{const N=n5+m++;_.set(R,N),V.forEach(W=>Fa(W,N))}),t.push(()=>{p.forEach((V,R)=>{const N=f.get(R);V.forEach(W=>A0(W,N))}),b.forEach((V,R)=>{const N=_.get(R);V.forEach(W=>A0(W,N))}),g.forEach(V=>{this.processLeaveNode(V)})});const x=[],w=[];for(let V=this._namespaceList.length-1;V>=0;V--)this._namespaceList[V].drainQueuedTransitions(i).forEach(N=>{const W=N.player,Q=N.element;if(x.push(W),this.collectedEnterElements.length){const ce=Q[Ra];if(ce&&ce.setForMove){if(ce.previousTriggersValues&&ce.previousTriggersValues.has(N.triggerName)){const te=ce.previousTriggersValues.get(N.triggerName),pe=this.statesByElement.get(N.element);if(pe&&pe.has(N.triggerName)){const se=pe.get(N.triggerName);se.value=te,pe.set(N.triggerName,se)}}return void W.destroy()}}const G=!u||!this.driver.containsElement(u,Q),Y=_.get(Q),J=f.get(Q),q=this._buildInstruction(N,n,J,Y,G);if(q.errors&&q.errors.length)return void w.push(q);if(G)return W.onStart(()=>T1(Q,q.fromStyles)),W.onDestroy(()=>bc(Q,q.toStyles)),void r.push(W);if(N.isFallbackTransition)return W.onStart(()=>T1(Q,q.fromStyles)),W.onDestroy(()=>bc(Q,q.toStyles)),void r.push(W);const ee=[];q.timelines.forEach(ce=>{ce.stretchStartingKeyframe=!0,this.disabledNodes.has(ce.element)||ee.push(ce)}),q.timelines=ee,n.append(Q,q.timelines),s.push({instruction:q,player:W,element:Q}),q.queriedElements.forEach(ce=>sa(a,ce,[]).push(W)),q.preStyleProps.forEach((ce,te)=>{if(ce.size){let pe=l.get(te);pe||l.set(te,pe=new Set),ce.forEach((se,ze)=>pe.add(ze))}}),q.postStyleProps.forEach((ce,te)=>{let pe=c.get(te);pe||c.set(te,pe=new Set),ce.forEach((se,ze)=>pe.add(ze))})});if(w.length){const V=[];w.forEach(R=>{V.push(function qOe(e,t){return new xe(3505,!1)}())}),x.forEach(R=>R.destroy()),this.reportError(V)}const S=new Map,C=new Map;s.forEach(V=>{const R=V.element;n.has(R)&&(C.set(R,R),this._beforeAnimationBuild(V.player.namespaceId,V.instruction,S))}),r.forEach(V=>{const R=V.element;this._getPreviousPlayers(R,!1,V.namespaceId,V.triggerName,null).forEach(W=>{sa(S,R,[]).push(W),W.destroy()})});const M=g.filter(V=>nQ(V,l,c)),z=new Map;eQ(z,this.driver,y,c,Lh).forEach(V=>{nQ(V,l,c)&&M.push(V)});const D=new Map;p.forEach((V,R)=>{eQ(D,this.driver,new Set(V),l,aT)}),M.forEach(V=>{const R=z.get(V),N=D.get(V);z.set(V,new Map([...Array.from(R?.entries()??[]),...Array.from(N?.entries()??[])]))});const P=[],I=[],B={};s.forEach(V=>{const{element:R,player:N,instruction:W}=V;if(n.has(R)){if(h.has(R))return N.onDestroy(()=>bc(R,W.toStyles)),N.disabled=!0,N.overrideTotalTime(W.totalTime),void r.push(N);let Q=B;if(C.size>1){let Y=R;const J=[];for(;Y=Y.parentNode;){const q=C.get(Y);if(q){Q=q;break}J.push(Y)}J.forEach(q=>C.set(q,Q))}const G=this._buildAnimation(N.namespaceId,W,S,o,D,z);if(N.setRealPlayer(G),Q===B)P.push(N);else{const Y=this.playersByElement.get(Q);Y&&Y.length&&(N.parentPlayer=Yu(Y)),r.push(N)}}else T1(R,W.fromStyles),N.onDestroy(()=>bc(R,W.toStyles)),I.push(N),h.has(R)&&r.push(N)}),I.forEach(V=>{const R=o.get(V.element);if(R&&R.length){const N=Yu(R);V.setRealPlayer(N)}}),r.forEach(V=>{V.parentPlayer?V.syncPlayerEvents(V.parentPlayer):V.destroy()});for(let V=0;V<g.length;V++){const R=g[V],N=R[Ra];if(A0(R,n5),N&&N.hasAnimation)continue;let W=[];if(a.size){let G=a.get(R);G&&G.length&&W.push(...G);let Y=this.driver.query(R,gT,!0);for(let J=0;J<Y.length;J++){let q=a.get(Y[J]);q&&q.length&&W.push(...q)}}const Q=W.filter(G=>!G.destroyed);Q.length?Qke(this,R,Q):this.processLeaveNode(R)}return g.length=0,P.forEach(V=>{this.players.push(V),V.onDone(()=>{V.destroy();const R=this.players.indexOf(V);this.players.splice(R,1)}),V.play()}),P}elementContainsData(t,i){let n=!1;const r=i[Ra];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(i)&&(n=!0),this.playersByQueriedElement.has(i)&&(n=!0),this.statesByElement.has(i)&&(n=!0),this._fetchNamespace(t).elementContainsData(i)||n}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,i,n,r,o){let s=[];if(i){const a=this.playersByQueriedElement.get(t);a&&(s=a)}else{const a=this.playersByElement.get(t);if(a){const l=!o||o==r3;a.forEach(c=>{c.queued||!l&&c.triggerName!=r||s.push(c)})}}return(n||r)&&(s=s.filter(a=>!(n&&n!=a.namespaceId||r&&r!=a.triggerName))),s}_beforeAnimationBuild(t,i,n){const o=i.element,s=i.isRemovalTransition?void 0:t,a=i.isRemovalTransition?void 0:i.triggerName;for(const l of i.timelines){const c=l.element,h=c!==o,u=sa(n,c,[]);this._getPreviousPlayers(c,h,s,a,i.toState).forEach(p=>{const f=p.getRealPlayer();f.beforeDestroy&&f.beforeDestroy(),p.destroy(),u.push(p)})}T1(o,i.fromStyles)}_buildAnimation(t,i,n,r,o,s){const a=i.triggerName,l=i.element,c=[],h=new Set,u=new Set,d=i.timelines.map(f=>{const m=f.element;h.add(m);const g=m[Ra];if(g&&g.removedBeforeQueried)return new J4(f.duration,f.delay);const v=m!==l,y=function Zke(e){const t=[];return iQ(e,t),t}((n.get(m)||jke).map(S=>S.getRealPlayer())).filter(S=>!!S.element&&S.element===m),_=o.get(m),b=s.get(m),x=E$(0,this._normalizer,0,f.keyframes,_,b),w=this._buildPlayer(f,x,y);if(f.subTimeline&&r&&u.add(m),v){const S=new AT(t,a,m);S.setRealPlayer(w),c.push(S)}return w});c.forEach(f=>{sa(this.playersByQueriedElement,f.element,[]).push(f),f.onDone(()=>function qke(e,t,i){let n=e.get(t);if(n){if(n.length){const r=n.indexOf(i);n.splice(r,1)}0==n.length&&e.delete(t)}return n}(this.playersByQueriedElement,f.element,f))}),h.forEach(f=>Fa(f,R$));const p=Yu(d);return p.onDestroy(()=>{h.forEach(f=>A0(f,R$)),bc(l,i.toStyles)}),u.forEach(f=>{sa(r,f,[]).push(p)}),p}_buildPlayer(t,i,n){return i.length>0?this.driver.animate(t.element,i,t.duration,t.delay,t.easing,n):new J4(t.duration,t.delay)}}class AT{constructor(t,i,n){this.namespaceId=t,this.triggerName=i,this.element=n,this._player=new J4,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((i,n)=>{i.forEach(r=>cT(t,n,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const i=this._player;i.triggerCallback&&t.onStart(()=>i.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,i){sa(this._queuedCallbacks,t,[]).push(i)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const i=this._player;i.triggerCallback&&i.triggerCallback(t)}}function g5(e){return e&&1===e.nodeType}function J$(e,t){const i=e.style.display;return e.style.display=t??"none",i}function eQ(e,t,i,n,r){const o=[];i.forEach(l=>o.push(J$(l)));const s=[];n.forEach((l,c)=>{const h=new Map;l.forEach(u=>{const d=t.computeStyle(c,u,r);h.set(u,d),(!d||0==d.length)&&(c[Ra]=Yke,s.push(c))}),e.set(c,h)});let a=0;return i.forEach(l=>J$(l,o[a++])),s}function tQ(e,t){const i=new Map;if(e.forEach(a=>i.set(a,[])),0==t.length)return i;const n=1,r=new Set(t),o=new Map;function s(a){if(!a)return n;let l=o.get(a);if(l)return l;const c=a.parentNode;return l=i.has(c)?c:r.has(c)?n:s(c),o.set(a,l),l}return t.forEach(a=>{const l=s(a);l!==n&&i.get(l).push(a)}),i}function Fa(e,t){e.classList?.add(t)}function A0(e,t){e.classList?.remove(t)}function Qke(e,t,i){Yu(i).onDone(()=>e.processLeaveNode(t))}function iQ(e,t){for(let i=0;i<e.length;i++){const n=e[i];n instanceof z$?iQ(n.players,t):t.push(n)}}function nQ(e,t,i){const n=i.get(e);if(!n)return!1;let r=t.get(e);return r?n.forEach(o=>r.add(o)):t.set(e,n),i.delete(e),!0}class v5{constructor(t,i,n){this.bodyNode=t,this._driver=i,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(r,o)=>{},this._transitionEngine=new Wke(t,i,n),this._timelineEngine=new Fke(t,i,n),this._transitionEngine.onRemovalComplete=(r,o)=>this.onRemovalComplete(r,o)}registerTrigger(t,i,n,r,o){const s=t+"-"+r;let a=this._triggerCache[s];if(!a){const l=[],c=[],h=bT(this._driver,o,l,c);if(l.length)throw function LOe(e,t){return new xe(3404,!1)}();a=function kke(e,t,i){return new Nke(e,t,i)}(r,h,this._normalizer),this._triggerCache[s]=a}this._transitionEngine.registerTrigger(i,r,a)}register(t,i){this._transitionEngine.register(t,i)}destroy(t,i){this._transitionEngine.destroy(t,i)}onInsert(t,i,n,r){this._transitionEngine.insertNode(t,i,n,r)}onRemove(t,i,n,r){this._transitionEngine.removeNode(t,i,r||!1,n)}disableAnimations(t,i){this._transitionEngine.markElementAsDisabled(t,i)}process(t,i,n,r){if("@"==n.charAt(0)){const[o,s]=D$(n);this._timelineEngine.command(o,i,s,r)}else this._transitionEngine.trigger(t,i,n,r)}listen(t,i,n,r,o){if("@"==n.charAt(0)){const[s,a]=D$(n);return this._timelineEngine.listen(s,i,a,o)}return this._transitionEngine.listen(t,i,n,r,o)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let eNe=(()=>{class e{constructor(i,n,r){this._element=i,this._startStyles=n,this._endStyles=r,this._state=0;let o=e.initialStylesByElement.get(i);o||e.initialStylesByElement.set(i,o=new Map),this._initialStyles=o}start(){this._state<1&&(this._startStyles&&bc(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(bc(this._element,this._initialStyles),this._endStyles&&(bc(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(T1(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(T1(this._element,this._endStyles),this._endStyles=null),bc(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function PT(e){let t=null;return e.forEach((i,n)=>{(function tNe(e){return"display"===e||"position"===e})(n)&&(t=t||new Map,t.set(n,i))}),t}class rQ{constructor(t,i,n,r){this.element=t,this.keyframes=i,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const i=[];return t.forEach(n=>{i.push(Object.fromEntries(n))}),i}_triggerWebAnimation(t,i,n){return t.animate(this._convertKeyframesToObject(i),n)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,r)=>{"offset"!==r&&t.set(r,this._finished?n:j$(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const i="start"===t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}class iNe{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,i){return!1}containsElement(t,i){return O$(t,i)}getParentElement(t){return pT(t)}query(t,i,n){return k$(t,i,n)}computeStyle(t,i,n){return window.getComputedStyle(t)[i]}animate(t,i,n,r,o,s=[]){const l={duration:n,delay:r,fill:0==r?"both":"forwards"};o&&(l.easing=o);const c=new Map,h=s.filter(p=>p instanceof rQ);(function ske(e,t){return 0===e||0===t})(n,r)&&h.forEach(p=>{p.currentSnapshot.forEach((f,m)=>c.set(m,f))});let u=function ike(e){return e.length?e[0]instanceof Map?e:e.map(t=>F$(t)):[]}(i).map(p=>Gu(p));u=function ake(e,t,i){if(i.size&&t.length){let n=t[0],r=[];if(i.forEach((o,s)=>{n.has(s)||r.push(s),n.set(s,o)}),r.length)for(let o=1;o<t.length;o++){let s=t[o];r.forEach(a=>s.set(a,j$(e,a)))}}return t}(t,u,c);const d=function Jke(e,t){let i=null,n=null;return Array.isArray(t)&&t.length?(i=PT(t[0]),t.length>1&&(n=PT(t[t.length-1]))):t instanceof Map&&(i=PT(t)),i||n?new eNe(e,i,n):null}(t,u);return new rQ(t,u,l,d)}}let nNe=(()=>{class e extends x${constructor(i,n){super(),this._nextAnimationId=0,this._renderer=i.createRenderer(n.body,{id:"0",encapsulation:Ua.None,styles:[],data:{animation:[]}})}build(i){const n=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(i)?w$(i):i;return oQ(this._renderer,null,n,"register",[r]),new rNe(n,this._renderer)}}return e.\u0275fac=function(i){return new(i||e)(he(Xh),he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class rNe extends fOe{constructor(t,i){super(),this._id=t,this._renderer=i}create(t,i){return new oNe(this._id,t,i||{},this._renderer)}}class oNe{constructor(t,i,n,r){this.id=t,this.element=i,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(t,i){return this._renderer.listen(this.element,`@@${this.id}:${t}`,i)}_command(t,...i){return oQ(this._renderer,this.element,this.id,t,i)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function oQ(e,t,i,n,r){return e.setProperty(t,`@@${i}:${n}`,r)}const sQ="@.disabled";let sNe=(()=>{class e{constructor(i,n,r){this.delegate=i,this.engine=n,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),n.onRemovalComplete=(o,s)=>{const a=s?.parentNode(o);a&&s.removeChild(a,o)}}createRenderer(i,n){const o=this.delegate.createRenderer(i,n);if(!(i&&n&&n.data&&n.data.animation)){let h=this._rendererCache.get(o);return h||(h=new aQ("",o,this.engine,()=>this._rendererCache.delete(o)),this._rendererCache.set(o,h)),h}const s=n.id,a=n.id+"-"+this._currentId;this._currentId++,this.engine.register(a,i);const l=h=>{Array.isArray(h)?h.forEach(l):this.engine.registerTrigger(s,a,i,h.name,h)};return n.data.animation.forEach(l),new aNe(this,a,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(i,n,r){i>=0&&i<this._microtaskId?this._zone.run(()=>n(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(o=>{const[s,a]=o;s(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([n,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(i){return new(i||e)(he(Xh),he(v5),he(Pt))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();class aQ{constructor(t,i,n,r){this.namespaceId=t,this.delegate=i,this.engine=n,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?o=>i.destroyNode(o):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(t,i){return this.delegate.createElement(t,i)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,i){this.delegate.appendChild(t,i),this.engine.onInsert(this.namespaceId,i,t,!1)}insertBefore(t,i,n,r=!0){this.delegate.insertBefore(t,i,n),this.engine.onInsert(this.namespaceId,i,t,r)}removeChild(t,i,n){this.engine.onRemove(this.namespaceId,i,this.delegate,n)}selectRootElement(t,i){return this.delegate.selectRootElement(t,i)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,i,n,r){this.delegate.setAttribute(t,i,n,r)}removeAttribute(t,i,n){this.delegate.removeAttribute(t,i,n)}addClass(t,i){this.delegate.addClass(t,i)}removeClass(t,i){this.delegate.removeClass(t,i)}setStyle(t,i,n,r){this.delegate.setStyle(t,i,n,r)}removeStyle(t,i,n){this.delegate.removeStyle(t,i,n)}setProperty(t,i,n){"@"==i.charAt(0)&&i==sQ?this.disableAnimations(t,!!n):this.delegate.setProperty(t,i,n)}setValue(t,i){this.delegate.setValue(t,i)}listen(t,i,n){return this.delegate.listen(t,i,n)}disableAnimations(t,i){this.engine.disableAnimations(t,i)}}class aNe extends aQ{constructor(t,i,n,r,o){super(i,n,r,o),this.factory=t,this.namespaceId=i}setProperty(t,i,n){"@"==i.charAt(0)?"."==i.charAt(1)&&i==sQ?this.disableAnimations(t,n=void 0===n||!!n):this.engine.process(this.namespaceId,t,i.slice(1),n):this.delegate.setProperty(t,i,n)}listen(t,i,n){if("@"==i.charAt(0)){const r=function lNe(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let o=i.slice(1),s="";return"@"!=o.charAt(0)&&([o,s]=function cNe(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(o)),this.engine.listen(this.namespaceId,r,o,s,a=>{this.factory.scheduleListenerCallback(a._data||-1,n,a)})}return this.delegate.listen(t,i,n)}}let hNe=(()=>{class e extends v5{constructor(i,n,r,o){super(i.body,n,r)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(i){return new(i||e)(he(_i),he(fT),he(MT),he(Sp))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const lQ=[{provide:x$,useClass:nNe},{provide:MT,useFactory:function uNe(){return new Ake}},{provide:v5,useClass:hNe},{provide:Xh,useFactory:function dNe(e,t,i){return new sNe(e,t,i)},deps:[Qg,v5,Pt]}],IT=[{provide:fT,useFactory:()=>new iNe},{provide:Am,useValue:"BrowserAnimations"},...lQ],cQ=[{provide:fT,useClass:N$},{provide:Am,useValue:"NoopAnimations"},...lQ];let pNe=(()=>{class e{static withConfig(i){return{ngModule:e,providers:i.disableAnimations?cQ:IT}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:IT,imports:[NN]}),e})();class fNe{constructor(t,i="/assets/i18n/",n=".json"){this.http=t,this.prefix=i,this.suffix=n}getTranslation(t){return this.http.get(`${this.prefix}${t}${this.suffix}`)}}var Wu=(()=>(function(e){e.Dark="dark",e.Default="default"}(Wu||(Wu={})),Wu))();let hQ=(()=>{class e{constructor(){this.currentTheme=Wu.Dark,this.themeChanged=new Yi(this.currentTheme);const i=localStorage.getItem("theme");i&&Object.values(Wu).includes(i)&&(this.currentTheme=i,this.themeChanged.next(this.currentTheme))}reverseTheme(i){return i===Wu.Dark?Wu.Default:Wu.Dark}removeUnusedTheme(i){document.documentElement.classList.remove(i);const n=document.getElementById(i);n&&document.head.removeChild(n)}loadTheme(i=!0){const n=this.currentTheme;return i&&document.documentElement.classList.add(n),new Promise((r,o)=>{this.loadCss(`${n}.css`,n).then(s=>{i||document.documentElement.classList.add(n),this.removeUnusedTheme(this.reverseTheme(n)),localStorage.setItem("theme",n),r(s)},s=>o(s))})}toggleTheme(){return this.currentTheme=this.reverseTheme(this.currentTheme),this.themeChanged.next(this.currentTheme),this.loadTheme(!1)}getThemeChanged(){return this.themeChanged}loadCss(i,n){return new Promise((r,o)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=i,s.id=n,s.onload=r,s.onerror=o,document.head.append(s)})}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const mNe={provide:Em,useFactory:e=>()=>e.loadTheme(),deps:[hQ],multi:!0};function D1(e){return null!=e&&"false"!=`${e}`}function P0(e,t=0){return uQ(e)?Number(e):t}function uQ(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}function _5(e){return Array.isArray(e)?e:[e]}function _r(e){return null==e?"":"string"==typeof e?e:`${e}px`}function I0(e){return e instanceof yt?e.nativeElement:e}const gNe=["addListener","removeListener"],vNe=["addEventListener","removeEventListener"],yNe=["on","off"];function $r(e,t,i,n){if(wi(i)&&(n=i,i=void 0),n)return $r(e,t,i).pipe(ob(n));const[r,o]=function xNe(e){return wi(e.addEventListener)&&wi(e.removeEventListener)}(e)?vNe.map(s=>a=>e[s](t,a,i)):function _Ne(e){return wi(e.addListener)&&wi(e.removeListener)}(e)?gNe.map(dQ(e,t)):function bNe(e){return wi(e.on)&&wi(e.off)}(e)?yNe.map(dQ(e,t)):[];if(!r&&s7(e))return xr(s=>$r(s,t,i))(eo(e));if(!r)throw new TypeError("Invalid event target");return new Li(s=>{const a=(...l)=>s.next(1<l.length?l:l[0]);return r(a),()=>o(a)})}function dQ(e,t){return i=>n=>e[i](t,n)}class wNe extends Vi{constructor(t,i){super()}schedule(t,i=0){return this}}const b5={setInterval(e,t,...i){const{delegate:n}=b5;return n?.setInterval?n.setInterval(e,t,...i):setInterval(e,t,...i)},clearInterval(e){const{delegate:t}=b5;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class OT extends wNe{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){var n;if(this.closed)return this;this.state=t;const r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,i)),this.pending=!0,this.delay=i,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(o,this.id,i),this}requestAsyncId(t,i,n=0){return b5.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return i;null!=i&&b5.clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,i);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let r,n=!1;try{this.work(t)}catch(o){n=!0,r=o||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:i}=this,{actions:n}=i;this.work=this.state=this.scheduler=null,this.pending=!1,jh(n,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,super.unsubscribe()}}}const o3={schedule(e){let t=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:n}=o3;n&&(t=n.requestAnimationFrame,i=n.cancelAnimationFrame);const r=t(o=>{i=void 0,e(o)});return new Vi(()=>i?.(r))},requestAnimationFrame(...e){const{delegate:t}=o3;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=o3;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};class s3{constructor(t,i=s3.now){this.schedulerActionCtor=t,this.now=i}schedule(t,i=0,n){return new this.schedulerActionCtor(this,t).schedule(n,i)}}s3.now=Mz.now;class kT extends s3{constructor(t,i=s3.now){super(t,i),this.actions=[],this._active=!1}flush(t){const{actions:i}=this;if(this._active)return void i.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=i.shift());if(this._active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}}const pQ=new class SNe extends kT{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class CNe extends OT{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=o3.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:o}=t;null!=i&&(null===(r=o[o.length-1])||void 0===r?void 0:r.id)!==i&&(o3.cancelAnimationFrame(i),t._scheduled=void 0)}});let NT,MNe=1;const x5={};function fQ(e){return e in x5&&(delete x5[e],!0)}const zNe={setImmediate(e){const t=MNe++;return x5[t]=!0,NT||(NT=Promise.resolve()),NT.then(()=>fQ(t)&&e()),t},clearImmediate(e){fQ(e)}},{setImmediate:TNe,clearImmediate:ENe}=zNe,w5={setImmediate(...e){const{delegate:t}=w5;return(t?.setImmediate||TNe)(...e)},clearImmediate(e){const{delegate:t}=w5;return(t?.clearImmediate||ENe)(e)},delegate:void 0},LT=new class ANe extends kT{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class DNe extends OT{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=w5.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:o}=t;null!=i&&(null===(r=o[o.length-1])||void 0===r?void 0:r.id)!==i&&(w5.clearImmediate(i),t._scheduled=void 0)}});function Sl(e,t=Tc){return e=e??PNe,Mn((i,n)=>{let r,o=!0;i.subscribe($i(n,s=>{const a=t(s);(o||!e(r,a))&&(o=!1,r=a,n.next(s))}))})}function PNe(e,t){return e===t}const C5=new kT(OT),INe=C5;function RT(e=0,t,i=INe){let n=-1;return null!=t&&(lD(t)?i=t:n=t),new Li(r=>{let o=function kNe(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;o<0&&(o=0);let s=0;return i.schedule(function(){r.closed||(r.next(s++),0<=n?this.schedule(void 0,n):r.complete())},o)})}function A1(e,t=C5){return function ONe(e){return Mn((t,i)=>{let n=!1,r=null,o=null,s=!1;const a=()=>{if(o?.unsubscribe(),o=null,n){n=!1;const c=r;r=null,i.next(c)}s&&i.complete()},l=()=>{o=null,s&&i.complete()};t.subscribe($i(i,c=>{n=!0,r=c,o||eo(e(c)).subscribe(o=$i(i,a,l))},()=>{s=!0,(!n||!o||o.closed)&&i.complete()}))})}(()=>RT(e,t))}function Ye(e){return Mn((t,i)=>{eo(e).subscribe($i(i,()=>i.complete(),Yh)),!i.closed&&t.subscribe(i)})}let FT;try{FT=typeof Intl<"u"&&Intl.v8BreakIterator}catch{FT=!1}let a3,S5,P1,VT,Qr=(()=>{class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function Kle(e){return e===uN}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!FT)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return e.\u0275fac=function(i){return new(i||e)(he(Dg))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Hs=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();function BT(e){return function LNe(){if(null==a3&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>a3=!0}))}finally{a3=a3||!1}return a3}()?e:!!e.capture}function gQ(){if(null==P1){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return P1=!1,P1;if("scrollBehavior"in document.documentElement.style)P1=!0;else{const e=Element.prototype.scrollTo;P1=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return P1}function l3(){if("object"!=typeof document||!document)return 0;if(null==S5){const e=document.createElement("div"),t=e.style;e.dir="rtl",t.width="1px",t.overflow="auto",t.visibility="hidden",t.pointerEvents="none",t.position="absolute";const i=document.createElement("div"),n=i.style;n.width="2px",n.height="1px",e.appendChild(i),document.body.appendChild(e),S5=0,0===e.scrollLeft&&(e.scrollLeft=1,S5=0===e.scrollLeft?1:2),e.remove()}return S5}function I1(e){return e.composedPath?e.composedPath()[0]:e.target}function vQ(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}const BNe=new Fe("cdk-dir-doc",{providedIn:"root",factory:function VNe(){return si(_i)}}),HNe=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Vn=(()=>{class e{constructor(i){this.value="ltr",this.change=new Re,i&&(this.value=function UNe(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?HNe.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return e.\u0275fac=function(i){return new(i||e)(he(BNe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),un=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();class jNe{}class GNe extends jNe{constructor(t){super(),this._data=t}connect(){return Oh(this._data)?this._data:tt(this._data)}disconnect(){}}class WNe{constructor(){this.viewCacheSize=20,this._viewCache=[]}applyChanges(t,i,n,r,o){t.forEachOperation((s,a,l)=>{let c,h;null==s.previousIndex?(c=this._insertView(()=>n(s,a,l),l,i,r(s)),h=c?1:0):null==l?(this._detachAndCacheView(a,i),h=3):(c=this._moveView(a,l,i,r(s)),h=2),o&&o({context:c?.context,operation:h,record:s})})}detach(){for(const t of this._viewCache)t.destroy();this._viewCache=[]}_insertView(t,i,n,r){const o=this._insertViewFromCache(i,n);if(o)return void(o.context.$implicit=r);const s=t();return n.createEmbeddedView(s.templateRef,s.context,s.index)}_detachAndCacheView(t,i){const n=i.detach(t);this._maybeCacheView(n,i)}_moveView(t,i,n,r){const o=n.get(t);return n.move(o,i),o.context.$implicit=r,o}_maybeCacheView(t,i){if(this._viewCache.length<this.viewCacheSize)this._viewCache.push(t);else{const n=i.indexOf(t);-1===n?t.destroy():i.remove(n)}}_insertViewFromCache(t,i){const n=this._viewCache.pop();return n&&i.insert(n,t),n||null}}const yQ=new Fe("_ViewRepeater"),qNe=["contentWrapper"],XNe=["*"],_Q=new Fe("VIRTUAL_SCROLL_STRATEGY");class $Ne{constructor(t,i,n){this._scrolledIndexChange=new He,this.scrolledIndexChange=this._scrolledIndexChange.pipe(Sl()),this._viewport=null,this._itemSize=t,this._minBufferPx=i,this._maxBufferPx=n}attach(t){this._viewport=t,this._updateTotalContentSize(),this._updateRenderedRange()}detach(){this._scrolledIndexChange.complete(),this._viewport=null}updateItemAndBufferSize(t,i,n){this._itemSize=t,this._minBufferPx=i,this._maxBufferPx=n,this._updateTotalContentSize(),this._updateRenderedRange()}onContentScrolled(){this._updateRenderedRange()}onDataLengthChanged(){this._updateTotalContentSize(),this._updateRenderedRange()}onContentRendered(){}onRenderedOffsetChanged(){}scrollToIndex(t,i){this._viewport&&this._viewport.scrollToOffset(t*this._itemSize,i)}_updateTotalContentSize(){this._viewport&&this._viewport.setTotalContentSize(this._viewport.getDataLength()*this._itemSize)}_updateRenderedRange(){if(!this._viewport)return;const t=this._viewport.getRenderedRange(),i={start:t.start,end:t.end},n=this._viewport.getViewportSize(),r=this._viewport.getDataLength();let o=this._viewport.measureScrollOffset(),s=this._itemSize>0?o/this._itemSize:0;if(i.end>r){const l=Math.ceil(n/this._itemSize),c=Math.max(0,Math.min(s,r-l));s!=c&&(s=c,o=c*this._itemSize,i.start=Math.floor(s)),i.end=Math.max(0,Math.min(r,i.start+l))}const a=o-i.start*this._itemSize;if(a<this._minBufferPx&&0!=i.start){const l=Math.ceil((this._maxBufferPx-a)/this._itemSize);i.start=Math.max(0,i.start-l),i.end=Math.min(r,Math.ceil(s+(n+this._minBufferPx)/this._itemSize))}else{const l=i.end*this._itemSize-(o+n);if(l<this._minBufferPx&&i.end!=r){const c=Math.ceil((this._maxBufferPx-l)/this._itemSize);c>0&&(i.end=Math.min(r,i.end+c),i.start=Math.max(0,Math.floor(s-this._minBufferPx/this._itemSize)))}}this._viewport.setRenderedRange(i),this._viewport.setRenderedContentOffset(this._itemSize*i.start),this._scrolledIndexChange.next(Math.floor(s))}}function QNe(e){return e._scrollStrategy}let ZNe=(()=>{class e{constructor(){this._itemSize=20,this._minBufferPx=100,this._maxBufferPx=200,this._scrollStrategy=new $Ne(this.itemSize,this.minBufferPx,this.maxBufferPx)}get itemSize(){return this._itemSize}set itemSize(i){this._itemSize=P0(i)}get minBufferPx(){return this._minBufferPx}set minBufferPx(i){this._minBufferPx=P0(i)}get maxBufferPx(){return this._maxBufferPx}set maxBufferPx(i){this._maxBufferPx=P0(i)}ngOnChanges(){this._scrollStrategy.updateItemAndBufferSize(this.itemSize,this.minBufferPx,this.maxBufferPx)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Ge({type:e,selectors:[["cdk-virtual-scroll-viewport","itemSize",""]],inputs:{itemSize:"itemSize",minBufferPx:"minBufferPx",maxBufferPx:"maxBufferPx"},standalone:!0,features:[vi([{provide:_Q,useFactory:QNe,deps:[nn(()=>e)]}]),Ht]}),e})(),M5=(()=>{class e{constructor(i,n,r){this._ngZone=i,this._platform=n,this._scrolled=new He,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const n=this.scrollContainers.get(i);n&&(n.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new Li(n=>{this._globalSubscription||this._addGlobalListener();const r=i>0?this._scrolled.pipe(A1(i)).subscribe(n):this._scrolled.subscribe(n);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):tt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,n)=>this.deregister(n)),this._scrolled.complete()}ancestorScrolled(i,n){const r=this.getAncestorScrollContainers(i);return this.scrolled(n).pipe(rn(o=>!o||r.indexOf(o)>-1))}getAncestorScrollContainers(i){const n=[];return this.scrollContainers.forEach((r,o)=>{this._scrollableContainsElement(o,i)&&n.push(o)}),n}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,n){let r=I0(n),o=i.getElementRef().nativeElement;do{if(r==o)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>$r(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return e.\u0275fac=function(i){return new(i||e)(he(Pt),he(Qr),he(_i,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),bQ=(()=>{class e{constructor(i,n,r,o){this.elementRef=i,this.scrollDispatcher=n,this.ngZone=r,this.dir=o,this._destroyed=new He,this._elementScrolled=new Li(s=>this.ngZone.runOutsideAngular(()=>$r(this.elementRef.nativeElement,"scroll").pipe(Ye(this._destroyed)).subscribe(s)))}ngOnInit(){this.scrollDispatcher.register(this)}ngOnDestroy(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(i){const n=this.elementRef.nativeElement,r=this.dir&&"rtl"==this.dir.value;null==i.left&&(i.left=r?i.end:i.start),null==i.right&&(i.right=r?i.start:i.end),null!=i.bottom&&(i.top=n.scrollHeight-n.clientHeight-i.bottom),r&&0!=l3()?(null!=i.left&&(i.right=n.scrollWidth-n.clientWidth-i.left),2==l3()?i.left=i.right:1==l3()&&(i.left=i.right?-i.right:i.right)):null!=i.right&&(i.left=n.scrollWidth-n.clientWidth-i.right),this._applyScrollToOptions(i)}_applyScrollToOptions(i){const n=this.elementRef.nativeElement;gQ()?n.scrollTo(i):(null!=i.top&&(n.scrollTop=i.top),null!=i.left&&(n.scrollLeft=i.left))}measureScrollOffset(i){const n="left",r="right",o=this.elementRef.nativeElement;if("top"==i)return o.scrollTop;if("bottom"==i)return o.scrollHeight-o.clientHeight-o.scrollTop;const s=this.dir&&"rtl"==this.dir.value;return"start"==i?i=s?r:n:"end"==i&&(i=s?n:r),s&&2==l3()?i==n?o.scrollWidth-o.clientWidth-o.scrollLeft:o.scrollLeft:s&&1==l3()?i==n?o.scrollLeft+o.scrollWidth-o.clientWidth:-o.scrollLeft:i==n?o.scrollLeft:o.scrollWidth-o.clientWidth-o.scrollLeft}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(M5),L(Pt),L(Vn,8))},e.\u0275dir=Ge({type:e,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]],standalone:!0}),e})(),z5=(()=>{class e{constructor(i,n,r){this._platform=i,this._change=new He,this._changeListener=o=>{this._change.next(o)},this._document=r,n.runOutsideAngular(()=>{if(i.isBrowser){const o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:n,height:r}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+r,right:i.left+n,height:r,width:n}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,n=this._getWindow(),r=i.documentElement,o=r.getBoundingClientRect();return{top:-o.top||i.body.scrollTop||n.scrollY||r.scrollTop||0,left:-o.left||i.body.scrollLeft||n.scrollX||r.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(A1(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}}return e.\u0275fac=function(i){return new(i||e)(he(Qr),he(Pt),he(_i,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const xQ=new Fe("VIRTUAL_SCROLLABLE");let eLe=(()=>{class e extends bQ{constructor(i,n,r,o){super(i,n,r,o)}measureViewportSize(i){const n=this.elementRef.nativeElement;return"horizontal"===i?n.clientWidth:n.clientHeight}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(M5),L(Pt),L(Vn,8))},e.\u0275dir=Ge({type:e,features:[Ci]}),e})();const iLe=typeof requestAnimationFrame<"u"?pQ:LT;let T5=(()=>{class e extends eLe{get orientation(){return this._orientation}set orientation(i){this._orientation!==i&&(this._orientation=i,this._calculateSpacerSize())}get appendOnly(){return this._appendOnly}set appendOnly(i){this._appendOnly=D1(i)}constructor(i,n,r,o,s,a,l,c){super(i,a,r,s),this.elementRef=i,this._changeDetectorRef=n,this._scrollStrategy=o,this.scrollable=c,this._platform=si(Qr),this._detachedSubject=new He,this._renderedRangeSubject=new He,this._orientation="vertical",this._appendOnly=!1,this.scrolledIndexChange=new Li(h=>this._scrollStrategy.scrolledIndexChange.subscribe(u=>Promise.resolve().then(()=>this.ngZone.run(()=>h.next(u))))),this.renderedRangeStream=this._renderedRangeSubject,this._totalContentSize=0,this._totalContentWidth="",this._totalContentHeight="",this._renderedRange={start:0,end:0},this._dataLength=0,this._viewportSize=0,this._renderedContentOffset=0,this._renderedContentOffsetNeedsRewrite=!1,this._isChangeDetectionPending=!1,this._runAfterChangeDetection=[],this._viewportChanges=Vi.EMPTY,this._viewportChanges=l.change().subscribe(()=>{this.checkViewportSize()}),this.scrollable||(this.elementRef.nativeElement.classList.add("cdk-virtual-scrollable"),this.scrollable=this)}ngOnInit(){this._platform.isBrowser&&(this.scrollable===this&&super.ngOnInit(),this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._measureViewportSize(),this._scrollStrategy.attach(this),this.scrollable.elementScrolled().pipe(Ho(null),A1(0,iLe)).subscribe(()=>this._scrollStrategy.onContentScrolled()),this._markChangeDetectionNeeded()})))}ngOnDestroy(){this.detach(),this._scrollStrategy.detach(),this._renderedRangeSubject.complete(),this._detachedSubject.complete(),this._viewportChanges.unsubscribe(),super.ngOnDestroy()}attach(i){this.ngZone.runOutsideAngular(()=>{this._forOf=i,this._forOf.dataStream.pipe(Ye(this._detachedSubject)).subscribe(n=>{const r=n.length;r!==this._dataLength&&(this._dataLength=r,this._scrollStrategy.onDataLengthChanged()),this._doChangeDetection()})})}detach(){this._forOf=null,this._detachedSubject.next()}getDataLength(){return this._dataLength}getViewportSize(){return this._viewportSize}getRenderedRange(){return this._renderedRange}measureBoundingClientRectWithScrollOffset(i){return this.getElementRef().nativeElement.getBoundingClientRect()[i]}setTotalContentSize(i){this._totalContentSize!==i&&(this._totalContentSize=i,this._calculateSpacerSize(),this._markChangeDetectionNeeded())}setRenderedRange(i){(function tLe(e,t){return e.start==t.start&&e.end==t.end})(this._renderedRange,i)||(this.appendOnly&&(i={start:0,end:Math.max(this._renderedRange.end,i.end)}),this._renderedRangeSubject.next(this._renderedRange=i),this._markChangeDetectionNeeded(()=>this._scrollStrategy.onContentRendered()))}getOffsetToRenderedContentStart(){return this._renderedContentOffsetNeedsRewrite?null:this._renderedContentOffset}setRenderedContentOffset(i,n="to-start"){i=this.appendOnly&&"to-start"===n?0:i;const o="horizontal"==this.orientation,s=o?"X":"Y";let l=`translate${s}(${Number((o&&this.dir&&"rtl"==this.dir.value?-1:1)*i)}px)`;this._renderedContentOffset=i,"to-end"===n&&(l+=` translate${s}(-100%)`,this._renderedContentOffsetNeedsRewrite=!0),this._renderedContentTransform!=l&&(this._renderedContentTransform=l,this._markChangeDetectionNeeded(()=>{this._renderedContentOffsetNeedsRewrite?(this._renderedContentOffset-=this.measureRenderedContentSize(),this._renderedContentOffsetNeedsRewrite=!1,this.setRenderedContentOffset(this._renderedContentOffset)):this._scrollStrategy.onRenderedOffsetChanged()}))}scrollToOffset(i,n="auto"){const r={behavior:n};"horizontal"===this.orientation?r.start=i:r.top=i,this.scrollable.scrollTo(r)}scrollToIndex(i,n="auto"){this._scrollStrategy.scrollToIndex(i,n)}measureScrollOffset(i){let n;return n=this.scrollable==this?r=>super.measureScrollOffset(r):r=>this.scrollable.measureScrollOffset(r),Math.max(0,n(i??("horizontal"===this.orientation?"start":"top"))-this.measureViewportOffset())}measureViewportOffset(i){let n;const r="left",o="right",s="rtl"==this.dir?.value;n="start"==i?s?o:r:"end"==i?s?r:o:i||("horizontal"===this.orientation?"left":"top");const a=this.scrollable.measureBoundingClientRectWithScrollOffset(n);return this.elementRef.nativeElement.getBoundingClientRect()[n]-a}measureRenderedContentSize(){const i=this._contentWrapper.nativeElement;return"horizontal"===this.orientation?i.offsetWidth:i.offsetHeight}measureRangeSize(i){return this._forOf?this._forOf.measureRangeSize(i,this.orientation):0}checkViewportSize(){this._measureViewportSize(),this._scrollStrategy.onDataLengthChanged()}_measureViewportSize(){this._viewportSize=this.scrollable.measureViewportSize(this.orientation)}_markChangeDetectionNeeded(i){i&&this._runAfterChangeDetection.push(i),this._isChangeDetectionPending||(this._isChangeDetectionPending=!0,this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._doChangeDetection()})))}_doChangeDetection(){this._isChangeDetectionPending=!1,this._contentWrapper.nativeElement.style.transform=this._renderedContentTransform,this.ngZone.run(()=>this._changeDetectorRef.markForCheck());const i=this._runAfterChangeDetection;this._runAfterChangeDetection=[];for(const n of i)n()}_calculateSpacerSize(){this._totalContentHeight="horizontal"===this.orientation?"":`${this._totalContentSize}px`,this._totalContentWidth="horizontal"===this.orientation?`${this._totalContentSize}px`:""}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Ri),L(Pt),L(_Q,8),L(Vn,8),L(M5),L(z5),L(xQ,8))},e.\u0275cmp=ut({type:e,selectors:[["cdk-virtual-scroll-viewport"]],viewQuery:function(i,n){if(1&i&&Ui(qNe,7),2&i){let r;Mt(r=zt())&&(n._contentWrapper=r.first)}},hostAttrs:[1,"cdk-virtual-scroll-viewport"],hostVars:4,hostBindings:function(i,n){2&i&&Dt("cdk-virtual-scroll-orientation-horizontal","horizontal"===n.orientation)("cdk-virtual-scroll-orientation-vertical","horizontal"!==n.orientation)},inputs:{orientation:"orientation",appendOnly:"appendOnly"},outputs:{scrolledIndexChange:"scrolledIndexChange"},standalone:!0,features:[vi([{provide:bQ,useFactory:(t,i)=>t||i,deps:[[new qh,new W3(xQ)],e]}]),Ci,a9],ngContentSelectors:XNe,decls:4,vars:4,consts:[[1,"cdk-virtual-scroll-content-wrapper"],["contentWrapper",""],[1,"cdk-virtual-scroll-spacer"]],template:function(i,n){1&i&&(Ln(),Ee(0,"div",0,1),Mi(2),Pe(),Je(3,"div",2)),2&i&&(ie(3),Xn("width",n._totalContentWidth)("height",n._totalContentHeight))},styles:["cdk-virtual-scroll-viewport{display:block;position:relative;transform:translateZ(0)}.cdk-virtual-scrollable{overflow:auto;will-change:scroll-position;contain:strict;-webkit-overflow-scrolling:touch}.cdk-virtual-scroll-content-wrapper{position:absolute;top:0;left:0;contain:content}[dir=rtl] .cdk-virtual-scroll-content-wrapper{right:0;left:auto}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper{min-height:100%}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-left:0;padding-right:0;margin-left:0;margin-right:0;border-left-width:0;border-right-width:0;outline:none}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper{min-width:100%}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;border-top-width:0;border-bottom-width:0;outline:none}.cdk-virtual-scroll-spacer{height:1px;transform-origin:0 0;flex:0 0 auto}[dir=rtl] .cdk-virtual-scroll-spacer{transform-origin:100% 0}"],encapsulation:2,changeDetection:0}),e})();function wQ(e,t,i){if(!i.getBoundingClientRect)return 0;const r=i.getBoundingClientRect();return"horizontal"===e?"start"===t?r.left:r.right:"start"===t?r.top:r.bottom}let nLe=(()=>{class e{get cdkVirtualForOf(){return this._cdkVirtualForOf}set cdkVirtualForOf(i){this._cdkVirtualForOf=i,function YNe(e){return e&&"function"==typeof e.connect&&!(e instanceof ab)}(i)?this._dataSourceChanges.next(i):this._dataSourceChanges.next(new GNe(Oh(i)?i:Array.from(i||[])))}get cdkVirtualForTrackBy(){return this._cdkVirtualForTrackBy}set cdkVirtualForTrackBy(i){this._needsUpdate=!0,this._cdkVirtualForTrackBy=i?(n,r)=>i(n+(this._renderedRange?this._renderedRange.start:0),r):void 0}set cdkVirtualForTemplate(i){i&&(this._needsUpdate=!0,this._template=i)}get cdkVirtualForTemplateCacheSize(){return this._viewRepeater.viewCacheSize}set cdkVirtualForTemplateCacheSize(i){this._viewRepeater.viewCacheSize=P0(i)}constructor(i,n,r,o,s,a){this._viewContainerRef=i,this._template=n,this._differs=r,this._viewRepeater=o,this._viewport=s,this.viewChange=new He,this._dataSourceChanges=new He,this.dataStream=this._dataSourceChanges.pipe(Ho(null),function NNe(){return Mn((e,t)=>{let i,n=!1;e.subscribe($i(t,r=>{const o=i;i=r,n&&t.next([o,r]),n=!0}))})}(),Sr(([l,c])=>this._changeDataSource(l,c)),zz(1)),this._differ=null,this._needsUpdate=!1,this._destroyed=new He,this.dataStream.subscribe(l=>{this._data=l,this._onRenderedDataChange()}),this._viewport.renderedRangeStream.pipe(Ye(this._destroyed)).subscribe(l=>{this._renderedRange=l,this.viewChange.observers.length&&a.run(()=>this.viewChange.next(this._renderedRange)),this._onRenderedDataChange()}),this._viewport.attach(this)}measureRangeSize(i,n){if(i.start>=i.end)return 0;const r=i.start-this._renderedRange.start,o=i.end-i.start;let s,a;for(let l=0;l<o;l++){const c=this._viewContainerRef.get(l+r);if(c&&c.rootNodes.length){s=a=c.rootNodes[0];break}}for(let l=o-1;l>-1;l--){const c=this._viewContainerRef.get(l+r);if(c&&c.rootNodes.length){a=c.rootNodes[c.rootNodes.length-1];break}}return s&&a?wQ(n,"end",a)-wQ(n,"start",s):0}ngDoCheck(){if(this._differ&&this._needsUpdate){const i=this._differ.diff(this._renderedItems);i?this._applyChanges(i):this._updateContext(),this._needsUpdate=!1}}ngOnDestroy(){this._viewport.detach(),this._dataSourceChanges.next(void 0),this._dataSourceChanges.complete(),this.viewChange.complete(),this._destroyed.next(),this._destroyed.complete(),this._viewRepeater.detach()}_onRenderedDataChange(){this._renderedRange&&(this._renderedItems=this._data.slice(this._renderedRange.start,this._renderedRange.end),this._differ||(this._differ=this._differs.find(this._renderedItems).create((i,n)=>this.cdkVirtualForTrackBy?this.cdkVirtualForTrackBy(i,n):n)),this._needsUpdate=!0)}_changeDataSource(i,n){return i&&i.disconnect(this),this._needsUpdate=!0,n?n.connect(this):tt()}_updateContext(){const i=this._data.length;let n=this._viewContainerRef.length;for(;n--;){const r=this._viewContainerRef.get(n);r.context.index=this._renderedRange.start+n,r.context.count=i,this._updateComputedContextProperties(r.context),r.detectChanges()}}_applyChanges(i){this._viewRepeater.applyChanges(i,this._viewContainerRef,(o,s,a)=>this._getEmbeddedViewArgs(o,a),o=>o.item),i.forEachIdentityChange(o=>{this._viewContainerRef.get(o.currentIndex).context.$implicit=o.item});const n=this._data.length;let r=this._viewContainerRef.length;for(;r--;){const o=this._viewContainerRef.get(r);o.context.index=this._renderedRange.start+r,o.context.count=n,this._updateComputedContextProperties(o.context)}}_updateComputedContextProperties(i){i.first=0===i.index,i.last=i.index===i.count-1,i.even=i.index%2==0,i.odd=!i.even}_getEmbeddedViewArgs(i,n){return{templateRef:this._template,context:{$implicit:i.item,cdkVirtualForOf:this._cdkVirtualForOf,index:-1,count:-1,first:!1,last:!1,odd:!1,even:!1},index:n}}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn),L(Pm),L(yQ),L(T5,4),L(Pt))},e.\u0275dir=Ge({type:e,selectors:[["","cdkVirtualFor","","cdkVirtualForOf",""]],inputs:{cdkVirtualForOf:"cdkVirtualForOf",cdkVirtualForTrackBy:"cdkVirtualForTrackBy",cdkVirtualForTemplate:"cdkVirtualForTemplate",cdkVirtualForTemplateCacheSize:"cdkVirtualForTemplateCacheSize"},standalone:!0,features:[vi([{provide:yQ,useClass:WNe}])]}),e})(),HT=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),UT=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,HT,T5,un,HT]}),e})();class jT{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class YT extends jT{constructor(t,i,n,r,o){super(),this.component=t,this.viewContainerRef=i,this.injector=n,this.componentFactoryResolver=r,this.projectableNodes=o}}class c3 extends jT{constructor(t,i,n,r){super(),this.templateRef=t,this.viewContainerRef=i,this.context=n,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,i=this.context){return this.context=i,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class rLe extends jT{constructor(t){super(),this.element=t instanceof yt?t.nativeElement:t}}class CQ{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof YT?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof c3?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof rLe?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class oLe extends CQ{constructor(t,i,n,r,o){super(),this.outletElement=t,this._componentFactoryResolver=i,this._appRef=n,this._defaultInjector=r,this.attachDomPortal=s=>{const a=s.element,l=this._document.createComment("dom-portal");a.parentNode.insertBefore(l,a),this.outletElement.appendChild(a),this._attachedPortal=s,super.setDisposeFn(()=>{l.parentNode&&l.parentNode.replaceChild(a,l)})},this._document=o}attachComponentPortal(t){const n=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(n,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=n.create(t.injector||this._defaultInjector||Bo.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let i=t.viewContainerRef,n=i.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return n.rootNodes.forEach(r=>this.outletElement.appendChild(r)),n.detectChanges(),this.setDisposeFn(()=>{let r=i.indexOf(n);-1!==r&&i.remove(r)}),this._attachedPortal=t,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let sLe=(()=>{class e extends CQ{constructor(i,n,r){super(),this._componentFactoryResolver=i,this._viewContainerRef=n,this._isInitialized=!1,this.attached=new Re,this.attachDomPortal=o=>{const s=o.element,a=this._document.createComment("dom-portal");o.setAttachedHost(this),s.parentNode.insertBefore(a,s),this._getRootNode().appendChild(s),this._attachedPortal=o,super.setDisposeFn(()=>{a.parentNode&&a.parentNode.replaceChild(s,a)})},this._document=r}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);const n=null!=i.viewContainerRef?i.viewContainerRef:this._viewContainerRef,o=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component),s=n.createComponent(o,n.length,i.injector||n.injector,i.projectableNodes||void 0);return n!==this._viewContainerRef&&this._getRootNode().appendChild(s.hostView.rootNodes[0]),super.setDisposeFn(()=>s.destroy()),this._attachedPortal=i,this._attachedRef=s,this.attached.emit(s),s}attachTemplatePortal(i){i.setAttachedHost(this);const n=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=n,this.attached.emit(n),n}_getRootNode(){const i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}}return e.\u0275fac=function(i){return new(i||e)(L(Lc),L($n),L(_i))},e.\u0275dir=Ge({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Ci]}),e})(),GT=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();const TQ=gQ();class xLe{constructor(t,i){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=_r(-this._previousScrollPosition.left),t.style.top=_r(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,n=t.style,r=this._document.body.style,o=n.scrollBehavior||"",s=r.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),TQ&&(n.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),TQ&&(n.scrollBehavior=o,r.scrollBehavior=s)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,n=this._viewportRuler.getViewportSize();return i.scrollHeight>n.height||i.scrollWidth>n.width}}class wLe{constructor(t,i,n,r){this._scrollDispatcher=t,this._ngZone=i,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(rn(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class EQ{enable(){}disable(){}attach(){}}function qT(e,t){return t.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function DQ(e,t){return t.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class CLe{constructor(t,i,n,r){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:r}=this._viewportRuler.getViewportSize();qT(i,[{width:n,height:r,bottom:r,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let SLe=(()=>{class e{constructor(i,n,r,o){this._scrollDispatcher=i,this._viewportRuler=n,this._ngZone=r,this.noop=()=>new EQ,this.close=s=>new wLe(this._scrollDispatcher,this._ngZone,this._viewportRuler,s),this.block=()=>new xLe(this._viewportRuler,this._document),this.reposition=s=>new CLe(this._scrollDispatcher,this._viewportRuler,this._ngZone,s),this._document=o}}return e.\u0275fac=function(i){return new(i||e)(he(M5),he(z5),he(Pt),he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class XT{constructor(t){if(this.scrollStrategy=new EQ,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const i=Object.keys(t);for(const n of i)void 0!==t[n]&&(this[n]=t[n])}}}class Sn{constructor(t,i,n,r,o){this.offsetX=n,this.offsetY=r,this.panelClass=o,this.originX=t.originX,this.originY=t.originY,this.overlayX=i.overlayX,this.overlayY=i.overlayY}}class MLe{constructor(t,i){this.connectionPair=t,this.scrollableViewProperties=i}}let AQ=(()=>{class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const n=this._attachedOverlays.indexOf(i);n>-1&&this._attachedOverlays.splice(n,1),0===this._attachedOverlays.length&&this.detach()}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),zLe=(()=>{class e extends AQ{constructor(i,n){super(i),this._ngZone=n,this._keydownListener=r=>{const o=this._attachedOverlays;for(let s=o.length-1;s>-1;s--)if(o[s]._keydownEvents.observers.length>0){const a=o[s]._keydownEvents;this._ngZone?this._ngZone.run(()=>a.next(r)):a.next(r);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return e.\u0275fac=function(i){return new(i||e)(he(_i),he(Pt,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),TLe=(()=>{class e extends AQ{constructor(i,n,r){super(i),this._platform=n,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=o=>{this._pointerDownEventTarget=I1(o)},this._clickListener=o=>{const s=I1(o),a="click"===o.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:s;this._pointerDownEventTarget=null;const l=this._attachedOverlays.slice();for(let c=l.length-1;c>-1;c--){const h=l[c];if(h._outsidePointerEvents.observers.length<1||!h.hasAttached())continue;if(h.overlayElement.contains(s)||h.overlayElement.contains(a))break;const u=h._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>u.next(o)):u.next(o)}}}add(i){if(super.add(i),!this._isAttached){const n=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(n)):this._addEventListeners(n),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=n.style.cursor,n.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}}return e.\u0275fac=function(i){return new(i||e)(he(_i),he(Qr),he(Pt,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),PQ=(()=>{class e{constructor(i,n){this._platform=n,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||vQ()){const r=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let o=0;o<r.length;o++)r[o].remove()}const n=this._document.createElement("div");n.classList.add(i),vQ()?n.setAttribute("platform","test"):this._platform.isBrowser||n.setAttribute("platform","server"),this._document.body.appendChild(n),this._containerElement=n}}return e.\u0275fac=function(i){return new(i||e)(he(_i),he(Qr))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class ELe{constructor(t,i,n,r,o,s,a,l,c,h=!1){this._portalOutlet=t,this._host=i,this._pane=n,this._config=r,this._ngZone=o,this._keyboardDispatcher=s,this._document=a,this._location=l,this._outsideClickDispatcher=c,this._animationsDisabled=h,this._backdropElement=null,this._backdropClick=new He,this._attachments=new He,this._detachments=new He,this._locationChanges=Vi.EMPTY,this._backdropClickHandler=u=>this._backdropClick.next(u),this._backdropTransitionendHandler=u=>{this._disposeBackdrop(u.target)},this._keydownEvents=new He,this._outsidePointerEvents=new He,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Fr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=_r(this._config.width),t.height=_r(this._config.height),t.minWidth=_r(this._config.minWidth),t.minHeight=_r(this._config.minHeight),t.maxWidth=_r(this._config.maxWidth),t.maxHeight=_r(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,i,n){const r=_5(i||[]).filter(o=>!!o);r.length&&(n?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Ye(ts(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const IQ="cdk-overlay-connected-position-bounding-box",DLe=/([A-Za-z%]+)$/;class ALe{get positions(){return this._preferredPositions}constructor(t,i,n,r,o){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=o,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new He,this._resizeSubscription=Vi.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(IQ),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,i=this._overlayRect,n=this._viewportRect,r=this._containerRect,o=[];let s;for(let a of this._preferredPositions){let l=this._getOriginPoint(t,r,a),c=this._getOverlayPoint(l,i,a),h=this._getOverlayFit(c,i,n,a);if(h.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(a,l);this._canFitWithFlexibleDimensions(h,c,n)?o.push({position:a,origin:l,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(l,a)}):(!s||s.overlayFit.visibleArea<h.visibleArea)&&(s={overlayFit:h,overlayPoint:c,originPoint:l,position:a,overlayRect:i})}if(o.length){let a=null,l=-1;for(const c of o){const h=c.boundingBoxRect.width*c.boundingBoxRect.height*(c.position.weight||1);h>l&&(l=h,a=c)}return this._isPushed=!1,void this._applyPosition(a.position,a.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(s.position,s.originPoint);this._applyPosition(s.position,s.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&O1(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(IQ),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,i)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,i,n){let r,o;if("center"==n.originX)r=t.left+t.width/2;else{const s=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;r="start"==n.originX?s:a}return i.left<0&&(r-=i.left),o="center"==n.originY?t.top+t.height/2:"top"==n.originY?t.top:t.bottom,i.top<0&&(o-=i.top),{x:r,y:o}}_getOverlayPoint(t,i,n){let r,o;return r="center"==n.overlayX?-i.width/2:"start"===n.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,o="center"==n.overlayY?-i.height/2:"top"==n.overlayY?0:-i.height,{x:t.x+r,y:t.y+o}}_getOverlayFit(t,i,n,r){const o=kQ(i);let{x:s,y:a}=t,l=this._getOffset(r,"x"),c=this._getOffset(r,"y");l&&(s+=l),c&&(a+=c);let d=0-a,p=a+o.height-n.height,f=this._subtractOverflows(o.width,0-s,s+o.width-n.width),m=this._subtractOverflows(o.height,d,p),g=f*m;return{visibleArea:g,isCompletelyWithinViewport:o.width*o.height===g,fitsInViewportVertically:m===o.height,fitsInViewportHorizontally:f==o.width}}_canFitWithFlexibleDimensions(t,i,n){if(this._hasFlexibleDimensions){const r=n.bottom-i.y,o=n.right-i.x,s=OQ(this._overlayRef.getConfig().minHeight),a=OQ(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=s&&s<=r)&&(t.fitsInViewportHorizontally||null!=a&&a<=o)}return!1}_pushOverlayOnScreen(t,i,n){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=kQ(i),o=this._viewportRect,s=Math.max(t.x+r.width-o.width,0),a=Math.max(t.y+r.height-o.height,0),l=Math.max(o.top-n.top-t.y,0),c=Math.max(o.left-n.left-t.x,0);let h=0,u=0;return h=r.width<=o.width?c||-s:t.x<this._viewportMargin?o.left-n.left-t.x:0,u=r.height<=o.height?l||-a:t.y<this._viewportMargin?o.top-n.top-t.y:0,this._previousPushAmount={x:h,y:u},{x:t.x+h,y:t.y+u}}_applyPosition(t,i){if(this._setTransformOrigin(t),this._setOverlayElementStyles(i,t),this._setBoundingBoxStyles(i,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const n=this._getScrollVisibility(),r=new MLe(t,n);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=t.overlayY;n="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let o=0;o<i.length;o++)i[o].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(t,i){const n=this._viewportRect,r=this._isRtl();let o,s,a,h,u,d;if("top"===i.overlayY)s=t.y,o=n.height-s+this._viewportMargin;else if("bottom"===i.overlayY)a=n.height-t.y+2*this._viewportMargin,o=n.height-a+this._viewportMargin;else{const p=Math.min(n.bottom-t.y+n.top,t.y),f=this._lastBoundingBoxSize.height;o=2*p,s=t.y-p,o>f&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-f/2)}if("end"===i.overlayX&&!r||"start"===i.overlayX&&r)d=n.width-t.x+this._viewportMargin,h=t.x-this._viewportMargin;else if("start"===i.overlayX&&!r||"end"===i.overlayX&&r)u=t.x,h=n.right-t.x;else{const p=Math.min(n.right-t.x+n.left,t.x),f=this._lastBoundingBoxSize.width;h=2*p,u=t.x-p,h>f&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.x-f/2)}return{top:s,left:u,bottom:a,right:d,width:h,height:o}}_setBoundingBoxStyles(t,i){const n=this._calculateBoundingBoxRect(t,i);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const o=this._overlayRef.getConfig().maxHeight,s=this._overlayRef.getConfig().maxWidth;r.height=_r(n.height),r.top=_r(n.top),r.bottom=_r(n.bottom),r.width=_r(n.width),r.left=_r(n.left),r.right=_r(n.right),r.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",r.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",o&&(r.maxHeight=_r(o)),s&&(r.maxWidth=_r(s))}this._lastBoundingBoxSize=n,O1(this._boundingBox.style,r)}_resetBoundingBoxStyles(){O1(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){O1(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,i){const n={},r=this._hasExactPosition(),o=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(r){const h=this._viewportRuler.getViewportScrollPosition();O1(n,this._getExactOverlayY(i,t,h)),O1(n,this._getExactOverlayX(i,t,h))}else n.position="static";let a="",l=this._getOffset(i,"x"),c=this._getOffset(i,"y");l&&(a+=`translateX(${l}px) `),c&&(a+=`translateY(${c}px)`),n.transform=a.trim(),s.maxHeight&&(r?n.maxHeight=_r(s.maxHeight):o&&(n.maxHeight="")),s.maxWidth&&(r?n.maxWidth=_r(s.maxWidth):o&&(n.maxWidth="")),O1(this._pane.style,n)}_getExactOverlayY(t,i,n){let r={top:"",bottom:""},o=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,n)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(o.y+this._overlayRect.height)+"px":r.top=_r(o.y),r}_getExactOverlayX(t,i,n){let s,r={left:"",right:""},o=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,n)),s=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===s?r.right=this._document.documentElement.clientWidth-(o.x+this._overlayRect.width)+"px":r.left=_r(o.x),r}_getScrollVisibility(){const t=this._getOriginRect(),i=this._pane.getBoundingClientRect(),n=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:DQ(t,n),isOriginOutsideView:qT(t,n),isOverlayClipped:DQ(i,n),isOverlayOutsideView:qT(i,n)}}_subtractOverflows(t,...i){return i.reduce((n,r)=>n-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+t-this._viewportMargin,bottom:n.top+i-this._viewportMargin,width:t-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,i){return"x"===i?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&_5(t).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof yt)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const i=t.width||0,n=t.height||0;return{top:t.y,bottom:t.y+n,left:t.x,right:t.x+i,height:n,width:i}}}function O1(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function OQ(e){if("number"!=typeof e&&null!=e){const[t,i]=e.split(DLe);return i&&"px"!==i?null:parseFloat(t)}return e||null}function kQ(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const NQ="cdk-global-overlay-wrapper";class PLe{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const i=t.getConfig();this._overlayRef=t,this._width&&!i.width&&t.updateSize({width:this._width}),this._height&&!i.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(NQ),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:r,height:o,maxWidth:s,maxHeight:a}=n,l=!("100%"!==r&&"100vw"!==r||s&&"100%"!==s&&"100vw"!==s),c=!("100%"!==o&&"100vh"!==o||a&&"100%"!==a&&"100vh"!==a),h=this._xPosition,u=this._xOffset,d="rtl"===this._overlayRef.getConfig().direction;let p="",f="",m="";l?m="flex-start":"center"===h?(m="center",d?f=u:p=u):d?"left"===h||"end"===h?(m="flex-end",p=u):("right"===h||"start"===h)&&(m="flex-start",f=u):"left"===h||"start"===h?(m="flex-start",p=u):("right"===h||"end"===h)&&(m="flex-end",f=u),t.position=this._cssPosition,t.marginLeft=l?"0":p,t.marginTop=c?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=l?"0":f,i.justifyContent=m,i.alignItems=c?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,n=i.style;i.classList.remove(NQ),n.justifyContent=n.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let ILe=(()=>{class e{constructor(i,n,r,o){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=o}global(){return new PLe}flexibleConnectedTo(i){return new ALe(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return e.\u0275fac=function(i){return new(i||e)(he(z5),he(_i),he(Qr),he(PQ))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),OLe=0,k0=(()=>{class e{constructor(i,n,r,o,s,a,l,c,h,u,d,p){this.scrollStrategies=i,this._overlayContainer=n,this._componentFactoryResolver=r,this._positionBuilder=o,this._keyboardDispatcher=s,this._injector=a,this._ngZone=l,this._document=c,this._directionality=h,this._location=u,this._outsideClickDispatcher=d,this._animationsModuleType=p}create(i){const n=this._createHostElement(),r=this._createPaneElement(n),o=this._createPortalOutlet(r),s=new XT(i);return s.direction=s.direction||this._directionality.value,new ELe(o,n,r,s,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const n=this._document.createElement("div");return n.id="cdk-overlay-"+OLe++,n.classList.add("cdk-overlay-pane"),i.appendChild(n),n}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(Sp)),new oLe(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return e.\u0275fac=function(i){return new(i||e)(he(SLe),he(PQ),he(Lc),he(ILe),he(zLe),he(Bo),he(Pt),he(_i),he(Vn),he(kg),he(TLe),he(Am,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const kLe=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],LQ=new Fe("cdk-connected-overlay-scroll-strategy");let N0=(()=>{class e{constructor(i){this.elementRef=i}}return e.\u0275fac=function(i){return new(i||e)(L(yt))},e.\u0275dir=Ge({type:e,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0}),e})(),u3=(()=>{class e{get offsetX(){return this._offsetX}set offsetX(i){this._offsetX=i,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(i){this._offsetY=i,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(i){this._hasBackdrop=D1(i)}get lockPosition(){return this._lockPosition}set lockPosition(i){this._lockPosition=D1(i)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(i){this._flexibleDimensions=D1(i)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(i){this._growAfterOpen=D1(i)}get push(){return this._push}set push(i){this._push=D1(i)}constructor(i,n,r,o,s){this._overlay=i,this._dir=s,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=Vi.EMPTY,this._attachSubscription=Vi.EMPTY,this._detachSubscription=Vi.EMPTY,this._positionSubscription=Vi.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Re,this.positionChange=new Re,this.attach=new Re,this.detach=new Re,this.overlayKeydown=new Re,this.overlayOutsideClick=new Re,this._templatePortal=new c3(n,r),this._scrollStrategyFactory=o,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(i){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),i.origin&&this.open&&this._position.apply()),i.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=kLe);const i=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=i.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=i.detachments().subscribe(()=>this.detach.emit()),i.keydownEvents().subscribe(n=>{this.overlayKeydown.next(n),27===n.keyCode&&!this.disableClose&&!function A5(e,...t){return t.length?t.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(n)&&(n.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(n=>{this.overlayOutsideClick.next(n)})}_buildConfig(){const i=this._position=this.positionStrategy||this._createPositionStrategy(),n=new XT({direction:this._dir,positionStrategy:i,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(n.width=this.width),(this.height||0===this.height)&&(n.height=this.height),(this.minWidth||0===this.minWidth)&&(n.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(n.minHeight=this.minHeight),this.backdropClass&&(n.backdropClass=this.backdropClass),this.panelClass&&(n.panelClass=this.panelClass),n}_updatePositionStrategy(i){const n=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return i.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(n).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const i=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(i),i}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof N0?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(i=>{this.backdropClick.emit(i)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(WN(()=>this.positionChange.observers.length>0)).subscribe(i=>{this.positionChange.emit(i),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return e.\u0275fac=function(i){return new(i||e)(L(k0),L(Tn),L($n),L(LQ),L(Vn,8))},e.\u0275dir=Ge({type:e,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[Ht]}),e})();const LLe={provide:LQ,deps:[k0],useFactory:function NLe(e){return()=>e.scrollStrategies.reposition()}};let Xu=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:[k0,LLe],imports:[un,GT,UT,UT]}),e})();function RQ(e){return rn((t,i)=>e<=i)}let BQ=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();const VQ=new Set;let L0,$T=(()=>{class e{constructor(i){this._platform=i,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):FLe}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&function RLe(e){if(!VQ.has(e))try{L0||(L0=document.createElement("style"),L0.setAttribute("type","text/css"),document.head.appendChild(L0)),L0.sheet&&(L0.sheet.insertRule(`@media ${e} {body{ }}`,0),VQ.add(e))}catch(t){console.error(t)}}(i),this._matchMedia(i)}}return e.\u0275fac=function(i){return new(i||e)(he(Qr))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function FLe(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let BLe=(()=>{class e{constructor(i,n){this._mediaMatcher=i,this._zone=n,this._queries=new Map,this._destroySubject=new He}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return HQ(_5(i)).some(r=>this._registerQuery(r).mql.matches)}observe(i){let o=Yc(HQ(_5(i)).map(s=>this._registerQuery(s).observable));return o=wd(o.pipe(Fr(1)),o.pipe(RQ(1),function FQ(e,t=C5){return Mn((i,n)=>{let r=null,o=null,s=null;const a=()=>{if(r){r.unsubscribe(),r=null;const c=o;o=null,n.next(c)}};function l(){const c=s+e,h=t.now();if(h<c)return r=this.schedule(void 0,c-h),void n.add(r);a()}i.subscribe($i(n,c=>{o=c,s=t.now(),r||(r=t.schedule(l,e),n.add(r))},()=>{a(),n.complete()},void 0,()=>{o=r=null}))})}(0))),o.pipe(bt(s=>{const a={matches:!1,breakpoints:{}};return s.forEach(({matches:l,query:c})=>{a.matches=a.matches||l,a.breakpoints[c]=l}),a}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);const n=this._mediaMatcher.matchMedia(i),o={observable:new Li(s=>{const a=l=>this._zone.run(()=>s.next(l));return n.addListener(a),()=>{n.removeListener(a)}}).pipe(Ho(n),bt(({matches:s})=>({query:i,matches:s})),Ye(this._destroySubject)),mql:n};return this._queries.set(i,o),o}}return e.\u0275fac=function(i){return new(i||e)(he($T),he(Pt))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function HQ(e){return e.map(t=>t.split(",")).reduce((t,i)=>t.concat(i)).map(t=>t.trim())}const QT=()=>{};let ZT=(()=>{class e{constructor(i,n){this.ngZone=i,this.rendererFactory2=n,this.resizeSource$=new He,this.listeners=0,this.disposeHandle=QT,this.handler=()=>{this.ngZone.run(()=>{this.resizeSource$.next()})},this.renderer=this.rendererFactory2.createRenderer(null,null)}ngOnDestroy(){this.handler=QT}subscribe(){return this.registerListener(),this.resizeSource$.pipe(A1(16),Hm(()=>this.unregisterListener()))}unsubscribe(){this.unregisterListener()}registerListener(){0===this.listeners&&this.ngZone.runOutsideAngular(()=>{this.disposeHandle=this.renderer.listen("window","resize",this.handler)}),this.listeners+=1}unregisterListener(){this.listeners-=1,0===this.listeners&&(this.disposeHandle(),this.disposeHandle=QT)}}return e.\u0275fac=function(i){return new(i||e)(he(Pt),he(Xh))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const VLe=new Map;let HLe=(()=>{class e{constructor(){this._singletonRegistry=new Map}get singletonRegistry(){return Jq.isTestMode?VLe:this._singletonRegistry}registerSingletonWithKey(i,n){const r=this.singletonRegistry.has(i),o=r?this.singletonRegistry.get(i):this.withNewTarget(n);r||this.singletonRegistry.set(i,o)}getSingletonWithKey(i){return this.singletonRegistry.has(i)?this.singletonRegistry.get(i).target:null}withNewTarget(i){return{target:i}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var P5=(()=>(function(e){e.xxl="xxl",e.xl="xl",e.lg="lg",e.md="md",e.sm="sm",e.xs="xs"}(P5||(P5={})),P5))();const I5={xs:"(max-width: 575px)",sm:"(min-width: 576px)",md:"(min-width: 768px)",lg:"(min-width: 992px)",xl:"(min-width: 1200px)",xxl:"(min-width: 1600px)"},ULe={xs:"(max-width: 479.98px)",sm:"(max-width: 575.98px)",md:"(max-width: 767.98px)",lg:"(max-width: 991.98px)",xl:"(max-width: 1199.98px)",xxl:"(max-width: 1599.98px)"};let UQ=(()=>{class e{constructor(i,n){this.resizeService=i,this.mediaMatcher=n,this.destroy$=new He,this.resizeService.subscribe().pipe(Ye(this.destroy$)).subscribe(()=>{})}ngOnDestroy(){this.destroy$.next()}subscribe(i,n){if(n){const r=()=>this.matchMedia(i,!0);return this.resizeService.subscribe().pipe(bt(r),Ho(r()),Sl((o,s)=>o[0]===s[0]),bt(o=>o[1]))}{const r=()=>this.matchMedia(i);return this.resizeService.subscribe().pipe(bt(r),Ho(r()),Sl())}}matchMedia(i,n){let r=P5.md;const o={};return Object.keys(i).map(s=>{const a=s,l=this.mediaMatcher.matchMedia(I5[a]).matches;o[s]=l,l&&(r=a)}),n?[r,o]:r}}return e.\u0275fac=function(i){return new(i||e)(he(ZT),he($T))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ba=(()=>{class e extends He{ngOnDestroy(){this.next(),this.complete()}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=lr(e)))(n||e)}}(),e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();function xc(e){return typeof e<"u"&&null!==e}function jQ(e){return D1(e)}function O5(e){return _r(e)}function KT(e,t){return function i(n,r,o){const s=`$$__zorroPropDecorator__${r}`;return Object.prototype.hasOwnProperty.call(n,s)&&Y4(`The prop "${s}" is already exist, it will be overrided by ${e} decorator.`),Object.defineProperty(n,s,{configurable:!0,writable:!0}),{get(){return o&&o.get?o.get.bind(this)():this[s]},set(a){o&&o.set&&o.set.bind(this)(t(a)),this[s]=t(a)}}}}function ft(){return KT("InputBoolean",jQ)}function JT(e){return KT("InputNumber",t=>function jLe(e,t=0){return uQ(e)?Number(e):t}(t,e))}typeof window<"u"&&window;const QLe=1,eE=3,ZLe=8;let dn;const tE={padding:"0",margin:"0",display:"inline",lineHeight:"inherit"};function iE(e){if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0}function eRe(e,t,i,n,r,o=""){dn||(dn=document.createElement("div"),dn.setAttribute("aria-hidden","true"),document.body.appendChild(dn));const s=window.getComputedStyle(e),a=function KLe(e){return Array.prototype.slice.apply(e).map(i=>`${i}: ${e.getPropertyValue(i)};`).join("")}(s),l=iE(s.lineHeight),c=Math.round(l*(t+1)+iE(s.paddingTop)+iE(s.paddingBottom));dn.setAttribute("style",a),dn.style.position="fixed",dn.style.left="0",dn.style.height="auto",dn.style.minHeight="auto",dn.style.maxHeight="auto",dn.style.top="-999999px",dn.style.zIndex="-1000",dn.style.textOverflow="clip",dn.style.whiteSpace="normal",dn.style.webkitLineClamp="none";const h=function JLe(e){const t=[];return e.forEach(i=>{const n=t[t.length-1];n&&i.nodeType===eE&&n.nodeType===eE?n.data+=i.data:t.push(i)}),t}(i),u=document.createElement("div"),d=document.createElement("span"),p=document.createTextNode(o),f=document.createElement("span");function m(){return dn.offsetHeight<c}if(Object.assign(u.style,tE),Object.assign(d.style,tE),Object.assign(f.style,tE),h.forEach(M=>{d.appendChild(M)}),d.appendChild(p),n.forEach(M=>{f.appendChild(M.cloneNode(!0))}),u.appendChild(d),u.appendChild(f),dn.appendChild(u),m()){const M=dn.innerHTML;return dn.removeChild(u),{contentNodes:i,text:M,ellipsis:!1}}const g=Array.prototype.slice.apply(dn.childNodes[0].childNodes[0].cloneNode(!0).childNodes).filter(({nodeType:M})=>M!==ZLe),v=Array.prototype.slice.apply(dn.childNodes[0].childNodes[1].cloneNode(!0).childNodes);dn.removeChild(u),dn.innerHTML="";const y=document.createElement("span");dn.appendChild(y);const _=document.createTextNode(r+o);function x(M,z,E=0,D=z.length,P=0){const I=Math.floor((E+D)/2);if(M.textContent=z.slice(0,I),E>=D-1)for(let B=D;B>=E;B-=1){const V=z.slice(0,B);if(M.textContent=V,m()||!V)return B===z.length?{finished:!1,node:document.createTextNode(z)}:{finished:!0,node:document.createTextNode(V)}}return m()?x(M,z,I,D,I):x(M,z,E,I,P)}function w(M,z){const E=M.nodeType;if(E===QLe)return m()?{finished:!1,node:h[z]}:(y.removeChild(M),{finished:!0,node:null});if(E===eE){const D=M.textContent||"",P=document.createTextNode(D);return function b(M){y.insertBefore(M,_)}(P),x(P,D)}return{finished:!1,node:null}}y.appendChild(_),v.forEach(M=>{dn.appendChild(M)});const S=[];g.some((M,z)=>{const{finished:E,node:D}=w(M,z);return D&&S.push(D),E});const C={contentNodes:S,text:dn.innerHTML,ellipsis:!0};for(;dn.firstChild;)dn.removeChild(dn.firstChild);return C}function XQ(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}const nRe="rc-util-key";function $Q({mark:e}={}){return e?e.startsWith("data-")?e:`data-${e}`:nRe}function oE(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function QQ(e,t={}){if(!XQ())return null;const i=document.createElement("style");t.csp?.nonce&&(i.nonce=t.csp?.nonce),i.innerHTML=e;const n=oE(t),{firstChild:r}=n;return t.prepend&&n.prepend?n.prepend(i):t.prepend&&r?n.insertBefore(i,r):n.appendChild(i),i}const sE=new Map;function KQ(e,t,i){return{[`${e}-status-success`]:"success"===t,[`${e}-status-warning`]:"warning"===t,[`${e}-status-error`]:"error"===t,[`${e}-status-validating`]:"validating"===t,[`${e}-has-feedback`]:i}}const Pi={top:new Sn({originX:"center",originY:"top"},{overlayX:"center",overlayY:"bottom"}),topCenter:new Sn({originX:"center",originY:"top"},{overlayX:"center",overlayY:"bottom"}),topLeft:new Sn({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"}),topRight:new Sn({originX:"end",originY:"top"},{overlayX:"end",overlayY:"bottom"}),right:new Sn({originX:"end",originY:"center"},{overlayX:"start",overlayY:"center"}),rightTop:new Sn({originX:"end",originY:"top"},{overlayX:"start",overlayY:"top"}),rightBottom:new Sn({originX:"end",originY:"bottom"},{overlayX:"start",overlayY:"bottom"}),bottom:new Sn({originX:"center",originY:"bottom"},{overlayX:"center",overlayY:"top"}),bottomCenter:new Sn({originX:"center",originY:"bottom"},{overlayX:"center",overlayY:"top"}),bottomLeft:new Sn({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),bottomRight:new Sn({originX:"end",originY:"bottom"},{overlayX:"end",overlayY:"top"}),left:new Sn({originX:"start",originY:"center"},{overlayX:"end",overlayY:"center"}),leftTop:new Sn({originX:"start",originY:"top"},{overlayX:"end",overlayY:"top"}),leftBottom:new Sn({originX:"start",originY:"bottom"},{overlayX:"end",overlayY:"bottom"})},JQ=[Pi.top,Pi.right,Pi.bottom,Pi.left];function N5(e){for(const t in Pi)if(e.connectionPair.originX===Pi[t].originX&&e.connectionPair.originY===Pi[t].originY&&e.connectionPair.overlayX===Pi[t].overlayX&&e.connectionPair.overlayY===Pi[t].overlayY)return t}new Sn({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"bottom"}),new Sn({originX:"start",originY:"bottom"},{overlayX:"end",overlayY:"bottom"}),new Sn({originX:"start",originY:"bottom"},{overlayX:"end",overlayY:"top"}),new Sn({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"},void 0,2),new Sn({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"},void 0,-2),new Sn({originX:"end",originY:"bottom"},{overlayX:"end",overlayY:"top"},void 0,2),new Sn({originX:"end",originY:"top"},{overlayX:"end",overlayY:"bottom"},void 0,-2);let eZ=(()=>{class e{constructor(i,n){this.cdkConnectedOverlay=i,this.nzDestroyService=n,this.nzArrowPointAtCenter=!1,this.cdkConnectedOverlay.backdropClass="nz-overlay-transparent-backdrop",this.cdkConnectedOverlay.positionChange.pipe(Ye(this.nzDestroyService)).subscribe(r=>{this.nzArrowPointAtCenter&&this.updateArrowPosition(r)})}updateArrowPosition(i){const n=this.getOriginRect(),r=N5(i);let o=0,s=0;"topLeft"===r||"bottomLeft"===r?o=n.width/2-14:"topRight"===r||"bottomRight"===r?o=-(n.width/2-14):"leftTop"===r||"rightTop"===r?s=n.height/2-10:("leftBottom"===r||"rightBottom"===r)&&(s=-(n.height/2-10)),(this.cdkConnectedOverlay.offsetX!==o||this.cdkConnectedOverlay.offsetY!==s)&&(this.cdkConnectedOverlay.offsetY=s,this.cdkConnectedOverlay.offsetX=o,this.cdkConnectedOverlay.overlayRef.updatePosition())}getFlexibleConnectedPositionStrategyOrigin(){return this.cdkConnectedOverlay.origin instanceof N0?this.cdkConnectedOverlay.origin.elementRef:this.cdkConnectedOverlay.origin}getOriginRect(){const i=this.getFlexibleConnectedPositionStrategyOrigin();if(i instanceof yt)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();const n=i.width||0,r=i.height||0;return{top:i.y,bottom:i.y+r,left:i.x,right:i.x+n,height:r,width:n}}}return e.\u0275fac=function(i){return new(i||e)(L(u3),L(Ba))},e.\u0275dir=Ge({type:e,selectors:[["","cdkConnectedOverlay","","nzConnectedOverlay",""]],inputs:{nzArrowPointAtCenter:"nzArrowPointAtCenter"},exportAs:["nzConnectedOverlay"],features:[vi([Ba])]}),Qe([ft()],e.prototype,"nzArrowPointAtCenter",void 0),e})(),d3=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})();function Oo(e,t){(function oRe(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var i=function sRe(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function R5(e){return Math.min(1,Math.max(0,e))}function tZ(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function F5(e){return e<=1?"".concat(100*Number(e),"%"):e}function k1(e){return 1===e.length?"0"+e:String(e)}function iZ(e,t,i){e=Oo(e,255),t=Oo(t,255),i=Oo(i,255);var n=Math.max(e,t,i),r=Math.min(e,t,i),o=0,s=0,a=(n+r)/2;if(n===r)s=0,o=0;else{var l=n-r;switch(s=a>.5?l/(2-n-r):l/(n+r),n){case e:o=(t-i)/l+(t<i?6:0);break;case t:o=(i-e)/l+2;break;case i:o=(e-t)/l+4}o/=6}return{h:o,s,l:a}}function aE(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*i*(t-e):i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function lE(e,t,i){e=Oo(e,255),t=Oo(t,255),i=Oo(i,255);var n=Math.max(e,t,i),r=Math.min(e,t,i),o=0,s=n,a=n-r,l=0===n?0:a/n;if(n===r)o=0;else{switch(n){case e:o=(t-i)/a+(t<i?6:0);break;case t:o=(i-e)/a+2;break;case i:o=(e-t)/a+4}o/=6}return{h:o,s:l,v:s}}function cE(e,t,i,n){var r=[k1(Math.round(e).toString(16)),k1(Math.round(t).toString(16)),k1(Math.round(i).toString(16))];return n&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function nZ(e){return Math.round(255*parseFloat(e)).toString(16)}function rZ(e){return la(e)/255}function la(e){return parseInt(e,16)}var hE={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function R0(e){var t={r:0,g:0,b:0},i=1,n=null,r=null,o=null,s=!1,a=!1;return"string"==typeof e&&(e=function fRe(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(hE[e])e=hE[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var i=Ml.rgb.exec(e);return i?{r:i[1],g:i[2],b:i[3]}:(i=Ml.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=Ml.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=Ml.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=Ml.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=Ml.hsva.exec(e))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=Ml.hex8.exec(e))?{r:la(i[1]),g:la(i[2]),b:la(i[3]),a:rZ(i[4]),format:t?"name":"hex8"}:(i=Ml.hex6.exec(e))?{r:la(i[1]),g:la(i[2]),b:la(i[3]),format:t?"name":"hex"}:(i=Ml.hex4.exec(e))?{r:la(i[1]+i[1]),g:la(i[2]+i[2]),b:la(i[3]+i[3]),a:rZ(i[4]+i[4]),format:t?"name":"hex8"}:!!(i=Ml.hex3.exec(e))&&{r:la(i[1]+i[1]),g:la(i[2]+i[2]),b:la(i[3]+i[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(Fh(e.r)&&Fh(e.g)&&Fh(e.b)?(t=function aRe(e,t,i){return{r:255*Oo(e,255),g:255*Oo(t,255),b:255*Oo(i,255)}}(e.r,e.g,e.b),s=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):Fh(e.h)&&Fh(e.s)&&Fh(e.v)?(n=F5(e.s),r=F5(e.v),t=function cRe(e,t,i){e=6*Oo(e,360),t=Oo(t,100),i=Oo(i,100);var n=Math.floor(e),r=e-n,o=i*(1-t),s=i*(1-r*t),a=i*(1-(1-r)*t),l=n%6;return{r:255*[i,s,o,o,a,i][l],g:255*[a,i,i,s,o,o][l],b:255*[o,o,a,i,i,s][l]}}(e.h,n,r),s=!0,a="hsv"):Fh(e.h)&&Fh(e.s)&&Fh(e.l)&&(n=F5(e.s),o=F5(e.l),t=function lRe(e,t,i){var n,r,o;if(e=Oo(e,360),t=Oo(t,100),i=Oo(i,100),0===t)r=i,o=i,n=i;else{var s=i<.5?i*(1+t):i+t-i*t,a=2*i-s;n=aE(a,s,e+1/3),r=aE(a,s,e),o=aE(a,s,e-1/3)}return{r:255*n,g:255*r,b:255*o}}(e.h,n,o),s=!0,a="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(i=e.a)),i=tZ(i),{ok:s,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:i}}var $u="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),uE="[\\s|\\(]+(".concat($u,")[,|\\s]+(").concat($u,")[,|\\s]+(").concat($u,")\\s*\\)?"),dE="[\\s|\\(]+(".concat($u,")[,|\\s]+(").concat($u,")[,|\\s]+(").concat($u,")[,|\\s]+(").concat($u,")\\s*\\)?"),Ml={CSS_UNIT:new RegExp($u),rgb:new RegExp("rgb"+uE),rgba:new RegExp("rgba"+dE),hsl:new RegExp("hsl"+uE),hsla:new RegExp("hsla"+dE),hsv:new RegExp("hsv"+uE),hsva:new RegExp("hsva"+dE),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Fh(e){return Boolean(Ml.CSS_UNIT.exec(String(e)))}var Qu=function(){function e(t,i){var n;if(void 0===t&&(t=""),void 0===i&&(i={}),t instanceof e)return t;"number"==typeof t&&(t=function uRe(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var r=R0(t);this.originalInput=t,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(n=i.format)&&void 0!==n?n:r.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},e.prototype.getLuminance=function(){var t=this.toRgb(),o=t.r/255,s=t.g/255,a=t.b/255;return.2126*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(t){return this.a=tZ(t),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var t=lE(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}},e.prototype.toHsvString=function(){var t=lE(this.r,this.g,this.b),i=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1===this.a?"hsv(".concat(i,", ").concat(n,"%, ").concat(r,"%)"):"hsva(".concat(i,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var t=iZ(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}},e.prototype.toHslString=function(){var t=iZ(this.r,this.g,this.b),i=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1===this.a?"hsl(".concat(i,", ").concat(n,"%, ").concat(r,"%)"):"hsla(".concat(i,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(t){return void 0===t&&(t=!1),cE(this.r,this.g,this.b,t)},e.prototype.toHexString=function(t){return void 0===t&&(t=!1),"#"+this.toHex(t)},e.prototype.toHex8=function(t){return void 0===t&&(t=!1),function hRe(e,t,i,n,r){var o=[k1(Math.round(e).toString(16)),k1(Math.round(t).toString(16)),k1(Math.round(i).toString(16)),k1(nZ(n))];return r&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,t)},e.prototype.toHex8String=function(t){return void 0===t&&(t=!1),"#"+this.toHex8(t)},e.prototype.toHexShortString=function(t){return void 0===t&&(t=!1),1===this.a?this.toHexString(t):this.toHex8String(t)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var t=Math.round(this.r),i=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(t,", ").concat(i,", ").concat(n,")"):"rgba(".concat(t,", ").concat(i,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var t=function(i){return"".concat(Math.round(100*Oo(i,255)),"%")};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var t=function(i){return Math.round(100*Oo(i,255))};return 1===this.a?"rgb(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%)"):"rgba(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var t="#"+cE(this.r,this.g,this.b,!1),i=0,n=Object.entries(hE);i<n.length;i++){var r=n[i];if(t===r[1])return r[0]}return!1},e.prototype.toString=function(t){var i=Boolean(t);t=t??this.format;var n=!1;return!i&&this.a<1&&this.a>=0&&(t.startsWith("hex")||"name"===t)?"name"===t&&0===this.a?this.toName():this.toRgbString():("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),("hex"===t||"hex6"===t)&&(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString())},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l+=t/100,i.l=R5(i.l),new e(i)},e.prototype.brighten=function(t){void 0===t&&(t=10);var i=this.toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),new e(i)},e.prototype.darken=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l-=t/100,i.l=R5(i.l),new e(i)},e.prototype.tint=function(t){return void 0===t&&(t=10),this.mix("white",t)},e.prototype.shade=function(t){return void 0===t&&(t=10),this.mix("black",t)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s-=t/100,i.s=R5(i.s),new e(i)},e.prototype.saturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s+=t/100,i.s=R5(i.s),new e(i)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var i=this.toHsl(),n=(i.h+t)%360;return i.h=n<0?360+n:n,new e(i)},e.prototype.mix=function(t,i){void 0===i&&(i=50);var n=this.toRgb(),r=new e(t).toRgb(),o=i/100;return new e({r:(r.r-n.r)*o+n.r,g:(r.g-n.g)*o+n.g,b:(r.b-n.b)*o+n.b,a:(r.a-n.a)*o+n.a})},e.prototype.analogous=function(t,i){void 0===t&&(t=6),void 0===i&&(i=30);var n=this.toHsl(),r=360/i,o=[this];for(n.h=(n.h-(r*t>>1)+720)%360;--t;)n.h=(n.h+r)%360,o.push(new e(n));return o},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var i=this.toHsv(),n=i.h,r=i.s,o=i.v,s=[],a=1/t;t--;)s.push(new e({h:n,s:r,v:o})),o=(o+a)%1;return s},e.prototype.splitcomplement=function(){var t=this.toHsl(),i=t.h;return[this,new e({h:(i+72)%360,s:t.s,l:t.l}),new e({h:(i+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var i=this.toRgb(),n=new e(t).toRgb(),r=i.a+n.a*(1-i.a);return new e({r:(i.r*i.a+n.r*n.a*(1-i.a))/r,g:(i.g*i.a+n.g*n.a*(1-i.a))/r,b:(i.b*i.a+n.b*n.a*(1-i.a))/r,a:r})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var i=this.toHsl(),n=i.h,r=[this],o=360/t,s=1;s<t;s++)r.push(new e({h:(n+s*o)%360,s:i.s,l:i.l}));return r},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}(),B5=2,oZ=.16,mRe=.05,gRe=.05,vRe=.15,sZ=5,aZ=4,yRe=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function lZ(e,t,i){var n;return(n=Math.round(e.h)>=60&&Math.round(e.h)<=240?i?Math.round(e.h)-B5*t:Math.round(e.h)+B5*t:i?Math.round(e.h)+B5*t:Math.round(e.h)-B5*t)<0?n+=360:n>=360&&(n-=360),n}function cZ(e,t,i){return 0===e.h&&0===e.s?e.s:((n=i?e.s-oZ*t:t===aZ?e.s+oZ:e.s+mRe*t)>1&&(n=1),i&&t===sZ&&n>.1&&(n=.1),n<.06&&(n=.06),Number(n.toFixed(2)));var n}function hZ(e,t,i){var n;return(n=i?e.v+gRe*t:e.v-vRe*t)>1&&(n=1),Number(n.toFixed(2))}function pE(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[],n=new Qu(e),r=sZ;r>0;r-=1){var o=n.toHsv(),s=new Qu({h:lZ(o,r,!0),s:cZ(o,r,!0),v:hZ(o,r,!0)}).toHexString();i.push(s)}i.push(n.toHexString());for(var a=1;a<=aZ;a+=1){var l=n.toHsv(),c=new Qu({h:lZ(l,a),s:cZ(l,a),v:hZ(l,a)}).toHexString();i.push(c)}return"dark"===t.theme?yRe.map(function(h){var u=h.index,d=h.opacity;return new Qu(t.backgroundColor||"#141414").mix(i[u],100*d).toHexString()}):i}var fE={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Jo={},mE={};Object.keys(fE).forEach(function(e){Jo[e]=pE(fE[e]),Jo[e].primary=Jo[e][5],mE[e]=pE(fE[e],{theme:"dark",backgroundColor:"#141414"}),mE[e].primary=mE[e][5]});const Bh="[@ant-design/icons-angular]:";function dZ(e){return pE(e)[0]}function V5(e,t){switch(t){case"fill":return`${e}-fill`;case"outline":return`${e}-o`;case"twotone":return`${e}-twotone`;case void 0:return e;default:throw new Error(`${Bh}Theme "${t}" is not a recognized theme!`)}}function pZ(e){return"object"==typeof e&&"string"==typeof e.name&&("string"==typeof e.theme||void 0===e.theme)&&"string"==typeof e.icon}function H5(e){const t=e.split(":");switch(t.length){case 1:return[e,""];case 2:return[t[1],t[0]];default:throw new Error(`${Bh}The icon type ${e} is not valid!`)}}function fZ(e){return new Error(`${Bh}the icon ${e} does not exist or is not registered.`)}function ARe(){return new Error(`${Bh}<svg> tag not found.`)}const ORe=new Fe("ant_icons");let mZ=(()=>{class e{constructor(i,n,r,o,s){this._rendererFactory=i,this._handler=n,this._document=r,this.sanitizer=o,this._antIcons=s,this.defaultTheme="outline",this._svgDefinitions=new Map,this._svgRenderedDefinitions=new Map,this._inProgressFetches=new Map,this._assetsUrlRoot="",this._twoToneColorPalette={primaryColor:"#333333",secondaryColor:"#E6E6E6"},this._enableJsonpLoading=!1,this._jsonpIconLoad$=new He,this._renderer=this._rendererFactory.createRenderer(null,null),this._handler&&(this._http=new oT(this._handler)),this._antIcons&&this.addIcon(...this._antIcons)}set twoToneColor({primaryColor:i,secondaryColor:n}){this._twoToneColorPalette.primaryColor=i,this._twoToneColorPalette.secondaryColor=n||dZ(i)}get twoToneColor(){return{...this._twoToneColorPalette}}get _disableDynamicLoading(){return!1}useJsonpLoading(){this._enableJsonpLoading||(this._enableJsonpLoading=!0,window.__ant_icon_load=i=>{this._jsonpIconLoad$.next(i)})}changeAssetsSource(i){this._assetsUrlRoot=i.endsWith("/")?i:i+"/"}addIcon(...i){i.forEach(n=>{this._svgDefinitions.set(V5(n.name,n.theme),n)})}addIconLiteral(i,n){const[r,o]=H5(i);if(!o)throw function TRe(){return new Error(`${Bh}Type should have a namespace. Try "namespace:${name}".`)}();this.addIcon({name:i,icon:n})}clear(){this._svgDefinitions.clear(),this._svgRenderedDefinitions.clear()}getRenderedContent(i,n){const r=pZ(i)?i:this._svgDefinitions.get(i)||null;if(!r&&this._disableDynamicLoading)throw fZ(i);return(r?tt(r):this._loadIconDynamically(i)).pipe(bt(s=>{if(!s)throw fZ(i);return this._loadSVGFromCacheOrCreateNew(s,n)}))}getCachedIcons(){return this._svgDefinitions}_loadIconDynamically(i){if(!this._http&&!this._enableJsonpLoading)return tt(function ERe(){return function _Re(e){console.error(`${Bh} ${e}.`)}('you need to import "HttpClientModule" to use dynamic importing.'),null}());let n=this._inProgressFetches.get(i);if(!n){const[r,o]=H5(i),s=o?{name:i,icon:""}:function CRe(e){const t=e.split("-"),i=function xRe(e){return"o"===e?"outline":e}(t.splice(t.length-1,1)[0]);return{name:t.join("-"),theme:i,icon:""}}(r),l=(o?`${this._assetsUrlRoot}assets/${o}/${r}`:`${this._assetsUrlRoot}assets/${s.theme}/${s.name}`)+(this._enableJsonpLoading?".js":".svg"),c=this.sanitizer.sanitize(wn.URL,l);if(!c)throw function DRe(e){return new Error(`${Bh}The url "${e}" is unsafe.`)}(l);n=(this._enableJsonpLoading?this._loadIconDynamicallyWithJsonp(s,c):this._http.get(c,{responseType:"text"}).pipe(bt(u=>({...s,icon:u})))).pipe(Br(u=>this.addIcon(u)),Hm(()=>this._inProgressFetches.delete(i)),Fl(()=>tt(null)),c7()),this._inProgressFetches.set(i,n)}return n}_loadIconDynamicallyWithJsonp(i,n){return new Li(r=>{const o=this._document.createElement("script"),s=setTimeout(()=>{a(),r.error(function PRe(){return new Error(`${Bh}Importing timeout error.`)}())},6e3);function a(){o.parentNode.removeChild(o),clearTimeout(s)}o.src=n,this._document.body.appendChild(o),this._jsonpIconLoad$.pipe(rn(l=>l.name===i.name&&l.theme===i.theme),Fr(1)).subscribe(l=>{r.next(l),a()})})}_loadSVGFromCacheOrCreateNew(i,n){let r;const o=n||this._twoToneColorPalette.primaryColor,s=dZ(o)||this._twoToneColorPalette.secondaryColor,a="twotone"===i.theme?function bRe(e,t,i,n){return`${V5(e,t)}-${i}-${n}`}(i.name,i.theme,o,s):void 0===i.theme?i.name:V5(i.name,i.theme),l=this._svgRenderedDefinitions.get(a);return l?r=l.icon:(r=this._setSVGAttribute(this._colorizeSVGIcon(this._createSVGElementFromString(function zRe(e){return""!==H5(e)[1]}(i.name)?i.icon:function MRe(e){return e.replace(/['"]#333['"]/g,'"primaryColor"').replace(/['"]#E6E6E6['"]/g,'"secondaryColor"').replace(/['"]#D9D9D9['"]/g,'"secondaryColor"').replace(/['"]#D8D8D8['"]/g,'"secondaryColor"')}(i.icon)),"twotone"===i.theme,o,s)),this._svgRenderedDefinitions.set(a,{...i,icon:r})),function SRe(e){return e.cloneNode(!0)}(r)}_createSVGElementFromString(i){const n=this._document.createElement("div");n.innerHTML=i;const r=n.querySelector("svg");if(!r)throw ARe;return r}_setSVGAttribute(i){return this._renderer.setAttribute(i,"width","1em"),this._renderer.setAttribute(i,"height","1em"),i}_colorizeSVGIcon(i,n,r,o){if(n){const s=i.childNodes,a=s.length;for(let l=0;l<a;l++){const c=s[l];"secondaryColor"===c.getAttribute("fill")?this._renderer.setAttribute(c,"fill",o):this._renderer.setAttribute(c,"fill",r)}}return this._renderer.setAttribute(i,"fill","currentColor"),i}}return e.\u0275fac=function(i){return new(i||e)(he(Xh),he(Q4,8),he(_i,8),he(Zg),he(ORe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),NRe=(()=>{class e{constructor(i,n,r){this._iconService=i,this._elementRef=n,this._renderer=r}ngOnChanges(i){(i.type||i.theme||i.twoToneColor)&&this._changeIcon()}_changeIcon(){return new Promise(i=>{if(!this.type)return this._clearSVGElement(),void i(null);const n=this._getSelfRenderMeta();this._iconService.getRenderedContent(this._parseIconType(this.type,this.theme),this.twoToneColor).subscribe(r=>{const o=this._getSelfRenderMeta();!function kRe(e,t){return e.type===t.type&&e.theme===t.theme&&e.twoToneColor===t.twoToneColor}(n,o)?i(null):(this._setSVGElement(r),i(r))})})}_getSelfRenderMeta(){return{type:this.type,theme:this.theme,twoToneColor:this.twoToneColor}}_parseIconType(i,n){if(pZ(i))return i;{const[r,o]=H5(i);return o?i:function wRe(e){return e.endsWith("-fill")||e.endsWith("-o")||e.endsWith("-twotone")}(r)?r:V5(r,n||this._iconService.defaultTheme)}}_setSVGElement(i){this._clearSVGElement(),this._renderer.appendChild(this._elementRef.nativeElement,i)}_clearSVGElement(){const i=this._elementRef.nativeElement,n=i.childNodes;for(let o=n.length-1;o>=0;o--){const s=n[o];"svg"===s.tagName?.toLowerCase()&&this._renderer.removeChild(i,s)}}}return e.\u0275fac=function(i){return new(i||e)(L(mZ),L(yt),L(Nn))},e.\u0275dir=Ge({type:e,selectors:[["","antIcon",""]],inputs:{type:"type",theme:"theme",twoToneColor:"twoToneColor"},features:[Ht]}),e})();const gZ={name:"star",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z" /></svg>'},DFe=["pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"],U5=2,vZ=.16,PFe=.05,IFe=.05,OFe=.15,yZ=5,_Z=4,kFe=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function bZ({r:e,g:t,b:i}){const n=lE(e,t,i);return{h:360*n.h,s:n.s,v:n.v}}function j5({r:e,g:t,b:i}){return`#${cE(e,t,i,!1)}`}function xZ(e,t,i){let n;return n=Math.round(e.h)>=60&&Math.round(e.h)<=240?i?Math.round(e.h)-U5*t:Math.round(e.h)+U5*t:i?Math.round(e.h)+U5*t:Math.round(e.h)-U5*t,n<0?n+=360:n>=360&&(n-=360),n}function wZ(e,t,i){if(0===e.h&&0===e.s)return e.s;let n;return n=i?e.s-vZ*t:t===_Z?e.s+vZ:e.s+PFe*t,n>1&&(n=1),i&&t===yZ&&n>.1&&(n=.1),n<.06&&(n=.06),Number(n.toFixed(2))}function CZ(e,t,i){let n;return n=i?e.v+IFe*t:e.v-OFe*t,n>1&&(n=1),Number(n.toFixed(2))}function SZ(e,t={}){const i=[],n=R0(e);for(let r=yZ;r>0;r-=1){const o=bZ(n),s=j5(R0({h:xZ(o,r,!0),s:wZ(o,r,!0),v:CZ(o,r,!0)}));i.push(s)}i.push(j5(n));for(let r=1;r<=_Z;r+=1){const o=bZ(n),s=j5(R0({h:xZ(o,r),s:wZ(o,r),v:CZ(o,r)}));i.push(s)}return"dark"===t.theme?kFe.map(({index:r,opacity:o})=>j5(function NFe(e,t,i){const n=i/100;return{r:(t.r-e.r)*n+e.r,g:(t.g-e.g)*n+e.g,b:(t.b-e.b)*n+e.b}}(R0(t.backgroundColor||"#141414"),R0(i[r]),100*o))):i}const LFe=new Fe("nz-config"),RFe=`-ant-${Date.now()}-${Math.random()}`;function MZ(e,t){const i=function FFe(e,t){const i={},n=(s,a)=>{let l=s.clone();return l=a?.(l)||l,l.toRgbString()},r=(s,a)=>{const l=new Qu(s),c=SZ(l.toRgbString());i[`${a}-color`]=n(l),i[`${a}-color-disabled`]=c[1],i[`${a}-color-hover`]=c[4],i[`${a}-color-active`]=c[7],i[`${a}-color-outline`]=l.clone().setAlpha(.2).toRgbString(),i[`${a}-color-deprecated-bg`]=c[1],i[`${a}-color-deprecated-border`]=c[3]};if(t.primaryColor){r(t.primaryColor,"primary");const s=new Qu(t.primaryColor),a=SZ(s.toRgbString());a.forEach((c,h)=>{i[`primary-${h+1}`]=c}),i["primary-color-deprecated-l-35"]=n(s,c=>c.lighten(35)),i["primary-color-deprecated-l-20"]=n(s,c=>c.lighten(20)),i["primary-color-deprecated-t-20"]=n(s,c=>c.tint(20)),i["primary-color-deprecated-t-50"]=n(s,c=>c.tint(50)),i["primary-color-deprecated-f-12"]=n(s,c=>c.setAlpha(.12*c.getAlpha()));const l=new Qu(a[0]);i["primary-color-active-deprecated-f-30"]=n(l,c=>c.setAlpha(.3*c.getAlpha())),i["primary-color-active-deprecated-d-02"]=n(l,c=>c.darken(2))}return t.successColor&&r(t.successColor,"success"),t.warningColor&&r(t.warningColor,"warning"),t.errorColor&&r(t.errorColor,"error"),t.infoColor&&r(t.infoColor,"info"),`\n  :root {\n    ${Object.keys(i).map(s=>`--${e}-${s}: ${i[s]};`).join("\n")}\n  }\n  `.trim()}(e,t);XQ()?function rRe(e,t,i={}){const n=oE(i);if(!sE.has(n)){const s=QQ("",i),{parentNode:a}=s;sE.set(n,a),a.removeChild(s)}const r=function ZQ(e,t={}){const i=oE(t);return Array.from(sE.get(i)?.children||[]).find(n=>"STYLE"===n.tagName&&n.getAttribute($Q(t))===e)}(t,i);if(r)return i.csp?.nonce&&r.nonce!==i.csp?.nonce&&(r.nonce=i.csp?.nonce),r.innerHTML!==e&&(r.innerHTML=e),r;const o=QQ(e,i);o?.setAttribute($Q(i),t)}(i,`${RFe}-dynamic-theme`):Y4("NzConfigService: SSR do not support dynamic theme with css variables.")}const zZ=function(e){return void 0!==e};let Va=(()=>{class e{constructor(i){this.configUpdated$=new He,this.config=i||{},this.config.theme&&MZ(this.getConfig().prefixCls?.prefixCls||"ant",this.config.theme)}getConfig(){return this.config}getConfigForComponent(i){return this.config[i]}getConfigChangeEventForComponent(i){return this.configUpdated$.pipe(rn(n=>n===i),Cd(void 0))}set(i,n){this.config[i]={...this.config[i],...n},"theme"===i&&this.config.theme&&MZ(this.getConfig().prefixCls?.prefixCls||"ant",this.config.theme),this.configUpdated$.next(i)}}return e.\u0275fac=function(i){return new(i||e)(he(LFe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function mo(){return function(t,i,n){const r=`$$__zorroConfigDecorator__${i}`;return Object.defineProperty(t,r,{configurable:!0,writable:!0,enumerable:!1}),{get(){const o=n?.get?n.get.bind(this)():this[r],s=(this.propertyAssignCounter?.[i]||0)>1,a=this.nzConfigService.getConfigForComponent(this._nzModuleName)?.[i];return s&&zZ(o)?o:zZ(a)?a:o},set(o){this.propertyAssignCounter=this.propertyAssignCounter||{},this.propertyAssignCounter[i]=(this.propertyAssignCounter[i]||0)+1,n?.set?n.set.bind(this)(o):this[r]=o},configurable:!0,enumerable:!0}}}const BFe=[{name:"bars",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z" /></svg>'},{name:"calendar",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z" /></svg>'},{name:"caret-up",theme:"fill",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z" /></svg>'},{name:"caret-up",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z" /></svg>'},{name:"caret-down",theme:"fill",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z" /></svg>'},{name:"caret-down",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z" /></svg>'},{name:"check-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z" /></svg>'},{name:"check-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z" /><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /></svg>'},{name:"check",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z" /></svg>'},{name:"clock-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z" /></svg>'},{name:"close-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670a8.32 8.32 0 00-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4 66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z" /><path d="M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448 448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /></svg>'},{name:"close-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z" /></svg>'},{name:"close",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z" /></svg>'},{name:"copy",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z" /></svg>'},{name:"delete",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z" /></svg>'},{name:"double-left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z" /></svg>'},{name:"double-right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z" /></svg>'},{name:"down",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z" /></svg>'},{name:"edit",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z" /></svg>'},{name:"ellipsis",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z" /></svg>'},{name:"exclamation-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z" /></svg>'},{name:"exclamation-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z" /></svg>'},{name:"eye",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z" /></svg>'},{name:"file",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M854.6 288.7c6 6 9.4 14.1 9.4 22.6V928c0 17.7-14.3 32-32 32H192c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32h424.7c8.5 0 16.7 3.4 22.7 9.4l215.2 215.3zM790.2 326L602 137.8V326h188.2z" /></svg>'},{name:"file",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z" /></svg>'},{name:"filter",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M349 838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V642H349v196zm531.1-684H143.9c-24.5 0-39.8 26.7-27.5 48l221.3 376h348.8l221.3-376c12.1-21.3-3.2-48-27.7-48z" /></svg>'},{name:"info-circle",theme:"fill",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z" /></svg>'},{name:"info-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z" /></svg>'},{name:"left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z" /></svg>'},{name:"loading",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z" /></svg>'},{name:"paper-clip",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z" /></svg>'},{name:"question-circle",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" /><path d="M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0130.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1080 0 40 40 0 10-80 0z" /></svg>'},{name:"right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z" /></svg>'},{name:"rotate-right",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><defs><style /></defs><path d="M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z" /><path d="M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z" /></svg>'},{name:"rotate-left",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><defs><style /></defs><path d="M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z" /><path d="M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z" /></svg>'},gZ,{name:"search",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z" /></svg>'},gZ,{name:"upload",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z" /></svg>'},{name:"vertical-align-top",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z" /></svg>'},{name:"up",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z" /></svg>'},{name:"swap-right",theme:"outline",icon:'<svg viewBox="0 0 1024 1024" focusable="false"><path d="M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z" /></svg>'},{name:"zoom-in",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z" /></svg>'},{name:"zoom-out",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z" /></svg>'}],gE=new Fe("nz_icons"),EZ=(new Fe("nz_icon_default_twotone_color"),"#1890ff");let DZ=(()=>{class e extends mZ{constructor(i,n,r,o,s,a,l){super(i,s,a,n,[...BFe,...l||[]]),this.nzConfigService=r,this.platform=o,this.configUpdated$=new He,this.iconfontCache=new Set,this.subscription=null,this.onConfigChange(),this.configDefaultTwotoneColor(),this.configDefaultTheme()}get _disableDynamicLoading(){return!this.platform.isBrowser}ngOnDestroy(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}normalizeSvgElement(i){i.getAttribute("viewBox")||this._renderer.setAttribute(i,"viewBox","0 0 1024 1024"),(!i.getAttribute("width")||!i.getAttribute("height"))&&(this._renderer.setAttribute(i,"width","1em"),this._renderer.setAttribute(i,"height","1em")),i.getAttribute("fill")||this._renderer.setAttribute(i,"fill","currentColor")}fetchFromIconfont(i){const{scriptUrl:n}=i;if(this._document&&!this.iconfontCache.has(n)){const r=this._renderer.createElement("script");this._renderer.setAttribute(r,"src",n),this._renderer.setAttribute(r,"data-namespace",n.replace(/^(https?|http):/g,"")),this._renderer.appendChild(this._document.body,r),this.iconfontCache.add(n)}}createIconfontIcon(i){return this._createSVGElementFromString(`<svg><use xlink:href="${i}"></svg>`)}onConfigChange(){this.subscription=this.nzConfigService.getConfigChangeEventForComponent("icon").subscribe(()=>{this.configDefaultTwotoneColor(),this.configDefaultTheme(),this.configUpdated$.next()})}configDefaultTheme(){const i=this.getConfig();this.defaultTheme=i.nzTheme||"outline"}configDefaultTwotoneColor(){const n=this.getConfig().nzTwotoneColor||EZ;let r=EZ;n&&(n.startsWith("#")?r=n:Y4("Twotone color must be a hex color!")),this.twoToneColor={primaryColor:r}}getConfig(){return this.nzConfigService.getConfigForComponent("icon")||{}}}return e.\u0275fac=function(i){return new(i||e)(he(Xh),he(Zg),he(Va),he(Qr),he(Q4,8),he(_i,8),he(gE,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const AZ=new Fe("nz_icons_patch");let PZ=(()=>{class e{constructor(i,n){this.extraIcons=i,this.rootIconService=n,this.patched=!1}doPatch(){this.patched||(this.extraIcons.forEach(i=>this.rootIconService.addIcon(i)),this.patched=!0)}}return e.\u0275fac=function(i){return new(i||e)(he(AZ,2),he(DZ))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),ko=(()=>{class e extends NRe{constructor(i,n,r,o,s,a){super(o,r,s),this.ngZone=i,this.changeDetectorRef=n,this.iconService=o,this.renderer=s,this.cacheClassName=null,this.nzRotate=0,this.spin=!1,this.destroy$=new He,a&&a.doPatch(),this.el=r.nativeElement}set nzSpin(i){this.spin=i}set nzType(i){this.type=i}set nzTheme(i){this.theme=i}set nzTwotoneColor(i){this.twoToneColor=i}set nzIconfont(i){this.iconfont=i}ngOnChanges(i){const{nzType:n,nzTwotoneColor:r,nzSpin:o,nzTheme:s,nzRotate:a}=i;n||r||o||s?this.changeIcon2():a?this.handleRotate(this.el.firstChild):this._setSVGElement(this.iconService.createIconfontIcon(`#${this.iconfont}`))}ngOnInit(){this.renderer.setAttribute(this.el,"class",`anticon ${this.el.className}`.trim())}ngAfterContentChecked(){if(!this.type){const i=this.el.children;let n=i.length;if(!this.type&&i.length)for(;n--;){const r=i[n];"svg"===r.tagName.toLowerCase()&&this.iconService.normalizeSvgElement(r)}}}ngOnDestroy(){this.destroy$.next()}changeIcon2(){this.setClassName(),this.ngZone.runOutsideAngular(()=>{Wn(this._changeIcon()).pipe(Ye(this.destroy$)).subscribe({next:i=>{this.ngZone.run(()=>{this.changeDetectorRef.detectChanges(),i&&(this.setSVGData(i),this.handleSpin(i),this.handleRotate(i))})},error:Y4})})}handleSpin(i){this.spin||"loading"===this.type?this.renderer.addClass(i,"anticon-spin"):this.renderer.removeClass(i,"anticon-spin")}handleRotate(i){this.nzRotate?this.renderer.setAttribute(i,"style",`transform: rotate(${this.nzRotate}deg)`):this.renderer.removeAttribute(i,"style")}setClassName(){this.cacheClassName&&this.renderer.removeClass(this.el,this.cacheClassName),this.cacheClassName=`anticon-${this.type}`,this.renderer.addClass(this.el,this.cacheClassName)}setSVGData(i){this.renderer.setAttribute(i,"data-icon",this.type),this.renderer.setAttribute(i,"aria-hidden","true")}}return e.\u0275fac=function(i){return new(i||e)(L(Pt),L(Ri),L(yt),L(DZ),L(Nn),L(PZ,8))},e.\u0275dir=Ge({type:e,selectors:[["","nz-icon",""]],hostVars:2,hostBindings:function(i,n){2&i&&Dt("anticon",!0)},inputs:{nzSpin:"nzSpin",nzRotate:"nzRotate",nzType:"nzType",nzTheme:"nzTheme",nzTwotoneColor:"nzTwotoneColor",nzIconfont:"nzIconfont"},exportAs:["nzIcon"],features:[Ci,Ht]}),Qe([ft()],e.prototype,"nzSpin",null),e})(),go=(()=>{class e{static forRoot(i){return{ngModule:e,providers:[{provide:gE,useValue:i}]}}static forChild(i){return{ngModule:e,providers:[PZ,{provide:AZ,useValue:i}]}}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[Hs]}),e})();function VFe(e,t){1&e&&Je(0,"span",1),2&e&&X("nzType",de().iconType)}let IZ=(()=>{class e{constructor(){this.formStatusChanges=new Ny(1)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),OZ=(()=>{class e{constructor(){this.noFormStatus=new Yi(!1)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})();const HFe={error:"close-circle-fill",validating:"loading",success:"check-circle-fill",warning:"exclamation-circle-fill"};let kZ=(()=>{class e{constructor(i){this.cdr=i,this.status="",this.iconType=null}ngOnChanges(i){this.updateIcon()}updateIcon(){this.iconType=this.status?HFe[this.status]:null,this.cdr.markForCheck()}}return e.\u0275fac=function(i){return new(i||e)(L(Ri))},e.\u0275cmp=ut({type:e,selectors:[["nz-form-item-feedback-icon"]],hostAttrs:[1,"ant-form-item-feedback-icon"],hostVars:8,hostBindings:function(i,n){2&i&&Dt("ant-form-item-feedback-icon-error","error"===n.status)("ant-form-item-feedback-icon-warning","warning"===n.status)("ant-form-item-feedback-icon-success","success"===n.status)("ant-form-item-feedback-icon-validating","validating"===n.status)},inputs:{status:"status"},exportAs:["nzFormFeedbackIcon"],features:[Ht],decls:1,vars:1,consts:[["nz-icon","",3,"nzType",4,"ngIf"],["nz-icon","",3,"nzType"]],template:function(i,n){1&i&&ne(0,VFe,1,1,"span",0),2&i&&X("ngIf",n.iconType)},dependencies:[Fi,ko],encapsulation:2,changeDetection:0}),e})(),NZ=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ji,go]}),e})(),vo=(()=>{class e{constructor(i,n){this.viewContainer=i,this.templateRef=n,this.embeddedViewRef=null,this.context=new UFe,this.nzStringTemplateOutletContext=null,this.nzStringTemplateOutlet=null}static ngTemplateContextGuard(i,n){return!0}recreateView(){this.viewContainer.clear();const i=this.nzStringTemplateOutlet instanceof Tn;this.embeddedViewRef=this.viewContainer.createEmbeddedView(i?this.nzStringTemplateOutlet:this.templateRef,i?this.nzStringTemplateOutletContext:this.context)}updateContext(){const n=this.nzStringTemplateOutlet instanceof Tn?this.nzStringTemplateOutletContext:this.context,r=this.embeddedViewRef.context;if(n)for(const o of Object.keys(n))r[o]=n[o]}ngOnChanges(i){const{nzStringTemplateOutletContext:n,nzStringTemplateOutlet:r}=i;r&&(this.context.$implicit=r.currentValue),(()=>{let a=!1;return r&&(a=!!r.firstChange||(r.previousValue instanceof Tn||r.currentValue instanceof Tn)),n&&(h=>{const u=Object.keys(h.previousValue||{}),d=Object.keys(h.currentValue||{});if(u.length===d.length){for(const p of d)if(-1===u.indexOf(p))return!0;return!1}return!0})(n)||a})()?this.recreateView():this.updateContext()}}return e.\u0275fac=function(i){return new(i||e)(L($n),L(Tn))},e.\u0275dir=Ge({type:e,selectors:[["","nzStringTemplateOutlet",""]],inputs:{nzStringTemplateOutletContext:"nzStringTemplateOutletContext",nzStringTemplateOutlet:"nzStringTemplateOutlet"},exportAs:["nzStringTemplateOutlet"],features:[Ht]}),e})();class UFe{}let Zr=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ji]}),e})(),eBe=(()=>{class e{constructor(i,n,r,o,s,a,l){this.ngControl=i,this.renderer=n,this.elementRef=r,this.hostView=o,this.directionality=s,this.nzFormStatusService=a,this.nzFormNoStatusService=l,this.nzBorderless=!1,this.nzSize="default",this.nzStatus="",this._disabled=!1,this.disabled$=new He,this.dir="ltr",this.prefixCls="ant-input",this.status="",this.statusCls={},this.hasFeedback=!1,this.feedbackRef=null,this.components=[],this.destroy$=new He}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(i){this._disabled=null!=i&&"false"!=`${i}`}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe(Sl((i,n)=>i.status===n.status&&i.hasFeedback===n.hasFeedback),Ye(this.destroy$)).subscribe(({status:i,hasFeedback:n})=>{this.setStatusStyles(i,n)}),this.ngControl&&this.ngControl.statusChanges?.pipe(rn(()=>null!==this.ngControl.disabled),Ye(this.destroy$)).subscribe(()=>{this.disabled$.next(this.ngControl.disabled)}),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i})}ngOnChanges(i){const{disabled:n,nzStatus:r}=i;n&&this.disabled$.next(this.disabled),r&&this.setStatusStyles(this.nzStatus,this.hasFeedback)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setStatusStyles(i,n){this.status=i,this.hasFeedback=n,this.renderFeedbackIcon(),this.statusCls=KQ(this.prefixCls,i,n),Object.keys(this.statusCls).forEach(r=>{this.statusCls[r]?this.renderer.addClass(this.elementRef.nativeElement,r):this.renderer.removeClass(this.elementRef.nativeElement,r)})}renderFeedbackIcon(){if(!this.status||!this.hasFeedback||this.nzFormNoStatusService)return this.hostView.clear(),void(this.feedbackRef=null);this.feedbackRef=this.feedbackRef||this.hostView.createComponent(kZ),this.feedbackRef.location.nativeElement.classList.add("ant-input-suffix"),this.feedbackRef.instance.status=this.status,this.feedbackRef.instance.updateIcon()}}return e.\u0275fac=function(i){return new(i||e)(L(kh,10),L(Nn),L(yt),L($n),L(Vn,8),L(IZ,8),L(OZ,8))},e.\u0275dir=Ge({type:e,selectors:[["input","nz-input",""],["textarea","nz-input",""]],hostAttrs:[1,"ant-input"],hostVars:11,hostBindings:function(i,n){2&i&&(to("disabled",n.disabled||null),Dt("ant-input-disabled",n.disabled)("ant-input-borderless",n.nzBorderless)("ant-input-lg","large"===n.nzSize)("ant-input-sm","small"===n.nzSize)("ant-input-rtl","rtl"===n.dir))},inputs:{nzBorderless:"nzBorderless",nzSize:"nzSize",nzStatus:"nzStatus",disabled:"disabled"},exportAs:["nzInput"],features:[Ht]}),Qe([ft()],e.prototype,"nzBorderless",void 0),e})(),tBe=(()=>{class e{constructor(i){this.elementRef=i}}return e.\u0275fac=function(i){return new(i||e)(L(yt))},e.\u0275dir=Ge({type:e,selectors:[["nz-input-group","nzSuffix",""],["nz-input-group","nzPrefix",""]]}),e})(),LZ=(()=>{class e{constructor(i,n,r,o){this.elementRef=i,this.ngZone=n,this.platform=r,this.resizeService=o,this.autosize=!1,this.el=this.elementRef.nativeElement,this.maxHeight=null,this.minHeight=null,this.destroy$=new He,this.inputGap=10}set nzAutosize(i){var r;"string"==typeof i||!0===i?this.autosize=!0:"string"!=typeof(r=i)&&"boolean"!=typeof r&&(r.maxRows||r.minRows)&&(this.autosize=!0,this.minRows=i.minRows,this.maxRows=i.maxRows,this.maxHeight=this.setMaxHeight(),this.minHeight=this.setMinHeight())}resizeToFitContent(i=!1){if(this.cacheTextareaLineHeight(),!this.cachedLineHeight)return;const n=this.el,r=n.value;if(!i&&this.minRows===this.previousMinRows&&r===this.previousValue)return;const o=n.placeholder;n.classList.add("nz-textarea-autosize-measuring"),n.placeholder="";let s=Math.round((n.scrollHeight-this.inputGap)/this.cachedLineHeight)*this.cachedLineHeight+this.inputGap;null!==this.maxHeight&&s>this.maxHeight&&(s=this.maxHeight),null!==this.minHeight&&s<this.minHeight&&(s=this.minHeight),n.style.height=`${s}px`,n.classList.remove("nz-textarea-autosize-measuring"),n.placeholder=o,typeof requestAnimationFrame<"u"&&this.ngZone.runOutsideAngular(()=>requestAnimationFrame(()=>{const{selectionStart:a,selectionEnd:l}=n;!this.destroy$.isStopped&&document.activeElement===n&&n.setSelectionRange(a,l)})),this.previousValue=r,this.previousMinRows=this.minRows}cacheTextareaLineHeight(){if(this.cachedLineHeight>=0||!this.el.parentNode)return;const i=this.el.cloneNode(!1);i.rows=1,i.style.position="absolute",i.style.visibility="hidden",i.style.border="none",i.style.padding="0",i.style.height="",i.style.minHeight="",i.style.maxHeight="",i.style.overflow="hidden",this.el.parentNode.appendChild(i),this.cachedLineHeight=i.clientHeight-this.inputGap,this.el.parentNode.removeChild(i),this.maxHeight=this.setMaxHeight(),this.minHeight=this.setMinHeight()}setMinHeight(){const i=this.minRows&&this.cachedLineHeight?this.minRows*this.cachedLineHeight+this.inputGap:null;return null!==i&&(this.el.style.minHeight=`${i}px`),i}setMaxHeight(){const i=this.maxRows&&this.cachedLineHeight?this.maxRows*this.cachedLineHeight+this.inputGap:null;return null!==i&&(this.el.style.maxHeight=`${i}px`),i}noopInputHandler(){}ngAfterViewInit(){this.autosize&&this.platform.isBrowser&&(this.resizeToFitContent(),this.resizeService.subscribe().pipe(Ye(this.destroy$)).subscribe(()=>this.resizeToFitContent(!0)))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngDoCheck(){this.autosize&&this.platform.isBrowser&&this.resizeToFitContent()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Pt),L(Qr),L(ZT))},e.\u0275dir=Ge({type:e,selectors:[["textarea","nzAutosize",""]],hostAttrs:["rows","1"],hostBindings:function(i,n){1&i&&pt("input",function(){return n.noopInputHandler()})},inputs:{nzAutosize:"nzAutosize"},exportAs:["nzAutosize"]}),e})(),vE=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,go,Hs,Zr,NZ]}),e})();const RZ="nz-animate-disabled";let Ha=(()=>{class e{constructor(i,n,r){this.element=i,this.renderer=n,this.animationType=r,this.nzNoAnimation=!1}ngOnChanges(){this.updateClass()}ngAfterViewInit(){this.updateClass()}updateClass(){const i=I0(this.element);i&&(this.nzNoAnimation||"NoopAnimations"===this.animationType?this.renderer.addClass(i,RZ):this.renderer.removeClass(i,RZ))}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Nn),L(Am,8))},e.\u0275dir=Ge({type:e,selectors:[["","nzNoAnimation",""]],inputs:{nzNoAnimation:"nzNoAnimation"},exportAs:["nzNoAnimation"],features:[Ht]}),Qe([ft()],e.prototype,"nzNoAnimation",void 0),e})(),Vh=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ji]}),e})();function FZ(e,t){return t?i=>wd(t.pipe(Fr(1),function iBe(){return Mn((e,t)=>{e.subscribe($i(t,Yh))})}()),i.pipe(FZ(e))):xr((i,n)=>eo(e(i,n)).pipe(Fr(1),Cd(i)))}function yE(e,t=C5){const i=RT(e,t);return FZ(()=>i)}const lBe={provide:Na,useExisting:nn(()=>hBe),multi:!0};let hBe=(()=>{class e{constructor(i,n,r,o,s,a){this.ngZone=i,this.elementRef=n,this.overlay=r,this.viewContainerRef=o,this.nzInputGroupWhitSuffixOrPrefixDirective=s,this.document=a,this.onChange=()=>{},this.onTouched=()=>{},this.panelOpen=!1,this.destroy$=new He,this.overlayRef=null,this.portal=null,this.previousValue=null}get activeOption(){return this.nzAutocomplete&&this.nzAutocomplete.options.length?this.nzAutocomplete.activeItem:null}ngAfterViewInit(){this.nzAutocomplete&&this.nzAutocomplete.animationStateChange.pipe(Ye(this.destroy$)).subscribe(i=>{"void"===i.toState&&this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.destroyPanel()}writeValue(i){this.ngZone.runOutsideAngular(()=>Promise.resolve(null).then(()=>this.setTriggerValue(i)))}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.elementRef.nativeElement.disabled=i,this.closePanel()}openPanel(){this.previousValue=this.elementRef.nativeElement.value,this.attachOverlay(),this.updateStatus()}closePanel(){this.panelOpen&&(this.nzAutocomplete.isOpen=this.panelOpen=!1,this.overlayRef&&this.overlayRef.hasAttached()&&(this.overlayRef.detach(),this.selectionChangeSubscription.unsubscribe(),this.overlayOutsideClickSubscription.unsubscribe(),this.optionsChangeSubscription.unsubscribe(),this.portal=null))}handleKeydown(i){const n=i.keyCode,r=38===n||40===n;27===n&&i.preventDefault(),!this.panelOpen||27!==n&&9!==n?this.panelOpen&&13===n?this.nzAutocomplete.showPanel&&(i.preventDefault(),this.activeOption?this.activeOption.selectViaInteraction():this.closePanel()):this.panelOpen&&r&&this.nzAutocomplete.showPanel&&(i.stopPropagation(),i.preventDefault(),38===n?this.nzAutocomplete.setPreviousItemActive():this.nzAutocomplete.setNextItemActive(),this.activeOption&&this.activeOption.scrollIntoViewIfNeeded(),this.doBackfill()):(this.activeOption&&this.activeOption.getLabel()!==this.previousValue&&this.setTriggerValue(this.previousValue),this.closePanel())}handleInput(i){const n=i.target,r=this.document;let o=n.value;"number"===n.type&&(o=""===o?null:parseFloat(o)),this.previousValue!==o&&(this.previousValue=o,this.onChange(o),this.canOpen()&&r.activeElement===i.target&&this.openPanel())}handleFocus(){this.canOpen()&&this.openPanel()}handleBlur(){this.onTouched()}subscribeOptionsChange(){return this.nzAutocomplete.options.changes.pipe(Br(()=>this.positionStrategy.reapplyLastPosition()),yE(0)).subscribe(()=>{this.resetActiveItem(),this.panelOpen&&this.overlayRef.updatePosition()})}subscribeSelectionChange(){return this.nzAutocomplete.selectionChange.subscribe(i=>{this.setValueAndClose(i)})}subscribeOverlayOutsideClick(){return this.overlayRef.outsidePointerEvents().pipe(rn(i=>!this.elementRef.nativeElement.contains(i.target))).subscribe(()=>{this.closePanel()})}attachOverlay(){if(!this.nzAutocomplete)throw function cBe(){return Error("Attempting to open an undefined instance of `nz-autocomplete`. Make sure that the id passed to the `nzAutocomplete` is correct and that you're attempting to open it after the ngAfterContentInit hook.")}();!this.portal&&this.nzAutocomplete.template&&(this.portal=new c3(this.nzAutocomplete.template,this.viewContainerRef)),this.overlayRef||(this.overlayRef=this.overlay.create(this.getOverlayConfig())),this.overlayRef&&!this.overlayRef.hasAttached()&&(this.overlayRef.attach(this.portal),this.selectionChangeSubscription=this.subscribeSelectionChange(),this.optionsChangeSubscription=this.subscribeOptionsChange(),this.overlayOutsideClickSubscription=this.subscribeOverlayOutsideClick(),this.overlayRef.detachments().pipe(Ye(this.destroy$)).subscribe(()=>{this.closePanel()})),this.nzAutocomplete.isOpen=this.panelOpen=!0}updateStatus(){this.overlayRef&&this.overlayRef.updateSize({width:this.nzAutocomplete.nzWidth||this.getHostWidth()}),this.nzAutocomplete.setVisibility(),this.resetActiveItem(),this.activeOption&&this.activeOption.scrollIntoViewIfNeeded()}destroyPanel(){this.overlayRef&&this.closePanel()}getOverlayConfig(){return new XT({positionStrategy:this.getOverlayPosition(),disposeOnNavigation:!0,scrollStrategy:this.overlay.scrollStrategies.reposition(),width:this.nzAutocomplete.nzWidth||this.getHostWidth()})}getConnectedElement(){return this.nzInputGroupWhitSuffixOrPrefixDirective?this.nzInputGroupWhitSuffixOrPrefixDirective.elementRef:this.elementRef}getHostWidth(){return this.getConnectedElement().nativeElement.getBoundingClientRect().width}getOverlayPosition(){const i=[new Sn({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new Sn({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.positionStrategy=this.overlay.position().flexibleConnectedTo(this.getConnectedElement()).withFlexibleDimensions(!1).withPush(!1).withPositions(i).withTransformOriginOn(".ant-select-dropdown"),this.positionStrategy}resetActiveItem(){const i=this.nzAutocomplete.getOptionIndex(this.previousValue);this.nzAutocomplete.clearSelectedOptions(null,!0),-1!==i?(this.nzAutocomplete.setActiveItem(i),this.nzAutocomplete.activeItem.select(!1)):this.nzAutocomplete.setActiveItem(this.nzAutocomplete.nzDefaultActiveFirstOption?0:-1)}setValueAndClose(i){const n=i.nzValue;this.setTriggerValue(i.getLabel()),this.onChange(n),this.elementRef.nativeElement.focus(),this.closePanel()}setTriggerValue(i){const n=this.nzAutocomplete.getOption(i),r=n?n.getLabel():i;this.elementRef.nativeElement.value=r??"",this.nzAutocomplete.nzBackfill||(this.previousValue=r)}doBackfill(){this.nzAutocomplete.nzBackfill&&this.nzAutocomplete.activeItem&&this.setTriggerValue(this.nzAutocomplete.activeItem.getLabel())}canOpen(){const i=this.elementRef.nativeElement;return!i.readOnly&&!i.disabled}}return e.\u0275fac=function(i){return new(i||e)(L(Pt),L(yt),L(k0),L($n),L(tBe,8),L(_i,8))},e.\u0275dir=Ge({type:e,selectors:[["input","nzAutocomplete",""],["textarea","nzAutocomplete",""]],hostAttrs:["autocomplete","off","aria-autocomplete","list"],hostBindings:function(i,n){1&i&&pt("focusin",function(){return n.handleFocus()})("blur",function(){return n.handleBlur()})("input",function(o){return n.handleInput(o)})("keydown",function(o){return n.handleKeydown(o)})},inputs:{nzAutocomplete:"nzAutocomplete"},exportAs:["nzAutocompleteTrigger"],features:[vi([lBe])]}),e})(),uBe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,Zr,Vh,vE]}),e})();const BZ=["moz","ms","webkit"];function _E(e){if(typeof window>"u")return null;if(window.cancelAnimationFrame)return window.cancelAnimationFrame(e);const t=BZ.filter(i=>`${i}CancelAnimationFrame`in window||`${i}CancelRequestAnimationFrame`in window)[0];return t?(window[`${t}CancelAnimationFrame`]||window[`${t}CancelRequestAnimationFrame`]).call(this,e):clearTimeout(e)}const p3=function pBe(){if(typeof window>"u")return()=>0;if(window.requestAnimationFrame)return window.requestAnimationFrame.bind(window);const e=BZ.filter(t=>`${t}RequestAnimationFrame`in window)[0];return e?window[`${e}RequestAnimationFrame`]:function dBe(){let e=0;return function(t){const i=(new Date).getTime(),n=Math.max(0,16-(i-e)),r=setTimeout(()=>{t(i+n)},n);return e=i+n,r}}()}();let fBe=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Y5=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:[fBe]}),e})();const zBe=new Fe("cdk-input-modality-detector-options"),TBe={ignoreKeys:[18,17,224,91,16]},F0=BT({passive:!0,capture:!0});let EBe=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(i,n,r,o){this._platform=i,this._mostRecentTarget=null,this._modality=new Yi(null),this._lastTouchMs=0,this._onKeydown=s=>{this._options?.ignoreKeys?.some(a=>a===s.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=I1(s))},this._onMousedown=s=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function SBe(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}(s)?"keyboard":"mouse"),this._mostRecentTarget=I1(s))},this._onTouchstart=s=>{!function MBe(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(s)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=I1(s)):this._modality.next("keyboard")},this._options={...TBe,...o},this.modalityDetected=this._modality.pipe(RQ(1)),this.modalityChanged=this.modalityDetected.pipe(Sl()),i.isBrowser&&n.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,F0),r.addEventListener("mousedown",this._onMousedown,F0),r.addEventListener("touchstart",this._onTouchstart,F0)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,F0),document.removeEventListener("mousedown",this._onMousedown,F0),document.removeEventListener("touchstart",this._onTouchstart,F0))}}return e.\u0275fac=function(i){return new(i||e)(he(Qr),he(Pt),he(_i),he(zBe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ABe=new Fe("cdk-focus-monitor-default-options"),G5=BT({passive:!0,capture:!0});let bE=(()=>{class e{constructor(i,n,r,o,s){this._ngZone=i,this._platform=n,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new He,this._rootNodeFocusAndBlurListener=a=>{for(let c=I1(a);c;c=c.parentElement)"focus"===a.type?this._onFocus(a,c):this._onBlur(a,c)},this._document=o,this._detectionMode=s?.detectionMode||0}monitor(i,n=!1){const r=I0(i);if(!this._platform.isBrowser||1!==r.nodeType)return tt(null);const o=function FNe(e){if(function RNe(){if(null==VT){const e=typeof document<"u"?document.head:null;VT=!(!e||!e.createShadowRoot&&!e.attachShadow)}return VT}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),s=this._elementInfo.get(r);if(s)return n&&(s.checkChildren=!0),s.subject;const a={checkChildren:n,subject:new He,rootNode:o};return this._elementInfo.set(r,a),this._registerGlobalListeners(a),a.subject}stopMonitoring(i){const n=I0(i),r=this._elementInfo.get(n);r&&(r.subject.complete(),this._setClasses(n),this._elementInfo.delete(n),this._removeGlobalListeners(r))}focusVia(i,n,r){const o=I0(i);o===this._getDocument().activeElement?this._getClosestElementsInfo(o).forEach(([a,l])=>this._originChanged(a,n,l)):(this._setOrigin(n),"function"==typeof o.focus&&o.focus(r))}ngOnDestroy(){this._elementInfo.forEach((i,n)=>this.stopMonitoring(n))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return 1===this._detectionMode||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,n){i.classList.toggle("cdk-focused",!!n),i.classList.toggle("cdk-touch-focused","touch"===n),i.classList.toggle("cdk-keyboard-focused","keyboard"===n),i.classList.toggle("cdk-mouse-focused","mouse"===n),i.classList.toggle("cdk-program-focused","program"===n)}_setOrigin(i,n=!1){this._ngZone.runOutsideAngular(()=>{this._origin=i,this._originFromTouchInteraction="touch"===i&&n,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(i,n){const r=this._elementInfo.get(n),o=I1(i);!r||!r.checkChildren&&n!==o||this._originChanged(n,this._getFocusOrigin(o),r)}_onBlur(i,n){const r=this._elementInfo.get(n);!r||r.checkChildren&&i.relatedTarget instanceof Node&&n.contains(i.relatedTarget)||(this._setClasses(n),this._emitOrigin(r,null))}_emitOrigin(i,n){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(n))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;const n=i.rootNode,r=this._rootNodeFocusListenerCount.get(n)||0;r||this._ngZone.runOutsideAngular(()=>{n.addEventListener("focus",this._rootNodeFocusAndBlurListener,G5),n.addEventListener("blur",this._rootNodeFocusAndBlurListener,G5)}),this._rootNodeFocusListenerCount.set(n,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ye(this._stopInputModalityDetector)).subscribe(o=>{this._setOrigin(o,!0)}))}_removeGlobalListeners(i){const n=i.rootNode;if(this._rootNodeFocusListenerCount.has(n)){const r=this._rootNodeFocusListenerCount.get(n);r>1?this._rootNodeFocusListenerCount.set(n,r-1):(n.removeEventListener("focus",this._rootNodeFocusAndBlurListener,G5),n.removeEventListener("blur",this._rootNodeFocusAndBlurListener,G5),this._rootNodeFocusListenerCount.delete(n))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,n,r){this._setClasses(i,n),this._emitOrigin(r,n),this._lastFocusOrigin=n}_getClosestElementsInfo(i){const n=[];return this._elementInfo.forEach((r,o)=>{(o===i||r.checkChildren&&o.contains(i))&&n.push([o,r])}),n}_isLastInteractionFromInputLabel(i){const{_mostRecentTarget:n,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!n||n===i||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName||i.disabled)return!1;const o=i.labels;if(o)for(let s=0;s<o.length;s++)if(o[s].contains(n))return!0;return!1}}return e.\u0275fac=function(i){return new(i||e)(he(Pt),he(Qr),he(EBe),he(_i,8),he(ABe,8))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const YZ="cdk-high-contrast-black-on-white",GZ="cdk-high-contrast-white-on-black",xE="cdk-high-contrast-active";let IBe=(()=>{class e{constructor(i,n){this._platform=i,this._document=n,this._breakpointSubscription=si(BLe).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);const n=this._document.defaultView||window,r=n&&n.getComputedStyle?n.getComputedStyle(i):null,o=(r&&r.backgroundColor||"").replace(/ /g,"");switch(i.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const i=this._document.body.classList;i.remove(xE,YZ,GZ),this._hasCheckedHighContrastMode=!0;const n=this.getHighContrastMode();1===n?i.add(xE,YZ):2===n&&i.add(xE,GZ)}}}return e.\u0275fac=function(i){return new(i||e)(he(Qr),he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),WZ=(()=>{class e{constructor(i){i._applyBodyHighContrastModeCssClasses()}}return e.\u0275fac=function(i){return new(i||e)(he(IBe))},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[Y5]}),e})(),ca=(()=>{class e{}return e.SLOW="0.3s",e.BASE="0.2s",e.FAST="0.1s",e})(),es=(()=>{class e{}return e.EASE_BASE_OUT="cubic-bezier(0.7, 0.3, 0.1, 1)",e.EASE_BASE_IN="cubic-bezier(0.9, 0, 0.3, 0.7)",e.EASE_OUT="cubic-bezier(0.215, 0.61, 0.355, 1)",e.EASE_IN="cubic-bezier(0.55, 0.055, 0.675, 0.19)",e.EASE_IN_OUT="cubic-bezier(0.645, 0.045, 0.355, 1)",e.EASE_OUT_BACK="cubic-bezier(0.12, 0.4, 0.29, 1.46)",e.EASE_IN_BACK="cubic-bezier(0.71, -0.46, 0.88, 0.6)",e.EASE_IN_OUT_BACK="cubic-bezier(0.71, -0.46, 0.29, 1.46)",e.EASE_OUT_CIRC="cubic-bezier(0.08, 0.82, 0.17, 1)",e.EASE_IN_CIRC="cubic-bezier(0.6, 0.04, 0.98, 0.34)",e.EASE_IN_OUT_CIRC="cubic-bezier(0.78, 0.14, 0.15, 0.86)",e.EASE_OUT_QUINT="cubic-bezier(0.23, 1, 0.32, 1)",e.EASE_IN_QUINT="cubic-bezier(0.755, 0.05, 0.855, 0.06)",e.EASE_IN_OUT_QUINT="cubic-bezier(0.86, 0, 0.07, 1)",e})();const OBe=Cl("collapseMotion",[La("expanded",Jt({height:"*"})),La("collapsed",Jt({height:0,overflow:"hidden"})),La("hidden",Jt({height:0,overflow:"hidden",borderTopWidth:"0"})),Yn("expanded => collapsed",Bn(`150ms ${es.EASE_IN_OUT}`)),Yn("expanded => hidden",Bn(`150ms ${es.EASE_IN_OUT}`)),Yn("collapsed => expanded",Bn(`150ms ${es.EASE_IN_OUT}`)),Yn("hidden => expanded",Bn(`150ms ${es.EASE_IN_OUT}`))]),kBe=(Cl("treeCollapseMotion",[Yn("* => *",[C$("nz-tree-node:leave,nz-tree-builtin-node:leave",[Jt({overflow:"hidden"}),S$(0,[Bn(`150ms ${es.EASE_IN_OUT}`,Jt({height:0,opacity:0,"padding-bottom":0}))])],{optional:!0}),C$("nz-tree-node:enter,nz-tree-builtin-node:enter",[Jt({overflow:"hidden",height:0,opacity:0,"padding-bottom":0}),S$(0,[Bn(`150ms ${es.EASE_IN_OUT}`,Jt({overflow:"hidden",height:"*",opacity:"*","padding-bottom":"*"}))])],{optional:!0})])]),Cl("fadeMotion",[Yn(":enter",[Jt({opacity:0}),Bn(`${ca.BASE}`,Jt({opacity:1}))]),Yn(":leave",[Jt({opacity:1}),Bn(`${ca.BASE}`,Jt({opacity:0}))])]),Cl("helpMotion",[Yn(":enter",[Jt({opacity:0,transform:"translateY(-5px)"}),Bn(`${ca.SLOW} ${es.EASE_IN_OUT}`,Jt({opacity:1,transform:"translateY(0)"}))]),Yn(":leave",[Jt({opacity:1,transform:"translateY(0)"}),Bn(`${ca.SLOW} ${es.EASE_IN_OUT}`,Jt({opacity:0,transform:"translateY(-5px)"}))])]),Cl("moveUpMotion",[Yn("* => enter",[Jt({transformOrigin:"0 0",transform:"translateY(-100%)",opacity:0}),Bn(`${ca.BASE}`,Jt({transformOrigin:"0 0",transform:"translateY(0%)",opacity:1}))]),Yn("* => leave",[Jt({transformOrigin:"0 0",transform:"translateY(0%)",opacity:1}),Bn(`${ca.BASE}`,Jt({transformOrigin:"0 0",transform:"translateY(-100%)",opacity:0}))])]),Cl("notificationMotion",[La("enterRight",Jt({opacity:1,transform:"translateX(0)"})),Yn("* => enterRight",[Jt({opacity:0,transform:"translateX(5%)"}),Bn("100ms linear")]),La("enterLeft",Jt({opacity:1,transform:"translateX(0)"})),Yn("* => enterLeft",[Jt({opacity:0,transform:"translateX(-5%)"}),Bn("100ms linear")]),La("enterTop",Jt({opacity:1,transform:"translateY(0)"})),Yn("* => enterTop",[Jt({opacity:0,transform:"translateY(-5%)"}),Bn("100ms linear")]),La("enterBottom",Jt({opacity:1,transform:"translateY(0)"})),Yn("* => enterBottom",[Jt({opacity:0,transform:"translateY(5%)"}),Bn("100ms linear")]),La("leave",Jt({opacity:0,transform:"scaleY(0.8)",transformOrigin:"0% 0%"})),Yn("* => leave",[Jt({opacity:1,transform:"scaleY(1)",transformOrigin:"0% 0%"}),Bn("100ms linear")])])),NBe=`${ca.BASE} ${es.EASE_OUT_QUINT}`,LBe=`${ca.BASE} ${es.EASE_IN_QUINT}`,wE=Cl("slideMotion",[La("void",Jt({opacity:0,transform:"scaleY(0.8)"})),La("enter",Jt({opacity:1,transform:"scaleY(1)"})),Yn("void => *",[Bn(NBe)]),Yn("* => void",[Bn(LBe)])]),qZ=(Cl("slideAlertMotion",[Yn(":leave",[Jt({opacity:1,transform:"scaleY(1)",transformOrigin:"0% 0%"}),Bn(`${ca.SLOW} ${es.EASE_IN_OUT_CIRC}`,Jt({opacity:0,transform:"scaleY(0)",transformOrigin:"0% 0%"}))])]),Cl("zoomBigMotion",[Yn("void => active",[Jt({opacity:0,transform:"scale(0.8)"}),Bn(`${ca.BASE} ${es.EASE_OUT_CIRC}`,Jt({opacity:1,transform:"scale(1)"}))]),Yn("active => void",[Jt({opacity:1,transform:"scale(1)"}),Bn(`${ca.BASE} ${es.EASE_IN_OUT_CIRC}`,Jt({opacity:0,transform:"scale(0.8)"}))])])),RBe=(Cl("zoomBadgeMotion",[Yn(":enter",[Jt({opacity:0,transform:"scale(0) translate(50%, -50%)"}),Bn(`${ca.SLOW} ${es.EASE_OUT_BACK}`,Jt({opacity:1,transform:"scale(1) translate(50%, -50%)"}))]),Yn(":leave",[Jt({opacity:1,transform:"scale(1) translate(50%, -50%)"}),Bn(`${ca.SLOW} ${es.EASE_IN_BACK}`,Jt({opacity:0,transform:"scale(0) translate(50%, -50%)"}))])]),Cl("thumbMotion",[La("from",Jt({transform:"translateX({{ transform }}px)",width:"{{ width }}px"}),{params:{transform:0,width:0}}),La("to",Jt({transform:"translateX({{ transform }}px)",width:"{{ width }}px"}),{params:{transform:100,width:0}}),Yn("from => to",Bn(`300ms ${es.EASE_IN_OUT}`))]),["nz-submenu-title",""]);function FBe(e,t){1&e&&Je(0,"span",4),2&e&&X("nzType",de().nzIcon)}function BBe(e,t){if(1&e&&(Yt(0),Ee(1,"span"),zi(2),Pe(),Gt()),2&e){const i=de();ie(2),cr(i.nzTitle)}}function VBe(e,t){1&e&&Je(0,"span",8)}function HBe(e,t){1&e&&Je(0,"span",9)}function UBe(e,t){1&e&&(Ee(0,"span",5),ne(1,VBe,1,0,"span",6),ne(2,HBe,1,0,"span",7),Pe()),2&e&&(X("ngSwitch",de().dir),ie(1),X("ngSwitchCase","rtl"))}function jBe(e,t){1&e&&Je(0,"span",10)}const YBe=["*"],GBe=["nz-submenu-inline-child",""];function WBe(e,t){}const qBe=["nz-submenu-none-inline-child",""];function XBe(e,t){}const $Be=["nz-submenu",""];function QBe(e,t){1&e&&Mi(0,0,["*ngIf","!nzTitle"])}function ZBe(e,t){if(1&e&&Je(0,"div",6),2&e){const i=de(),n=gn(7);X("mode",i.mode)("nzOpen",i.nzOpen)("@.disabled",!(null==i.noAnimation||!i.noAnimation.nzNoAnimation))("nzNoAnimation",null==i.noAnimation?null:i.noAnimation.nzNoAnimation)("menuClass",i.nzMenuClassName)("templateOutlet",n)}}function KBe(e,t){if(1&e){const i=Ji();Ee(0,"div",8),pt("subMenuMouseState",function(r){return ai(i),li(de(2).setMouseEnterState(r))}),Pe()}if(2&e){const i=de(2),n=gn(7);X("theme",i.theme)("mode",i.mode)("nzOpen",i.nzOpen)("position",i.position)("nzDisabled",i.nzDisabled)("isMenuInsideDropDown",i.isMenuInsideDropDown)("templateOutlet",n)("menuClass",i.nzMenuClassName)("@.disabled",!(null==i.noAnimation||!i.noAnimation.nzNoAnimation))("nzNoAnimation",null==i.noAnimation?null:i.noAnimation.nzNoAnimation)}}function JBe(e,t){if(1&e){const i=Ji();ne(0,KBe,1,10,"ng-template",7),pt("positionChange",function(r){return ai(i),li(de().onPositionChange(r))})}if(2&e){const i=de(),n=gn(1);X("cdkConnectedOverlayPositions",i.overlayPositions)("cdkConnectedOverlayOrigin",n)("cdkConnectedOverlayWidth",i.triggerWidth)("cdkConnectedOverlayOpen",i.nzOpen)("cdkConnectedOverlayTransformOriginOn",".ant-menu-submenu")}}function eVe(e,t){1&e&&Mi(0,1)}const tVe=[[["","title",""]],"*"],iVe=["[title]","*"],N1=new Fe("NzIsInDropDownMenuToken"),XZ=new Fe("NzMenuServiceLocalToken");let Hh=(()=>{class e{constructor(){this.descendantMenuItemClick$=new He,this.childMenuItemClick$=new He,this.theme$=new Yi("light"),this.mode$=new Yi("vertical"),this.inlineIndent$=new Yi(24),this.isChildSubMenuOpen$=new Yi(!1)}onDescendantMenuItemClick(i){this.descendantMenuItemClick$.next(i)}onChildMenuItemClick(i){this.childMenuItemClick$.next(i)}setMode(i){this.mode$.next(i)}setTheme(i){this.theme$.next(i)}setInlineIndent(i){this.inlineIndent$.next(i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),CE=(()=>{class e{constructor(i,n,r){this.nzHostSubmenuService=i,this.nzMenuService=n,this.isMenuInsideDropDown=r,this.mode$=this.nzMenuService.mode$.pipe(bt(l=>"inline"===l?"inline":"vertical"===l||this.nzHostSubmenuService?"vertical":"horizontal")),this.level=1,this.isCurrentSubMenuOpen$=new Yi(!1),this.isChildSubMenuOpen$=new Yi(!1),this.isMouseEnterTitleOrOverlay$=new He,this.childMenuItemClick$=new He,this.destroy$=new He,this.nzHostSubmenuService&&(this.level=this.nzHostSubmenuService.level+1);const o=this.childMenuItemClick$.pipe(xr(()=>this.mode$),rn(l=>"inline"!==l||this.isMenuInsideDropDown),Cd(!1)),s=ts(this.isMouseEnterTitleOrOverlay$,o);Yc([this.isChildSubMenuOpen$,s]).pipe(bt(([l,c])=>l||c),A1(150),Sl(),Ye(this.destroy$)).pipe(Sl()).subscribe(l=>{this.setOpenStateWithoutDebounce(l),this.nzHostSubmenuService?this.nzHostSubmenuService.isChildSubMenuOpen$.next(l):this.nzMenuService.isChildSubMenuOpen$.next(l)})}onChildMenuItemClick(i){this.childMenuItemClick$.next(i)}setOpenStateWithoutDebounce(i){this.isCurrentSubMenuOpen$.next(i)}setMouseEnterTitleOrOverlayState(i){this.isMouseEnterTitleOrOverlay$.next(i)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(he(e,12),he(Hh),he(N1))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac}),e})(),SE=(()=>{class e{constructor(i,n,r,o,s,a,l){this.nzMenuService=i,this.cdr=n,this.nzSubmenuService=r,this.isMenuInsideDropDown=o,this.directionality=s,this.routerLink=a,this.router=l,this.destroy$=new He,this.level=this.nzSubmenuService?this.nzSubmenuService.level+1:1,this.selected$=new He,this.inlinePaddingLeft=null,this.dir="ltr",this.nzDisabled=!1,this.nzSelected=!1,this.nzDanger=!1,this.nzMatchRouterExact=!1,this.nzMatchRouter=!1,l&&this.router.events.pipe(Ye(this.destroy$),rn(c=>c instanceof qc)).subscribe(()=>{this.updateRouterActive()})}clickMenuItem(i){this.nzDisabled?(i.preventDefault(),i.stopPropagation()):(this.nzMenuService.onDescendantMenuItemClick(this),this.nzSubmenuService?this.nzSubmenuService.onChildMenuItemClick(this):this.nzMenuService.onChildMenuItemClick(this))}setSelectedState(i){this.nzSelected=i,this.selected$.next(i)}updateRouterActive(){!this.listOfRouterLink||!this.router||!this.router.navigated||!this.nzMatchRouter||Promise.resolve().then(()=>{const i=this.hasActiveLinks();this.nzSelected!==i&&(this.nzSelected=i,this.setSelectedState(this.nzSelected),this.cdr.markForCheck())})}hasActiveLinks(){const i=this.isLinkActive(this.router);return this.routerLink&&i(this.routerLink)||this.listOfRouterLink.some(i)}isLinkActive(i){return n=>i.isActive(n.urlTree||"",{paths:this.nzMatchRouterExact?"exact":"subset",queryParams:this.nzMatchRouterExact?"exact":"subset",fragment:"ignored",matrixParams:"ignored"})}ngOnInit(){Yc([this.nzMenuService.mode$,this.nzMenuService.inlineIndent$]).pipe(Ye(this.destroy$)).subscribe(([i,n])=>{this.inlinePaddingLeft="inline"===i?this.level*n:null}),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i})}ngAfterContentInit(){this.listOfRouterLink.changes.pipe(Ye(this.destroy$)).subscribe(()=>this.updateRouterActive()),this.updateRouterActive()}ngOnChanges(i){i.nzSelected&&this.setSelectedState(this.nzSelected)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Hh),L(Ri),L(CE,8),L(N1),L(Vn,8),L(Rp,8),L(ls,8))},e.\u0275dir=Ge({type:e,selectors:[["","nz-menu-item",""]],contentQueries:function(i,n,r){if(1&i&&Un(r,Rp,5),2&i){let o;Mt(o=zt())&&(n.listOfRouterLink=o)}},hostVars:20,hostBindings:function(i,n){1&i&&pt("click",function(o){return n.clickMenuItem(o)}),2&i&&(Xn("padding-left","rtl"===n.dir?null:n.nzPaddingLeft||n.inlinePaddingLeft,"px")("padding-right","rtl"===n.dir?n.nzPaddingLeft||n.inlinePaddingLeft:null,"px"),Dt("ant-dropdown-menu-item",n.isMenuInsideDropDown)("ant-dropdown-menu-item-selected",n.isMenuInsideDropDown&&n.nzSelected)("ant-dropdown-menu-item-danger",n.isMenuInsideDropDown&&n.nzDanger)("ant-dropdown-menu-item-disabled",n.isMenuInsideDropDown&&n.nzDisabled)("ant-menu-item",!n.isMenuInsideDropDown)("ant-menu-item-selected",!n.isMenuInsideDropDown&&n.nzSelected)("ant-menu-item-danger",!n.isMenuInsideDropDown&&n.nzDanger)("ant-menu-item-disabled",!n.isMenuInsideDropDown&&n.nzDisabled))},inputs:{nzPaddingLeft:"nzPaddingLeft",nzDisabled:"nzDisabled",nzSelected:"nzSelected",nzDanger:"nzDanger",nzMatchRouterExact:"nzMatchRouterExact",nzMatchRouter:"nzMatchRouter"},exportAs:["nzMenuItem"],features:[Ht]}),Qe([ft()],e.prototype,"nzDisabled",void 0),Qe([ft()],e.prototype,"nzSelected",void 0),Qe([ft()],e.prototype,"nzDanger",void 0),Qe([ft()],e.prototype,"nzMatchRouterExact",void 0),Qe([ft()],e.prototype,"nzMatchRouter",void 0),e})(),nVe=(()=>{class e{constructor(i,n){this.cdr=i,this.directionality=n,this.nzIcon=null,this.nzTitle=null,this.isMenuInsideDropDown=!1,this.nzDisabled=!1,this.paddingLeft=null,this.mode="vertical",this.toggleSubMenu=new Re,this.subMenuMouseState=new Re,this.dir="ltr",this.destroy$=new He}ngOnInit(){this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.detectChanges()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setMouseState(i){this.nzDisabled||this.subMenuMouseState.next(i)}clickTitle(){"inline"===this.mode&&!this.nzDisabled&&this.toggleSubMenu.emit()}}return e.\u0275fac=function(i){return new(i||e)(L(Ri),L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["","nz-submenu-title",""]],hostVars:8,hostBindings:function(i,n){1&i&&pt("click",function(){return n.clickTitle()})("mouseenter",function(){return n.setMouseState(!0)})("mouseleave",function(){return n.setMouseState(!1)}),2&i&&(Xn("padding-left","rtl"===n.dir?null:n.paddingLeft,"px")("padding-right","rtl"===n.dir?n.paddingLeft:null,"px"),Dt("ant-dropdown-menu-submenu-title",n.isMenuInsideDropDown)("ant-menu-submenu-title",!n.isMenuInsideDropDown))},inputs:{nzIcon:"nzIcon",nzTitle:"nzTitle",isMenuInsideDropDown:"isMenuInsideDropDown",nzDisabled:"nzDisabled",paddingLeft:"paddingLeft",mode:"mode"},outputs:{toggleSubMenu:"toggleSubMenu",subMenuMouseState:"subMenuMouseState"},exportAs:["nzSubmenuTitle"],attrs:RBe,ngContentSelectors:YBe,decls:6,vars:4,consts:[["nz-icon","",3,"nzType",4,"ngIf"],[4,"nzStringTemplateOutlet"],["class","ant-dropdown-menu-submenu-expand-icon",3,"ngSwitch",4,"ngIf","ngIfElse"],["notDropdownTpl",""],["nz-icon","",3,"nzType"],[1,"ant-dropdown-menu-submenu-expand-icon",3,"ngSwitch"],["nz-icon","","nzType","left","class","ant-dropdown-menu-submenu-arrow-icon",4,"ngSwitchCase"],["nz-icon","","nzType","right","class","ant-dropdown-menu-submenu-arrow-icon",4,"ngSwitchDefault"],["nz-icon","","nzType","left",1,"ant-dropdown-menu-submenu-arrow-icon"],["nz-icon","","nzType","right",1,"ant-dropdown-menu-submenu-arrow-icon"],[1,"ant-menu-submenu-arrow"]],template:function(i,n){if(1&i&&(Ln(),ne(0,FBe,1,1,"span",0),ne(1,BBe,3,1,"ng-container",1),Mi(2),ne(3,UBe,3,2,"span",2),ne(4,jBe,1,0,"ng-template",null,3,jn)),2&i){const r=gn(5);X("ngIf",n.nzIcon),ie(1),X("nzStringTemplateOutlet",n.nzTitle),ie(2),X("ngIf",n.isMenuInsideDropDown)("ngIfElse",r)}},dependencies:[Fi,Kh,zp,Yg,ko,vo],encapsulation:2,changeDetection:0}),e})(),rVe=(()=>{class e{constructor(i,n,r){this.elementRef=i,this.renderer=n,this.directionality=r,this.templateOutlet=null,this.menuClass="",this.mode="vertical",this.nzOpen=!1,this.listOfCacheClassName=[],this.expandState="collapsed",this.dir="ltr",this.destroy$=new He}calcMotionState(){this.expandState=this.nzOpen?"expanded":"collapsed"}ngOnInit(){this.calcMotionState(),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i})}ngOnChanges(i){const{mode:n,nzOpen:r,menuClass:o}=i;(n||r)&&this.calcMotionState(),o&&(this.listOfCacheClassName.length&&this.listOfCacheClassName.filter(s=>!!s).forEach(s=>{this.renderer.removeClass(this.elementRef.nativeElement,s)}),this.menuClass&&(this.listOfCacheClassName=this.menuClass.split(" "),this.listOfCacheClassName.filter(s=>!!s).forEach(s=>{this.renderer.addClass(this.elementRef.nativeElement,s)})))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Nn),L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["","nz-submenu-inline-child",""]],hostAttrs:[1,"ant-menu","ant-menu-inline","ant-menu-sub"],hostVars:3,hostBindings:function(i,n){2&i&&(gg("@collapseMotion",n.expandState),Dt("ant-menu-rtl","rtl"===n.dir))},inputs:{templateOutlet:"templateOutlet",menuClass:"menuClass",mode:"mode",nzOpen:"nzOpen"},exportAs:["nzSubmenuInlineChild"],features:[Ht],attrs:GBe,decls:1,vars:1,consts:[[3,"ngTemplateOutlet"]],template:function(i,n){1&i&&ne(0,WBe,0,0,"ng-template",0),2&i&&X("ngTemplateOutlet",n.templateOutlet)},dependencies:[as],encapsulation:2,data:{animation:[OBe]},changeDetection:0}),e})(),oVe=(()=>{class e{constructor(i){this.directionality=i,this.menuClass="",this.theme="light",this.templateOutlet=null,this.isMenuInsideDropDown=!1,this.mode="vertical",this.position="right",this.nzDisabled=!1,this.nzOpen=!1,this.subMenuMouseState=new Re,this.expandState="collapsed",this.dir="ltr",this.destroy$=new He}setMouseState(i){this.nzDisabled||this.subMenuMouseState.next(i)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}calcMotionState(){this.nzOpen?"horizontal"===this.mode?this.expandState="bottom":"vertical"===this.mode&&(this.expandState="active"):this.expandState="collapsed"}ngOnInit(){this.calcMotionState(),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i})}ngOnChanges(i){const{mode:n,nzOpen:r}=i;(n||r)&&this.calcMotionState()}}return e.\u0275fac=function(i){return new(i||e)(L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["","nz-submenu-none-inline-child",""]],hostAttrs:[1,"ant-menu-submenu","ant-menu-submenu-popup"],hostVars:14,hostBindings:function(i,n){1&i&&pt("mouseenter",function(){return n.setMouseState(!0)})("mouseleave",function(){return n.setMouseState(!1)}),2&i&&(gg("@slideMotion",n.expandState)("@zoomBigMotion",n.expandState),Dt("ant-menu-light","light"===n.theme)("ant-menu-dark","dark"===n.theme)("ant-menu-submenu-placement-bottom","horizontal"===n.mode)("ant-menu-submenu-placement-right","vertical"===n.mode&&"right"===n.position)("ant-menu-submenu-placement-left","vertical"===n.mode&&"left"===n.position)("ant-menu-submenu-rtl","rtl"===n.dir))},inputs:{menuClass:"menuClass",theme:"theme",templateOutlet:"templateOutlet",isMenuInsideDropDown:"isMenuInsideDropDown",mode:"mode",position:"position",nzDisabled:"nzDisabled",nzOpen:"nzOpen"},outputs:{subMenuMouseState:"subMenuMouseState"},exportAs:["nzSubmenuNoneInlineChild"],features:[Ht],attrs:qBe,decls:2,vars:16,consts:[[3,"ngClass"],[3,"ngTemplateOutlet"]],template:function(i,n){1&i&&(Ee(0,"div",0),ne(1,XBe,0,0,"ng-template",1),Pe()),2&i&&(Dt("ant-dropdown-menu",n.isMenuInsideDropDown)("ant-menu",!n.isMenuInsideDropDown)("ant-dropdown-menu-vertical",n.isMenuInsideDropDown)("ant-menu-vertical",!n.isMenuInsideDropDown)("ant-dropdown-menu-sub",n.isMenuInsideDropDown)("ant-menu-sub",!n.isMenuInsideDropDown)("ant-menu-rtl","rtl"===n.dir),X("ngClass",n.menuClass),ie(1),X("ngTemplateOutlet",n.templateOutlet))},dependencies:[Nm,as],encapsulation:2,data:{animation:[qZ,wE]},changeDetection:0}),e})();const $Z=[Pi.rightTop,Pi.right,Pi.rightBottom,Pi.leftTop,Pi.left,Pi.leftBottom],sVe=[Pi.bottomLeft,Pi.bottomRight,Pi.topRight,Pi.topLeft];let aVe=(()=>{class e{constructor(i,n,r,o,s,a,l){this.nzMenuService=i,this.cdr=n,this.nzSubmenuService=r,this.platform=o,this.isMenuInsideDropDown=s,this.directionality=a,this.noAnimation=l,this.nzMenuClassName="",this.nzPaddingLeft=null,this.nzTitle=null,this.nzIcon=null,this.nzOpen=!1,this.nzDisabled=!1,this.nzPlacement="bottomLeft",this.nzOpenChange=new Re,this.cdkOverlayOrigin=null,this.listOfNzSubMenuComponent=null,this.listOfNzMenuItemDirective=null,this.level=this.nzSubmenuService.level,this.destroy$=new He,this.position="right",this.triggerWidth=null,this.theme="light",this.mode="vertical",this.inlinePaddingLeft=null,this.overlayPositions=$Z,this.isSelected=!1,this.isActive=!1,this.dir="ltr"}setOpenStateWithoutDebounce(i){this.nzSubmenuService.setOpenStateWithoutDebounce(i)}toggleSubMenu(){this.setOpenStateWithoutDebounce(!this.nzOpen)}setMouseEnterState(i){this.isActive=i,"inline"!==this.mode&&this.nzSubmenuService.setMouseEnterTitleOrOverlayState(i)}setTriggerWidth(){"horizontal"===this.mode&&this.platform.isBrowser&&this.cdkOverlayOrigin&&"bottomLeft"===this.nzPlacement&&(this.triggerWidth=this.cdkOverlayOrigin.nativeElement.getBoundingClientRect().width)}onPositionChange(i){const n=N5(i);"rightTop"===n||"rightBottom"===n||"right"===n?this.position="right":("leftTop"===n||"leftBottom"===n||"left"===n)&&(this.position="left")}ngOnInit(){this.nzMenuService.theme$.pipe(Ye(this.destroy$)).subscribe(i=>{this.theme=i,this.cdr.markForCheck()}),this.nzSubmenuService.mode$.pipe(Ye(this.destroy$)).subscribe(i=>{this.mode=i,"horizontal"===i?this.overlayPositions=[Pi[this.nzPlacement],...sVe]:"vertical"===i&&(this.overlayPositions=$Z),this.cdr.markForCheck()}),Yc([this.nzSubmenuService.mode$,this.nzMenuService.inlineIndent$]).pipe(Ye(this.destroy$)).subscribe(([i,n])=>{this.inlinePaddingLeft="inline"===i?this.level*n:null,this.cdr.markForCheck()}),this.nzSubmenuService.isCurrentSubMenuOpen$.pipe(Ye(this.destroy$)).subscribe(i=>{this.isActive=i,i!==this.nzOpen&&(this.setTriggerWidth(),this.nzOpen=i,this.nzOpenChange.emit(this.nzOpen),this.cdr.markForCheck())}),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.markForCheck()})}ngAfterContentInit(){this.setTriggerWidth();const i=this.listOfNzMenuItemDirective,n=i.changes,r=ts(n,...i.map(o=>o.selected$));n.pipe(Ho(i),Sr(()=>r),Ho(!0),bt(()=>i.some(o=>o.nzSelected)),Ye(this.destroy$)).subscribe(o=>{this.isSelected=o,this.cdr.markForCheck()})}ngOnChanges(i){const{nzOpen:n}=i;n&&(this.nzSubmenuService.setOpenStateWithoutDebounce(this.nzOpen),this.setTriggerWidth())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Hh),L(Ri),L(CE),L(Qr),L(N1),L(Vn,8),L(Ha,9))},e.\u0275cmp=ut({type:e,selectors:[["","nz-submenu",""]],contentQueries:function(i,n,r){if(1&i&&(Un(r,e,5),Un(r,SE,5)),2&i){let o;Mt(o=zt())&&(n.listOfNzSubMenuComponent=o),Mt(o=zt())&&(n.listOfNzMenuItemDirective=o)}},viewQuery:function(i,n){if(1&i&&Ui(N0,7,yt),2&i){let r;Mt(r=zt())&&(n.cdkOverlayOrigin=r.first)}},hostVars:34,hostBindings:function(i,n){2&i&&Dt("ant-dropdown-menu-submenu",n.isMenuInsideDropDown)("ant-dropdown-menu-submenu-disabled",n.isMenuInsideDropDown&&n.nzDisabled)("ant-dropdown-menu-submenu-open",n.isMenuInsideDropDown&&n.nzOpen)("ant-dropdown-menu-submenu-selected",n.isMenuInsideDropDown&&n.isSelected)("ant-dropdown-menu-submenu-vertical",n.isMenuInsideDropDown&&"vertical"===n.mode)("ant-dropdown-menu-submenu-horizontal",n.isMenuInsideDropDown&&"horizontal"===n.mode)("ant-dropdown-menu-submenu-inline",n.isMenuInsideDropDown&&"inline"===n.mode)("ant-dropdown-menu-submenu-active",n.isMenuInsideDropDown&&n.isActive)("ant-menu-submenu",!n.isMenuInsideDropDown)("ant-menu-submenu-disabled",!n.isMenuInsideDropDown&&n.nzDisabled)("ant-menu-submenu-open",!n.isMenuInsideDropDown&&n.nzOpen)("ant-menu-submenu-selected",!n.isMenuInsideDropDown&&n.isSelected)("ant-menu-submenu-vertical",!n.isMenuInsideDropDown&&"vertical"===n.mode)("ant-menu-submenu-horizontal",!n.isMenuInsideDropDown&&"horizontal"===n.mode)("ant-menu-submenu-inline",!n.isMenuInsideDropDown&&"inline"===n.mode)("ant-menu-submenu-active",!n.isMenuInsideDropDown&&n.isActive)("ant-menu-submenu-rtl","rtl"===n.dir)},inputs:{nzMenuClassName:"nzMenuClassName",nzPaddingLeft:"nzPaddingLeft",nzTitle:"nzTitle",nzIcon:"nzIcon",nzOpen:"nzOpen",nzDisabled:"nzDisabled",nzPlacement:"nzPlacement"},outputs:{nzOpenChange:"nzOpenChange"},exportAs:["nzSubmenu"],features:[vi([CE]),Ht],attrs:$Be,ngContentSelectors:iVe,decls:8,vars:9,consts:[["nz-submenu-title","","cdkOverlayOrigin","",3,"nzIcon","nzTitle","mode","nzDisabled","isMenuInsideDropDown","paddingLeft","subMenuMouseState","toggleSubMenu"],["origin","cdkOverlayOrigin"],[4,"ngIf"],["nz-submenu-inline-child","",3,"mode","nzOpen","nzNoAnimation","menuClass","templateOutlet",4,"ngIf","ngIfElse"],["nonInlineTemplate",""],["subMenuTemplate",""],["nz-submenu-inline-child","",3,"mode","nzOpen","nzNoAnimation","menuClass","templateOutlet"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayPositions","cdkConnectedOverlayOrigin","cdkConnectedOverlayWidth","cdkConnectedOverlayOpen","cdkConnectedOverlayTransformOriginOn","positionChange"],["nz-submenu-none-inline-child","",3,"theme","mode","nzOpen","position","nzDisabled","isMenuInsideDropDown","templateOutlet","menuClass","nzNoAnimation","subMenuMouseState"]],template:function(i,n){if(1&i&&(Ln(tVe),Ee(0,"div",0,1),pt("subMenuMouseState",function(o){return n.setMouseEnterState(o)})("toggleSubMenu",function(){return n.toggleSubMenu()}),ne(2,QBe,1,0,"ng-content",2),Pe(),ne(3,ZBe,1,6,"div",3),ne(4,JBe,1,5,"ng-template",null,4,jn),ne(6,eVe,1,0,"ng-template",null,5,jn)),2&i){const r=gn(5);X("nzIcon",n.nzIcon)("nzTitle",n.nzTitle)("mode",n.mode)("nzDisabled",n.nzDisabled)("isMenuInsideDropDown",n.isMenuInsideDropDown)("paddingLeft",n.nzPaddingLeft||n.inlinePaddingLeft),ie(2),X("ngIf",!n.nzTitle),ie(1),X("ngIf","inline"===n.mode)("ngIfElse",r)}},dependencies:[Fi,u3,N0,Ha,nVe,rVe,oVe],encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzOpen",void 0),Qe([ft()],e.prototype,"nzDisabled",void 0),e})();function lVe(e,t){return e||t}function cVe(e){return e||!1}let QZ=(()=>{class e{constructor(i,n,r,o){this.nzMenuService=i,this.isMenuInsideDropDown=n,this.cdr=r,this.directionality=o,this.nzInlineIndent=24,this.nzTheme="light",this.nzMode="vertical",this.nzInlineCollapsed=!1,this.nzSelectable=!this.isMenuInsideDropDown,this.nzClick=new Re,this.actualMode="vertical",this.dir="ltr",this.inlineCollapsed$=new Yi(this.nzInlineCollapsed),this.mode$=new Yi(this.nzMode),this.destroy$=new He,this.listOfOpenedNzSubMenuComponent=[]}setInlineCollapsed(i){this.nzInlineCollapsed=i,this.inlineCollapsed$.next(i)}updateInlineCollapse(){this.listOfNzMenuItemDirective&&(this.nzInlineCollapsed?(this.listOfOpenedNzSubMenuComponent=this.listOfNzSubMenuComponent.filter(i=>i.nzOpen),this.listOfNzSubMenuComponent.forEach(i=>i.setOpenStateWithoutDebounce(!1))):(this.listOfOpenedNzSubMenuComponent.forEach(i=>i.setOpenStateWithoutDebounce(!0)),this.listOfOpenedNzSubMenuComponent=[]))}ngOnInit(){Yc([this.inlineCollapsed$,this.mode$]).pipe(Ye(this.destroy$)).subscribe(([i,n])=>{this.actualMode=i?"vertical":n,this.nzMenuService.setMode(this.actualMode),this.cdr.markForCheck()}),this.nzMenuService.descendantMenuItemClick$.pipe(Ye(this.destroy$)).subscribe(i=>{this.nzClick.emit(i),this.nzSelectable&&!i.nzMatchRouter&&this.listOfNzMenuItemDirective.forEach(n=>n.setSelectedState(n===i))}),this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.nzMenuService.setMode(this.actualMode),this.cdr.markForCheck()})}ngAfterContentInit(){this.inlineCollapsed$.pipe(Ye(this.destroy$)).subscribe(()=>{this.updateInlineCollapse(),this.cdr.markForCheck()})}ngOnChanges(i){const{nzInlineCollapsed:n,nzInlineIndent:r,nzTheme:o,nzMode:s}=i;n&&this.inlineCollapsed$.next(this.nzInlineCollapsed),r&&this.nzMenuService.setInlineIndent(this.nzInlineIndent),o&&this.nzMenuService.setTheme(this.nzTheme),s&&(this.mode$.next(this.nzMode),!i.nzMode.isFirstChange()&&this.listOfNzSubMenuComponent&&this.listOfNzSubMenuComponent.forEach(a=>a.setOpenStateWithoutDebounce(!1)))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Hh),L(N1),L(Ri),L(Vn,8))},e.\u0275dir=Ge({type:e,selectors:[["","nz-menu",""]],contentQueries:function(i,n,r){if(1&i&&(Un(r,SE,5),Un(r,aVe,5)),2&i){let o;Mt(o=zt())&&(n.listOfNzMenuItemDirective=o),Mt(o=zt())&&(n.listOfNzSubMenuComponent=o)}},hostVars:34,hostBindings:function(i,n){2&i&&Dt("ant-dropdown-menu",n.isMenuInsideDropDown)("ant-dropdown-menu-root",n.isMenuInsideDropDown)("ant-dropdown-menu-light",n.isMenuInsideDropDown&&"light"===n.nzTheme)("ant-dropdown-menu-dark",n.isMenuInsideDropDown&&"dark"===n.nzTheme)("ant-dropdown-menu-vertical",n.isMenuInsideDropDown&&"vertical"===n.actualMode)("ant-dropdown-menu-horizontal",n.isMenuInsideDropDown&&"horizontal"===n.actualMode)("ant-dropdown-menu-inline",n.isMenuInsideDropDown&&"inline"===n.actualMode)("ant-dropdown-menu-inline-collapsed",n.isMenuInsideDropDown&&n.nzInlineCollapsed)("ant-menu",!n.isMenuInsideDropDown)("ant-menu-root",!n.isMenuInsideDropDown)("ant-menu-light",!n.isMenuInsideDropDown&&"light"===n.nzTheme)("ant-menu-dark",!n.isMenuInsideDropDown&&"dark"===n.nzTheme)("ant-menu-vertical",!n.isMenuInsideDropDown&&"vertical"===n.actualMode)("ant-menu-horizontal",!n.isMenuInsideDropDown&&"horizontal"===n.actualMode)("ant-menu-inline",!n.isMenuInsideDropDown&&"inline"===n.actualMode)("ant-menu-inline-collapsed",!n.isMenuInsideDropDown&&n.nzInlineCollapsed)("ant-menu-rtl","rtl"===n.dir)},inputs:{nzInlineIndent:"nzInlineIndent",nzTheme:"nzTheme",nzMode:"nzMode",nzInlineCollapsed:"nzInlineCollapsed",nzSelectable:"nzSelectable"},outputs:{nzClick:"nzClick"},exportAs:["nzMenu"],features:[vi([{provide:XZ,useClass:Hh},{provide:Hh,useFactory:lVe,deps:[[new ud,new qh,Hh],XZ]},{provide:N1,useFactory:cVe,deps:[[new ud,new qh,N1]]}]),Ht]}),Qe([ft()],e.prototype,"nzInlineCollapsed",void 0),Qe([ft()],e.prototype,"nzSelectable",void 0),e})(),ME=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Hs,Xu,go,Vh,Zr]}),e})(),Zu=(()=>{class e{constructor(i,n){this.elementRef=i,this.renderer=n,this.hidden=null,this.renderer.setAttribute(this.elementRef.nativeElement,"hidden","")}setHiddenAttribute(){this.hidden?this.renderer.setAttribute(this.elementRef.nativeElement,"hidden","string"==typeof this.hidden?this.hidden:""):this.renderer.removeAttribute(this.elementRef.nativeElement,"hidden")}ngOnChanges(){this.setHiddenAttribute()}ngAfterViewInit(){this.setHiddenAttribute()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Nn))},e.\u0275dir=Ge({type:e,selectors:[["","nz-button",""],["nz-button-group"],["","nz-icon",""],["","nz-menu-item",""],["","nz-submenu",""],["nz-select-top-control"],["nz-select-placeholder"],["nz-input-group"]],inputs:{hidden:"hidden"},features:[Ht]}),e})(),zE=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[Hs]}),e})();const hVe={disabled:!1};new Fe("nz-wave-global-options",{providedIn:"root",factory:function uVe(){return hVe}});let TE=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[Hs]}),e})();const dVe=["nz-button",""];function pVe(e,t){1&e&&Je(0,"span",1)}const fVe=["*"];let mVe=(()=>{class e{constructor(i,n,r,o,s,a){this.ngZone=i,this.elementRef=n,this.cdr=r,this.renderer=o,this.nzConfigService=s,this.directionality=a,this._nzModuleName="button",this.nzBlock=!1,this.nzGhost=!1,this.nzSearch=!1,this.nzLoading=!1,this.nzDanger=!1,this.disabled=!1,this.tabIndex=null,this.nzType=null,this.nzShape=null,this.nzSize="default",this.dir="ltr",this.destroy$=new He,this.loading$=new He,this.nzConfigService.getConfigChangeEventForComponent("button").pipe(Ye(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}insertSpan(i,n){i.forEach(r=>{if("#text"===r.nodeName){const o=n.createElement("span"),s=n.parentNode(r);n.insertBefore(s,o,r),n.appendChild(o,r)}})}assertIconOnly(i,n){const r=Array.from(i.childNodes),o=r.filter(c=>{const h=Array.from(c.childNodes||[]);return"SPAN"===c.nodeName&&h.length>0&&h.every(u=>"svg"===u.nodeName)}).length,s=r.every(c=>"#text"!==c.nodeName);r.filter(c=>{const h=Array.from(c.childNodes||[]);return!("SPAN"===c.nodeName&&h.length>0&&h.every(u=>"svg"===u.nodeName))}).every(c=>"SPAN"!==c.nodeName)&&s&&o>=1&&n.addClass(i,"ant-btn-icon-only")}ngOnInit(){this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.detectChanges()}),this.dir=this.directionality.value,this.ngZone.runOutsideAngular(()=>{$r(this.elementRef.nativeElement,"click",{capture:!0}).pipe(Ye(this.destroy$)).subscribe(i=>{(this.disabled&&"A"===i.target?.tagName||this.nzLoading)&&(i.preventDefault(),i.stopImmediatePropagation())})})}ngOnChanges(i){const{nzLoading:n}=i;n&&this.loading$.next(this.nzLoading)}ngAfterViewInit(){this.assertIconOnly(this.elementRef.nativeElement,this.renderer),this.insertSpan(this.elementRef.nativeElement.childNodes,this.renderer)}ngAfterContentInit(){this.loading$.pipe(Ho(this.nzLoading),rn(()=>!!this.nzIconDirectiveElement),Ye(this.destroy$)).subscribe(i=>{const n=this.nzIconDirectiveElement.nativeElement;i?this.renderer.setStyle(n,"display","none"):this.renderer.removeStyle(n,"display")})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Pt),L(yt),L(Ri),L(Nn),L(Va),L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["button","nz-button",""],["a","nz-button",""]],contentQueries:function(i,n,r){if(1&i&&Un(r,ko,5,yt),2&i){let o;Mt(o=zt())&&(n.nzIconDirectiveElement=o.first)}},hostAttrs:[1,"ant-btn"],hostVars:30,hostBindings:function(i,n){2&i&&(to("tabindex",n.disabled?-1:null===n.tabIndex?null:n.tabIndex)("disabled",n.disabled||null),Dt("ant-btn-primary","primary"===n.nzType)("ant-btn-dashed","dashed"===n.nzType)("ant-btn-link","link"===n.nzType)("ant-btn-text","text"===n.nzType)("ant-btn-circle","circle"===n.nzShape)("ant-btn-round","round"===n.nzShape)("ant-btn-lg","large"===n.nzSize)("ant-btn-sm","small"===n.nzSize)("ant-btn-dangerous",n.nzDanger)("ant-btn-loading",n.nzLoading)("ant-btn-background-ghost",n.nzGhost)("ant-btn-block",n.nzBlock)("ant-input-search-button",n.nzSearch)("ant-btn-rtl","rtl"===n.dir))},inputs:{nzBlock:"nzBlock",nzGhost:"nzGhost",nzSearch:"nzSearch",nzLoading:"nzLoading",nzDanger:"nzDanger",disabled:"disabled",tabIndex:"tabIndex",nzType:"nzType",nzShape:"nzShape",nzSize:"nzSize"},exportAs:["nzButton"],features:[Ht],attrs:dVe,ngContentSelectors:fVe,decls:2,vars:1,consts:[["nz-icon","","nzType","loading",4,"ngIf"],["nz-icon","","nzType","loading"]],template:function(i,n){1&i&&(Ln(),ne(0,pVe,1,0,"span",0),Mi(1)),2&i&&X("ngIf",n.nzLoading)},dependencies:[Fi,ko,Zu],encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzBlock",void 0),Qe([ft()],e.prototype,"nzGhost",void 0),Qe([ft()],e.prototype,"nzSearch",void 0),Qe([ft()],e.prototype,"nzLoading",void 0),Qe([ft()],e.prototype,"nzDanger",void 0),Qe([ft()],e.prototype,"disabled",void 0),Qe([mo()],e.prototype,"nzSize",void 0),e})(),KZ=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,TE,go,zE,zE,TE]}),e})(),xVe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),JZ=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,KZ,ME,go,Vh,Hs,d3,xVe,Zr,ME]}),e})();new Sn({originX:"start",originY:"top"},{overlayX:"start",overlayY:"top"}),new Sn({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"}),new Sn({originX:"start",originY:"top"},{overlayX:"end",overlayY:"bottom"}),new Sn({originX:"start",originY:"top"},{overlayX:"end",overlayY:"top"}),new Fe("NZ_TAB_SET");let rHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Y5,go,Zr,Hs,WZ,HT,JZ]}),e})(),uHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,tT,Vy,go,Zr]}),e})();const dHe=["overlay"];function pHe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(2);ie(1),cr(i.nzTitle)}}function fHe(e,t){if(1&e&&(Ee(0,"div",2)(1,"div",3)(2,"div",4),Je(3,"span",5),Pe(),Ee(4,"div",6),ne(5,pHe,2,1,"ng-container",7),Pe()()()),2&e){const i=de();Dt("ant-tooltip-rtl","rtl"===i.dir),X("ngClass",i._classMap)("ngStyle",i.nzOverlayStyle)("@.disabled",!(null==i.noAnimation||!i.noAnimation.nzNoAnimation))("nzNoAnimation",null==i.noAnimation?null:i.noAnimation.nzNoAnimation)("@zoomBigMotion","active"),ie(3),X("ngStyle",i._contentStyleMap),ie(1),X("ngStyle",i._contentStyleMap),ie(1),X("nzStringTemplateOutlet",i.nzTitle)("nzStringTemplateOutletContext",i.nzTitleContext)}}let mHe=(()=>{class e{constructor(i,n,r,o,s,a){this.elementRef=i,this.hostView=n,this.resolver=r,this.renderer=o,this.noAnimation=s,this.nzConfigService=a,this.visibleChange=new Re,this.internalVisible=!1,this.destroy$=new He,this.triggerDisposables=[]}get _title(){return this.title||this.directiveTitle||null}get _content(){return this.content||this.directiveContent||null}get _trigger(){return typeof this.trigger<"u"?this.trigger:"hover"}get _placement(){const i=this.placement;return Array.isArray(i)&&i.length>0?i:"string"==typeof i&&i?[i]:["top"]}get _visible(){return(typeof this.visible<"u"?this.visible:this.internalVisible)||!1}get _mouseEnterDelay(){return this.mouseEnterDelay||.15}get _mouseLeaveDelay(){return this.mouseLeaveDelay||.1}get _overlayClassName(){return this.overlayClassName||null}get _overlayStyle(){return this.overlayStyle||null}getProxyPropertyMap(){return{noAnimation:["noAnimation",()=>!!this.noAnimation]}}ngOnChanges(i){const{trigger:n}=i;n&&!n.isFirstChange()&&this.registerTriggers(),this.component&&this.updatePropertiesByChanges(i)}ngAfterViewInit(){this.createComponent(),this.registerTriggers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.clearTogglingTimer(),this.removeTriggerListeners()}show(){this.component?.show()}hide(){this.component?.hide()}updatePosition(){this.component&&this.component.updatePosition()}createComponent(){const i=this.componentRef;this.component=i.instance,this.renderer.removeChild(this.renderer.parentNode(this.elementRef.nativeElement),i.location.nativeElement),this.component.setOverlayOrigin(this.origin||this.elementRef),this.initProperties();const n=this.component.nzVisibleChange.pipe(Sl());n.pipe(Ye(this.destroy$)).subscribe(r=>{this.internalVisible=r,this.visibleChange.emit(r)}),n.pipe(rn(r=>r),yE(0,LT),rn(()=>Boolean(this.component?.overlay?.overlayRef)),Ye(this.destroy$)).subscribe(()=>{this.component?.updatePosition()})}registerTriggers(){const i=this.elementRef.nativeElement,n=this.trigger;if(this.removeTriggerListeners(),"hover"===n){let r;this.triggerDisposables.push(this.renderer.listen(i,"mouseenter",()=>{this.delayEnterLeave(!0,!0,this._mouseEnterDelay)})),this.triggerDisposables.push(this.renderer.listen(i,"mouseleave",()=>{this.delayEnterLeave(!0,!1,this._mouseLeaveDelay),this.component?.overlay.overlayRef&&!r&&(r=this.component.overlay.overlayRef.overlayElement,this.triggerDisposables.push(this.renderer.listen(r,"mouseenter",()=>{this.delayEnterLeave(!1,!0,this._mouseEnterDelay)})),this.triggerDisposables.push(this.renderer.listen(r,"mouseleave",()=>{this.delayEnterLeave(!1,!1,this._mouseLeaveDelay)})))}))}else"focus"===n?(this.triggerDisposables.push(this.renderer.listen(i,"focusin",()=>this.show())),this.triggerDisposables.push(this.renderer.listen(i,"focusout",()=>this.hide()))):"click"===n&&this.triggerDisposables.push(this.renderer.listen(i,"click",r=>{r.preventDefault(),this.show()}))}updatePropertiesByChanges(i){this.updatePropertiesByKeys(Object.keys(i))}updatePropertiesByKeys(i){const n={title:["nzTitle",()=>this._title],directiveTitle:["nzTitle",()=>this._title],content:["nzContent",()=>this._content],directiveContent:["nzContent",()=>this._content],trigger:["nzTrigger",()=>this._trigger],placement:["nzPlacement",()=>this._placement],visible:["nzVisible",()=>this._visible],mouseEnterDelay:["nzMouseEnterDelay",()=>this._mouseEnterDelay],mouseLeaveDelay:["nzMouseLeaveDelay",()=>this._mouseLeaveDelay],overlayClassName:["nzOverlayClassName",()=>this._overlayClassName],overlayStyle:["nzOverlayStyle",()=>this._overlayStyle],arrowPointAtCenter:["nzArrowPointAtCenter",()=>this.arrowPointAtCenter],...this.getProxyPropertyMap()};(i||Object.keys(n).filter(r=>!r.startsWith("directive"))).forEach(r=>{if(n[r]){const[o,s]=n[r];this.updateComponentValue(o,s())}}),this.component?.updateByDirective()}initProperties(){this.updatePropertiesByKeys()}updateComponentValue(i,n){typeof n<"u"&&(this.component[i]=n)}delayEnterLeave(i,n,r=-1){this.delayTimer?this.clearTogglingTimer():r>0?this.delayTimer=setTimeout(()=>{this.delayTimer=void 0,n?this.show():this.hide()},1e3*r):n&&i?this.show():this.hide()}removeTriggerListeners(){this.triggerDisposables.forEach(i=>i()),this.triggerDisposables.length=0}clearTogglingTimer(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=void 0)}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L($n),L(Lc),L(Nn),L(Ha),L(Va))},e.\u0275dir=Ge({type:e,features:[Ht]}),e})(),gHe=(()=>{class e{constructor(i,n,r){this.cdr=i,this.directionality=n,this.noAnimation=r,this.nzTitle=null,this.nzContent=null,this.nzArrowPointAtCenter=!1,this.nzOverlayStyle={},this.nzBackdrop=!1,this.nzVisibleChange=new He,this._visible=!1,this._trigger="hover",this.preferredPlacement="top",this.dir="ltr",this._classMap={},this._prefix="ant-tooltip",this._positions=[...JQ],this.destroy$=new He}set nzVisible(i){const n=jQ(i);this._visible!==n&&(this._visible=n,this.nzVisibleChange.next(n))}get nzVisible(){return this._visible}set nzTrigger(i){this._trigger=i}get nzTrigger(){return this._trigger}set nzPlacement(i){const n=i.map(r=>Pi[r]);this._positions=[...n,...JQ]}ngOnInit(){this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.nzVisibleChange.complete(),this.destroy$.next(),this.destroy$.complete()}show(){this.nzVisible||(this.isEmpty()||(this.nzVisible=!0,this.nzVisibleChange.next(!0),this.cdr.detectChanges()),this.origin&&this.overlay&&this.overlay.overlayRef&&"rtl"===this.overlay.overlayRef.getDirection()&&this.overlay.overlayRef.setDirection("ltr"))}hide(){this.nzVisible&&(this.nzVisible=!1,this.nzVisibleChange.next(!1),this.cdr.detectChanges())}updateByDirective(){this.updateStyles(),this.cdr.detectChanges(),Promise.resolve().then(()=>{this.updatePosition(),this.updateVisibilityByTitle()})}updatePosition(){this.origin&&this.overlay&&this.overlay.overlayRef&&this.overlay.overlayRef.updatePosition()}onPositionChange(i){this.preferredPlacement=N5(i),this.updateStyles(),this.cdr.detectChanges()}setOverlayOrigin(i){this.origin=i,this.cdr.markForCheck()}onClickOutside(i){!this.origin.nativeElement.contains(i.target)&&null!==this.nzTrigger&&this.hide()}updateVisibilityByTitle(){this.isEmpty()&&this.hide()}updateStyles(){this._classMap={[this.nzOverlayClassName]:!0,[`${this._prefix}-placement-${this.preferredPlacement}`]:!0}}}return e.\u0275fac=function(i){return new(i||e)(L(Ri),L(Vn,8),L(Ha))},e.\u0275dir=Ge({type:e,viewQuery:function(i,n){if(1&i&&Ui(dHe,5),2&i){let r;Mt(r=zt())&&(n.overlay=r.first)}}}),e})(),dK=(()=>{class e extends mHe{constructor(i,n,r,o,s){super(i,n,r,o,s),this.titleContext=null,this.trigger="hover",this.placement="top",this.visibleChange=new Re,this.componentRef=this.hostView.createComponent(yHe)}getProxyPropertyMap(){return{...super.getProxyPropertyMap(),nzTooltipColor:["nzColor",()=>this.nzTooltipColor],nzTooltipTitleContext:["nzTitleContext",()=>this.titleContext]}}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L($n),L(Lc),L(Nn),L(Ha,9))},e.\u0275dir=Ge({type:e,selectors:[["","nz-tooltip",""]],hostVars:2,hostBindings:function(i,n){2&i&&Dt("ant-tooltip-open",n.visible)},inputs:{title:["nzTooltipTitle","title"],titleContext:["nzTooltipTitleContext","titleContext"],directiveTitle:["nz-tooltip","directiveTitle"],trigger:["nzTooltipTrigger","trigger"],placement:["nzTooltipPlacement","placement"],origin:["nzTooltipOrigin","origin"],visible:["nzTooltipVisible","visible"],mouseEnterDelay:["nzTooltipMouseEnterDelay","mouseEnterDelay"],mouseLeaveDelay:["nzTooltipMouseLeaveDelay","mouseLeaveDelay"],overlayClassName:["nzTooltipOverlayClassName","overlayClassName"],overlayStyle:["nzTooltipOverlayStyle","overlayStyle"],arrowPointAtCenter:["nzTooltipArrowPointAtCenter","arrowPointAtCenter"],nzTooltipColor:"nzTooltipColor"},outputs:{visibleChange:"nzTooltipVisibleChange"},exportAs:["nzTooltip"],features:[Ci]}),Qe([ft()],e.prototype,"arrowPointAtCenter",void 0),e})(),yHe=(()=>{class e extends gHe{constructor(i,n,r){super(i,n,r),this.nzTitle=null,this.nzTitleContext=null,this._contentStyleMap={}}isEmpty(){return function vHe(e){return!(e instanceof Tn||""!==e&&xc(e))}(this.nzTitle)}updateStyles(){const i=this.nzColor&&function AFe(e){return-1!==DFe.indexOf(e)}(this.nzColor);this._classMap={[this.nzOverlayClassName]:!0,[`${this._prefix}-placement-${this.preferredPlacement}`]:!0,[`${this._prefix}-${this.nzColor}`]:i},this._contentStyleMap={backgroundColor:this.nzColor&&!i?this.nzColor:null}}}return e.\u0275fac=function(i){return new(i||e)(L(Ri),L(Vn,8),L(Ha,9))},e.\u0275cmp=ut({type:e,selectors:[["nz-tooltip"]],exportAs:["nzTooltipComponent"],features:[Ci],decls:2,vars:5,consts:[["cdkConnectedOverlay","","nzConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayPush","nzArrowPointAtCenter","overlayOutsideClick","detach","positionChange"],["overlay","cdkConnectedOverlay"],[1,"ant-tooltip",3,"ngClass","ngStyle","nzNoAnimation"],[1,"ant-tooltip-content"],[1,"ant-tooltip-arrow"],[1,"ant-tooltip-arrow-content",3,"ngStyle"],[1,"ant-tooltip-inner",3,"ngStyle"],[4,"nzStringTemplateOutlet","nzStringTemplateOutletContext"]],template:function(i,n){1&i&&(ne(0,fHe,6,11,"ng-template",0,1,jn),pt("overlayOutsideClick",function(o){return n.onClickOutside(o)})("detach",function(){return n.hide()})("positionChange",function(o){return n.onPositionChange(o)})),2&i&&X("cdkConnectedOverlayOrigin",n.origin)("cdkConnectedOverlayOpen",n._visible)("cdkConnectedOverlayPositions",n._positions)("cdkConnectedOverlayPush",!0)("nzArrowPointAtCenter",n.nzArrowPointAtCenter)},dependencies:[Nm,Tp,u3,vo,eZ,Ha],encapsulation:2,data:{animation:[qZ]},changeDetection:0}),e})(),IE=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,Zr,d3,Vh]}),e})(),wHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,Zr,d3,Vh,IE]}),e})(),HHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),UHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,GT,go,Zr,Vh,HHe]}),e})(),GHe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,go,Zr,Vh]}),e})(),aUe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ji,Zr,un]}),e})(),pK=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,go,Hs]}),e})();function fUe(e,t){if(1&e&&(Yt(0),Je(1,"img",5),Gt()),2&e){const i=de(2);ie(1),X("src",i.nzNotFoundImage,fd)("alt",i.isContentString?i.nzNotFoundContent:"empty")}}function mUe(e,t){if(1&e&&(Yt(0),ne(1,fUe,2,2,"ng-container",4),Gt()),2&e){const i=de();ie(1),X("nzStringTemplateOutlet",i.nzNotFoundImage)}}function gUe(e,t){1&e&&Je(0,"nz-empty-default")}function vUe(e,t){1&e&&Je(0,"nz-empty-simple")}function yUe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(2);ie(1),$a(" ",i.isContentString?i.nzNotFoundContent:i.locale.description," ")}}function _Ue(e,t){if(1&e&&(Ee(0,"p",6),ne(1,yUe,2,1,"ng-container",4),Pe()),2&e){const i=de();ie(1),X("nzStringTemplateOutlet",i.nzNotFoundContent)}}function bUe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(2);ie(1),$a(" ",i.nzNotFoundFooter," ")}}function xUe(e,t){if(1&e&&(Ee(0,"div",7),ne(1,bUe,2,1,"ng-container",4),Pe()),2&e){const i=de();ie(1),X("nzStringTemplateOutlet",i.nzNotFoundFooter)}}function wUe(e,t){1&e&&Je(0,"nz-empty",6),2&e&&X("nzNotFoundImage","simple")}function CUe(e,t){1&e&&Je(0,"nz-empty",7),2&e&&X("nzNotFoundImage","simple")}function SUe(e,t){1&e&&Je(0,"nz-empty")}function MUe(e,t){1&e&&(Yt(0,2),ne(1,wUe,1,1,"nz-empty",3),ne(2,CUe,1,1,"nz-empty",4),ne(3,SUe,1,0,"nz-empty",5),Gt()),2&e&&(X("ngSwitch",de().size),ie(1),X("ngSwitchCase","normal"),ie(1),X("ngSwitchCase","small"))}function zUe(e,t){}function TUe(e,t){1&e&&ne(0,zUe,0,0,"ng-template",8),2&e&&X("cdkPortalOutlet",de(2).contentPortal)}function EUe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(2);ie(1),$a(" ",i.content," ")}}function DUe(e,t){if(1&e&&(Yt(0),ne(1,TUe,1,1,null,1),ne(2,EUe,2,1,"ng-container",1),Gt()),2&e){const i=de();ie(1),X("ngIf","string"!==i.contentType),ie(1),X("ngIf","string"===i.contentType)}}const AUe=new Fe("nz-empty-component-name");let PUe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-empty-default"]],exportAs:["nzEmptyDefault"],decls:12,vars:0,consts:[["width","184","height","152","viewBox","0 0 184 152","xmlns","http://www.w3.org/2000/svg",1,"ant-empty-img-default"],["fill","none","fill-rule","evenodd"],["transform","translate(24 31.67)"],["cx","67.797","cy","106.89","rx","67.797","ry","12.668",1,"ant-empty-img-default-ellipse"],["d","M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",1,"ant-empty-img-default-path-1"],["d","M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z","transform","translate(13.56)",1,"ant-empty-img-default-path-2"],["d","M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",1,"ant-empty-img-default-path-3"],["d","M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",1,"ant-empty-img-default-path-4"],["d","M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",1,"ant-empty-img-default-path-5"],["transform","translate(149.65 15.383)",1,"ant-empty-img-default-g"],["cx","20.654","cy","3.167","rx","2.849","ry","2.815"],["d","M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"]],template:function(i,n){1&i&&(O7(),Ee(0,"svg",0)(1,"g",1)(2,"g",2),Je(3,"ellipse",3)(4,"path",4)(5,"path",5)(6,"path",6)(7,"path",7),Pe(),Je(8,"path",8),Ee(9,"g",9),Je(10,"ellipse",10)(11,"path",11),Pe()()())},encapsulation:2,changeDetection:0}),e})(),IUe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-empty-simple"]],exportAs:["nzEmptySimple"],decls:6,vars:0,consts:[["width","64","height","41","viewBox","0 0 64 41","xmlns","http://www.w3.org/2000/svg",1,"ant-empty-img-simple"],["transform","translate(0 1)","fill","none","fill-rule","evenodd"],["cx","32","cy","33","rx","32","ry","7",1,"ant-empty-img-simple-ellipse"],["fill-rule","nonzero",1,"ant-empty-img-simple-g"],["d","M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"],["d","M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",1,"ant-empty-img-simple-path"]],template:function(i,n){1&i&&(O7(),Ee(0,"svg",0)(1,"g",1),Je(2,"ellipse",2),Ee(3,"g",3),Je(4,"path",4)(5,"path",5),Pe()()())},encapsulation:2,changeDetection:0}),e})();const OUe=["default","simple"];let kUe=(()=>{class e{constructor(i,n){this.i18n=i,this.cdr=n,this.nzNotFoundImage="default",this.isContentString=!1,this.isImageBuildIn=!0,this.destroy$=new He}ngOnChanges(i){const{nzNotFoundContent:n,nzNotFoundImage:r}=i;if(n&&(this.isContentString="string"==typeof n.currentValue),r){const o=r.currentValue||"default";this.isImageBuildIn=OUe.findIndex(s=>s===o)>-1}}ngOnInit(){this.i18n.localeChange.pipe(Ye(this.destroy$)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Empty"),this.cdr.markForCheck()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(G4),L(Ri))},e.\u0275cmp=ut({type:e,selectors:[["nz-empty"]],hostAttrs:[1,"ant-empty"],inputs:{nzNotFoundImage:"nzNotFoundImage",nzNotFoundContent:"nzNotFoundContent",nzNotFoundFooter:"nzNotFoundFooter"},exportAs:["nzEmpty"],features:[Ht],decls:6,vars:5,consts:[[1,"ant-empty-image"],[4,"ngIf"],["class","ant-empty-description",4,"ngIf"],["class","ant-empty-footer",4,"ngIf"],[4,"nzStringTemplateOutlet"],[3,"src","alt"],[1,"ant-empty-description"],[1,"ant-empty-footer"]],template:function(i,n){1&i&&(Ee(0,"div",0),ne(1,mUe,2,1,"ng-container",1),ne(2,gUe,1,0,"nz-empty-default",1),ne(3,vUe,1,0,"nz-empty-simple",1),Pe(),ne(4,_Ue,2,1,"p",2),ne(5,xUe,2,1,"div",3)),2&i&&(ie(1),X("ngIf",!n.isImageBuildIn),ie(1),X("ngIf",n.isImageBuildIn&&"simple"!==n.nzNotFoundImage),ie(1),X("ngIf",n.isImageBuildIn&&"simple"===n.nzNotFoundImage),ie(1),X("ngIf",null!==n.nzNotFoundContent),ie(1),X("ngIf",n.nzNotFoundFooter))},dependencies:[Fi,vo,PUe,IUe],encapsulation:2,changeDetection:0}),e})(),fK=(()=>{class e{constructor(i,n,r,o){this.configService=i,this.viewContainerRef=n,this.cdr=r,this.injector=o,this.contentType="string",this.size="",this.destroy$=new He}ngOnChanges(i){i.nzComponentName&&(this.size=function NUe(e){switch(e){case"table":case"list":return"normal";case"select":case"tree-select":case"cascader":case"transfer":return"small";default:return""}}(i.nzComponentName.currentValue)),i.specificContent&&!i.specificContent.isFirstChange()&&(this.content=i.specificContent.currentValue,this.renderEmpty())}ngOnInit(){this.subscribeDefaultEmptyContentChange()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}renderEmpty(){const i=this.content;if("string"==typeof i)this.contentType="string";else if(i instanceof Tn){const n={$implicit:this.nzComponentName};this.contentType="template",this.contentPortal=new c3(i,this.viewContainerRef,n)}else if(i instanceof j3){const n=Bo.create({parent:this.injector,providers:[{provide:AUe,useValue:this.nzComponentName}]});this.contentType="component",this.contentPortal=new YT(i,this.viewContainerRef,n)}else this.contentType="string",this.contentPortal=void 0;this.cdr.detectChanges()}subscribeDefaultEmptyContentChange(){this.configService.getConfigChangeEventForComponent("empty").pipe(Ho(!0),Ye(this.destroy$)).subscribe(()=>{this.content=this.specificContent||this.getUserDefaultEmptyContent(),this.renderEmpty()})}getUserDefaultEmptyContent(){return(this.configService.getConfigForComponent("empty")||{}).nzDefaultEmptyContent}}return e.\u0275fac=function(i){return new(i||e)(L(Va),L($n),L(Ri),L(Bo))},e.\u0275cmp=ut({type:e,selectors:[["nz-embed-empty"]],inputs:{nzComponentName:"nzComponentName",specificContent:"specificContent"},exportAs:["nzEmbedEmpty"],features:[Ht],decls:2,vars:2,consts:[[3,"ngSwitch",4,"ngIf"],[4,"ngIf"],[3,"ngSwitch"],["class","ant-empty-normal",3,"nzNotFoundImage",4,"ngSwitchCase"],["class","ant-empty-small",3,"nzNotFoundImage",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"ant-empty-normal",3,"nzNotFoundImage"],[1,"ant-empty-small",3,"nzNotFoundImage"],[3,"cdkPortalOutlet"]],template:function(i,n){1&i&&(ne(0,MUe,4,3,"ng-container",0),ne(1,DUe,3,2,"ng-container",1)),2&i&&(X("ngIf",!n.content&&null!==n.specificContent),ie(1),X("ngIf",n.content))},dependencies:[Fi,Kh,zp,Yg,sLe,kUe],encapsulation:2,changeDetection:0}),e})(),mK=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,GT,Zr,Vy]}),e})(),YUe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Y5]}),e})(),yK=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,BQ,Hs]}),e})(),Wje=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,YUe,yK,pK,Zr,mK]}),e})(),Kje=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Y5,Zr,Vh]}),e})();function Jje(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(2);ie(1),cr(i.nzText)}}function eYe(e,t){if(1&e&&(Ee(0,"span",1),ne(1,Jje,2,1,"ng-container",2),Pe()),2&e){const i=de();ie(1),X("nzStringTemplateOutlet",i.nzText)}}let tYe=(()=>{class e{constructor(){this.nzType="horizontal",this.nzOrientation="center",this.nzDashed=!1,this.nzPlain=!1}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-divider"]],hostAttrs:[1,"ant-divider"],hostVars:16,hostBindings:function(i,n){2&i&&Dt("ant-divider-horizontal","horizontal"===n.nzType)("ant-divider-vertical","vertical"===n.nzType)("ant-divider-with-text",n.nzText)("ant-divider-plain",n.nzPlain)("ant-divider-with-text-left",n.nzText&&"left"===n.nzOrientation)("ant-divider-with-text-right",n.nzText&&"right"===n.nzOrientation)("ant-divider-with-text-center",n.nzText&&"center"===n.nzOrientation)("ant-divider-dashed",n.nzDashed)},inputs:{nzText:"nzText",nzType:"nzType",nzOrientation:"nzOrientation",nzDashed:"nzDashed",nzPlain:"nzPlain"},exportAs:["nzDivider"],decls:1,vars:1,consts:[["class","ant-divider-inner-text",4,"ngIf"],[1,"ant-divider-inner-text"],[4,"nzStringTemplateOutlet"]],template:function(i,n){1&i&&ne(0,eYe,2,1,"span",0),2&i&&X("ngIf",n.nzText)},dependencies:[Fi,vo],encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzDashed",void 0),Qe([ft()],e.prototype,"nzPlain",void 0),e})(),iYe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Zr]}),e})();function TK(...e){const t=l7(e);return Mn((i,n)=>{const r=e.length,o=new Array(r);let s=e.map(()=>!1),a=!1;for(let l=0;l<r;l++)eo(e[l]).subscribe($i(n,c=>{o[l]=c,!a&&!s[l]&&(s[l]=!0,(a=s.every(Tc))&&(s=null))},Yh));i.subscribe($i(n,l=>{if(a){const c=[l,...o];n.next(t?t(...c):c)}}))})}const EK=["*"];function nYe(e,t){}function rYe(e,t){1&e&&ne(0,nYe,0,0,"ng-template",4),2&e&&X("ngTemplateOutlet",de().template)}function oYe(e,t){1&e&&zi(0),2&e&&cr(de().label)}function sYe(e,t){1&e&&Je(0,"span",7)}function aYe(e,t){if(1&e&&(Ee(0,"div",5),ne(1,sYe,1,0,"span",6),Pe()),2&e){const i=de();ie(1),X("ngIf",!i.icon)("ngIfElse",i.icon)}}function lYe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de();ie(1),cr(i.nzLabel)}}function cYe(e,t){if(1&e&&(Ee(0,"div",4),Je(1,"nz-embed-empty",5),Pe()),2&e){const i=de();ie(1),X("specificContent",i.notFoundContent)}}function hYe(e,t){1&e&&Je(0,"nz-option-item-group",9),2&e&&X("nzLabel",de().$implicit.groupLabel)}function uYe(e,t){if(1&e){const i=Ji();Ee(0,"nz-option-item",10),pt("itemHover",function(r){return ai(i),li(de(2).onItemHover(r))})("itemClick",function(r){return ai(i),li(de(2).onItemClick(r))}),Pe()}if(2&e){const i=de().$implicit,n=de();X("icon",n.menuItemSelectedIcon)("customContent",i.nzCustomContent)("template",i.template)("grouped",!!i.groupLabel)("disabled",i.nzDisabled)("showState","tags"===n.mode||"multiple"===n.mode)("label",i.nzLabel)("compareWith",n.compareWith)("activatedValue",n.activatedValue)("listOfSelectedValue",n.listOfSelectedValue)("value",i.nzValue)}}function dYe(e,t){1&e&&(Yt(0,6),ne(1,hYe,1,1,"nz-option-item-group",7),ne(2,uYe,1,11,"nz-option-item",8),Gt()),2&e&&(X("ngSwitch",t.$implicit.type),ie(1),X("ngSwitchCase","group"),ie(1),X("ngSwitchCase","item"))}function pYe(e,t){}function fYe(e,t){1&e&&Mi(0)}const mYe=["inputElement"],gYe=["mirrorElement"];function vYe(e,t){1&e&&Je(0,"span",3,4)}function yYe(e,t){if(1&e&&(Ee(0,"div",4),zi(1),Pe()),2&e){const i=de(2);ie(1),cr(i.label)}}function _Ye(e,t){1&e&&zi(0),2&e&&cr(de(2).label)}function bYe(e,t){if(1&e&&(Yt(0),ne(1,yYe,2,1,"div",2),ne(2,_Ye,1,1,"ng-template",null,3,jn),Gt()),2&e){const i=gn(3),n=de();ie(1),X("ngIf",n.deletable)("ngIfElse",i)}}function xYe(e,t){1&e&&Je(0,"span",7)}function wYe(e,t){if(1&e){const i=Ji();Ee(0,"span",5),pt("click",function(r){return ai(i),li(de().onDelete(r))}),ne(1,xYe,1,0,"span",6),Pe()}if(2&e){const i=de();ie(1),X("ngIf",!i.removeIcon)("ngIfElse",i.removeIcon)}}const CYe=function(e){return{$implicit:e}};function SYe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de();ie(1),$a(" ",i.placeholder," ")}}function MYe(e,t){if(1&e&&Je(0,"nz-select-item",6),2&e){const i=de(2);X("deletable",!1)("disabled",!1)("removeIcon",i.removeIcon)("label",i.listOfTopItem[0].nzLabel)("contentTemplateOutlet",i.customTemplate)("contentTemplateOutletContext",i.listOfTopItem[0])}}function zYe(e,t){if(1&e){const i=Ji();Yt(0),Ee(1,"nz-select-search",4),pt("isComposingChange",function(r){return ai(i),li(de().isComposingChange(r))})("valueChange",function(r){return ai(i),li(de().onInputValueChange(r))}),Pe(),ne(2,MYe,1,6,"nz-select-item",5),Gt()}if(2&e){const i=de();ie(1),X("nzId",i.nzId)("disabled",i.disabled)("value",i.inputValue)("showInput",i.showSearch)("mirrorSync",!1)("autofocus",i.autofocus)("focusTrigger",i.open),ie(1),X("ngIf",i.isShowSingleLabel)}}function TYe(e,t){if(1&e){const i=Ji();Ee(0,"nz-select-item",9),pt("delete",function(){const o=ai(i).$implicit;return li(de(2).onDeleteItem(o.contentTemplateOutletContext))}),Pe()}if(2&e){const i=t.$implicit,n=de(2);X("removeIcon",n.removeIcon)("label",i.nzLabel)("disabled",i.nzDisabled||n.disabled)("contentTemplateOutlet",i.contentTemplateOutlet)("deletable",!0)("contentTemplateOutletContext",i.contentTemplateOutletContext)}}function EYe(e,t){if(1&e){const i=Ji();Yt(0),ne(1,TYe,1,6,"nz-select-item",7),Ee(2,"nz-select-search",8),pt("isComposingChange",function(r){return ai(i),li(de().isComposingChange(r))})("valueChange",function(r){return ai(i),li(de().onInputValueChange(r))}),Pe(),Gt()}if(2&e){const i=de();ie(1),X("ngForOf",i.listOfSlicedItem)("ngForTrackBy",i.trackValue),ie(1),X("nzId",i.nzId)("disabled",i.disabled)("value",i.inputValue)("autofocus",i.autofocus)("showInput",!0)("mirrorSync",!0)("focusTrigger",i.open)}}function DYe(e,t){1&e&&Je(0,"nz-select-placeholder",10),2&e&&X("placeholder",de().placeHolder)}function AYe(e,t){1&e&&Je(0,"span",1)}function PYe(e,t){1&e&&Je(0,"span",3)}function IYe(e,t){1&e&&Je(0,"span",8)}function OYe(e,t){1&e&&Je(0,"span",9)}function kYe(e,t){if(1&e&&(Yt(0),ne(1,IYe,1,0,"span",6),ne(2,OYe,1,0,"span",7),Gt()),2&e){const i=de(2);ie(1),X("ngIf",!i.search),ie(1),X("ngIf",i.search)}}function NYe(e,t){1&e&&Je(0,"span",11),2&e&&X("nzType",de().$implicit)}function LYe(e,t){if(1&e&&(Yt(0),ne(1,NYe,1,1,"span",10),Gt()),2&e){const i=t.$implicit;ie(1),X("ngIf",i)}}function RYe(e,t){1&e&&ne(0,LYe,2,1,"ng-container",2),2&e&&X("nzStringTemplateOutlet",de(2).suffixIcon)}function FYe(e,t){if(1&e&&(ne(0,kYe,3,2,"ng-container",4),ne(1,RYe,1,1,"ng-template",null,5,jn)),2&e){const i=gn(2),n=de();X("ngIf",n.showArrow&&!n.suffixIcon)("ngIfElse",i)}}function BYe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de();ie(1),cr(i.feedbackIcon)}}function VYe(e,t){1&e&&Je(0,"nz-form-item-feedback-icon",8),2&e&&X("status",de(3).status)}function HYe(e,t){if(1&e&&ne(0,VYe,1,1,"nz-form-item-feedback-icon",7),2&e){const i=de(2);X("ngIf",i.hasFeedback&&!!i.status)}}function UYe(e,t){if(1&e&&(Ee(0,"nz-select-arrow",5),ne(1,HYe,1,1,"ng-template",null,6,jn),Pe()),2&e){const i=gn(2),n=de();X("showArrow",n.nzShowArrow)("loading",n.nzLoading)("search",n.nzOpen&&n.nzShowSearch)("suffixIcon",n.nzSuffixIcon)("feedbackIcon",i)}}function jYe(e,t){if(1&e){const i=Ji();Ee(0,"nz-select-clear",9),pt("clear",function(){return ai(i),li(de().onClearSelection())}),Pe()}2&e&&X("clearIcon",de().nzClearIcon)}function YYe(e,t){if(1&e){const i=Ji();Ee(0,"nz-option-container",10),pt("keydown",function(r){return ai(i),li(de().onKeyDown(r))})("itemClick",function(r){return ai(i),li(de().onItemClick(r))})("scrollToBottom",function(){return ai(i),li(de().nzScrollToBottom.emit())}),Pe()}if(2&e){const i=de();Dt("ant-select-dropdown-placement-bottomLeft","bottomLeft"===i.dropDownPosition)("ant-select-dropdown-placement-topLeft","topLeft"===i.dropDownPosition)("ant-select-dropdown-placement-bottomRight","bottomRight"===i.dropDownPosition)("ant-select-dropdown-placement-topRight","topRight"===i.dropDownPosition),X("ngStyle",i.nzDropdownStyle)("itemSize",i.nzOptionHeightPx)("maxItemLength",i.nzOptionOverflowSize)("matchWidth",i.nzDropdownMatchSelectWidth)("@slideMotion","enter")("@.disabled",!(null==i.noAnimation||!i.noAnimation.nzNoAnimation))("nzNoAnimation",null==i.noAnimation?null:i.noAnimation.nzNoAnimation)("listOfContainerItem",i.listOfContainerItem)("menuItemSelectedIcon",i.nzMenuItemSelectedIcon)("notFoundContent",i.nzNotFoundContent)("activatedValue",i.activatedValue)("listOfSelectedValue",i.listOfValue)("dropdownRender",i.nzDropdownRender)("compareWith",i.compareWith)("mode",i.nzMode)}}let FE=(()=>{class e{constructor(){this.nzLabel=null,this.changes=new He}ngOnChanges(){this.changes.next()}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-option-group"]],inputs:{nzLabel:"nzLabel"},exportAs:["nzOptionGroup"],features:[Ht],ngContentSelectors:EK,decls:1,vars:0,template:function(i,n){1&i&&(Ln(),Mi(0))},encapsulation:2,changeDetection:0}),e})(),GYe=(()=>{class e{constructor(i,n,r){this.elementRef=i,this.ngZone=n,this.destroy$=r,this.selected=!1,this.activated=!1,this.grouped=!1,this.customContent=!1,this.template=null,this.disabled=!1,this.showState=!1,this.label=null,this.value=null,this.activatedValue=null,this.listOfSelectedValue=[],this.icon=null,this.itemClick=new Re,this.itemHover=new Re}ngOnChanges(i){const{value:n,activatedValue:r,listOfSelectedValue:o}=i;(n||o)&&(this.selected=this.listOfSelectedValue.some(s=>this.compareWith(s,this.value))),(n||r)&&(this.activated=this.compareWith(this.activatedValue,this.value))}ngOnInit(){this.ngZone.runOutsideAngular(()=>{$r(this.elementRef.nativeElement,"click").pipe(Ye(this.destroy$)).subscribe(()=>{this.disabled||this.ngZone.run(()=>this.itemClick.emit(this.value))}),$r(this.elementRef.nativeElement,"mouseenter").pipe(Ye(this.destroy$)).subscribe(()=>{this.disabled||this.ngZone.run(()=>this.itemHover.emit(this.value))})})}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Pt),L(Ba))},e.\u0275cmp=ut({type:e,selectors:[["nz-option-item"]],hostAttrs:[1,"ant-select-item","ant-select-item-option"],hostVars:9,hostBindings:function(i,n){2&i&&(to("title",n.label),Dt("ant-select-item-option-grouped",n.grouped)("ant-select-item-option-selected",n.selected&&!n.disabled)("ant-select-item-option-disabled",n.disabled)("ant-select-item-option-active",n.activated&&!n.disabled))},inputs:{grouped:"grouped",customContent:"customContent",template:"template",disabled:"disabled",showState:"showState",label:"label",value:"value",activatedValue:"activatedValue",listOfSelectedValue:"listOfSelectedValue",icon:"icon",compareWith:"compareWith"},outputs:{itemClick:"itemClick",itemHover:"itemHover"},features:[vi([Ba]),Ht],decls:5,vars:3,consts:[[1,"ant-select-item-option-content"],[3,"ngIf","ngIfElse"],["noCustomContent",""],["class","ant-select-item-option-state","style","user-select: none","unselectable","on",4,"ngIf"],[3,"ngTemplateOutlet"],["unselectable","on",1,"ant-select-item-option-state",2,"user-select","none"],["nz-icon","","nzType","check","class","ant-select-selected-icon",4,"ngIf","ngIfElse"],["nz-icon","","nzType","check",1,"ant-select-selected-icon"]],template:function(i,n){if(1&i&&(Ee(0,"div",0),ne(1,rYe,1,1,"ng-template",1),ne(2,oYe,1,1,"ng-template",null,2,jn),Pe(),ne(4,aYe,2,2,"div",3)),2&i){const r=gn(3);ie(1),X("ngIf",n.customContent)("ngIfElse",r),ie(3),X("ngIf",n.showState&&n.selected)}},dependencies:[Fi,as,ko,Zu],encapsulation:2,changeDetection:0}),e})(),WYe=(()=>{class e{constructor(){this.nzLabel=null}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-option-item-group"]],hostAttrs:[1,"ant-select-item","ant-select-item-group"],inputs:{nzLabel:"nzLabel"},decls:1,vars:1,consts:[[4,"nzStringTemplateOutlet"]],template:function(i,n){1&i&&ne(0,lYe,2,1,"ng-container",0),2&i&&X("nzStringTemplateOutlet",n.nzLabel)},dependencies:[vo],encapsulation:2,changeDetection:0}),e})(),qYe=(()=>{class e{constructor(){this.notFoundContent=void 0,this.menuItemSelectedIcon=null,this.dropdownRender=null,this.activatedValue=null,this.listOfSelectedValue=[],this.mode="default",this.matchWidth=!0,this.itemSize=32,this.maxItemLength=8,this.listOfContainerItem=[],this.itemClick=new Re,this.scrollToBottom=new Re,this.scrolledIndex=0}onItemClick(i){this.itemClick.emit(i)}onItemHover(i){this.activatedValue=i}trackValue(i,n){return n.key}onScrolledIndexChange(i){this.scrolledIndex=i,i===this.listOfContainerItem.length-this.maxItemLength&&this.scrollToBottom.emit()}scrollToActivatedValue(){const i=this.listOfContainerItem.findIndex(n=>this.compareWith(n.key,this.activatedValue));(i<this.scrolledIndex||i>=this.scrolledIndex+this.maxItemLength)&&this.cdkVirtualScrollViewport.scrollToIndex(i||0)}ngOnChanges(i){const{listOfContainerItem:n,activatedValue:r}=i;(n||r)&&this.scrollToActivatedValue()}ngAfterViewInit(){setTimeout(()=>this.scrollToActivatedValue())}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-option-container"]],viewQuery:function(i,n){if(1&i&&Ui(T5,7),2&i){let r;Mt(r=zt())&&(n.cdkVirtualScrollViewport=r.first)}},hostAttrs:[1,"ant-select-dropdown"],inputs:{notFoundContent:"notFoundContent",menuItemSelectedIcon:"menuItemSelectedIcon",dropdownRender:"dropdownRender",activatedValue:"activatedValue",listOfSelectedValue:"listOfSelectedValue",compareWith:"compareWith",mode:"mode",matchWidth:"matchWidth",itemSize:"itemSize",maxItemLength:"maxItemLength",listOfContainerItem:"listOfContainerItem"},outputs:{itemClick:"itemClick",scrollToBottom:"scrollToBottom"},exportAs:["nzOptionContainer"],features:[Ht],decls:5,vars:14,consts:[["class","ant-select-item-empty",4,"ngIf"],[3,"itemSize","maxBufferPx","minBufferPx","scrolledIndexChange"],["cdkVirtualFor","",3,"cdkVirtualForOf","cdkVirtualForTrackBy","cdkVirtualForTemplateCacheSize"],[3,"ngTemplateOutlet"],[1,"ant-select-item-empty"],["nzComponentName","select",3,"specificContent"],[3,"ngSwitch"],[3,"nzLabel",4,"ngSwitchCase"],[3,"icon","customContent","template","grouped","disabled","showState","label","compareWith","activatedValue","listOfSelectedValue","value","itemHover","itemClick",4,"ngSwitchCase"],[3,"nzLabel"],[3,"icon","customContent","template","grouped","disabled","showState","label","compareWith","activatedValue","listOfSelectedValue","value","itemHover","itemClick"]],template:function(i,n){1&i&&(Ee(0,"div"),ne(1,cYe,2,1,"div",0),Ee(2,"cdk-virtual-scroll-viewport",1),pt("scrolledIndexChange",function(o){return n.onScrolledIndexChange(o)}),ne(3,dYe,3,3,"ng-template",2),Pe(),ne(4,pYe,0,0,"ng-template",3),Pe()),2&i&&(ie(1),X("ngIf",0===n.listOfContainerItem.length),ie(1),Xn("height",n.listOfContainerItem.length*n.itemSize,"px")("max-height",n.itemSize*n.maxItemLength,"px"),Dt("full-width",!n.matchWidth),X("itemSize",n.itemSize)("maxBufferPx",n.itemSize*n.maxItemLength)("minBufferPx",n.itemSize*n.maxItemLength),ie(1),X("cdkVirtualForOf",n.listOfContainerItem)("cdkVirtualForTrackBy",n.trackValue)("cdkVirtualForTemplateCacheSize",0),ie(1),X("ngTemplateOutlet",n.dropdownRender))},dependencies:[Fi,as,Kh,zp,ZNe,nLe,T5,fK,GYe,WYe],encapsulation:2,changeDetection:0}),e})(),DK=(()=>{class e{constructor(i,n){this.nzOptionGroupComponent=i,this.destroy$=n,this.changes=new He,this.groupLabel=null,this.nzLabel=null,this.nzValue=null,this.nzDisabled=!1,this.nzHide=!1,this.nzCustomContent=!1}ngOnInit(){this.nzOptionGroupComponent&&this.nzOptionGroupComponent.changes.pipe(Ho(!0),Ye(this.destroy$)).subscribe(()=>{this.groupLabel=this.nzOptionGroupComponent.nzLabel})}ngOnChanges(){this.changes.next()}}return e.\u0275fac=function(i){return new(i||e)(L(FE,8),L(Ba))},e.\u0275cmp=ut({type:e,selectors:[["nz-option"]],viewQuery:function(i,n){if(1&i&&Ui(Tn,7),2&i){let r;Mt(r=zt())&&(n.template=r.first)}},inputs:{nzLabel:"nzLabel",nzValue:"nzValue",nzDisabled:"nzDisabled",nzHide:"nzHide",nzCustomContent:"nzCustomContent"},exportAs:["nzOption"],features:[vi([Ba]),Ht],ngContentSelectors:EK,decls:1,vars:0,template:function(i,n){1&i&&(Ln(),ne(0,fYe,1,0,"ng-template"))},encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzDisabled",void 0),Qe([ft()],e.prototype,"nzHide",void 0),Qe([ft()],e.prototype,"nzCustomContent",void 0),e})(),AK=(()=>{class e{constructor(i,n,r){this.elementRef=i,this.renderer=n,this.focusMonitor=r,this.nzId=null,this.disabled=!1,this.mirrorSync=!1,this.showInput=!0,this.focusTrigger=!1,this.value="",this.autofocus=!1,this.valueChange=new Re,this.isComposingChange=new Re}setCompositionState(i){this.isComposingChange.next(i)}onValueChange(i){this.value=i,this.valueChange.next(i),this.mirrorSync&&this.syncMirrorWidth()}clearInputValue(){this.inputElement.nativeElement.value="",this.onValueChange("")}syncMirrorWidth(){const i=this.mirrorElement.nativeElement,n=this.elementRef.nativeElement,r=this.inputElement.nativeElement;this.renderer.removeStyle(n,"width"),this.renderer.setProperty(i,"textContent",`${r.value}\xa0`),this.renderer.setStyle(n,"width",`${i.scrollWidth}px`)}focus(){this.focusMonitor.focusVia(this.inputElement,"keyboard")}blur(){this.inputElement.nativeElement.blur()}ngOnChanges(i){const n=this.inputElement.nativeElement,{focusTrigger:r,showInput:o}=i;o&&(this.showInput?this.renderer.removeAttribute(n,"readonly"):this.renderer.setAttribute(n,"readonly","readonly")),r&&!0===r.currentValue&&!1===r.previousValue&&n.focus()}ngAfterViewInit(){this.mirrorSync&&this.syncMirrorWidth(),this.autofocus&&this.focus()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Nn),L(bE))},e.\u0275cmp=ut({type:e,selectors:[["nz-select-search"]],viewQuery:function(i,n){if(1&i&&(Ui(mYe,7),Ui(gYe,5)),2&i){let r;Mt(r=zt())&&(n.inputElement=r.first),Mt(r=zt())&&(n.mirrorElement=r.first)}},hostAttrs:[1,"ant-select-selection-search"],inputs:{nzId:"nzId",disabled:"disabled",mirrorSync:"mirrorSync",showInput:"showInput",focusTrigger:"focusTrigger",value:"value",autofocus:"autofocus"},outputs:{valueChange:"valueChange",isComposingChange:"isComposingChange"},features:[vi([{provide:sX,useValue:!1}]),Ht],decls:3,vars:7,consts:[["autocomplete","off",1,"ant-select-selection-search-input",3,"ngModel","disabled","ngModelChange","compositionstart","compositionend"],["inputElement",""],["class","ant-select-selection-search-mirror",4,"ngIf"],[1,"ant-select-selection-search-mirror"],["mirrorElement",""]],template:function(i,n){1&i&&(Ee(0,"input",0,1),pt("ngModelChange",function(o){return n.onValueChange(o)})("compositionstart",function(){return n.setCompositionState(!0)})("compositionend",function(){return n.setCompositionState(!1)}),Pe(),ne(2,vYe,2,0,"span",2)),2&i&&(Xn("opacity",n.showInput?null:0),X("ngModel",n.value)("disabled",n.disabled),to("id",n.nzId)("autofocus",n.autofocus?"autofocus":null),ie(2),X("ngIf",n.mirrorSync))},dependencies:[Fi,Hy,Rz,Ky],encapsulation:2,changeDetection:0}),e})(),XYe=(()=>{class e{constructor(){this.disabled=!1,this.label=null,this.deletable=!1,this.removeIcon=null,this.contentTemplateOutletContext=null,this.contentTemplateOutlet=null,this.delete=new Re}onDelete(i){i.preventDefault(),i.stopPropagation(),this.disabled||this.delete.next(i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-select-item"]],hostAttrs:[1,"ant-select-selection-item"],hostVars:3,hostBindings:function(i,n){2&i&&(to("title",n.label),Dt("ant-select-selection-item-disabled",n.disabled))},inputs:{disabled:"disabled",label:"label",deletable:"deletable",removeIcon:"removeIcon",contentTemplateOutletContext:"contentTemplateOutletContext",contentTemplateOutlet:"contentTemplateOutlet"},outputs:{delete:"delete"},decls:2,vars:5,consts:[[4,"nzStringTemplateOutlet","nzStringTemplateOutletContext"],["class","ant-select-selection-item-remove",3,"click",4,"ngIf"],["class","ant-select-selection-item-content",4,"ngIf","ngIfElse"],["labelTemplate",""],[1,"ant-select-selection-item-content"],[1,"ant-select-selection-item-remove",3,"click"],["nz-icon","","nzType","close",4,"ngIf","ngIfElse"],["nz-icon","","nzType","close"]],template:function(i,n){1&i&&(ne(0,bYe,4,2,"ng-container",0),ne(1,wYe,2,2,"span",1)),2&i&&(X("nzStringTemplateOutlet",n.contentTemplateOutlet)("nzStringTemplateOutletContext",Cg(3,CYe,n.contentTemplateOutletContext)),ie(1),X("ngIf",n.deletable&&!n.disabled))},dependencies:[Fi,ko,vo,Zu],encapsulation:2,changeDetection:0}),e})(),$Ye=(()=>{class e{constructor(){this.placeholder=null}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-select-placeholder"]],hostAttrs:[1,"ant-select-selection-placeholder"],inputs:{placeholder:"placeholder"},decls:1,vars:1,consts:[[4,"nzStringTemplateOutlet"]],template:function(i,n){1&i&&ne(0,SYe,2,1,"ng-container",0),2&i&&X("nzStringTemplateOutlet",n.placeholder)},dependencies:[vo],encapsulation:2,changeDetection:0}),e})(),BE=(()=>{class e{constructor(i,n,r){this.elementRef=i,this.ngZone=n,this.noAnimation=r,this.nzId=null,this.showSearch=!1,this.placeHolder=null,this.open=!1,this.maxTagCount=1/0,this.autofocus=!1,this.disabled=!1,this.mode="default",this.customTemplate=null,this.maxTagPlaceholder=null,this.removeIcon=null,this.listOfTopItem=[],this.tokenSeparators=[],this.tokenize=new Re,this.inputValueChange=new Re,this.deleteItem=new Re,this.listOfSlicedItem=[],this.isShowPlaceholder=!0,this.isShowSingleLabel=!1,this.isComposing=!1,this.inputValue=null,this.destroy$=new He}updateTemplateVariable(){const i=0===this.listOfTopItem.length;this.isShowPlaceholder=i&&!this.isComposing&&!this.inputValue,this.isShowSingleLabel=!i&&!this.isComposing&&!this.inputValue}isComposingChange(i){this.isComposing=i,this.updateTemplateVariable()}onInputValueChange(i){i!==this.inputValue&&(this.inputValue=i,this.updateTemplateVariable(),this.inputValueChange.emit(i),this.tokenSeparate(i,this.tokenSeparators))}tokenSeparate(i,n){if(i&&i.length&&n.length&&"default"!==this.mode&&((s,a)=>{for(let l=0;l<a.length;++l)if(s.lastIndexOf(a[l])>0)return!0;return!1})(i,n)){const s=((s,a)=>{const l=new RegExp(`[${a.join()}]`),c=s.split(l).filter(h=>h);return[...new Set(c)]})(i,n);this.tokenize.next(s)}}clearInputValue(){this.nzSelectSearchComponent&&this.nzSelectSearchComponent.clearInputValue()}focus(){this.nzSelectSearchComponent&&this.nzSelectSearchComponent.focus()}blur(){this.nzSelectSearchComponent&&this.nzSelectSearchComponent.blur()}trackValue(i,n){return n.nzValue}onDeleteItem(i){!this.disabled&&!i.nzDisabled&&this.deleteItem.next(i)}ngOnChanges(i){const{listOfTopItem:n,maxTagCount:r,customTemplate:o,maxTagPlaceholder:s}=i;if(n&&this.updateTemplateVariable(),n||r||o||s){const a=this.listOfTopItem.slice(0,this.maxTagCount).map(l=>({nzLabel:l.nzLabel,nzValue:l.nzValue,nzDisabled:l.nzDisabled,contentTemplateOutlet:this.customTemplate,contentTemplateOutletContext:l}));if(this.listOfTopItem.length>this.maxTagCount){const l=`+ ${this.listOfTopItem.length-this.maxTagCount} ...`,c=this.listOfTopItem.map(u=>u.nzValue),h={nzLabel:l,nzValue:"$$__nz_exceeded_item",nzDisabled:!0,contentTemplateOutlet:this.maxTagPlaceholder,contentTemplateOutletContext:c.slice(this.maxTagCount)};a.push(h)}this.listOfSlicedItem=a}}ngOnInit(){this.ngZone.runOutsideAngular(()=>{$r(this.elementRef.nativeElement,"click").pipe(Ye(this.destroy$)).subscribe(i=>{i.target!==this.nzSelectSearchComponent.inputElement.nativeElement&&this.nzSelectSearchComponent.focus()}),$r(this.elementRef.nativeElement,"keydown").pipe(Ye(this.destroy$)).subscribe(i=>{i.target instanceof HTMLInputElement&&8===i.keyCode&&"default"!==this.mode&&!i.target.value&&this.listOfTopItem.length>0&&(i.preventDefault(),this.ngZone.run(()=>this.onDeleteItem(this.listOfTopItem[this.listOfTopItem.length-1])))})})}ngOnDestroy(){this.destroy$.next()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Pt),L(Ha,9))},e.\u0275cmp=ut({type:e,selectors:[["nz-select-top-control"]],viewQuery:function(i,n){if(1&i&&Ui(AK,5),2&i){let r;Mt(r=zt())&&(n.nzSelectSearchComponent=r.first)}},hostAttrs:[1,"ant-select-selector"],inputs:{nzId:"nzId",showSearch:"showSearch",placeHolder:"placeHolder",open:"open",maxTagCount:"maxTagCount",autofocus:"autofocus",disabled:"disabled",mode:"mode",customTemplate:"customTemplate",maxTagPlaceholder:"maxTagPlaceholder",removeIcon:"removeIcon",listOfTopItem:"listOfTopItem",tokenSeparators:"tokenSeparators"},outputs:{tokenize:"tokenize",inputValueChange:"inputValueChange",deleteItem:"deleteItem"},exportAs:["nzSelectTopControl"],features:[Ht],decls:4,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"placeholder",4,"ngIf"],[3,"nzId","disabled","value","showInput","mirrorSync","autofocus","focusTrigger","isComposingChange","valueChange"],[3,"deletable","disabled","removeIcon","label","contentTemplateOutlet","contentTemplateOutletContext",4,"ngIf"],[3,"deletable","disabled","removeIcon","label","contentTemplateOutlet","contentTemplateOutletContext"],[3,"removeIcon","label","disabled","contentTemplateOutlet","deletable","contentTemplateOutletContext","delete",4,"ngFor","ngForOf","ngForTrackBy"],[3,"nzId","disabled","value","autofocus","showInput","mirrorSync","focusTrigger","isComposingChange","valueChange"],[3,"removeIcon","label","disabled","contentTemplateOutlet","deletable","contentTemplateOutletContext","delete"],[3,"placeholder"]],template:function(i,n){1&i&&(Yt(0,0),ne(1,zYe,3,8,"ng-container",1),ne(2,EYe,3,9,"ng-container",2),Gt(),ne(3,DYe,1,1,"nz-select-placeholder",3)),2&i&&(X("ngSwitch",n.mode),ie(1),X("ngSwitchCase","default"),ie(2),X("ngIf",n.isShowPlaceholder))},dependencies:[Zh,Fi,Kh,zp,Yg,Zu,AK,XYe,$Ye],encapsulation:2,changeDetection:0}),e})(),QYe=(()=>{class e{constructor(){this.clearIcon=null,this.clear=new Re}onClick(i){i.preventDefault(),i.stopPropagation(),this.clear.emit(i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-select-clear"]],hostAttrs:[1,"ant-select-clear"],hostBindings:function(i,n){1&i&&pt("click",function(o){return n.onClick(o)})},inputs:{clearIcon:"clearIcon"},outputs:{clear:"clear"},decls:1,vars:2,consts:[["nz-icon","","nzType","close-circle","nzTheme","fill","class","ant-select-close-icon",4,"ngIf","ngIfElse"],["nz-icon","","nzType","close-circle","nzTheme","fill",1,"ant-select-close-icon"]],template:function(i,n){1&i&&ne(0,AYe,1,0,"span",0),2&i&&X("ngIf",!n.clearIcon)("ngIfElse",n.clearIcon)},dependencies:[Fi,ko,Zu],encapsulation:2,changeDetection:0}),e})(),ZYe=(()=>{class e{constructor(){this.loading=!1,this.search=!1,this.showArrow=!1,this.suffixIcon=null,this.feedbackIcon=null}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["nz-select-arrow"]],hostAttrs:[1,"ant-select-arrow"],hostVars:2,hostBindings:function(i,n){2&i&&Dt("ant-select-arrow-loading",n.loading)},inputs:{loading:"loading",search:"search",showArrow:"showArrow",suffixIcon:"suffixIcon",feedbackIcon:"feedbackIcon"},decls:4,vars:3,consts:[["nz-icon","","nzType","loading",4,"ngIf","ngIfElse"],["defaultArrow",""],[4,"nzStringTemplateOutlet"],["nz-icon","","nzType","loading"],[4,"ngIf","ngIfElse"],["suffixTemplate",""],["nz-icon","","nzType","down",4,"ngIf"],["nz-icon","","nzType","search",4,"ngIf"],["nz-icon","","nzType","down"],["nz-icon","","nzType","search"],["nz-icon","",3,"nzType",4,"ngIf"],["nz-icon","",3,"nzType"]],template:function(i,n){if(1&i&&(ne(0,PYe,1,0,"span",0),ne(1,FYe,3,2,"ng-template",null,1,jn),ne(3,BYe,2,1,"ng-container",2)),2&i){const r=gn(2);X("ngIf",n.loading)("ngIfElse",r),ie(3),X("nzStringTemplateOutlet",n.feedbackIcon)}},dependencies:[Fi,ko,vo,Zu],encapsulation:2,changeDetection:0}),e})();const KYe=(e,t)=>!(!t||!t.nzLabel)&&t.nzLabel.toString().toLowerCase().indexOf(e.toLowerCase())>-1;let eGe=(()=>{class e{constructor(i,n,r,o,s,a,l,c,h,u,d,p){this.ngZone=i,this.destroy$=n,this.nzConfigService=r,this.cdr=o,this.host=s,this.renderer=a,this.platform=l,this.focusMonitor=c,this.directionality=h,this.noAnimation=u,this.nzFormStatusService=d,this.nzFormNoStatusService=p,this._nzModuleName="select",this.nzId=null,this.nzSize="default",this.nzStatus="",this.nzOptionHeightPx=32,this.nzOptionOverflowSize=8,this.nzDropdownClassName=null,this.nzDropdownMatchSelectWidth=!0,this.nzDropdownStyle=null,this.nzNotFoundContent=void 0,this.nzPlaceHolder=null,this.nzPlacement=null,this.nzMaxTagCount=1/0,this.nzDropdownRender=null,this.nzCustomTemplate=null,this.nzSuffixIcon=null,this.nzClearIcon=null,this.nzRemoveIcon=null,this.nzMenuItemSelectedIcon=null,this.nzTokenSeparators=[],this.nzMaxTagPlaceholder=null,this.nzMaxMultipleCount=1/0,this.nzMode="default",this.nzFilterOption=KYe,this.compareWith=(f,m)=>f===m,this.nzAllowClear=!1,this.nzBorderless=!1,this.nzShowSearch=!1,this.nzLoading=!1,this.nzAutoFocus=!1,this.nzAutoClearSearchValue=!0,this.nzServerSearch=!1,this.nzDisabled=!1,this.nzOpen=!1,this.nzSelectOnTab=!1,this.nzBackdrop=!1,this.nzOptions=[],this.nzOnSearch=new Re,this.nzScrollToBottom=new Re,this.nzOpenChange=new Re,this.nzBlur=new Re,this.nzFocus=new Re,this.listOfValue$=new Yi([]),this.listOfTemplateItem$=new Yi([]),this.listOfTagAndTemplateItem=[],this.searchValue="",this.isReactiveDriven=!1,this.requestId=-1,this.isNzDisableFirstChange=!0,this.onChange=()=>{},this.onTouched=()=>{},this.dropDownPosition="bottomLeft",this.triggerWidth=null,this.listOfContainerItem=[],this.listOfTopItem=[],this.activatedValue=null,this.listOfValue=[],this.focused=!1,this.dir="ltr",this.positions=[],this.prefixCls="ant-select",this.statusCls={},this.status="",this.hasFeedback=!1}set nzShowArrow(i){this._nzShowArrow=i}get nzShowArrow(){return void 0===this._nzShowArrow?"default"===this.nzMode:this._nzShowArrow}generateTagItem(i){return{nzValue:i,nzLabel:i,type:"item"}}onItemClick(i){if(this.activatedValue=i,"default"===this.nzMode)(0===this.listOfValue.length||!this.compareWith(this.listOfValue[0],i))&&this.updateListOfValue([i]),this.setOpenState(!1);else{const n=this.listOfValue.findIndex(r=>this.compareWith(r,i));if(-1!==n){const r=this.listOfValue.filter((o,s)=>s!==n);this.updateListOfValue(r)}else if(this.listOfValue.length<this.nzMaxMultipleCount){const r=[...this.listOfValue,i];this.updateListOfValue(r)}this.focus(),this.nzAutoClearSearchValue&&this.clearInput()}}onItemDelete(i){const n=this.listOfValue.filter(r=>!this.compareWith(r,i.nzValue));this.updateListOfValue(n),this.clearInput()}updateListOfContainerItem(){let i=this.listOfTagAndTemplateItem.filter(o=>!o.nzHide).filter(o=>!(!this.nzServerSearch&&this.searchValue)||this.nzFilterOption(this.searchValue,o));if("tags"===this.nzMode&&this.searchValue){const o=this.listOfTagAndTemplateItem.find(s=>s.nzLabel===this.searchValue);if(o)this.activatedValue=o.nzValue;else{const s=this.generateTagItem(this.searchValue);i=[s,...i],this.activatedValue=s.nzValue}}const n=i.find(o=>o.nzLabel===this.searchValue)||i.find(o=>this.compareWith(o.nzValue,this.activatedValue))||i.find(o=>this.compareWith(o.nzValue,this.listOfValue[0]))||i[0];this.activatedValue=n&&n.nzValue||null;let r=[];this.isReactiveDriven?r=[...new Set(this.nzOptions.filter(o=>o.groupLabel).map(o=>o.groupLabel))]:this.listOfNzOptionGroupComponent&&(r=this.listOfNzOptionGroupComponent.map(o=>o.nzLabel)),r.forEach(o=>{const s=i.findIndex(a=>o===a.groupLabel);s>-1&&i.splice(s,0,{groupLabel:o,type:"group",key:o})}),this.listOfContainerItem=[...i],this.updateCdkConnectedOverlayPositions()}clearInput(){this.nzSelectTopControlComponent.clearInputValue()}updateListOfValue(i){const r=((o,s)=>"default"===this.nzMode?o.length>0?o[0]:null:o)(i);this.value!==r&&(this.listOfValue=i,this.listOfValue$.next(i),this.value=r,this.onChange(this.value))}onTokenSeparate(i){const n=this.listOfTagAndTemplateItem.filter(r=>-1!==i.findIndex(o=>o===r.nzLabel)).map(r=>r.nzValue).filter(r=>-1===this.listOfValue.findIndex(o=>this.compareWith(o,r)));if("multiple"===this.nzMode)this.updateListOfValue([...this.listOfValue,...n]);else if("tags"===this.nzMode){const r=i.filter(o=>-1===this.listOfTagAndTemplateItem.findIndex(s=>s.nzLabel===o));this.updateListOfValue([...this.listOfValue,...n,...r])}this.clearInput()}onKeyDown(i){if(this.nzDisabled)return;const n=this.listOfContainerItem.filter(o=>"item"===o.type).filter(o=>!o.nzDisabled),r=n.findIndex(o=>this.compareWith(o.nzValue,this.activatedValue));switch(i.keyCode){case 38:i.preventDefault(),this.nzOpen&&n.length>0&&(this.activatedValue=n[r>0?r-1:n.length-1].nzValue);break;case 40:i.preventDefault(),this.nzOpen&&n.length>0?this.activatedValue=n[r<n.length-1?r+1:0].nzValue:this.setOpenState(!0);break;case 13:i.preventDefault(),this.nzOpen?xc(this.activatedValue)&&-1!==r&&this.onItemClick(this.activatedValue):this.setOpenState(!0);break;case 32:this.nzOpen||(this.setOpenState(!0),i.preventDefault());break;case 9:this.nzSelectOnTab?this.nzOpen&&(i.preventDefault(),xc(this.activatedValue)&&this.onItemClick(this.activatedValue)):this.setOpenState(!1);break;case 27:break;default:this.nzOpen||this.setOpenState(!0)}}setOpenState(i){this.nzOpen!==i&&(this.nzOpen=i,this.nzOpenChange.emit(i),this.onOpenChange(),this.cdr.markForCheck())}onOpenChange(){this.updateCdkConnectedOverlayStatus(),this.clearInput()}onInputValueChange(i){this.searchValue=i,this.updateListOfContainerItem(),this.nzOnSearch.emit(i),this.updateCdkConnectedOverlayPositions()}onClearSelection(){this.updateListOfValue([])}onClickOutside(i){this.host.nativeElement.contains(i.target)||this.setOpenState(!1)}focus(){this.nzSelectTopControlComponent.focus()}blur(){this.nzSelectTopControlComponent.blur()}onPositionChange(i){const n=N5(i);this.dropDownPosition=n}updateCdkConnectedOverlayStatus(){if(this.platform.isBrowser&&this.originElement.nativeElement){const i=this.triggerWidth;_E(this.requestId),this.requestId=p3(()=>{this.triggerWidth=this.originElement.nativeElement.getBoundingClientRect().width,i!==this.triggerWidth&&this.cdr.detectChanges()})}}updateCdkConnectedOverlayPositions(){p3(()=>{this.cdkConnectedOverlay?.overlayRef?.updatePosition()})}writeValue(i){if(this.value!==i){this.value=i;const r=((o,s)=>null==o?[]:"default"===this.nzMode?[o]:o)(i);this.listOfValue=r,this.listOfValue$.next(r),this.cdr.markForCheck()}}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||i,this.isNzDisableFirstChange=!1,this.nzDisabled&&this.setOpenState(!1),this.cdr.markForCheck()}ngOnChanges(i){const{nzOpen:n,nzDisabled:r,nzOptions:o,nzStatus:s,nzPlacement:a}=i;if(n&&this.onOpenChange(),r&&this.nzDisabled&&this.setOpenState(!1),o){this.isReactiveDriven=!0;const c=(this.nzOptions||[]).map(h=>({template:h.label instanceof Tn?h.label:null,nzLabel:"string"==typeof h.label||"number"==typeof h.label?h.label:null,nzValue:h.value,nzDisabled:h.disabled||!1,nzHide:h.hide||!1,nzCustomContent:h.label instanceof Tn,groupLabel:h.groupLabel||null,type:"item",key:h.value}));this.listOfTemplateItem$.next(c)}if(s&&this.setStatusStyles(this.nzStatus,this.hasFeedback),a){const{currentValue:l}=a;this.dropDownPosition=l;const c=["bottomLeft","topLeft","bottomRight","topRight"];this.positions=l&&c.includes(l)?[Pi[l]]:c.map(h=>Pi[h])}}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe(Sl((i,n)=>i.status===n.status&&i.hasFeedback===n.hasFeedback),TK(this.nzFormNoStatusService?this.nzFormNoStatusService.noFormStatus:tt(!1)),bt(([{status:i,hasFeedback:n},r])=>({status:r?"":i,hasFeedback:n})),Ye(this.destroy$)).subscribe(({status:i,hasFeedback:n})=>{this.setStatusStyles(i,n)}),this.focusMonitor.monitor(this.host,!0).pipe(Ye(this.destroy$)).subscribe(i=>{i?(this.focused=!0,this.cdr.markForCheck(),this.nzFocus.emit()):(this.focused=!1,this.cdr.markForCheck(),this.nzBlur.emit(),Promise.resolve().then(()=>{this.onTouched()}))}),Yc([this.listOfValue$,this.listOfTemplateItem$]).pipe(Ye(this.destroy$)).subscribe(([i,n])=>{const r=i.filter(()=>"tags"===this.nzMode).filter(o=>-1===n.findIndex(s=>this.compareWith(s.nzValue,o))).map(o=>this.listOfTopItem.find(s=>this.compareWith(s.nzValue,o))||this.generateTagItem(o));this.listOfTagAndTemplateItem=[...n,...r],this.listOfTopItem=this.listOfValue.map(o=>[...this.listOfTagAndTemplateItem,...this.listOfTopItem].find(s=>this.compareWith(o,s.nzValue))).filter(o=>!!o),this.updateListOfContainerItem()}),this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.detectChanges()}),this.nzConfigService.getConfigChangeEventForComponent("select").pipe(Ye(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()}),this.dir=this.directionality.value,this.ngZone.runOutsideAngular(()=>$r(this.host.nativeElement,"click").pipe(Ye(this.destroy$)).subscribe(()=>{this.nzOpen&&this.nzShowSearch||this.nzDisabled||this.ngZone.run(()=>this.setOpenState(!this.nzOpen))})),this.cdkConnectedOverlay.overlayKeydown.pipe(Ye(this.destroy$)).subscribe(i=>{27===i.keyCode&&this.setOpenState(!1)})}ngAfterContentInit(){this.isReactiveDriven||ts(this.listOfNzOptionGroupComponent.changes,this.listOfNzOptionComponent.changes).pipe(Ho(!0),Sr(()=>ts(this.listOfNzOptionComponent.changes,this.listOfNzOptionGroupComponent.changes,...this.listOfNzOptionComponent.map(i=>i.changes),...this.listOfNzOptionGroupComponent.map(i=>i.changes)).pipe(Ho(!0))),Ye(this.destroy$)).subscribe(()=>{const i=this.listOfNzOptionComponent.toArray().map(n=>{const{template:r,nzLabel:o,nzValue:s,nzDisabled:a,nzHide:l,nzCustomContent:c,groupLabel:h}=n;return{template:r,nzLabel:o,nzValue:s,nzDisabled:a,nzHide:l,nzCustomContent:c,groupLabel:h,type:"item",key:s}});this.listOfTemplateItem$.next(i),this.cdr.markForCheck()})}ngOnDestroy(){_E(this.requestId),this.focusMonitor.stopMonitoring(this.host)}setStatusStyles(i,n){this.status=i,this.hasFeedback=n,this.cdr.markForCheck(),this.statusCls=KQ(this.prefixCls,i,n),Object.keys(this.statusCls).forEach(r=>{this.statusCls[r]?this.renderer.addClass(this.host.nativeElement,r):this.renderer.removeClass(this.host.nativeElement,r)})}}return e.\u0275fac=function(i){return new(i||e)(L(Pt),L(Ba),L(Va),L(Ri),L(yt),L(Nn),L(Qr),L(bE),L(Vn,8),L(Ha,9),L(IZ,8),L(OZ,8))},e.\u0275cmp=ut({type:e,selectors:[["nz-select"]],contentQueries:function(i,n,r){if(1&i&&(Un(r,DK,5),Un(r,FE,5)),2&i){let o;Mt(o=zt())&&(n.listOfNzOptionComponent=o),Mt(o=zt())&&(n.listOfNzOptionGroupComponent=o)}},viewQuery:function(i,n){if(1&i&&(Ui(N0,7,yt),Ui(u3,7),Ui(BE,7),Ui(FE,7,yt),Ui(BE,7,yt)),2&i){let r;Mt(r=zt())&&(n.originElement=r.first),Mt(r=zt())&&(n.cdkConnectedOverlay=r.first),Mt(r=zt())&&(n.nzSelectTopControlComponent=r.first),Mt(r=zt())&&(n.nzOptionGroupComponentElement=r.first),Mt(r=zt())&&(n.nzSelectTopControlComponentElement=r.first)}},hostAttrs:[1,"ant-select"],hostVars:26,hostBindings:function(i,n){2&i&&Dt("ant-select-in-form-item",!!n.nzFormStatusService)("ant-select-lg","large"===n.nzSize)("ant-select-sm","small"===n.nzSize)("ant-select-show-arrow",n.nzShowArrow)("ant-select-disabled",n.nzDisabled)("ant-select-show-search",(n.nzShowSearch||"default"!==n.nzMode)&&!n.nzDisabled)("ant-select-allow-clear",n.nzAllowClear)("ant-select-borderless",n.nzBorderless)("ant-select-open",n.nzOpen)("ant-select-focused",n.nzOpen||n.focused)("ant-select-single","default"===n.nzMode)("ant-select-multiple","default"!==n.nzMode)("ant-select-rtl","rtl"===n.dir)},inputs:{nzId:"nzId",nzSize:"nzSize",nzStatus:"nzStatus",nzOptionHeightPx:"nzOptionHeightPx",nzOptionOverflowSize:"nzOptionOverflowSize",nzDropdownClassName:"nzDropdownClassName",nzDropdownMatchSelectWidth:"nzDropdownMatchSelectWidth",nzDropdownStyle:"nzDropdownStyle",nzNotFoundContent:"nzNotFoundContent",nzPlaceHolder:"nzPlaceHolder",nzPlacement:"nzPlacement",nzMaxTagCount:"nzMaxTagCount",nzDropdownRender:"nzDropdownRender",nzCustomTemplate:"nzCustomTemplate",nzSuffixIcon:"nzSuffixIcon",nzClearIcon:"nzClearIcon",nzRemoveIcon:"nzRemoveIcon",nzMenuItemSelectedIcon:"nzMenuItemSelectedIcon",nzTokenSeparators:"nzTokenSeparators",nzMaxTagPlaceholder:"nzMaxTagPlaceholder",nzMaxMultipleCount:"nzMaxMultipleCount",nzMode:"nzMode",nzFilterOption:"nzFilterOption",compareWith:"compareWith",nzAllowClear:"nzAllowClear",nzBorderless:"nzBorderless",nzShowSearch:"nzShowSearch",nzLoading:"nzLoading",nzAutoFocus:"nzAutoFocus",nzAutoClearSearchValue:"nzAutoClearSearchValue",nzServerSearch:"nzServerSearch",nzDisabled:"nzDisabled",nzOpen:"nzOpen",nzSelectOnTab:"nzSelectOnTab",nzBackdrop:"nzBackdrop",nzOptions:"nzOptions",nzShowArrow:"nzShowArrow"},outputs:{nzOnSearch:"nzOnSearch",nzScrollToBottom:"nzScrollToBottom",nzOpenChange:"nzOpenChange",nzBlur:"nzBlur",nzFocus:"nzFocus"},exportAs:["nzSelect"],features:[vi([Ba,{provide:Na,useExisting:nn(()=>e),multi:!0}]),Ht],decls:5,vars:25,consts:[["cdkOverlayOrigin","",3,"nzId","open","disabled","mode","nzNoAnimation","maxTagPlaceholder","removeIcon","placeHolder","maxTagCount","customTemplate","tokenSeparators","showSearch","autofocus","listOfTopItem","inputValueChange","tokenize","deleteItem","keydown"],["origin","cdkOverlayOrigin"],[3,"showArrow","loading","search","suffixIcon","feedbackIcon",4,"ngIf"],[3,"clearIcon","clear",4,"ngIf"],["cdkConnectedOverlay","","nzConnectedOverlay","",3,"cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayMinWidth","cdkConnectedOverlayWidth","cdkConnectedOverlayOrigin","cdkConnectedOverlayTransformOriginOn","cdkConnectedOverlayPanelClass","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","overlayOutsideClick","detach","positionChange"],[3,"showArrow","loading","search","suffixIcon","feedbackIcon"],["feedbackIconTpl",""],[3,"status",4,"ngIf"],[3,"status"],[3,"clearIcon","clear"],[3,"ngStyle","itemSize","maxItemLength","matchWidth","nzNoAnimation","listOfContainerItem","menuItemSelectedIcon","notFoundContent","activatedValue","listOfSelectedValue","dropdownRender","compareWith","mode","keydown","itemClick","scrollToBottom"]],template:function(i,n){if(1&i&&(Ee(0,"nz-select-top-control",0,1),pt("inputValueChange",function(o){return n.onInputValueChange(o)})("tokenize",function(o){return n.onTokenSeparate(o)})("deleteItem",function(o){return n.onItemDelete(o)})("keydown",function(o){return n.onKeyDown(o)}),Pe(),ne(2,UYe,3,5,"nz-select-arrow",2),ne(3,jYe,1,1,"nz-select-clear",3),ne(4,YYe,1,23,"ng-template",4),pt("overlayOutsideClick",function(o){return n.onClickOutside(o)})("detach",function(){return n.setOpenState(!1)})("positionChange",function(o){return n.onPositionChange(o)})),2&i){const r=gn(1);X("nzId",n.nzId)("open",n.nzOpen)("disabled",n.nzDisabled)("mode",n.nzMode)("@.disabled",!(null==n.noAnimation||!n.noAnimation.nzNoAnimation))("nzNoAnimation",null==n.noAnimation?null:n.noAnimation.nzNoAnimation)("maxTagPlaceholder",n.nzMaxTagPlaceholder)("removeIcon",n.nzRemoveIcon)("placeHolder",n.nzPlaceHolder)("maxTagCount",n.nzMaxTagCount)("customTemplate",n.nzCustomTemplate)("tokenSeparators",n.nzTokenSeparators)("showSearch",n.nzShowSearch)("autofocus",n.nzAutoFocus)("listOfTopItem",n.listOfTopItem),ie(2),X("ngIf",n.nzShowArrow||n.hasFeedback&&!!n.status),ie(1),X("ngIf",n.nzAllowClear&&!n.nzDisabled&&n.listOfValue.length),ie(1),X("cdkConnectedOverlayHasBackdrop",n.nzBackdrop)("cdkConnectedOverlayMinWidth",n.nzDropdownMatchSelectWidth?null:n.triggerWidth)("cdkConnectedOverlayWidth",n.nzDropdownMatchSelectWidth?n.triggerWidth:null)("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayTransformOriginOn",".ant-select-dropdown")("cdkConnectedOverlayPanelClass",n.nzDropdownClassName)("cdkConnectedOverlayOpen",n.nzOpen)("cdkConnectedOverlayPositions",n.positions)}},dependencies:[Fi,Tp,u3,N0,eZ,Ha,Zu,kZ,qYe,BE,QYe,ZYe],encapsulation:2,data:{animation:[wE]},changeDetection:0}),Qe([mo()],e.prototype,"nzSuffixIcon",void 0),Qe([ft()],e.prototype,"nzAllowClear",void 0),Qe([mo(),ft()],e.prototype,"nzBorderless",void 0),Qe([ft()],e.prototype,"nzShowSearch",void 0),Qe([ft()],e.prototype,"nzLoading",void 0),Qe([ft()],e.prototype,"nzAutoFocus",void 0),Qe([ft()],e.prototype,"nzAutoClearSearchValue",void 0),Qe([ft()],e.prototype,"nzServerSearch",void 0),Qe([ft()],e.prototype,"nzDisabled",void 0),Qe([ft()],e.prototype,"nzOpen",void 0),Qe([ft()],e.prototype,"nzSelectOnTab",void 0),Qe([mo(),ft()],e.prototype,"nzBackdrop",void 0),e})(),tGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Vy,tT,Hs,Xu,go,Zr,mK,d3,Vh,zE,NZ,UT,WZ]}),e})();const PK=["*"],iGe=["nz-sider-trigger",""];function nGe(e,t){}function rGe(e,t){if(1&e&&(Yt(0),ne(1,nGe,0,0,"ng-template",3),Gt()),2&e){const i=de(),n=gn(5);ie(1),X("ngTemplateOutlet",i.nzZeroTrigger||n)}}function oGe(e,t){}function sGe(e,t){if(1&e&&(Yt(0),ne(1,oGe,0,0,"ng-template",3),Gt()),2&e){const i=de(),n=gn(3);ie(1),X("ngTemplateOutlet",i.nzTrigger||n)}}function aGe(e,t){1&e&&Je(0,"span",5),2&e&&X("nzType",de(2).nzCollapsed?"right":"left")}function lGe(e,t){1&e&&Je(0,"span",5),2&e&&X("nzType",de(2).nzCollapsed?"left":"right")}function cGe(e,t){if(1&e&&(ne(0,aGe,1,1,"span",4),ne(1,lGe,1,1,"span",4)),2&e){const i=de();X("ngIf",!i.nzReverseArrow),ie(1),X("ngIf",i.nzReverseArrow)}}function hGe(e,t){1&e&&Je(0,"span",6)}function uGe(e,t){if(1&e){const i=Ji();Ee(0,"div",2),pt("click",function(){ai(i);const r=de();return li(r.setCollapsed(!r.nzCollapsed))}),Pe()}if(2&e){const i=de();X("matchBreakPoint",i.matchBreakPoint)("nzCollapsedWidth",i.nzCollapsedWidth)("nzCollapsed",i.nzCollapsed)("nzBreakpoint",i.nzBreakpoint)("nzReverseArrow",i.nzReverseArrow)("nzTrigger",i.nzTrigger)("nzZeroTrigger",i.nzZeroTrigger)("siderWidth",i.widthSetting)}}let dGe=(()=>{class e{constructor(){this.nzCollapsed=!1,this.nzReverseArrow=!1,this.nzZeroTrigger=null,this.nzTrigger=void 0,this.matchBreakPoint=!1,this.nzCollapsedWidth=null,this.siderWidth=null,this.nzBreakpoint=null,this.isZeroTrigger=!1,this.isNormalTrigger=!1}updateTriggerType(){this.isZeroTrigger=0===this.nzCollapsedWidth&&(this.nzBreakpoint&&this.matchBreakPoint||!this.nzBreakpoint),this.isNormalTrigger=0!==this.nzCollapsedWidth}ngOnInit(){this.updateTriggerType()}ngOnChanges(){this.updateTriggerType()}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["","nz-sider-trigger",""]],hostVars:10,hostBindings:function(i,n){2&i&&(Xn("width",n.isNormalTrigger?n.siderWidth:null),Dt("ant-layout-sider-trigger",n.isNormalTrigger)("ant-layout-sider-zero-width-trigger",n.isZeroTrigger)("ant-layout-sider-zero-width-trigger-right",n.isZeroTrigger&&n.nzReverseArrow)("ant-layout-sider-zero-width-trigger-left",n.isZeroTrigger&&!n.nzReverseArrow))},inputs:{nzCollapsed:"nzCollapsed",nzReverseArrow:"nzReverseArrow",nzZeroTrigger:"nzZeroTrigger",nzTrigger:"nzTrigger",matchBreakPoint:"matchBreakPoint",nzCollapsedWidth:"nzCollapsedWidth",siderWidth:"siderWidth",nzBreakpoint:"nzBreakpoint"},exportAs:["nzSiderTrigger"],features:[Ht],attrs:iGe,decls:6,vars:2,consts:[[4,"ngIf"],["defaultTrigger",""],["defaultZeroTrigger",""],[3,"ngTemplateOutlet"],["nz-icon","",3,"nzType",4,"ngIf"],["nz-icon","",3,"nzType"],["nz-icon","","nzType","bars"]],template:function(i,n){1&i&&(ne(0,rGe,2,1,"ng-container",0),ne(1,sGe,2,1,"ng-container",0),ne(2,cGe,2,2,"ng-template",null,1,jn),ne(4,hGe,1,0,"ng-template",null,2,jn)),2&i&&(X("ngIf",n.isZeroTrigger),ie(1),X("ngIf",n.isNormalTrigger))},dependencies:[Fi,as,ko],encapsulation:2,changeDetection:0}),e})(),pGe=(()=>{class e{constructor(i,n,r){this.platform=i,this.cdr=n,this.breakpointService=r,this.destroy$=new He,this.nzMenuDirective=null,this.nzCollapsedChange=new Re,this.nzWidth=200,this.nzTheme="dark",this.nzCollapsedWidth=80,this.nzBreakpoint=null,this.nzZeroTrigger=null,this.nzTrigger=void 0,this.nzReverseArrow=!1,this.nzCollapsible=!1,this.nzCollapsed=!1,this.matchBreakPoint=!1,this.flexSetting=null,this.widthSetting=null}updateStyleMap(){this.widthSetting=this.nzCollapsed?`${this.nzCollapsedWidth}px`:O5(this.nzWidth),this.flexSetting=`0 0 ${this.widthSetting}`,this.cdr.markForCheck()}updateMenuInlineCollapsed(){this.nzMenuDirective&&"inline"===this.nzMenuDirective.nzMode&&0!==this.nzCollapsedWidth&&this.nzMenuDirective.setInlineCollapsed(this.nzCollapsed)}setCollapsed(i){i!==this.nzCollapsed&&(this.nzCollapsed=i,this.nzCollapsedChange.emit(i),this.updateMenuInlineCollapsed(),this.updateStyleMap(),this.cdr.markForCheck())}ngOnInit(){this.updateStyleMap(),this.platform.isBrowser&&this.breakpointService.subscribe(ULe,!0).pipe(Ye(this.destroy$)).subscribe(i=>{const n=this.nzBreakpoint;n&&function tRe(){const e=new He;return Promise.resolve().then(()=>e.next()),e.pipe(Fr(1))}().subscribe(()=>{this.matchBreakPoint=!i[n],this.setCollapsed(this.matchBreakPoint),this.cdr.markForCheck()})})}ngOnChanges(i){const{nzCollapsed:n,nzCollapsedWidth:r,nzWidth:o}=i;(n||r||o)&&this.updateStyleMap(),n&&this.updateMenuInlineCollapsed()}ngAfterContentInit(){this.updateMenuInlineCollapsed()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Qr),L(Ri),L(UQ))},e.\u0275cmp=ut({type:e,selectors:[["nz-sider"]],contentQueries:function(i,n,r){if(1&i&&Un(r,QZ,5),2&i){let o;Mt(o=zt())&&(n.nzMenuDirective=o.first)}},hostAttrs:[1,"ant-layout-sider"],hostVars:18,hostBindings:function(i,n){2&i&&(Xn("flex",n.flexSetting)("max-width",n.widthSetting)("min-width",n.widthSetting)("width",n.widthSetting),Dt("ant-layout-sider-zero-width",n.nzCollapsed&&0===n.nzCollapsedWidth)("ant-layout-sider-light","light"===n.nzTheme)("ant-layout-sider-dark","dark"===n.nzTheme)("ant-layout-sider-collapsed",n.nzCollapsed)("ant-layout-sider-has-trigger",n.nzCollapsible&&null!==n.nzTrigger))},inputs:{nzWidth:"nzWidth",nzTheme:"nzTheme",nzCollapsedWidth:"nzCollapsedWidth",nzBreakpoint:"nzBreakpoint",nzZeroTrigger:"nzZeroTrigger",nzTrigger:"nzTrigger",nzReverseArrow:"nzReverseArrow",nzCollapsible:"nzCollapsible",nzCollapsed:"nzCollapsed"},outputs:{nzCollapsedChange:"nzCollapsedChange"},exportAs:["nzSider"],features:[Ht],ngContentSelectors:PK,decls:3,vars:1,consts:[[1,"ant-layout-sider-children"],["nz-sider-trigger","",3,"matchBreakPoint","nzCollapsedWidth","nzCollapsed","nzBreakpoint","nzReverseArrow","nzTrigger","nzZeroTrigger","siderWidth","click",4,"ngIf"],["nz-sider-trigger","",3,"matchBreakPoint","nzCollapsedWidth","nzCollapsed","nzBreakpoint","nzReverseArrow","nzTrigger","nzZeroTrigger","siderWidth","click"]],template:function(i,n){1&i&&(Ln(),Ee(0,"div",0),Mi(1),Pe(),ne(2,uGe,1,8,"div",1)),2&i&&(ie(2),X("ngIf",n.nzCollapsible&&null!==n.nzTrigger))},dependencies:[Fi,dGe],encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzReverseArrow",void 0),Qe([ft()],e.prototype,"nzCollapsible",void 0),Qe([ft()],e.prototype,"nzCollapsed",void 0),e})(),fGe=(()=>{class e{constructor(i){this.directionality=i,this.dir="ltr",this.destroy$=new He}ngOnInit(){this.dir=this.directionality.value,this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(i){return new(i||e)(L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["nz-layout"]],contentQueries:function(i,n,r){if(1&i&&Un(r,pGe,4),2&i){let o;Mt(o=zt())&&(n.listOfNzSiderComponent=o)}},hostAttrs:[1,"ant-layout"],hostVars:4,hostBindings:function(i,n){2&i&&Dt("ant-layout-rtl","rtl"===n.dir)("ant-layout-has-sider",n.listOfNzSiderComponent.length>0)},exportAs:["nzLayout"],ngContentSelectors:PK,decls:1,vars:0,template:function(i,n){1&i&&(Ln(),Mi(0))},encapsulation:2,changeDetection:0}),e})(),mGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,go,BQ,Hs]}),e})(),yGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,TE,go,Zr]}),e})();const _Ge=[{name:"menu-fold",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z" /></svg>'},{name:"menu-unfold",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z" /></svg>'},{name:"dashboard",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M924.8 385.6a446.7 446.7 0 00-96-142.4 446.7 446.7 0 00-142.4-96C631.1 123.8 572.5 112 512 112s-119.1 11.8-174.4 35.2a446.7 446.7 0 00-142.4 96 446.7 446.7 0 00-96 142.4C75.8 440.9 64 499.5 64 560c0 132.7 58.3 257.7 159.9 343.1l1.7 1.4c5.8 4.8 13.1 7.5 20.6 7.5h531.7c7.5 0 14.8-2.7 20.6-7.5l1.7-1.4C901.7 817.7 960 692.7 960 560c0-60.5-11.9-119.1-35.2-174.4zM761.4 836H262.6A371.12 371.12 0 01140 560c0-99.4 38.7-192.8 109-263 70.3-70.3 163.7-109 263-109 99.4 0 192.8 38.7 263 109 70.3 70.3 109 163.7 109 263 0 105.6-44.5 205.5-122.6 276zM623.5 421.5a8.03 8.03 0 00-11.3 0L527.7 506c-18.7-5-39.4-.2-54.1 14.5a55.95 55.95 0 000 79.2 55.95 55.95 0 0079.2 0 55.87 55.87 0 0014.5-54.1l84.5-84.5c3.1-3.1 3.1-8.2 0-11.3l-28.3-28.3zM490 320h44c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8h-44c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8zm260 218v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8h-80c-4.4 0-8 3.6-8 8zm12.7-197.2l-31.1-31.1a8.03 8.03 0 00-11.3 0l-56.6 56.6a8.03 8.03 0 000 11.3l31.1 31.1c3.1 3.1 8.2 3.1 11.3 0l56.6-56.6c3.1-3.1 3.1-8.2 0-11.3zm-458.6-31.1a8.03 8.03 0 00-11.3 0l-31.1 31.1a8.03 8.03 0 000 11.3l56.6 56.6c3.1 3.1 8.2 3.1 11.3 0l31.1-31.1c3.1-3.1 3.1-8.2 0-11.3l-56.6-56.6zM262 530h-80c-4.4 0-8 3.6-8 8v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8z" /></svg>'},{name:"form",theme:"outline",icon:'<svg viewBox="64 64 896 896" focusable="false"><path d="M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z" /><path d="M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z" /></svg>'}];let bGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({providers:[{provide:gE,useValue:_Ge}],imports:[go,go]}),e})();class xGe{constructor(t,i){this._document=i;const n=this._textarea=this._document.createElement("textarea"),r=n.style;r.position="fixed",r.top=r.opacity="0",r.left="-999em",n.setAttribute("aria-hidden","true"),n.value=t,n.readOnly=!0,this._document.body.appendChild(n)}copy(){const t=this._textarea;let i=!1;try{if(t){const n=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),i=this._document.execCommand("copy"),n&&n.focus()}}catch{}return i}destroy(){const t=this._textarea;t&&(t.remove(),this._textarea=void 0)}}let wGe=(()=>{class e{constructor(i){this._document=i}copy(i){const n=this.beginCopy(i),r=n.copy();return n.destroy(),r}beginCopy(i){return new xGe(i,this._document)}}return e.\u0275fac=function(i){return new(i||e)(he(_i))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),CGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),IK=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Ge({type:e,selectors:[["button","nz-trans-button",""]],hostVars:8,hostBindings:function(i,n){2&i&&Xn("border","0")("background","transparent")("padding","0")("line-height","inherit")}}),e})(),SGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ji]}),e})();function MGe(e,t){if(1&e&&(Yt(0),Je(1,"span",2),Gt()),2&e){const i=t.$implicit;ie(1),X("nzType",i)}}const zGe=["textarea"];function TGe(e,t){if(1&e){const i=Ji();Ee(0,"textarea",2,3),pt("blur",function(){return ai(i),li(de().confirm())}),Pe(),Ee(2,"button",4),pt("click",function(){return ai(i),li(de().confirm())}),Je(3,"span",5),Pe()}}function EGe(e,t){if(1&e&&(Yt(0),Je(1,"span",8),Gt()),2&e){const i=t.$implicit;ie(1),X("nzType",i)}}function DGe(e,t){if(1&e){const i=Ji();Ee(0,"button",6),pt("click",function(){return ai(i),li(de().onClick())}),ne(1,EGe,2,1,"ng-container",7),Pe()}if(2&e){const i=de();X("nzTooltipTitle",null===i.tooltip?null:i.tooltip||(null==i.locale?null:i.locale.edit)),ie(1),X("nzStringTemplateOutlet",i.icon)}}const AGe=["ellipsisContainer"],PGe=["expandable"],IGe=["contentTemplate"];function OGe(e,t){1&e&&Mi(0,0,["*ngIf","!content"])}function kGe(e,t){if(1&e&&(ne(0,OGe,1,0,"ng-content",1),zi(1)),2&e){const i=t.content;X("ngIf",!i),ie(1),$a(" ",i," ")}}function NGe(e,t){}function LGe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(3);ie(1),cr(i.nzSuffix)}}const RGe=function(e){return{content:e}};function FGe(e,t){if(1&e&&(Yt(0),ne(1,NGe,0,0,"ng-template",6),ne(2,LGe,2,1,"ng-container",1),Gt()),2&e){const i=de(2),n=gn(1);ie(1),X("ngTemplateOutlet",n)("ngTemplateOutletContext",Cg(3,RGe,i.nzContent)),ie(1),X("ngIf",i.nzSuffix)}}function BGe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(3);ie(1),cr(i.ellipsisStr)}}function VGe(e,t){if(1&e&&(Yt(0),zi(1),Gt()),2&e){const i=de(3);ie(1),cr(i.nzSuffix)}}function HGe(e,t){if(1&e){const i=Ji();Ee(0,"a",9,10),pt("click",function(){return ai(i),li(de(3).onExpand())}),zi(2),Pe()}if(2&e){const i=de(3);ie(2),$a(" ",null==i.locale?null:i.locale.expand," ")}}function UGe(e,t){if(1&e&&(Je(0,"span",null,7),ne(2,BGe,2,1,"ng-container",1),ne(3,VGe,2,1,"ng-container",1),ne(4,HGe,3,1,"a",8)),2&e){const i=de(2);ie(2),X("ngIf",i.isEllipsis),ie(1),X("ngIf",i.nzSuffix),ie(1),X("ngIf",i.nzExpandable&&i.isEllipsis)}}function jGe(e,t){if(1&e&&(Yt(0),ne(1,FGe,3,5,"ng-container",4),ne(2,UGe,5,3,"ng-template",null,5,jn),Gt()),2&e){const i=gn(3),n=de();ie(1),X("ngIf",n.expanded||!n.hasOperationsWithEllipsis&&1===n.nzEllipsisRows&&!n.hasEllipsisObservers||n.canCssEllipsis||n.nzSuffix&&n.expanded)("ngIfElse",i)}}function YGe(e,t){if(1&e){const i=Ji();Ee(0,"nz-text-edit",11),pt("endEditing",function(r){return ai(i),li(de().onEndEditing(r))})("startEditing",function(){return ai(i),li(de().onStartEditing())}),Pe()}if(2&e){const i=de();X("text",i.nzContent)("icon",i.nzEditIcon)("tooltip",i.nzEditTooltip)}}function GGe(e,t){if(1&e){const i=Ji();Ee(0,"nz-text-copy",12),pt("textCopy",function(r){return ai(i),li(de().onTextCopy(r))}),Pe()}if(2&e){const i=de();X("text",i.copyText)("tooltips",i.nzCopyTooltips)("icons",i.nzCopyIcons)}}const WGe=["*"];let OK=(()=>{class e{constructor(i,n,r,o){this.host=i,this.cdr=n,this.clipboard=r,this.i18n=o,this.copied=!1,this.copyId=-1,this.nativeElement=this.host.nativeElement,this.copyTooltip=null,this.copedTooltip=null,this.copyIcon="copy",this.copedIcon="check",this.destroy$=new He,this.icons=["copy","check"],this.textCopy=new Re}ngOnInit(){this.i18n.localeChange.pipe(Ye(this.destroy$)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.updateTooltips(),this.cdr.markForCheck()})}ngOnChanges(i){const{tooltips:n,icons:r}=i;n&&this.updateTooltips(),r&&this.updateIcons()}ngOnDestroy(){clearTimeout(this.copyId),this.destroy$.next(),this.destroy$.complete()}onClick(){if(this.copied)return;this.copied=!0,this.cdr.detectChanges();const i=this.text;this.textCopy.emit(i),this.clipboard.copy(i),this.onCopied()}onCopied(){clearTimeout(this.copyId),this.copyId=setTimeout(()=>{this.copied=!1,this.cdr.detectChanges()},3e3)}updateTooltips(){if(null===this.tooltips)this.copedTooltip=null,this.copyTooltip=null;else if(Array.isArray(this.tooltips)){const[i,n]=this.tooltips;this.copyTooltip=i||this.locale?.copy,this.copedTooltip=n||this.locale?.copied}else this.copyTooltip=this.locale?.copy,this.copedTooltip=this.locale?.copied;this.cdr.markForCheck()}updateIcons(){const[i,n]=this.icons;this.copyIcon=i,this.copedIcon=n,this.cdr.markForCheck()}}return e.\u0275fac=function(i){return new(i||e)(L(yt),L(Ri),L(wGe),L(G4))},e.\u0275cmp=ut({type:e,selectors:[["nz-text-copy"]],inputs:{text:"text",tooltips:"tooltips",icons:"icons"},outputs:{textCopy:"textCopy"},exportAs:["nzTextCopy"],features:[Ht],decls:2,vars:4,consts:[["type","button","nz-tooltip","","nz-trans-button","",1,"ant-typography-copy",3,"nzTooltipTitle","click"],[4,"nzStringTemplateOutlet"],["nz-icon","",3,"nzType"]],template:function(i,n){1&i&&(Ee(0,"button",0),pt("click",function(){return n.onClick()}),ne(1,MGe,2,1,"ng-container",1),Pe()),2&i&&(Dt("ant-typography-copy-success",n.copied),X("nzTooltipTitle",n.copied?n.copedTooltip:n.copyTooltip),ie(1),X("nzStringTemplateOutlet",n.copied?n.copedIcon:n.copyIcon))},dependencies:[ko,dK,IK,vo],encapsulation:2,changeDetection:0}),e})(),kK=(()=>{class e{constructor(i,n,r,o,s){this.ngZone=i,this.host=n,this.cdr=r,this.i18n=o,this.destroy$=s,this.editing=!1,this.icon="edit",this.startEditing=new Re,this.endEditing=new Re(!0),this.nativeElement=this.host.nativeElement,this.textarea$=new Yi(null)}set textarea(i){this.textarea$.next(i)}ngOnInit(){this.i18n.localeChange.pipe(Ye(this.destroy$)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.cdr.markForCheck()}),this.textarea$.pipe(Sr(i=>i?new Li(n=>this.ngZone.runOutsideAngular(()=>$r(i.nativeElement,"keydown").subscribe(n))):js),Ye(this.destroy$)).subscribe(i=>{27!==i.keyCode&&13!==i.keyCode||this.ngZone.run(()=>{27===i.keyCode?this.onCancel():this.onEnter(i),this.cdr.markForCheck()})}),this.textarea$.pipe(Sr(i=>i?new Li(n=>this.ngZone.runOutsideAngular(()=>$r(i.nativeElement,"input").subscribe(n))):js),Ye(this.destroy$)).subscribe(i=>{this.currentText=i.target.value})}onClick(){this.beforeText=this.text,this.currentText=this.beforeText,this.editing=!0,this.startEditing.emit(),this.focusAndSetValue()}confirm(){this.editing=!1,this.endEditing.emit(this.currentText)}onEnter(i){i.stopPropagation(),i.preventDefault(),this.confirm()}onCancel(){this.currentText=this.beforeText,this.confirm()}focusAndSetValue(){const i=this.ngZone.isStable?Wn(Promise.resolve()):this.ngZone.onStable.pipe(Fr(1));this.ngZone.runOutsideAngular(()=>{i.pipe(TK(this.textarea$),Ye(this.destroy$)).subscribe(([,n])=>{n&&(n.nativeElement.focus(),n.nativeElement.value=this.currentText||"",this.autosizeDirective.resizeToFitContent(),this.cdr.markForCheck())})})}}return e.\u0275fac=function(i){return new(i||e)(L(Pt),L(yt),L(Ri),L(G4),L(Ba))},e.\u0275cmp=ut({type:e,selectors:[["nz-text-edit"]],viewQuery:function(i,n){if(1&i&&(Ui(zGe,5),Ui(LZ,5)),2&i){let r;Mt(r=zt())&&(n.textarea=r.first),Mt(r=zt())&&(n.autosizeDirective=r.first)}},inputs:{text:"text",icon:"icon",tooltip:"tooltip"},outputs:{startEditing:"startEditing",endEditing:"endEditing"},exportAs:["nzTextEdit"],features:[vi([Ba])],decls:3,vars:2,consts:[[3,"ngIf","ngIfElse"],["notEditing",""],["nz-input","","nzAutosize","",3,"blur"],["textarea",""],["nz-trans-button","",1,"ant-typography-edit-content-confirm",3,"click"],["nz-icon","","nzType","enter"],["nz-tooltip","","nz-trans-button","",1,"ant-typography-edit",3,"nzTooltipTitle","click"],[4,"nzStringTemplateOutlet"],["nz-icon","",3,"nzType"]],template:function(i,n){if(1&i&&(ne(0,TGe,4,0,"ng-template",0),ne(1,DGe,2,2,"ng-template",null,1,jn)),2&i){const r=gn(2);X("ngIf",n.editing)("ngIfElse",r)}},dependencies:[Fi,ko,dK,eBe,LZ,IK,vo],encapsulation:2,changeDetection:0}),e})(),$Ge=(()=>{class e{constructor(i,n,r,o,s,a,l,c,h,u){this.nzConfigService=i,this.host=n,this.cdr=r,this.viewContainerRef=o,this.renderer=s,this.platform=a,this.i18n=l,this.resizeService=h,this.directionality=u,this._nzModuleName="typography",this.nzCopyable=!1,this.nzEditable=!1,this.nzDisabled=!1,this.nzExpandable=!1,this.nzEllipsis=!1,this.nzCopyTooltips=void 0,this.nzCopyIcons=["copy","check"],this.nzEditTooltip=void 0,this.nzEditIcon="edit",this.nzEllipsisRows=1,this.nzContentChange=new Re,this.nzCopy=new Re,this.nzExpandChange=new Re,this.nzOnEllipsis=new Re,this.expandableBtnElementCache=null,this.editing=!1,this.cssEllipsis=!1,this.isEllipsis=!0,this.expanded=!1,this.ellipsisStr="...",this.dir="ltr",this.viewInit=!1,this.rfaId=-1,this.destroy$=new He,this.windowResizeSubscription=Vi.EMPTY,this.document=c}get hasEllipsisObservers(){return this.nzOnEllipsis.observers.length>0}get canCssEllipsis(){return this.nzEllipsis&&this.cssEllipsis&&!this.expanded&&!this.hasEllipsisObservers}get hasOperationsWithEllipsis(){return(this.nzCopyable||this.nzEditable||this.nzExpandable)&&this.nzEllipsis}get copyText(){return"string"==typeof this.nzCopyText?this.nzCopyText:this.nzContent}onTextCopy(i){this.nzCopy.emit(i)}onStartEditing(){this.editing=!0}onEndEditing(i){this.editing=!1,this.nzContentChange.emit(i),this.nzContent===i&&this.renderOnNextFrame(),this.cdr.markForCheck()}onExpand(){this.isEllipsis=!1,this.expanded=!0,this.nzExpandChange.emit(),this.nzOnEllipsis.emit(!1)}canUseCSSEllipsis(){return!(this.nzEditable||this.nzCopyable||this.nzExpandable||this.nzSuffix||this.hasEllipsisObservers)&&function WQ(e){if(typeof window<"u"&&window.document&&window.document.documentElement){const t=Array.isArray(e)?e:[e],{documentElement:i}=window.document;return t.some(n=>n in i.style)}return!1}(1===this.nzEllipsisRows?"textOverflow":"webkitLineClamp")}renderOnNextFrame(){_E(this.rfaId),this.viewInit&&this.nzEllipsis&&!(this.nzEllipsisRows<0)&&!this.expanded&&this.platform.isBrowser&&(this.rfaId=p3(()=>{this.syncEllipsis()}))}getOriginContentViewRef(){const i=this.viewContainerRef.createEmbeddedView(this.contentTemplate,{content:this.nzContent});return i.detectChanges(),{viewRef:i,removeView:()=>{this.viewContainerRef.remove(this.viewContainerRef.indexOf(i))}}}syncEllipsis(){if(this.cssEllipsis)return;const{viewRef:i,removeView:n}=this.getOriginContentViewRef(),r=[this.textCopyRef,this.textEditRef].filter(h=>h&&h.nativeElement).map(h=>h.nativeElement),o=this.getExpandableBtnElement();o&&r.push(o);const{contentNodes:s,text:a,ellipsis:l}=eRe(this.host.nativeElement,this.nzEllipsisRows,i.rootNodes,r,this.ellipsisStr,this.nzSuffix);n(),this.ellipsisText=a,l!==this.isEllipsis&&(this.isEllipsis=l,this.nzOnEllipsis.emit(l));const c=this.ellipsisContainer.nativeElement;for(;c.firstChild;)this.renderer.removeChild(c,c.firstChild);s.forEach(h=>{this.renderer.appendChild(c,h.cloneNode(!0))}),this.cdr.markForCheck()}getExpandableBtnElement(){if(this.nzExpandable){const i=this.locale?this.locale.expand:"",n=this.expandableBtnElementCache;if(!n||n.innerText===i){const r=this.document.createElement("a");r.className="ant-typography-expand",r.innerText=i,this.expandableBtnElementCache=r}return this.expandableBtnElementCache}return this.expandableBtnElementCache=null,null}renderAndSubscribeWindowResize(){this.platform.isBrowser&&(this.windowResizeSubscription.unsubscribe(),this.cssEllipsis=this.canUseCSSEllipsis(),this.renderOnNextFrame(),this.windowResizeSubscription=this.resizeService.subscribe().pipe(Ye(this.destroy$)).subscribe(()=>this.renderOnNextFrame()))}ngOnInit(){this.i18n.localeChange.pipe(Ye(this.destroy$)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.cdr.markForCheck()}),this.directionality.change?.pipe(Ye(this.destroy$)).subscribe(i=>{this.dir=i,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngAfterViewInit(){this.viewInit=!0,this.renderAndSubscribeWindowResize()}ngOnChanges(i){const{nzCopyable:n,nzEditable:r,nzExpandable:o,nzEllipsis:s,nzContent:a,nzEllipsisRows:l,nzSuffix:c}=i;(n||r||o||s||a||l||c)&&this.nzEllipsis&&(this.expanded?this.windowResizeSubscription.unsubscribe():this.renderAndSubscribeWindowResize())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.expandableBtnElementCache=null,this.windowResizeSubscription.unsubscribe()}}return e.\u0275fac=function(i){return new(i||e)(L(Va),L(yt),L(Ri),L($n),L(Nn),L(Qr),L(G4),L(_i),L(ZT),L(Vn,8))},e.\u0275cmp=ut({type:e,selectors:[["nz-typography"],["","nz-typography",""],["p","nz-paragraph",""],["span","nz-text",""],["h1","nz-title",""],["h2","nz-title",""],["h3","nz-title",""],["h4","nz-title",""]],viewQuery:function(i,n){if(1&i&&(Ui(kK,5),Ui(OK,5),Ui(AGe,5),Ui(PGe,5),Ui(IGe,5)),2&i){let r;Mt(r=zt())&&(n.textEditRef=r.first),Mt(r=zt())&&(n.textCopyRef=r.first),Mt(r=zt())&&(n.ellipsisContainer=r.first),Mt(r=zt())&&(n.expandableBtn=r.first),Mt(r=zt())&&(n.contentTemplate=r.first)}},hostVars:26,hostBindings:function(i,n){2&i&&(Xn("-webkit-line-clamp",n.canCssEllipsis&&n.nzEllipsisRows>1?n.nzEllipsisRows:null),Dt("ant-typography",!n.editing)("ant-typography-rtl","rtl"===n.dir)("ant-typography-edit-content",n.editing)("ant-typography-secondary","secondary"===n.nzType)("ant-typography-warning","warning"===n.nzType)("ant-typography-danger","danger"===n.nzType)("ant-typography-success","success"===n.nzType)("ant-typography-disabled",n.nzDisabled)("ant-typography-ellipsis",n.nzEllipsis&&!n.expanded)("ant-typography-single-line",n.nzEllipsis&&1===n.nzEllipsisRows)("ant-typography-ellipsis-single-line",n.canCssEllipsis&&1===n.nzEllipsisRows)("ant-typography-ellipsis-multiple-line",n.canCssEllipsis&&n.nzEllipsisRows>1))},inputs:{nzCopyable:"nzCopyable",nzEditable:"nzEditable",nzDisabled:"nzDisabled",nzExpandable:"nzExpandable",nzEllipsis:"nzEllipsis",nzCopyTooltips:"nzCopyTooltips",nzCopyIcons:"nzCopyIcons",nzEditTooltip:"nzEditTooltip",nzEditIcon:"nzEditIcon",nzContent:"nzContent",nzEllipsisRows:"nzEllipsisRows",nzType:"nzType",nzCopyText:"nzCopyText",nzSuffix:"nzSuffix"},outputs:{nzContentChange:"nzContentChange",nzCopy:"nzCopy",nzExpandChange:"nzExpandChange",nzOnEllipsis:"nzOnEllipsis"},exportAs:["nzTypography"],features:[Ht],ngContentSelectors:WGe,decls:5,vars:3,consts:[["contentTemplate",""],[4,"ngIf"],[3,"text","icon","tooltip","endEditing","startEditing",4,"ngIf"],[3,"text","tooltips","icons","textCopy",4,"ngIf"],[4,"ngIf","ngIfElse"],["jsEllipsis",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["ellipsisContainer",""],["class","ant-typography-expand",3,"click",4,"ngIf"],[1,"ant-typography-expand",3,"click"],["expandable",""],[3,"text","icon","tooltip","endEditing","startEditing"],[3,"text","tooltips","icons","textCopy"]],template:function(i,n){1&i&&(Ln(),ne(0,kGe,2,2,"ng-template",null,0,jn),ne(2,jGe,4,2,"ng-container",1),ne(3,YGe,1,3,"nz-text-edit",2),ne(4,GGe,1,3,"nz-text-copy",3)),2&i&&(ie(2),X("ngIf",!n.editing),ie(1),X("ngIf",n.nzEditable),ie(1),X("ngIf",n.nzCopyable&&!n.editing))},dependencies:[Fi,as,OK,kK],encapsulation:2,changeDetection:0}),Qe([ft()],e.prototype,"nzCopyable",void 0),Qe([ft()],e.prototype,"nzEditable",void 0),Qe([ft()],e.prototype,"nzDisabled",void 0),Qe([ft()],e.prototype,"nzExpandable",void 0),Qe([ft()],e.prototype,"nzEllipsis",void 0),Qe([mo()],e.prototype,"nzCopyTooltips",void 0),Qe([mo()],e.prototype,"nzCopyIcons",void 0),Qe([mo()],e.prototype,"nzEditTooltip",void 0),Qe([mo()],e.prototype,"nzEditIcon",void 0),Qe([mo(),JT()],e.prototype,"nzEllipsisRows",void 0),e})(),QGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,go,IE,vE,Vy,SGe,CGe,Zr,Hs]}),e})(),ZGe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=ut({type:e,selectors:[["app-navbar"]],decls:9,vars:0,consts:[[1,"float-md-start","mb-0"],["nz-typography",""],["nz-typography","","nzType","secondary"],[1,"nav","nav-masthead","justify-content-center","float-md-end",2,"font-size","20px"]],template:function(i,n){1&i&&(Ee(0,"header")(1,"div")(2,"h3",0)(3,"span",1),zi(4,"Hans L\xf3pez"),Pe(),Ee(5,"h6")(6,"span",2),zi(7,"Desarrollador Fullstack"),Pe()()(),Je(8,"nav",3),Pe()())},dependencies:[$Ge],styles:[".nav-masthead[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#ffffff80;border-bottom:.25rem solid transparent}.nav-masthead[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover, .nav-masthead[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:focus{border-bottom-color:#ffffff40}.nav-masthead[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%] + .nav-link[_ngcontent-%COMP%]{margin-left:1rem}.nav-masthead[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:#fff;border-bottom-color:#fff}"]}),e})(),KGe=0;class JGe{constructor(t,i,n){this.nzSingletonService=t,this.overlay=i,this.injector=n}remove(t){this.container&&(t?this.container.remove(t):this.container.removeAll())}getInstanceId(){return`${this.componentPrefix}-${KGe++}`}withContainer(t){let i=this.nzSingletonService.getSingletonWithKey(this.componentPrefix);if(i)return i;const n=this.overlay.create({hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.noop(),positionStrategy:this.overlay.position().global()}),r=new YT(t,null,this.injector),o=n.attach(r);return n.overlayElement.style.zIndex="1010",i||(this.container=i=o.instance,this.nzSingletonService.registerSingletonWithKey(this.componentPrefix,i)),i}}let eWe=(()=>{class e{constructor(i,n){this.cdr=i,this.nzConfigService=n,this.instances=[],this.destroy$=new He,this.updateConfig()}ngOnInit(){this.subscribeConfigChange()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}create(i){const n=this.onCreate(i);return this.instances.length>=this.config.nzMaxStack&&(this.instances=this.instances.slice(1)),this.instances=[...this.instances,n],this.readyInstances(),n}remove(i,n=!1){this.instances.some((r,o)=>r.messageId===i&&(this.instances.splice(o,1),this.instances=[...this.instances],this.onRemove(r,n),this.readyInstances(),!0))}removeAll(){this.instances.forEach(i=>this.onRemove(i,!1)),this.instances=[],this.readyInstances()}onCreate(i){return i.options=this.mergeOptions(i.options),i.onClose=new He,i}onRemove(i,n){i.onClose.next(n),i.onClose.complete()}readyInstances(){this.cdr.detectChanges()}mergeOptions(i){const{nzDuration:n,nzAnimate:r,nzPauseOnHover:o}=this.config;return{nzDuration:n,nzAnimate:r,nzPauseOnHover:o,...i}}}return e.\u0275fac=function(i){return new(i||e)(L(Ri),L(Va))},e.\u0275dir=Ge({type:e}),e})(),tWe=(()=>{class e{constructor(i){this.cdr=i,this.destroyed=new Re,this.animationStateChanged=new He,this.userAction=!1,this.eraseTimer=null}ngOnInit(){this.options=this.instance.options,this.options.nzAnimate&&(this.instance.state="enter",this.animationStateChanged.pipe(rn(i=>"done"===i.phaseName&&"leave"===i.toState),Fr(1)).subscribe(()=>{clearTimeout(this.closeTimer),this.destroyed.next({id:this.instance.messageId,userAction:this.userAction})})),this.autoClose=this.options.nzDuration>0,this.autoClose&&(this.initErase(),this.startEraseTimeout())}ngOnDestroy(){this.autoClose&&this.clearEraseTimeout(),this.animationStateChanged.complete()}onEnter(){this.autoClose&&this.options.nzPauseOnHover&&(this.clearEraseTimeout(),this.updateTTL())}onLeave(){this.autoClose&&this.options.nzPauseOnHover&&this.startEraseTimeout()}destroy(i=!1){this.userAction=i,this.options.nzAnimate?(this.instance.state="leave",this.cdr.detectChanges(),this.closeTimer=setTimeout(()=>{this.closeTimer=void 0,this.destroyed.next({id:this.instance.messageId,userAction:i})},200)):this.destroyed.next({id:this.instance.messageId,userAction:i})}initErase(){this.eraseTTL=this.options.nzDuration,this.eraseTimingStart=Date.now()}updateTTL(){this.autoClose&&(this.eraseTTL-=Date.now()-this.eraseTimingStart)}startEraseTimeout(){this.eraseTTL>0?(this.clearEraseTimeout(),this.eraseTimer=setTimeout(()=>this.destroy(),this.eraseTTL),this.eraseTimingStart=Date.now()):this.destroy()}clearEraseTimeout(){null!==this.eraseTimer&&(clearTimeout(this.eraseTimer),this.eraseTimer=null)}}return e.\u0275fac=function(i){return new(i||e)(L(Ri))},e.\u0275dir=Ge({type:e}),e})();function iWe(e,t){1&e&&Je(0,"span",16)}function nWe(e,t){1&e&&Je(0,"span",17)}function rWe(e,t){1&e&&Je(0,"span",18)}function oWe(e,t){1&e&&Je(0,"span",19)}const sWe=function(e){return{"ant-notification-notice-with-icon":e}};function aWe(e,t){if(1&e&&(Ee(0,"div",7)(1,"div",8)(2,"div"),Yt(3,9),ne(4,iWe,1,0,"span",10),ne(5,nWe,1,0,"span",11),ne(6,rWe,1,0,"span",12),ne(7,oWe,1,0,"span",13),Gt(),Je(8,"div",14)(9,"div",15),Pe()()()),2&e){const i=de();ie(1),X("ngClass",Cg(10,sWe,"blank"!==i.instance.type)),ie(1),Dt("ant-notification-notice-with-icon","blank"!==i.instance.type),ie(1),X("ngSwitch",i.instance.type),ie(1),X("ngSwitchCase","success"),ie(1),X("ngSwitchCase","info"),ie(1),X("ngSwitchCase","warning"),ie(1),X("ngSwitchCase","error"),ie(1),X("innerHTML",i.instance.title,m_),ie(1),X("innerHTML",i.instance.content,m_)}}function lWe(e,t){}function cWe(e,t){if(1&e&&(Yt(0),Je(1,"span",21),Gt()),2&e){const i=t.$implicit;ie(1),X("nzType",i)}}function hWe(e,t){if(1&e&&(Yt(0),ne(1,cWe,2,1,"ng-container",20),Gt()),2&e){const i=de();ie(1),X("nzStringTemplateOutlet",null==i.instance.options?null:i.instance.options.nzCloseIcon)}}function uWe(e,t){1&e&&Je(0,"span",22)}const dWe=function(e,t){return{$implicit:e,data:t}};function pWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","topLeft")}function fWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","topRight")}function mWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","bottomLeft")}function gWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","bottomRight")}function vWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","top")}function yWe(e,t){if(1&e){const i=Ji();Ee(0,"nz-notification",7),pt("destroyed",function(r){return ai(i),li(de().remove(r.id,r.userAction))}),Pe()}2&e&&X("instance",t.$implicit)("placement","bottom")}let _We=(()=>{class e extends tWe{constructor(i){super(i),this.destroyed=new Re}ngOnDestroy(){super.ngOnDestroy(),this.instance.onClick.complete()}onClick(i){this.instance.onClick.next(i)}close(){this.destroy(!0)}get state(){if("enter"!==this.instance.state)return this.instance.state;switch(this.placement){case"topLeft":case"bottomLeft":return"enterLeft";case"topRight":case"bottomRight":default:return"enterRight";case"top":return"enterTop";case"bottom":return"enterBottom"}}}return e.\u0275fac=function(i){return new(i||e)(L(Ri))},e.\u0275cmp=ut({type:e,selectors:[["nz-notification"]],inputs:{instance:"instance",index:"index",placement:"placement"},outputs:{destroyed:"destroyed"},exportAs:["nzNotification"],features:[Ci],decls:8,vars:12,consts:[[1,"ant-notification-notice","ant-notification-notice-closable",3,"ngStyle","ngClass","click","mouseenter","mouseleave"],["class","ant-notification-notice-content",4,"ngIf"],[3,"ngIf","ngTemplateOutlet","ngTemplateOutletContext"],["tabindex","0",1,"ant-notification-notice-close",3,"click"],[1,"ant-notification-notice-close-x"],[4,"ngIf","ngIfElse"],["iconTpl",""],[1,"ant-notification-notice-content"],[1,"ant-notification-notice-content",3,"ngClass"],[3,"ngSwitch"],["nz-icon","","nzType","check-circle","class","ant-notification-notice-icon ant-notification-notice-icon-success",4,"ngSwitchCase"],["nz-icon","","nzType","info-circle","class","ant-notification-notice-icon ant-notification-notice-icon-info",4,"ngSwitchCase"],["nz-icon","","nzType","exclamation-circle","class","ant-notification-notice-icon ant-notification-notice-icon-warning",4,"ngSwitchCase"],["nz-icon","","nzType","close-circle","class","ant-notification-notice-icon ant-notification-notice-icon-error",4,"ngSwitchCase"],[1,"ant-notification-notice-message",3,"innerHTML"],[1,"ant-notification-notice-description",3,"innerHTML"],["nz-icon","","nzType","check-circle",1,"ant-notification-notice-icon","ant-notification-notice-icon-success"],["nz-icon","","nzType","info-circle",1,"ant-notification-notice-icon","ant-notification-notice-icon-info"],["nz-icon","","nzType","exclamation-circle",1,"ant-notification-notice-icon","ant-notification-notice-icon-warning"],["nz-icon","","nzType","close-circle",1,"ant-notification-notice-icon","ant-notification-notice-icon-error"],[4,"nzStringTemplateOutlet"],["nz-icon","",3,"nzType"],["nz-icon","","nzType","close",1,"ant-notification-close-icon"]],template:function(i,n){if(1&i&&(Ee(0,"div",0),pt("@notificationMotion.done",function(o){return n.animationStateChanged.next(o)})("click",function(o){return n.onClick(o)})("mouseenter",function(){return n.onEnter()})("mouseleave",function(){return n.onLeave()}),ne(1,aWe,10,12,"div",1),ne(2,lWe,0,0,"ng-template",2),Ee(3,"a",3),pt("click",function(){return n.close()}),Ee(4,"span",4),ne(5,hWe,2,1,"ng-container",5),ne(6,uWe,1,0,"ng-template",null,6,jn),Pe()()()),2&i){const r=gn(7);X("ngStyle",(null==n.instance.options?null:n.instance.options.nzStyle)||null)("ngClass",(null==n.instance.options?null:n.instance.options.nzClass)||"")("@notificationMotion",n.state),ie(1),X("ngIf",!n.instance.template),ie(1),X("ngIf",n.instance.template)("ngTemplateOutlet",n.instance.template)("ngTemplateOutletContext",Sg(9,dWe,n,null==n.instance.options?null:n.instance.options.nzData)),ie(3),X("ngIf",null==n.instance.options?null:n.instance.options.nzCloseIcon)("ngIfElse",r)}},dependencies:[Nm,Fi,as,Tp,Kh,zp,ko,vo],encapsulation:2,data:{animation:[kBe]}}),e})();const X5="notification",bWe={nzTop:"24px",nzBottom:"24px",nzPlacement:"topRight",nzDuration:4500,nzMaxStack:7,nzPauseOnHover:!0,nzAnimate:!0,nzDirection:"ltr"};let xWe=(()=>{class e extends eWe{constructor(i,n){super(i,n),this.dir="ltr",this.instances=[],this.topLeftInstances=[],this.topRightInstances=[],this.bottomLeftInstances=[],this.bottomRightInstances=[],this.topInstances=[],this.bottomInstances=[];const r=this.nzConfigService.getConfigForComponent(X5);this.dir=r?.nzDirection||"ltr"}create(i){const n=this.onCreate(i),r=n.options.nzKey,o=this.instances.find(s=>s.options.nzKey===i.options.nzKey);return r&&o?this.replaceNotification(o,n):(this.instances.length>=this.config.nzMaxStack&&(this.instances=this.instances.slice(1)),this.instances=[...this.instances,n]),this.readyInstances(),n}onCreate(i){return i.options=this.mergeOptions(i.options),i.onClose=new He,i.onClick=new He,i}subscribeConfigChange(){this.nzConfigService.getConfigChangeEventForComponent(X5).pipe(Ye(this.destroy$)).subscribe(()=>{this.updateConfig();const i=this.nzConfigService.getConfigForComponent(X5);if(i){const{nzDirection:n}=i;this.dir=n||this.dir}})}updateConfig(){this.config={...bWe,...this.config,...this.nzConfigService.getConfigForComponent(X5)},this.top=O5(this.config.nzTop),this.bottom=O5(this.config.nzBottom),this.cdr.markForCheck()}replaceNotification(i,n){i.title=n.title,i.content=n.content,i.template=n.template,i.type=n.type,i.options=n.options}readyInstances(){const i={topLeft:[],topRight:[],bottomLeft:[],bottomRight:[],top:[],bottom:[]};this.instances.forEach(n=>{switch(n.options.nzPlacement){case"topLeft":i.topLeft.push(n);break;case"topRight":default:i.topRight.push(n);break;case"bottomLeft":i.bottomLeft.push(n);break;case"bottomRight":i.bottomRight.push(n);break;case"top":i.top.push(n);break;case"bottom":i.bottom.push(n)}}),this.topLeftInstances=i.topLeft,this.topRightInstances=i.topRight,this.bottomLeftInstances=i.bottomLeft,this.bottomRightInstances=i.bottomRight,this.topInstances=i.top,this.bottomInstances=i.bottom,this.cdr.detectChanges()}mergeOptions(i){const{nzDuration:n,nzAnimate:r,nzPauseOnHover:o,nzPlacement:s}=this.config;return{nzDuration:n,nzAnimate:r,nzPauseOnHover:o,nzPlacement:s,...i}}}return e.\u0275fac=function(i){return new(i||e)(L(Ri),L(Va))},e.\u0275cmp=ut({type:e,selectors:[["nz-notification-container"]],exportAs:["nzNotificationContainer"],features:[Ci],decls:12,vars:46,consts:[[1,"ant-notification","ant-notification-topLeft"],[3,"instance","placement","destroyed",4,"ngFor","ngForOf"],[1,"ant-notification","ant-notification-topRight"],[1,"ant-notification","ant-notification-bottomLeft"],[1,"ant-notification","ant-notification-bottomRight"],[1,"ant-notification","ant-notification-top"],[1,"ant-notification","ant-notification-bottom"],[3,"instance","placement","destroyed"]],template:function(i,n){1&i&&(Ee(0,"div",0),ne(1,pWe,1,2,"nz-notification",1),Pe(),Ee(2,"div",2),ne(3,fWe,1,2,"nz-notification",1),Pe(),Ee(4,"div",3),ne(5,mWe,1,2,"nz-notification",1),Pe(),Ee(6,"div",4),ne(7,gWe,1,2,"nz-notification",1),Pe(),Ee(8,"div",5),ne(9,vWe,1,2,"nz-notification",1),Pe(),Ee(10,"div",6),ne(11,yWe,1,2,"nz-notification",1),Pe()),2&i&&(Xn("top",n.top)("left","0px"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.topLeftInstances),ie(1),Xn("top",n.top)("right","0px"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.topRightInstances),ie(1),Xn("bottom",n.bottom)("left","0px"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.bottomLeftInstances),ie(1),Xn("bottom",n.bottom)("right","0px"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.bottomRightInstances),ie(1),Xn("top",n.top)("left","50%")("transform","translateX(-50%)"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.topInstances),ie(1),Xn("bottom",n.bottom)("left","50%")("transform","translateX(-50%)"),Dt("ant-notification-rtl","rtl"===n.dir),ie(1),X("ngForOf",n.bottomInstances))},dependencies:[Zh,_We],encapsulation:2,changeDetection:0}),e})(),NK=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({}),e})(),wWe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Xu,go,Zr,NK]}),e})(),CWe=0,SWe=(()=>{class e extends JGe{constructor(i,n,r){super(i,n,r),this.componentPrefix="notification-"}success(i,n,r){return this.createInstance({type:"success",title:i,content:n},r)}error(i,n,r){return this.createInstance({type:"error",title:i,content:n},r)}info(i,n,r){return this.createInstance({type:"info",title:i,content:n},r)}warning(i,n,r){return this.createInstance({type:"warning",title:i,content:n},r)}blank(i,n,r){return this.createInstance({type:"blank",title:i,content:n},r)}create(i,n,r,o){return this.createInstance({type:i,title:n,content:r},o)}template(i,n){return this.createInstance({template:i},n)}generateMessageId(){return`${this.componentPrefix}-${CWe++}`}createInstance(i,n){return this.container=this.withContainer(xWe),this.container.create({...i,createdAt:new Date,messageId:this.generateMessageId(),options:n})}}return e.\u0275fac=function(i){return new(i||e)(he(HLe),he(k0),he(Bo))},e.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:NK}),e})();function MWe(e,t){if(1&e&&Je(0,"nz-option",9),2&e){const i=t.$implicit;X("nzValue",i.value)("nzLabel",i.name)}}let zWe=(()=>{class e{constructor(i,n,r,o,s){this.sanitizer=i,this.app=n,this.themeService=r,this.notification=o,this.translateService=s,this.language=[{value:"es",name:"Espa\xf1ol"},{value:"en",name:"English"}],this.linkedin=i.bypassSecurityTrustUrl("https://www.linkedin.com/in/hnslopez/"),this.github=i.bypassSecurityTrustUrl("https://github.com/hnslopez"),this.mail=i.bypassSecurityTrustUrl("https://github.com/hnslopez")}trackByValue(i,n){return n.value}languageChange(i){var n=this;return(0,Dn.Z)(function*(){n.app.switchLanguage(i);const r=n.translateService.instant("components.notification.changeLanguage.title"),o=n.translateService.instant("components.notification.changeLanguage.description");yield n.notification.create("success",r,o)})()}ngOnInit(){const i=localStorage.getItem("locale");this.selectedValue=i||"es",this.year=(new Date).getFullYear()}}return e.\u0275fac=function(i){return new(i||e)(L(Zg),L(Oz),L(hQ),L(SWe),L(Fy))},e.\u0275cmp=ut({type:e,selectors:[["app-footer"]],decls:21,vars:8,consts:[[1,"py-3","text-center"],[1,"text-center","container"],["nzType","vertical"],["nz-button","","nzType","link","target","_blank",3,"href"],["id","icon","nz-icon","","nzType","github","nzTheme","fill"],["id","icon","nz-icon","","nzType","linkedin","nzTheme","fill"],["nz-icon","","nzType","mail","nzTheme","outline"],["nzPlaceHolder","Language","nzBorderless","",3,"nzSuffixIcon","ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf","ngForTrackBy"],[3,"nzValue","nzLabel"]],template:function(i,n){1&i&&(Ee(0,"div",0)(1,"div",1)(2,"span"),zi(3),Pe(),Je(4,"nz-divider",2),Ee(5,"span")(6,"a",3),zi(7," Github "),Je(8,"span",4),Pe(),Je(9,"nz-divider",2),Ee(10,"a",3),zi(11," Linkedin "),Je(12,"span",5),Pe(),Je(13,"nz-divider",2),Ee(14,"a",3),zi(15," Mail "),Je(16,"span",6),Pe()(),Je(17,"nz-divider",2),Ee(18,"span")(19,"nz-select",7),pt("ngModelChange",function(o){return n.selectedValue=o})("ngModelChange",function(o){return n.languageChange(o)}),ne(20,MWe,1,2,"nz-option",8),Pe()()()()),2&i&&(ie(3),$a(" \xa9 ",n.year," "),ie(3),X("href",n.github,fd),ie(4),X("href",n.linkedin,fd),ie(4),X("href",n.mail,fd),ie(5),X("nzSuffixIcon","up")("ngModel",n.selectedValue),ie(1),X("ngForOf",n.language)("ngForTrackBy",n.trackByValue))},dependencies:[Zh,Rz,Ky,mVe,Zu,tYe,DK,eGe,ko]}),e})(),EWe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,Hs]}),e})();BT({passive:!0});let PWe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[un,ji,EWe,Hs]}),e})();!function xle(e,t,i){(function Wre(e,t,i){"string"!=typeof t&&(i=t,t=e[nt.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),_p[t]=e,i&&(_p[t][nt.ExtraData]=i)})(e,t,i)}(YPe);let IWe=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e,bootstrap:[Oz]}),e.\u0275inj=ht({providers:[mNe,{provide:nX,useValue:iX}],imports:[NN,Lde,tT,pOe,pNe,LPe.forRoot({loader:{provide:j4,useFactory:OWe,deps:[oT]}}),d3,vE,uBe,mGe,ME,JZ,yK,UHe,pK,KZ,iYe,tGe,yGe,bGe,GHe,Kje,Wje,aUe,rHe,uHe,IE,wHe,PWe,QGe,go,wWe]}),e})();function OWe(e){return new fNe(e,"./assets/i18n/",".json")}(function _D(e,t,i){const n=e.\u0275cmp;n.directiveDefs=z3(t,!1),n.pipeDefs=z3(i,!0)})(Oz,function(){return[fGe,Nb,ZGe,zWe]},[]),$ce().bootstrapModule(IWe).catch(e=>console.error(e))},861:(f3,m3,mn)=>{function wi(ed,jh,Vi,td,id,nd,Us){try{var Tl=ed[nd](Us),zc=Tl.value}catch(Yh){return void Vi(Yh)}Tl.done?jh(zc):Promise.resolve(zc).then(td,id)}function j0(ed){return function(){var jh=this,Vi=arguments;return new Promise(function(td,id){var nd=ed.apply(jh,Vi);function Us(zc){wi(nd,td,id,Us,Tl,"next",zc)}function Tl(zc){wi(nd,td,id,Us,Tl,"throw",zc)}Us(void 0)})}}mn.d(m3,{Z:()=>j0})}},f3=>{f3(f3.s=328)}]);